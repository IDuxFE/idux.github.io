import{c as x,b7 as ae,be as Fe,R as b,a_ as Ne,d as de,i as ke,bg as ne,q as te,f as A,br as Ke,cb as Be,j as De,aW as Te,as as ee,at as Le,bs as Me,bb as Ee,a7 as Pe,aO as Ve,aX as ze,aY as Re,x as $e,a4 as He,an as Oe,bu as we,af as We,bv as je,bS as Ge}from"./index-ab797f89.js";import{I as Ue}from"./index-7d963db4.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _e(e,n,t,o){return{mergedNodeMap:x(()=>{const c=new Map,d=se(e,e.dataSource,n.value,t.value,o.value);return le(d,c),c})}}function se(e,n,t,o,r,c){const{treeDisabled:d,loadChildren:i}=e;return n.map(I=>ue(I,t,o,r,d,!!i,c))}function ue(e,n,t,o,r,c,d){var h;const i=t(e),{check:I,drag:v,drop:u,select:g}=Xe(e,r),C=e[n],K=e[o],p=C==null?void 0:C.map(B=>ue(B,n,t,o,r,c,i));return{children:p,label:K,key:i,isLeaf:(h=e.isLeaf)!=null?h:!(p!=null&&p.length||c),parentKey:d,rawData:e,checkDisabled:I,dragDisabled:v,dropDisabled:u,selectDisabled:g}}function Xe(e,n){const t=e.disabled;if(ae(t))return{check:t,drag:t,drop:t,select:t};{let{drag:o,drop:r,select:c}=t!=null?t:{},d;if(n){const i=n(e);ae(i)?(d!=null||(d=i),o!=null||(o=i),r!=null||(r=i),c!=null||(c=i)):(o!=null||(o=i.drag),r!=null||(r=i.drop),c!=null||(c=i.select),d!=null||(d=i.select))}return{check:d,drag:o,drop:r,select:c}}}function le(e,n){e.forEach(t=>{const{key:o,children:r}=t;n.set(o,t),r&&le(r,n)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qe(e,n,t,o){const r=x(()=>Fe(n.value)),c=x(()=>{const u=o.value;return r.value.map(g=>u.get(g)).filter(Boolean)}),d=u=>{const g=e.multiple?u:u[0],C=Ne(n.value);g!==C&&(n.setValue(g),b(e.onChange,g,C))};return{selectedValue:r,selectedNodes:c,changeSelected:u=>{!e.multiple&&!u.length||d(u)},handleRemove:u=>{var g;(g=t.value)==null||g._handleCheck(u)},handleClear:u=>{d([]),b(e.onClear,u)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ie=Symbol("treeSelectToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ye=de({setup(){const{config:e,props:n,slots:t,locale:o,mergedPrefixCls:r,mergedChildrenKey:c,mergedGetKey:d,mergedLabelKey:i,mergedNodeMap:I,inputValue:v,setInputValue:u,treeRef:g,expandedKeys:C,setExpandedKeys:K,selectedValue:p,changeSelected:h,handleNodeClick:B}=ke(ie),[z,R]=ne(n,"loadedKeys",()=>[]),D=te(!1),$=x(()=>n.multiple&&n.checkable),W=x(()=>$.value?n.cascaderStrategy:"off"),j=(l,s,y)=>{const{onScrolledChange:m}=n;b(m,l,s,y.map(F=>F.rawData))},T=l=>{l.stopPropagation()},O=(l,s)=>{const{onCheck:y}=n;b(y,l,s),B()},G=(l,s)=>{var m;const{onSelect:y}=n;!n.multiple&&((m=p.value)==null?void 0:m[0])!==s.key&&b(y,l,s),B()},U=(l,s)=>{const{onExpand:y}=n;b(y,l,s)},H=(l,s)=>{const{onExpandedChange:y}=n;b(y,l,s),K(l)},w=l=>{var y,m;const s=D.value;s?(y=g.value)==null||y.expandAll():(m=g.value)==null||m.collapseAll(),D.value=!s,l.stopPropagation()},_=async(l,s)=>{const y=c.value,m=i.value,F=d.value,N=s[y],L=F(s),M=I.value,k=M.get(L);if(N.length&&k){const E=se(n,N,y,F,m,L);le(E,M),k.rawData[y]=N,k.children=E,R(l),b(n.onLoaded,l,s)}},X=x(()=>{var l;return(l=n.clearIcon)!=null?l:e.clearIcon}),q=l=>{const{value:s}=l.target;u(s),n.searchable&&b(n.onSearch,s)},Y=()=>{u(""),n.searchable&&b(n.onSearch,"")};return()=>{const{customAdditional:l,dataSource:s,draggable:y,draggableIcon:m,empty:F,expandIcon:N,multiple:L,leafLineIcon:M,virtual:k,virtualItemHeight:E,searchable:J,showLine:a,searchPlaceholder:f,onDragstart:S,onDragend:P,onDragenter:V,onDragleave:ye,onDragover:fe,onDrop:ge,onNodeClick:ve,onNodeContextmenu:pe,onScroll:he,onScrolledBottom:me,droppable:Se,treeDisabled:be,loadChildren:Ce,searchFn:Q,overlayRender:oe,overlayHeight:xe}=n,Ae=r.value,Ie={label:t.treeLabel,prefix:t.treePrefix,suffix:t.treeSuffix,leafLineIcon:t.leafLineIcon,empty:t.empty,expandIcon:t.expandIcon,draggableIcon:t.draggableIcon},Z=[A(Ue,{ref:g,blocked:!0,checkOnClick:!0,checkedKeys:p.value,customAdditional:l,expandedKeys:C.value,loadedKeys:z.value,labelKey:i.value,checkable:$.value,cascaderStrategy:W.value,childrenKey:c.value,dataSource:s,draggable:y,draggableIcon:m,droppable:Se,disabled:be,empty:F,expandIcon:N,getKey:d.value,height:xe,loadChildren:Ce,leafLineIcon:M,virtual:k,virtualItemHeight:E,selectable:L?"multiple":!0,selectedKeys:p.value,searchValue:Q!==!1?v.value:void 0,searchFn:Ke(Q)?Q:void 0,showLine:a,onClick:T,onCheck:O,onDragstart:S,onDragend:P,onDragenter:V,onDragleave:ye,onDragover:fe,onDrop:ge,onNodeClick:ve,onNodeContextmenu:pe,onExpand:U,onSelect:G,onLoaded:_,onCheckedChange:h,onSelectedChange:$.value?Be:h,onExpandedChange:H,onScroll:he,onScrolledBottom:me,onScrolledChange:j},Ie)];if(J==="overlay"){const re=v.value;Z.unshift(A("div",{class:`${Ae}-overlay-search-wrapper`},[A(De,{size:"xs",shape:"square",title:D.value?o.treeSelect.expandAll:o.treeSelect.collapseAll,icon:D.value?"expand-all":"collapse-all",onClick:w},null),A(Te,{clearable:!0,clearIcon:X.value,clearVisible:!!re,size:"sm",suffix:"search",value:re,placeholder:f,onClear:Y,onInput:q},null)]))}return A("div",{tabindex:-1},[oe?oe(Z):Z])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Je={control:{type:[String,Number,Object,Array],default:void 0},value:{type:null,default:void 0},open:{type:Boolean,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:{type:Function,default:void 0},empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},leafLineIcon:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},offset:Array,overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayTabindex:{type:Number,default:void 0},overlayMatchWidth:{type:[Boolean,String],default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},searchPlaceholder:{type:String,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},showLine:{type:Boolean,default:void 0},status:String,suffix:{type:String,default:void 0},treeDisabled:{type:Function,default:void 0},virtual:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:32},"onUpdate:value":[Function,Array],"onUpdate:open":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],onCheck:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onSearch:[Function,Array],onSelect:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array],overlayHeight:{type:Number,default:256}};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ce(e){const{fontSizeSm:n,heightMd:t,marginSizeSm:o,paddingSizeXs:r,paddingSizeSm:c,paddingSizeMd:d}=e;return{optionFontSize:n,optionHeight:t,optionPadding:`${c}px ${d}px`,optionMarginLeft:o,optionContainerPadding:`${r}px 0`,optionContainerTreeNodePadding:`0 0 0 ${d}px`,overlaySearchWrapperPadding:`${r}px ${d}px ${c}px`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Qe=(e,n)=>ce(e);/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ze=de({name:"IxTreeSelect",inheritAttrs:!1,props:Je,setup(e,{attrs:n,expose:t,slots:o}){const r=ee("common"),{globalHashId:c,hashId:d,registerToken:i}=Le("treeSelect");i(Qe);const I=ee("locale"),v=ee("treeSelect"),u=x(()=>`${r.prefixCls}-tree-select`),g=x(()=>{var a;return(a=e.childrenKey)!=null?a:v.childrenKey}),C=Me(e,v),K=x(()=>{var a;return(a=e.labelKey)!=null?a:v.labelKey}),p=te(),h=te(),[B,z]=Ee(""),R=()=>{var a;return(a=p.value)==null?void 0:a.focus()},D=()=>{var a;return(a=p.value)==null?void 0:a.blur()},$=()=>{var a;e.searchable==="overlay"?z(""):(a=p.value)==null||a.clearInput()},[W,j]=ne(e,"expandedKeys",()=>[]),{accessor:T,control:O}=Pe();Ve(O);const G=ze(e,v),U=Re(e,O),{mergedNodeMap:H}=_e(e,g,C,K),{selectedValue:w,selectedNodes:_,changeSelected:X,handleRemove:q,handleClear:Y}=qe(e,T,h,H),[l,s]=ne(e,"open",!1);t({focus:R,blur:D,collapseAll:()=>{var a;return(a=h.value)==null?void 0:a.collapseAll()},expandAll:()=>{var a;return(a=h.value)==null?void 0:a.expandAll()},scrollTo:a=>{var f;(f=h.value)==null||f.scrollTo(a)},getNode:a=>{var f;return h.value?h.value.getNode(a):(f=H.value.get(a))==null?void 0:f.rawData}}),$e(l,a=>{a&&R(),$()});const m=()=>{e.multiple||s(!1)},F=a=>{b(e.onFocus,a)},N=a=>{T.markAsBlurred(),b(e.onBlur,a)},L=a=>{R(),q(a)};He(ie,{props:e,slots:o,config:v,locale:I,mergedPrefixCls:u,mergedChildrenKey:g,mergedGetKey:C,mergedLabelKey:K,expandedKeys:W,mergedNodeMap:H,inputValue:B,setInputValue:z,treeRef:h,accessor:T,setExpandedKeys:j,overlayOpened:l,setOverlayOpened:s,handleNodeClick:m,selectedValue:w,changeSelected:X});const M=x(()=>{const{overlayClassName:a,multiple:f}=e,S=u.value;return Oe({[c.value]:!!c.value,[d.value]:!!d.value,[`${S}-overlay`]:!0,[`${S}-overlay-multiple`]:f,[a||""]:!!a})}),k=({focused:a,disabled:f,clearable:S,clearIcon:P,opened:V})=>[A(je,We({ref:p,class:u.value,allowInput:e.searchable===!0?"searchable":!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:S,clearIcon:P,dataSource:_.value,disabled:f,focused:a,maxLabel:e.maxLabel,multiple:e.multiple,opened:V,placeholder:e.placeholder,readonly:e.readonly,size:G.value,status:U.value,suffix:e.suffix,onClear:Y,onInputValueChange:z,onItemRemove:L},n),o)],E=a=>{const{spin:f}=e,S=ae(f)?{spinning:f}:f;return S?A(Ge,S,{default:()=>[a]}):a},J=()=>E(A(Ye,null,null));return()=>{var f,S,P,V;const a={autofocus:e.autofocus,clearable:e.clearable,clearIcon:e.clearIcon,disabled:T.disabled||e.readonly,overlayLazy:!1,readonly:e.readonly,value:w.value,open:l.value,offset:(f=e.offset)!=null?f:v.offset,overlayClassName:M.value,overlayContainer:(S=e.overlayContainer)!=null?S:v.overlayContainer,overlayContainerFallback:`.${u.value}-overlay-container`,overlayTabindex:(P=e.overlayTabindex)!=null?P:v.overlayTabindex,overlayMatchWidth:(V=e.overlayMatchWidth)!=null?V:v.overlayMatchWidth,"onUpdate:open":s,onFocus:F,onBlur:N};return A(we,a,{trigger:k,overlay:J})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const na=Ze;export{na as I};
