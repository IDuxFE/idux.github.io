import{a3 as q,a9 as J,u as M,v as K}from"./index.f300137b.js";import{i as Q,u as Z}from"./Input.04e38db2.js";import{e as m,N as W,x as O,w as H,aj as R,a4 as ee,H as te,h as oe,M as j,v as ne,y as x,a1 as ie,z as k}from"./vendor.6b73f509.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function G(e){const{boxSizing:t,paddingBottom:l,paddingTop:n,borderBottom:s,borderTop:u}=window.getComputedStyle(e),o=parseFloat(n),r=parseFloat(l),c=parseFloat(u),d=parseFloat(s);return{boxSizing:t,paddingSize:o+r,borderSize:c+d,paddingTop:o,paddingBottom:r,borderTop:c,borderBottom:d}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const D={height:"0","min-height":"0","max-height":"none",visibility:"hidden",overflow:"hidden",transition:"none"};function P(e,t,l=!0){let n;const s=e;s.__cdk_measure_textarea?n=s.__cdk_measure_textarea:(n=e.cloneNode(!1),l&&(s.__cdk_measure_textarea=n)),Object.keys(D).forEach(o=>{n.style.setProperty(o,D[o],"important")}),e.parentNode.appendChild(n);const u=t(n);return e.parentNode.removeChild(n),u}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function se(e){return m(()=>ae(e.value))}function ae(e){return!e||!e.parentNode?0:P(e,t=>{const l=t.rows,{paddingSize:n}=G(t);t.rows=1,t.value="x";const s=t.scrollHeight-n;return t.rows=l,s},!1)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const E=e=>oe(e)&&(j(e.minRows)||j(e.maxRows));function le(e,t){let l,n,s,u=!1,o,r;const c=m(()=>E(t.value)||ee(t.value)&&!!t.value),d=m(()=>E(t.value)?t.value.minRows:void 0),p=m(()=>E(t.value)?t.value.maxRows:void 0),v=se(e),b=m(()=>e.value?G(e.value):{paddingSize:0,borderSize:0,boxSizing:""});function T(){return P(e.value,a=>(a.value=e.value.value,a.scrollHeight,L(a.scrollHeight,b.value)))}function _(){return!e.value||!e.value.placeholder?0:(r||P(e.value,i=>{i.style.height="",i.value=i.placeholder,i.scrollHeight,r=L(i.scrollHeight,b.value)}),r)}function y(a=!1){if(!c.value||!v.value)return;const i=e.value,f=i.value;if(!a&&d.value===n&&f===l)return;i.style.lineHeight=`${v.value}px`;const S=Math.max(T(),_());i.style.height=`${S}px`,o=o!=null?o:i.style.overflow,i.style.overflow="hidden",te(()=>J(()=>{I(i),i.style.overflow=o!=null?o:"",o=void 0})),l=f,n=d.value}function $(){if(!e.value)return;const a=d.value&&v.value?d.value*v.value:null,i=a?`${V(a,b.value)}px`:"";e.value.style.maxHeight=i}function B(){if(!e.value)return;const a=p.value&&v.value?p.value*v.value:null,i=a?`${V(a,b.value)}px`:"";e.value.style.maxHeight=i}function I(a){const{selectionStart:i,selectionEnd:f}=a;u&&document.activeElement===a&&a.setSelectionRange(i,f)}function F(){s!==void 0&&e.value&&(e.value.style.height=s)}let z;const N=W(()=>{r=void 0,y(!0)},16);return O(()=>{const a=[H(e,()=>{e.value&&(s=e.value.style.height)},{immediate:!0}),H(t,()=>{c.value?y(!0):F()},{immediate:!0}),H(d,()=>{$()},{immediate:!0}),H(p,()=>{B()},{immediate:!0})],i=q(e,N);z=()=>{a.forEach(f=>f()),i()},u=!0}),R(()=>{z==null||z(),u=!1}),{resizeToFitContent:y,lineHeight:v,boxSizingData:b}}function L(e,t){const{borderSize:l,paddingSize:n,boxSizing:s}=t;return s==="border-box"?e+l:e-n}function V(e,t){const{borderSize:l,paddingSize:n,boxSizing:s}=t;return s==="border-box"?e+l+n:e+n}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ue={...Q,autoRows:{type:[Boolean,Object],default:void 0},computeCount:{type:Function,default:void 0},maxCount:{type:[Number,String],default:void 0},resize:{type:String,default:void 0},showCount:{type:Boolean,default:void 0}},me=ne({name:"IxTextarea",inheritAttrs:!1,props:ue,setup(e,{slots:t,expose:l,attrs:n}){const s=M("common"),u=m(()=>`${s.prefixCls}-textarea`),o=M("textarea"),{elementRef:r,accessor:c,mergedSize:d,mergedStatus:p,clearable:v,clearIcon:b,clearVisible:T,isFocused:_,isComposing:y,focus:$,blur:B,handleInput:I,handleCompositionStart:F,handleCompositionEnd:z,handleClear:N,syncValue:a}=Z(e,o);l({focus:$,blur:B});const i=m(()=>{const{showCount:h=o.showCount}=e,C=p.value,g=u.value,w={[g]:!0,[`${g}-${d.value}`]:!0,[`${g}-${C}`]:!!C,[`${g}-clearable`]:v.value,[`${g}-disabled`]:c.disabled,[`${g}-focused`]:_.value,[`${g}-with-count`]:h};return k([w,n.class])}),f=re(e,o,c),S=m(()=>{var h;return(h=e.autoRows)!=null?h:o.autoRows}),U=m(()=>{var C;const h=(C=e.resize)!=null?C:o.resize;return S.value?h==="horizontal"?"horizontal":"none":h}),X=m(()=>({resize:U.value})),{resizeToFitContent:A}=le(r,S);O(()=>{a(),H(()=>c.value,A,{immediate:!0})});const Y=h=>{I(h),y.value&&A()};return()=>{const{class:h,style:C,...g}=n,w=u.value;return x("span",{class:i.value,style:C,"data-count":f.value},[x("textarea",ie(g,{ref:r,class:`${w}-inner`,style:X.value,disabled:c.disabled,readonly:e.readonly,onInput:Y,onCompositionstart:F,onCompositionend:z}),null),v.value&&x("span",{class:k([`${w}-clear`,T.value?"visible":""]),onClick:N},[t.clearIcon?t.clearIcon():x(K,{name:b.value},null)])])}}});function re(e,t,l){return m(()=>{var r,c,d,p;const n=(r=e.showCount)!=null?r:t.showCount,s=(c=e.computeCount)!=null?c:t.computeCount,u=(d=e.maxCount)!=null?d:t.maxCount;let o="";if(n){const v=(p=l.value)!=null?p:"";o=v.length,s?o=s(v):u&&(o+=" / "+u)}return o})}export{me as T,P as m,le as u};
