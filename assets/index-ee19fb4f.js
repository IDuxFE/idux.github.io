import{N as Ae,m as C,al as oe,aP as Ie,c as Fe,ac as Ne,L as Y,ar as ke,K as Ke,r as Be,a9 as De,ad as Le,ae as Ee,as as Me,at as Re,au as Ve}from"./index-cbea949a.js";import{f as S,al as ne,t as Oe,v as re,i as Te,b as Z,y as A,a as Pe,w as ze,a2 as te,z as we,p as $e}from"./vendor-334c0a91.js";import{I as Ge}from"./index-868615e6.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ue(e,a,n,c){return{mergedNodeMap:S(()=>{const d=new Map,r=ce(e,e.dataSource,a.value,n.value,c.value);return ee(r,d),d})}}function ce(e,a,n,c,s,d){const{treeDisabled:r,loadChildren:u}=e;return a.map(b=>de(b,n,c,s,r,!!u,d))}function de(e,a,n,c,s,d,r){var N;const u=n(e),{check:b,drag:i,drop:f,select:v}=je(e,s),I=e[a],F=e[c],p=I==null?void 0:I.map(k=>de(k,a,n,c,s,d,u));return{children:p,label:F,key:u,isLeaf:(N=e.isLeaf)!=null?N:!(p!=null&&p.length||d),parentKey:r,rawData:e,checkDisabled:b,dragDisabled:i,dropDisabled:f,selectDisabled:v}}function je(e,a){const n=e.disabled;if(ne(n))return{check:n,drag:n,drop:n,select:n};{let{drag:c,drop:s,select:d}=n!=null?n:{},r;if(a){const u=a(e);ne(u)?(r!=null||(r=u),c!=null||(c=u),s!=null||(s=u),d!=null||(d=u)):(c!=null||(c=u.drag),s!=null||(s=u.drop),d!=null||(d=u.select),r!=null||(r=u.select))}return{check:r,drag:c,drop:s,select:d}}}function ee(e,a){e.forEach(n=>{const{key:c,children:s}=n;a.set(c,n),s&&ee(s,a)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function He(e,a,n){const c=S(()=>Ae(a.value)),s=S(()=>{const i=n.value;return c.value.map(f=>i.get(f)).filter(Boolean)}),d=i=>{const f=e.multiple?i:i[0],v=Oe(a.value);f!==v&&(a.setValue(f),C(e.onChange,f,v))};return{selectedValue:c,selectedNodes:s,changeSelected:i=>{!e.multiple&&!i.length||d(i)},handleRemove:i=>{d(c.value.filter(f=>i!==f))},handleClear:i=>{i.stopPropagation(),d([]),C(e.onClear,i)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const se=Symbol("treeSelectToken"),_e=re({setup(){const{config:e,props:a,slots:n,locale:c,mergedPrefixCls:s,mergedChildrenKey:d,mergedGetKey:r,mergedLabelKey:u,mergedNodeMap:b,inputValue:i,setInputValue:f,treeRef:v,expandedKeys:I,setExpandedKeys:F,selectedValue:p,changeSelected:N,handleNodeClick:k}=Te(se),[P,z]=oe(a,"loadedKeys",()=>[]),m=Z(!1),D=S(()=>a.multiple&&a.checkable),w=S(()=>D.value?a.cascaderStrategy:"off"),$=(t,o,y)=>{const{onScrolledChange:g}=a;C(g,t,o,y.map(x=>x.rawData))},V=t=>{t.stopPropagation()},O=(t,o)=>{const{onCheck:y}=a;C(y,t,o),k()},G=(t,o)=>{var g;const{onSelect:y}=a;!a.multiple&&((g=p.value)==null?void 0:g[0])!==o.key&&C(y,t,o),k()},U=(t,o)=>{const{onExpand:y}=a;C(y,t,o)},j=(t,o)=>{const{onExpandedChange:y}=a;C(y,t,o),F(t)},H=t=>{var y,g;const o=m.value;o?(y=v.value)==null||y.expandAll():(g=v.value)==null||g.collapseAll(),m.value=!o,t.stopPropagation()},_=async(t,o)=>{var E;const y=(E=o.children)!=null?E:[],g=o.key,x=b.value,K=x.get(g);if(y.length&&K){const M=d.value,R=ce(a,y,M,r.value,u.value,g);ee(R,x),K.rawData[M]=y,K.children=R,z(t),C(a.onLoaded,t,o)}},q=S(()=>{var t;return(t=a.clearIcon)!=null?t:e.clearIcon}),W=t=>{const{value:o}=t.target;f(o),a.searchable&&C(a.onSearch,o)},L=()=>f("");return()=>{const{customAdditional:t,dataSource:o,draggable:y,draggableIcon:g,empty:x,expandIcon:K,multiple:E,leafLineIcon:M,virtual:R,searchable:X,showLine:l,onDragstart:h,onDragend:B,onDragenter:T,onDragleave:ue,onDragover:ie,onDrop:ye,onNodeClick:fe,onNodeContextmenu:ve,onScroll:ge,onScrolledBottom:pe,droppable:he,treeDisabled:me,loadChildren:Se,searchFn:J,overlayRender:ae,overlayHeight:be}=a,Ce=s.value,xe={label:n.treeLabel,prefix:n.treePrefix,suffix:n.treeSuffix,leafLineIcon:n.leafLineIcon,empty:n.empty,expandIcon:n.expandIcon,draggableIcon:n.draggableIcon},Q=[A(Ge,{ref:v,blocked:!0,checkOnClick:!0,checkedKeys:p.value,customAdditional:t,expandedKeys:I.value,loadedKeys:P.value,labelKey:u.value,checkable:D.value,cascaderStrategy:w.value,childrenKey:d.value,dataSource:o,draggable:y,draggableIcon:g,droppable:he,disabled:me,empty:x,expandIcon:K,getKey:r.value,height:be,loadChildren:Se,leafLineIcon:M,virtual:R,selectable:E?"multiple":!0,selectedKeys:p.value,searchValue:J!==!1?i.value:void 0,searchFn:Pe(J)?J:void 0,showLine:l,onClick:V,onCheck:O,onDragstart:h,onDragend:B,onDragenter:T,onDragleave:ue,onDragover:ie,onDrop:ye,onNodeClick:fe,onNodeContextmenu:ve,onExpand:U,onSelect:G,onLoaded:_,onCheckedChange:N,onSelectedChange:D.value?Ie:N,onExpandedChange:j,onScroll:ge,onScrolledBottom:pe,onScrolledChange:$},xe)];if(X==="overlay"){const le=i.value;Q.unshift(A("div",{class:`${Ce}-overlay-search-wrapper`},[A(Fe,{size:"xs",shape:"square",title:m.value?c.treeSelect.expandAll:c.treeSelect.collapseAll,icon:m.value?"tree-expand":"tree-unexpand",onClick:H},null),A(Ne,{clearable:!0,clearIcon:q.value,clearVisible:!!le,size:"sm",suffix:"search",value:le,onClear:L,onInput:W},null)]))}return A("div",null,[ae?ae(Q):Q])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const qe={control:{type:[String,Number,Object,Array],default:void 0},value:{type:null,default:void 0},open:{type:Boolean,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:{type:Function,default:void 0},empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Array],default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},leafLineIcon:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},offset:Array,overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},size:{type:String,default:void 0},showLine:{type:Boolean,default:void 0},status:String,suffix:{type:String,default:void 0},treeDisabled:{type:Function,default:void 0},virtual:{type:Boolean,default:!1},"onUpdate:value":[Function,Array],"onUpdate:open":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],onCheck:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onSearch:[Function,Array],onSelect:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array],overlayHeight:{type:Number,default:256}},We=re({name:"IxTreeSelect",inheritAttrs:!1,props:qe,setup(e,{attrs:a,expose:n,slots:c}){const s=Y("common"),d=Y("locale"),r=Y("treeSelect"),u=S(()=>`${s.prefixCls}-tree-select`),b=S(()=>{var l;return(l=e.childrenKey)!=null?l:r.childrenKey}),i=ke(e,r),f=S(()=>{var l;return(l=e.labelKey)!=null?l:r.labelKey}),v=Z(),[I,F]=Ke(""),p=()=>{var l;return(l=v.value)==null?void 0:l.focus()},N=()=>{var l;return(l=v.value)==null?void 0:l.blur()},k=()=>{var l;e.searchable==="overlay"?F(""):(l=v.value)==null||l.clearInput()},[P,z]=oe(e,"expandedKeys",()=>[]),{accessor:m,control:D}=Be();De(D);const w=Le(e,r),$=Ee(e,D),{mergedNodeMap:V}=Ue(e,b,i,f),{selectedValue:O,selectedNodes:G,changeSelected:U,handleRemove:j,handleClear:H}=He(e,m,V),{overlayRef:_,overlayStyle:q,updateOverlay:W,overlayOpened:L,setOverlayOpened:t}=Me(e,r,v),o=Z();n({focus:p,blur:N,collapseAll:()=>{var l;return(l=o.value)==null?void 0:l.collapseAll()},expandAll:()=>{var l;return(l=o.value)==null?void 0:l.expandAll()},scrollTo:l=>{var h;(h=o.value)==null||h.scrollTo(l)},getNode:l=>{var h;return o.value?o.value.getNode(l):(h=V.value.get(l))==null?void 0:h.rawData}}),ze(L,l=>{l&&p(),k()});const g=()=>{e.searchable!=="overlay"&&p()},x=()=>{e.multiple?k():t(!1)},K=()=>m.markAsBlurred(),E=l=>{p(),j(l)};$e(se,{props:e,slots:c,config:r,locale:d,mergedPrefixCls:u,mergedChildrenKey:b,mergedGetKey:i,mergedLabelKey:f,expandedKeys:P,mergedNodeMap:V,inputValue:I,setInputValue:F,treeRef:o,accessor:m,setExpandedKeys:z,overlayOpened:L,setOverlayOpened:t,handleNodeClick:x,selectedValue:O,changeSelected:U});const M=S(()=>{const{overlayClassName:l,multiple:h}=e,B=u.value;return we({[`${B}-overlay`]:!0,[`${B}-overlay-multiple`]:h,[l||""]:!!l})}),R=()=>A(Ve,te({ref:v,className:u.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:r,dataSource:G.value,disabled:m.disabled,maxLabel:e.maxLabel,multiple:e.multiple,opened:L.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:w.value,status:$.value,suffix:e.suffix,value:O.value,onBlur:K,onClear:H,onInputValueChange:F,onItemRemove:E,onOpenedChange:t,onResize:W,onSearch:e.onSearch},a),c),X=()=>A(_e,{onClick:g},null);return()=>{var B,T;const l={class:M.value,style:q.value,clickOutside:!0,container:(B=e.overlayContainer)!=null?B:r.overlayContainer,containerFallback:`.${u.value}-overlay-container`,disabled:m.disabled||e.readonly,offset:(T=e.offset)!=null?T:r.offset,placement:"bottomStart",transitionName:`${s.prefixCls}-slide-auto`,trigger:"manual",triggerId:a.id,visible:L.value,"onUpdate:visible":t},h={default:R,content:X};return A(Re,te({ref:_},l),h)}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ye=We;export{Ye as I};
