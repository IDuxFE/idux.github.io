import{A as R,ao as ce,a9 as de,j as he,c as fe,aP as me,m as U,k as ge,ak as oe,O as _,M as Ce,aq as be,I as ye}from"./index-9cb41eac.js";import{t as ve,g as pe,I as xe}from"./index-d29e663e.js";import{u as X}from"./globalConfig-554a5005.js";import{I as ke}from"./index-80f92ab6.js";import{g as Te,f as se,m as J}from"./useTreeCheckState-6f6c6f23.js";import{I as ze}from"./index-05ef2efb.js";import{l as A,y as te,c as w,q as u,p as Z,w as N,f as M,r as ee,z as Se,D as we,a7 as Pe,b as Ie}from"./vendor-fe119cfa.js";import{u as Ve,a as Fe}from"./index-f8c9f5ab.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const O=Symbol("proTableToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Re(e,t){const{title:o,type:a}=e;return o||(a?t.layout[a]:"")}const Q=A({props:{columns:{type:Array,required:!0},checkedKeys:{type:Array,required:!0},searchValue:{type:String,default:void 0},title:{type:String,default:void 0},onDrop:{type:Function,required:!0},onFixedChange:{type:Function,required:!0},onVisibleChange:{type:Function,required:!0}},setup(e){const{locale:t,mergedPrefixCls:o}=te(O),a=w(()=>new Set(Te(e.columns,"children",d=>d.key,!0))),r=d=>{const i=new Set(d),s=new Set(e.checkedKeys.filter(n=>a.value.has(n)));d.forEach(n=>{s.has(n)&&(i.delete(n),s.delete(n))}),e.onVisibleChange(i,s)},c=d=>{const{dragNode:i,dropNode:s}=d,n=i==null?void 0:i.key,b=s==null?void 0:s.key;!n||!b||e.onDrop(d)},h=(d,i,s)=>{s.preventDefault(),s.stopImmediatePropagation(),e.onFixedChange(i,d)};return()=>{if(e.columns.length===0)return;const d=`${o.value}-layout-tool-tree`,{columns:i,searchValue:s,title:n}=e,{startPin:b,endPin:y,noPin:g}=t.table.layout,x={blocked:!0,cascaderStrategy:"child",checkable:!0,checkedKeys:e.checkedKeys,checkOnClick:!0,draggable:!0,dataSource:i,disabled:$e,empty:"",childrenKey:"children",getKey:"key",labelKey:"title",searchValue:s,searchFn:()=>!0,onCheckedChange:r,onDrop:c},z={label:({node:f})=>Re(f,t.table),suffix:({node:f})=>{if(f.changeFixed===!1||f.parentKey!=null)return null;const{fixed:k}=f;return k==="start"?[u(R,{name:"vertical-align-center",title:g,onClick:l=>h(void 0,f,l)},null),u(R,{name:"vertical-align-top",rotate:180,title:y,onClick:l=>h("end",f,l)},null)]:k==="end"?[u(R,{name:"vertical-align-top",title:b,onClick:l=>h("start",f,l)},null),u(R,{name:"vertical-align-center",title:g,onClick:l=>h(void 0,f,l)},null)]:[u(R,{name:"vertical-align-top",title:b,onClick:l=>h("start",f,l)},null),u(R,{name:"vertical-align-top",rotate:180,title:y,onClick:l=>h("end",f,l)},null)]}};return u("div",{class:d},[n&&u("div",{class:`${d}-title`},[n]),u(ze,x,z)])}}});function $e(e){const{changeIndex:t,changeVisible:o}=e;return t!==!1&&o!==!1?!1:{check:o===!1,select:o===!1,drag:t===!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ke={...ve,columns:{type:Array,default:()=>[]},layoutTool:{type:[Boolean,Object],default:!0},toolbar:{type:Array,default:void 0},onColumnsChange:[Function,Array]},Ae={changeSize:{type:Boolean,default:void 0},className:{type:String,default:void 0},placeholder:{type:String,default:void 0},resetable:{type:Boolean,default:void 0},searchable:{type:Boolean,default:void 0},searchValue:{type:String,default:void 0},visible:{type:Boolean,default:void 0},"onUpdate:searchValue":[Function,Array],"onUpdate:visible":[Function,Array],onReset:[Function,Array]},Le={placeholder:{type:String,default:void 0},resetable:{type:Boolean,required:!0},searchable:{type:Boolean,required:!0},searchValue:{type:String,default:void 0},"onUpdate:searchValue":[Function,Array],onReset:[Function,Array]};var D=function(e){return e[e.start=0]="start",e[e.center=1]="center",e[e.end=2]="end",e}(D||{});const Ee=A({props:Le,setup(e){const{locale:t,mergedPrefixCls:o,mergedColumns:a,checkedColumnKeys:r,setMergedColumns:c,mergedColumnMap:h,resetColumns:d}=te(O),i=w(()=>a.value.length!==h.value.size),s=w(()=>a.value.filter(m=>m.visible===!1)),[n,b]=ce(e,"searchValue"),y=w(()=>{var v;const m=(v=n.value)==null?void 0:v.toLowerCase();return se(a.value,"children",C=>{if(C.layoutable===!1)return!1;if(!m)return!0;const{title:p}=C;return p?p.toLowerCase().includes(m):!1})}),g=w(()=>Y(y.value)),x=m=>{const v=m.target.value;b(v)},z=m=>{U(e.onReset,m)!==!1&&d()},f=m=>{const v=J(a.value,"children",(C,p)=>{var I;const T={...C};return!((I=C.children)!=null&&I.length)&&C.changeVisible!==!1&&C.layoutable!==!1&&p.every(S=>S.layoutable!==!1)&&(T.visible=m),T});c(v)},k=(m,v)=>{const C=J(a.value,"children",(S,$)=>{const V={...S};return(S.key===m.key||$.some(F=>F.key===m.key))&&(V.fixed=v),V}),{startColumns:p,centerColumns:T,endColumns:I}=Y(C);c([...p,...T,...I])},l=(m,v)=>{const C=J(a.value,"children",p=>{const T={...p};return m.has(p.key)&&(T.visible=!0),v.has(p.key)&&(T.visible=!1),T});c(C)},P=(m,v)=>{const{dragNode:C,dropNode:p,dropType:T}=v,I=C==null?void 0:C.key,S=p==null?void 0:p.key;if(!I||!S)return;const{startColumns:$,centerColumns:V,endColumns:F}=Y(a.value),j=[$,V,F].reduce((L,E,G)=>G===m?L.concat(We(E,I,S,T)):L.concat(E),[]);c(j)};return()=>{var le;const{startColumns:m,centerColumns:v,endColumns:C}=g.value,p=m.length>0,T=C.length>0,I=p||T,S=`${o.value}-layout-tool`,$=Z({[`${S}-content`]:!0,[`${S}-with-fixed`]:I,[`${S}-with-children`]:i.value}),{placeholder:V,all:F,reset:j,startPinTitle:L,noPinTitle:E,endPinTitle:G}=t.table.layout,ne=a.value.length,H=s.value.length,ie=H===0&&ne!==0,ue=H>0&&H!==ne,W=n.value;return u("div",{class:$},[e.searchable&&u("div",{class:`${S}-search-wrapper`},[u(de,{placeholder:(le=e.placeholder)!=null?le:V,size:"sm",suffix:"search",value:W,onInput:x},null)]),u("div",{class:`${S}-select-wrapper`},[u(he,{checked:ie,indeterminate:ue,label:F,onChange:f},null),e.resetable&&u(fe,{size:"sm",mode:"link",onClick:z},{default:()=>[j]})]),y.value.length?u("div",{class:`${S}-tree-wrapper`},[p&&u(Q,{key:"start",columns:m,checkedKeys:r.value.start,searchValue:W,title:L,onDrop:K=>P(D.start,K),onFixedChange:k,onVisibleChange:l},null),(!I||v.length>0)&&u(Q,{key:"center",columns:v,checkedKeys:r.value.center,searchValue:W,title:I?E:void 0,onDrop:K=>P(D.center,K),onFixedChange:k,onVisibleChange:l},null),T&&u(Q,{key:"end",columns:C,checkedKeys:r.value.end,searchValue:W,title:G,onDrop:K=>P(D.end,K),onFixedChange:k,onVisibleChange:l},null)]):u(me,{simple:!0},null)])}}});function Y(e){const t=[],o=[],a=[];return e.forEach(r=>{const{fixed:c}=r;c==="start"?t.push(r):c==="end"?o.push(r):a.push(r)}),{startColumns:t,endColumns:o,centerColumns:a}}function We(e,t,o,a){const r=[...e];let c;if(q(r,t,(h,d,i)=>{c=h,i.splice(d,1)}),a==="inside")q(r,o,h=>{h.children.unshift(c)});else{let h,d=[];q(r,o,(i,s,n)=>{h=s,d=n}),a==="before"?d.splice(h,0,c):d.splice(h+1,0,c)}return r}function q(e,t,o){for(let a=0;a<e.length;a++){const r=e[a];if(r.key===t)return o(r,a,e);"children"in r&&r.children&&q(r.children,t,o)}}const Me=[0,4],De={sm:"grid-compact",md:"grid-medium",lg:"grid-loose"},re=A({name:"IxProTableLayoutTool",props:Ae,setup(e,{slots:t}){const{config:o,locale:a,mergedPrefixCls:r,mergedSize:c,setMergedSize:h}=te(O),d=w(()=>{var n;return(n=e.changeSize)!=null?n:o.layoutTool.changeSize}),i=w(()=>{var n;return(n=e.resetable)!=null?n:o.layoutTool.resetable}),s=w(()=>{var n;return(n=e.searchable)!=null?n:o.layoutTool.searchable});return()=>{var f;const n=`${r.value}-layout-tool`,b=a.table.layout,y=k=>{const l=De[k],P=b[k];return u(R,{key:l,class:Z([`${n}-header-icon`,c.value===k?`${n}-header-icon-active`:""]),name:l,title:P,onClick:()=>h(k)},null)},g=d.value?u(ge,null,{default:()=>[y("sm"),y("md"),y("lg")]}):void 0,x={placeholder:e.placeholder,resetable:i.value,searchable:s.value,searchValue:e.searchValue,"onUpdate:searchValue":e["onUpdate:searchValue"],onReset:e.onReset},z={class:Z([n,e.className]),header:{title:b.title,suffix:g},offset:Me,placement:"bottomEnd",showArrow:!1,trigger:"click",visible:e.visible,"onUpdate:visible":e["onUpdate:visible"]};return u(ke,z,{default:(f=t.default)!=null?f:()=>u("span",{class:`${n}-trigger`},[u(R,{name:"ellipsis"},null)]),content:()=>u(Ee,x,null)})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qe(e,t){const o=w(()=>e.columns),[a,r]=oe(B(o.value,t)),c=w(()=>{const n=new Map,b={start:[],center:[],end:[]},y=se(a.value,"children",(g,x)=>{var f;const z=g.key;return n.set(z,g),g.visible===!1||x.some(k=>k.visible===!1)?!1:(!((f=g.children)!=null&&f.length)&&g.layoutable!==!1&&x.every(k=>k.layoutable!==!1)&&(ae("start",g,x)?b.start.push(z):ae("end",g,x)?b.end.push(z):b.center.push(z)),!0)},"and");return{map:n,checkedKeys:b,displayColumns:y}}),h=w(()=>c.value.map),d=w(()=>c.value.checkedKeys),i=w(()=>c.value.displayColumns);return N(o,n=>r(B(n,t))),N(a,n=>U(e.onColumnsChange,n)),{checkedColumnKeys:d,mergedColumns:a,setMergedColumns:r,mergedColumnMap:h,displayColumns:i,resetColumns:()=>r(B(o.value,t))}}function B(e,t,o){return e.map(a=>Be(a,t,o))}function Be(e,t,o){var h;const a=pe(e),c={...e.type==="indexable"?t.columnIndexable:void 0,...e,key:a,parentKey:o};return(h=e.children)!=null&&h.length&&(c.children=B(e.children,t,a)),c}function ae(e,t,o){return t.fixed===e||o.some(a=>a.fixed===e)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ue({mergedColumns:e,setMergedColumns:t,mergedColumnMap:o}){return{hasResizable:w(()=>e.value.some(c=>c.resizable)),onResizeEnd:(c,h,d)=>{const i=o.value.get(c);if(!i)return;const s=i.width,n=M(s)?_(s.replace("px","")):s;if(!n)i.width=h;else{const b=h-d,y=Math.floor(n*h/b*1e3)/1e3,{minWidth:g,maxWidth:x}=i,z=M(g)?_(g.replace("px","")):g,f=M(x)?_(x.replace("px",""),Number.MAX_SAFE_INTEGER):x;z&&y<z?i.width=z:f&&y>f?i.width=f:i.width=y}t([...e.value])}}}const Ne=A({props:["column","onClick","onResizeEnd"],setup(e,{slots:t}){const o=ee(),a=s=>{U(e.onResizeEnd,e.column.key,s.width,s.offsetWidth)},r=Se({maxWidth:e.column.maxWidth,minWidth:e.column.minWidth,onResizeEnd:a}),{resizing:c,position:h}=Ve(o,r),d=ee(!c.value);N(c,s=>{s?d.value=!1:setTimeout(()=>d.value=!0)});const i=s=>{d.value&&U(e.onClick,s)};return()=>{var n,b;if(!e.column.resizable)return u("th",{onClick:i},[(n=t.default)==null?void 0:n.call(t)]);const s=[u(Fe,{placement:"end"},null)];if(c.value){const{width:y,height:g}=h.value;s.push(u("div",{class:"cdk-resizable-preview",style:`width:${y}px;height:${g}px`},null))}return u("th",{ref:o,onClick:i},[(b=t.default)==null?void 0:b.call(t),s])}}}),Oe=A({name:"IxProTable",props:Ke,setup(e,{slots:t,expose:o}){const a=X("common"),r=X("table"),c=Ce("table"),h=X("locale"),d=w(()=>`${a.prefixCls}-table`),i=qe(e,r),{hasResizable:s,onResizeEnd:n}=Ue(i),b=w(()=>{var l;return(l=e.size)!=null?l:c.size}),[y,g]=oe(b.value);N(b,g),we(O,{props:e,config:r,locale:h,mergedPrefixCls:d,mergedSize:y,setMergedSize:g,...i});const x=ee();o({scrollTo:l=>{var P;return(P=x.value)==null?void 0:P.scrollTo(l)}});const z=()=>{const{layoutTool:l}=e;if(!l)return null;const P=Ie(l)?l:void 0;return u(re,P,null)},f=()=>{const{toolbar:l}=e;if(l)return l.length<=1?l:u(ye,{align:"center",gap:8},{default:()=>[l]})},k=()=>{var m;if(t.header)return t.header();const{header:l,toolbar:P}=e;if(l||P||t.toolbar){const v={suffix:(m=t.toolbar)!=null?m:f},C=M(l)?{title:l}:l;return u(be,C,v)}};return()=>{const{customAdditional:l,customTag:P,layoutTool:m,toolbar:v,tableLayout:C,...p}=e,T=s.value,I=C||(T?"fixed":void 0),S={...l,headCell:({column:V})=>{const F=l!=null&&l.headCell?l.headCell({column:V}):void 0;return T?{...F,column:V,onResizeEnd:n}:F}},$={headCell:T?Ne:void 0,...P};return u(xe,Pe({ref:x},p,{class:d.value,columns:i.displayColumns.value,customAdditional:S,customTag:$,size:y.value,tableLayout:I}),{...t,header:k,default:z})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ze=Oe,et=re;export{Ze as I,et as a};
