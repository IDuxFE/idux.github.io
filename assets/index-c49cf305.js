import{O as Xe,P as We,aR as Kt,ao as Ge,m as _,M as we,aL as X,aS as $e,o as te,D as Ie,a2 as Et,K as ke,Z as Ye,A as be,Y as Ze,c as Le,j as He,ab as Tt,at as $t,H as Je,a1 as pe,$ as de,a3 as Ne,aT as It,E as Rt,G as Ot,aU as Pt,av as Wt,L as De,N as Ht,aw as zt,ar as Mt,aG as Ft}from"./index-15e00ad6.js";import{b as Qe,f as j,Y as At,T as Lt,c as b,r as O,w as V,O as et,N as tt,d as fe,z as lt,n as he,m as Be,bq as Nt,a1 as Dt,l as F,y as M,p as ce,q as m,i as ve,ad as ye,an as _t,D as ze,L as Vt,au as jt}from"./vendor-f86ff22e.js";import{b as nt}from"./GlobalCodeBox-6e61adcf.js";import{I as Ut}from"./index-07e52dbd.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ot=Symbol("IxTableColumn"),Me=()=>{};Me.displayName="IxTableColumn";Me[ot]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rt(e,t,l){if(!e||Qe(e)&&e.title===!1)return;if(j(t)||At(t))return t;const o=Xe(t).find(r=>r.type===Lt);return o?o.children:l}function qt(e){return"key"in e?e.key:"dataKey"in e?We(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:Kt("__IDUX_table_column_key_")}function at(e,t,l,o,r,n,s=!1){const a=h=>h.filter(g=>g.type!=="scroll-bar"),i=s?r:a(r),c=s?n:a(n);if(!i.length&&!c.length)return;const d=o.findIndex(h=>h.rowKey===e.rowKey),v=h=>{if(t.findIndex(y=>y.key===h.key)>-1)return;const g=l.findIndex(y=>y.key===h.key);let p;return j(h.key)?p=`fix-${d}-${h.key}`:p=`fix-${d}-${g}`,{data:h,index:g,poolKey:p}};return{start:i.map(v).filter(Boolean),end:c.map(v).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Xt(e,t,l,o){const r=b(()=>{var u;const{columns:f}=e;return st(f&&f.length>0?f:ct((u=t.default)==null?void 0:u.call(t)),l)}),{flattedColumns:n,scrollBarColumn:s,flattedColumnsWithScrollBar:a}=Yt(r,o),{fixedColumns:i,fixedColumnKeys:c}=Zt(a),d=b(()=>!!e.ellipsis||n.value.some(f=>f.ellipsis)),v=b(()=>n.value.some(f=>f.fixed)),h=b(()=>a.value.length),{columnWidthMap:g,columnWidths:p,changeColumnWidth:y}=Jt(n),{columnOffsets:C,columnOffsetsWithScrollBar:w}=Qt(i,g,h),K=b(()=>el(r.value,s.value));return{flattedColumns:n,scrollBarColumn:s,flattedColumnsWithScrollBar:a,fixedColumns:i,fixedColumnKeys:c,hasEllipsis:d,hasFixed:v,columnWidthMap:g,columnWidths:p,changeColumnWidth:y,columnOffsets:C,columnOffsetsWithScrollBar:w,mergedRows:K}}function st(e,t){return e.map(l=>Gt(l,t))}function ct(e){const t=[];return Xe(e,{key:ot}).forEach((l,o)=>{const{props:r,children:n}=l,{key:s=o,editable:a,ellipsis:i,...c}=r||{};c.key=s,c.editable=a||a==="",c.ellipsis=i||i==="";const{default:d,cell:v,title:h,expand:g,icon:p}=n||{};d&&(c.children=ct(d())),v&&(c.customCell=v),h&&(c.customTitle=h),g&&(c.customExpand=g),p&&(c.customIcon=p),t.push(c)}),t}function ge(e){return j(e)?{title:e,cell:e}:e}function Gt(e,t){var i,c;const{columnBase:l,columnExpandable:o,columnSelectable:r,columnIndexable:n}=t,{align:s=l.align}=e,a=qt(e);if("type"in e){const{type:d}=e;if(d==="expandable"){const{showLine:v=o.showLine,icon:h=o.icon}=e;return{...e,key:a,align:ge(s),icon:h,showLine:v}}if(d==="selectable"){const{multiple:v=!0,showIndex:h=r.showIndex}=e;return{...e,key:a,align:ge(s),multiple:v,showIndex:h}}if(d==="indexable"){const v=(c=(i=e.align)!=null?i:n.align)!=null?c:l.align;return{...n,...e,align:ge(v),key:a}}return{...e,key:a,align:ge(s)}}else{const{sortable:d,filterable:v,children:h}=e,g={...e,key:a,align:ge(s)};return d&&(g.sortable={...l.sortable,...d}),v&&(g.filterable={...l.filterable,...v}),h!=null&&h.length&&(g.children=st(h,t)),g}}function Yt(e,t){const l=b(()=>Fe(e.value)),o=b(()=>{const n=t.value,s=l.value;if(n===0||s.length===0)return;const a=s[s.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:a&&a.fixed,width:n}}),r=b(()=>{const n=l.value,s=o.value;return s?[...n,s]:n});return{flattedColumns:l,scrollBarColumn:o,flattedColumnsWithScrollBar:r}}function Fe(e){const t=[];return e.forEach(l=>{const{fixed:o,children:r}=l;if(r!=null&&r.length){let n=Fe(r);o&&(n=n.map(s=>({fixed:o,...s}))),t.push(...n)}else t.push(l)}),t}function Zt(e){const t=b(()=>{const o=[],r=[],n={};return e.value.forEach((s,a)=>{const{key:i,fixed:c}=s;c==="start"?(o.push(s),n[i]=a):c==="end"&&(r.push(s),n[i]=a)}),{fixedStartColumns:o,fixedEndColumns:r,fixedColumnIndexMap:n}}),l=b(()=>{var n,s;const{fixedStartColumns:o,fixedEndColumns:r}=t.value;return{lastStartKey:(n=o[o.length-1])==null?void 0:n.key,firstEndKey:(s=r[0])==null?void 0:s.key}});return{fixedColumns:t,fixedColumnKeys:l}}function Jt(e){const t=O({}),l=O(),o=O([]);return V(l,et(n=>{o.value=n?n.split("-").filter(Boolean).map(Number):[]},16)),tt(()=>{const n=e.value;l.value=n.map(s=>t.value[s.key]).join("-")}),{columnWidthMap:t,columnWidths:o,changeColumnWidth:(n,s)=>{s===!1?delete t.value[n]:t.value[n]=s}}}function Qt(e,t,l){const o=b(()=>{const{fixedStartColumns:n,fixedEndColumns:s,fixedColumnIndexMap:a}=e.value;return _e(n,s.filter(i=>i.type!=="scroll-bar"),a,t.value,l.value-1)}),r=b(()=>{const{fixedStartColumns:n,fixedEndColumns:s,fixedColumnIndexMap:a}=e.value;return _e(n,s,a,t.value,l.value)});return{columnOffsets:o,columnOffsetsWithScrollBar:r}}function _e(e,t,l,o,r){var c,d,v,h,g,p;const n={},s={};let a=0,i=0;for(let y=0;y<e.length;y++){const C=e[y],w=(d=(c=o[C.key])!=null?c:C.width)!=null?d:0;n[C.key]={index:(v=l[C.key])!=null?v:y,offset:a},a+=w}for(let y=0;y<t.length;y++){const C=t[t.length-y-1],w=(g=(h=o[C.key])!=null?h:C.width)!=null?g:0;s[C.key]={index:(p=l[C.key])!=null?p:r-y-1,offset:i},i+=w}return{starts:n,ends:s}}function el(e,t){const l=[],o={};function r(a,i,c){var h;(h=l[c])!=null||(l[c]=[]);let d=i;return a.map(g=>{var K;let p=(K=g.titleColSpan)!=null?K:1,y=!1;const C=g.children;if(C!=null&&C.length){y=!0;const f=r(C,d,c+1);fe(g.titleColSpan)&&(p=f.reduce((u,S)=>u+S))}const w=d+p-1;return l[c].push({...g,titleColSpan:p,colStart:d,colEnd:w,hasChildren:y}),o[g.key]={colStart:d,colEnd:w},d+=p,p})}const n=t?[...e,t]:e;r(n,0,0);const s=l.length;return l.forEach((a,i)=>{a.forEach(c=>{c.hasChildren||(c.titleRowSpan=s-i)})}),{rows:l,offsetIndexMap:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tl(e,t,l,o,r,n,s){const a=b(()=>{const y=t.value,C=l.value;return e.dataSource.map((w,K)=>it(w,C,y,K,e.dataSource.length))}),i=b(()=>{const y=new Map;return Re(a.value,y),y}),c=b(()=>dt(a.value,r.value,n.value)),d=b(()=>ut(c.value,o.value,n.value)),v=b(()=>{const y=s.value,C=d.value;if(y===null||!y.pageSize)return C;{const{total:w}=y;if(w&&C.length<w)return C;const K=y.pageSize,f=(y.pageIndex-1)*K;return C.slice(f,f+K)}}),h=b(()=>{const y=new Map;return Re(v.value,y),y}),g=b(()=>{const y=n.value;return y.length>0?ft(v.value,y,0):v.value});return{isTreeData:b(()=>a.value.some(y=>{var C;return(C=y.children)==null?void 0:C.length})),filteredData:c,flattedData:g,mergedMap:i,paginatedMap:h}}function it(e,t,l,o,r,n){var c;const s=t(e),a={record:e,rowKey:s,parentKey:n==null?void 0:n[0].rowKey,showLineIndentIndexList:(c=[...n!=null?n:[]].reverse())==null?void 0:c.reduce((d,v,h)=>(v.hasNextSibling&&d.push(h),d),[]),hasPrevSibling:o>0,hasNextSibling:o<r-1},i=e[l];return i&&(a.children=i.map((d,v)=>it(d,t,l,v,i.length,[a,...n!=null?n:[]]))),a}function Re(e,t){e.forEach(l=>{const{rowKey:o,children:r}=l;t.set(o,l),r&&Re(r,t)})}function ut(e,t,l){const o=t.filter(s=>s.sorter),r=o.length;if(r===0)return e;const n=e.slice();return n.forEach(s=>{l.includes(s.rowKey)&&s.children&&s.children.length>0&&(s.children=ut(s.children,t,l))}),n.sort((s,a)=>{for(let i=0;i<r;i++){const{orderBy:c,sorter:d}=o[i],v=d(s.record,a.record);if(v!==0)return c==="ascend"?v:-v}return 0})}function dt(e,t,l){const o=t.filter(r=>r.filter);return o.length===0?e:e.map(r=>{const n=o.every(({filter:d,filterBy:v})=>d(v,r.record)),{rowKey:s,children:a}=r,i=l.includes(s);let c=r;if(i&&a&&a.length){const d=dt(a,t,l);d.length!==a.length&&(c={...r,children:d})}return n||i&&c.children&&c.children.length?c:null}).filter(r=>r!==null)}function ft(e,t,l){return e.reduce((o,r)=>{const{children:n,parentKey:s,record:a,rowKey:i,hasPrevSibling:c,hasNextSibling:d,showLineIndentIndexList:v}=r,h=t.includes(i);if(o.push({children:n,parentKey:s,record:a,rowKey:i,level:l,expanded:h,hasPrevSibling:c,hasNextSibling:d,showLineIndentIndexList:v}),h&&r.children){const g=ft(r.children,t,l+1);o.push(...g)}return o},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ll(e,t){const l=b(()=>t.value.find(a=>"type"in a&&a.type==="expandable")),[o,r]=Ge(e,"expandedRowKeys",()=>[]);return{expandable:l,expandedRowKeys:o,setExpandedRowKeys:r,checkExpandDisabled:a=>{if(!l.value)return!0;const{disabled:i,customExpand:c}=l.value,{record:d}=a;return i!=null&&i(d)?!0:!(c||a.children&&a.children.length>0)},handleExpandChange:(a,i)=>{const{onChange:c,onExpand:d}=l.value||{},v=[...o.value],h=v.indexOf(a),g=h>=0;g?v.splice(h,1):v.push(a),_(d,!g,i),r(v),_(c,v)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nl(e){const t=b(()=>e.value.filter(n=>n.filterable)),l=lt({}),o=O([]);return V(t,(n,s)=>{n.forEach(a=>{const{key:i,filterable:c}=a,d=c.filterBy;if(d||l[i]===void 0){l[i]=d||[];return}const v=s?s.find(g=>g.key===i):void 0;(v==null?void 0:v.filterable.filterBy)&&(l[i]=[])}),o.value=Ve(n,l)},{immediate:!0}),{activeFilters:o,activeFilterByMap:l,handleFilter:(n,s,a)=>{const{onChange:i}=s;l[n]=a,o.value=Ve(t.value,l),_(i,a,o.value)}}}function Ve(e,t){return e.map(l=>{const{key:o,filterable:r}=l,{filter:n,filterBy:s=t[o]}=r;return{key:o,filter:n,filterBy:s}}).filter(l=>l.filter&&l.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ol(e,t,l){var c,d,v,h,g;const o=we("pagination"),r=b(()=>{const{pagination:p}=e;return p===!1?null:p===!0?{}:p}),n=O((d=(c=r.value)==null?void 0:c.pageIndex)!=null?d:1),s=O((g=(h=(v=r.value)==null?void 0:v.pageSize)!=null?h:t.pagination.pageSize)!=null?g:o.pageSize),a=(p,y)=>{var C;n.value=p,s.value=y,_((C=r.value)==null?void 0:C.onChange,p,y)};return{mergedPagination:b(()=>{var y,C;const p=r.value;return p===null?null:{...t.pagination,size:l.value,...p,pageIndex:(y=p.pageIndex)!=null?y:n.value,pageSize:(C=p.pageSize)!=null?C:s.value,onChange:a}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rl(e,{setStickyScrollLeft:t}){const l=O(),o=O(),r=O(),n=O(),s=O(),a=O();V(l,u=>{u&&(n.value=u.getHolderElement())},{immediate:!0}),V(o,u=>{u&&(r.value=u.getHolderElement(),r.value.style.overflow="hidden")},{immediate:!0});const{handleScroll:i,pingedStart:c,pingedEnd:d}=al(e,l,o,r,n,a,t),{scrollHorizontalOverflowed:v,scrollVerticalOverflowed:h}=sl(n,s),g=b(()=>{var u;return X((u=e.scroll)==null?void 0:u.width)}),p=b(()=>{var u;return X((u=e.scroll)==null?void 0:u.height)}),y=b(()=>$e(te(n))),C=b(()=>h.value?y.value:0),w=b(()=>c.value&&v.value),K=b(()=>d.value&&v.value);return{virtualScrollRef:l,headerVirtualScrollRef:o,scrollHeadRef:r,scrollBodyRef:n,scrollContentRef:s,scrollFootRef:a,handleScroll:i,scrollTo:u=>{var S;e.virtual?(S=l.value)==null||S.scrollTo(u):typeof u=="number"&&Et({target:te(n),top:u,duration:200})},pingedStart:w,pingedEnd:K,scrollWidth:g,scrollHeight:p,scrollBarSize:y,scrollBarSizeOnFixedHolder:C,scrollHorizontalOverflowed:v,scrollVerticalOverflowed:h}}function al(e,t,l,o,r,n,s){const a=O(!1),i=O(!1);let c;const d=()=>{c&&(clearTimeout(c),c=void 0)};he(()=>d());const v=O(),h=w=>{v.value=w,d(),c=setTimeout(()=>{v.value=void 0,c=void 0},100)},g=(w,K)=>{K&&K.scrollLeft!==w&&(K.scrollLeft=w)},p=(w,K)=>{K&&K.scrollTo({left:w})},y=w=>{const K=te(r);if(!K)return;const{clientWidth:f,scrollWidth:u}=K;s(w/u*f||0)};return{handleScroll:(w,K)=>{const f=w==null?void 0:w.currentTarget,u=K!=null?K:f.scrollLeft,S=v.value;if((!S||S===f)&&(h(f),l.value?p(u,l.value):g(u,o.value),t.value?p(u,t.value):g(u,te(r)),g(u,n.value),y(u)),f){const{scrollWidth:B,clientWidth:k}=f;a.value=u>1,i.value=B-k-u>1}(w==null?void 0:w.type)==="scroll"&&_(e.onScroll,w)},pingedStart:a,pingedEnd:i}}function sl(e,t){const l=O(!1),o=O(!1),r=()=>{const a=te(e.value);a?(l.value=a.scrollWidth>a.clientWidth,o.value=a.scrollHeight>a.clientHeight):(l.value=!1,o.value=!1)};let n=[];const s=()=>n.forEach(a=>a());return Be(()=>{n=[Ie(e,r),Ie(t,r)]}),he(()=>s()),{scrollHorizontalOverflowed:l,scrollVerticalOverflowed:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function cl(e,t,l,o,r,n){const s=b(()=>{var d;return(d=e.scrollToTopOnChange)!=null?d:t.scrollToTopOnChange});let a=[];const i=()=>{a=[V([()=>{var d;return(d=l.value)==null?void 0:d.pageIndex},()=>{var d;return(d=l.value)==null?void 0:d.pageSize}],()=>n(0)),V([r,o],([d,v],[h,g])=>{(!il(d,h)||!ul(v,g))&&n(0)})]},c=()=>{a.forEach(d=>d())};V(s,d=>{c(),d&&i()},{immediate:!0})}function il(e,t){return e.length===t.length&&e.every(l=>{const o=t.find(r=>r.key===l.key);return o?l.filter===o.filter&&l.filterBy.length===o.filterBy.length&&l.filterBy.every(r=>o.filterBy.includes(r)):!1})}function ul(e,t){return e.length===t.length&&e.every(l=>{const o=t.find(r=>r.key===l.key);return o?l.sorter===o.sorter&&l.orderBy===o.orderBy&&l.multiple===o.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dl(e,t,l,{mergedMap:o,paginatedMap:r}){const n=b(()=>l.value.find(f=>"type"in f&&f.type==="selectable")),[s,a]=Ge(e,"selectedRowKeys",()=>[]),i=b(()=>{const{disabled:f}=n.value||{},u=[],S=[];return r.value.forEach((B,k)=>{f!=null&&f(B.record)?S.push(k):u.push(k)}),{enabledRowKeys:u,disabledRowKeys:S}}),c=b(()=>{const f=new Set,u=s.value,{disabledRowKeys:S}=i.value,B=o.value;return u.forEach(k=>{const{parentKey:E}=B.get(k)||{};if(!fe(E)){let x=B.get(E);if(x&&!u.includes(x.rowKey))for(;x&&!fe(x==null?void 0:x.rowKey);)S.includes(x.rowKey)||f.add(x.rowKey),x=fe(x.parentKey)?void 0:B.get(x.parentKey)}}),[...f]}),d=b(()=>{const f=s.value,{disabledRowKeys:u}=i.value;let S=0;return r.value.forEach((B,k)=>{!u.includes(k)&&f.includes(k)&&S++},0),S}),v=b(()=>{const f=r.value.size,u=i.value.disabledRowKeys.length;return f===0||f===u?!1:f===u+d.value}),h=b(()=>!v.value&&d.value>0),g=new Map,p=f=>{a(f);const u=o.value,{onChange:S}=n.value||{};if(S){const B=[];g.forEach((k,E)=>{f.includes(E)||g.delete(E)}),f.forEach(k=>{let E=u.get(k);E?g.set(k,E):E=g.get(k),E&&B.push(E.record)}),_(S,f,B)}},y=(f,u)=>{const S=o.value,{disabledRowKeys:B}=i.value,{multiple:k,onSelect:E}=n.value||{};let x=[...s.value];const $=x.indexOf(f),I=$>=0;if(k){const W=S.get(f),P=vt(W,B);if(I){x.splice($,1);const z=fl(S,W,B);x=x.filter(A=>!z.includes(A)&&!P.includes(A))}else x.push(f),x.push(...P);vl(S,W,x,B)}else x=I?[]:[f];_(E,!I,u),p(x)},C=()=>{const{enabledRowKeys:f}=i.value,u=new Set(s.value);v.value?f.forEach(S=>u.delete(S)):f.forEach(S=>u.add(S)),p([...u])},w=hl(n,t),K=yl(n,o,r,s,p);return{selectable:n,selectedRowKeys:s,indeterminateRowKeys:c,currentPageRowKeys:i,currentPageAllSelected:v,currentPageSomeSelected:h,handleSelectChange:y,handleHeadSelectChange:C,mergedSelectableMenus:w,handleSelectableMenuClick:K}}function vt(e,t){const l=[],{children:o}=e||{};return o&&o.forEach(r=>{const{rowKey:n}=r;t.includes(n)||l.push(r.rowKey),l.push(...vt(r,t))}),l}function fl(e,t,l){const o=[];for(;t!=null&&t.parentKey;){const{parentKey:r}=t;l.includes(t.parentKey)||o.push(r),t=e.get(r)}return o}function vl(e,t,l,o){let r=!0;for(;r&&t&&!fe(t.parentKey);){const n=e.get(t.parentKey);if(n&&!o.includes(t.parentKey)){r=n.children.every(a=>o.includes(a.rowKey)||l.includes(a.rowKey));const s=l.findIndex(a=>a===t.parentKey);r?s<0&&l.push(t.parentKey):s>-1&&l.splice(s,1)}t=n}}const ht=Symbol("IDUX_TABLE_KEY_selectable-all"),yt=Symbol("IDUX_TABLE_KEY_selectable-invert"),gt=Symbol("IDUX_TABLE_KEY_selectable-none"),pt=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function hl(e,t){return b(()=>{const{menus:l}=e.value||{};if(!l||l.length===0)return[];const{selectAll:o,selectInvert:r,selectNone:n,selectPageInvert:s}=t.table;return l.map(a=>j(a)?a==="all"?{type:"item",key:ht,label:o}:a==="invert"?{type:"item",key:yt,label:r}:a==="none"?{type:"item",key:gt,label:n}:a==="pageInvert"?{type:"item",key:pt,label:s}:{type:"item",key:a,label:a}:a)})}function yl(e,t,l,o,r){const n=()=>{const{disabled:d,onSelectAll:v}=e.value||{},h=[];t.value.forEach((g,p)=>{d!=null&&d(g.record)||h.push(p)}),_(v,h),r(h)},s=()=>{const{disabled:d,onSelectInvert:v}=e.value||{},h=[...o.value];t.value.forEach((g,p)=>{if(d!=null&&d(g.record))return;const y=h.indexOf(p);y>=0?h.splice(y,1):h.push(p)}),r(h),_(v,h)},a=()=>{const{onSelectNone:d}=e.value||{};_(d),r([])},i=()=>{const{disabled:d,onSelectPageInvert:v}=e.value||{},h=[],g=o.value;l.value.forEach((p,y)=>{d!=null&&d(p.record)||g.includes(y)||h.push(y)}),_(v,h),r(h)},c=new Map([[ht,n],[yt,s],[gt,a],[pt,i]]);return d=>{const v=d.key;if(Nt(v)&&c.has(v)){c.get(v)();return}const{disabled:h,onMenuClick:g}=e.value||{};if(!g)return;const p=[];l.value.forEach((y,C)=>{h!=null&&h(y.record)||p.push(C)}),_(g,d,p)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function gl(e){const t=b(()=>e.value.filter(s=>s.sortable)),l=b(()=>t.value.some(s=>s.sortable.multiple!==void 0)),o=lt({}),r=O([]);return V(t,(s,a)=>{s.forEach(i=>{const{key:c,sortable:d}=i,v=d.orderBy;if(v||o[c]===void 0){o[c]=v;return}const h=a?a.find(p=>p.key===c):void 0;(h==null?void 0:h.sortable.orderBy)&&(o[c]=void 0)}),r.value=Ue(s,o)},{immediate:!0}),{activeSorters:r,activeOrderByMap:o,handleSort:(s,a)=>{const{orders:i,onChange:c}=a,d=o[s],v=d?je(i,d):je(i);l.value?o[s]=v:Object.keys(o).forEach(h=>{s===h?o[h]=v:o[h]=void 0}),r.value=Ue(t.value,o),_(c,v,r.value)}}}function je(e,t){return t?e[e.indexOf(t)+1]:e[0]}function Ue(e,t){return e.map(l=>{const{key:o,sortable:r}=l,{multiple:n=0,orderBy:s=t[o],sorter:a}=r;return{key:o,multiple:n,orderBy:s,sorter:a}}).filter(l=>l.orderBy).sort((l,o)=>o.multiple-l.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function pl(e){const t=b(()=>!!e.sticky),l=b(()=>{const{sticky:n}=e,{offsetTop:s=0,offsetBottom:a=0,offsetScroll:i=0,container:c=window}=Dt(n)?n:{};return{offsetTop:s,offsetBottom:a,offsetScroll:i,container:c}}),[o,r]=ke(0);return{isSticky:t,mergedSticky:l,stickyScrollLeft:o,setStickyScrollLeft:r}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ml(e,{hasEllipsis:t,hasFixed:l},{scrollWidth:o,scrollHeight:r},n,s,a){return b(()=>e.tableLayout?e.tableLayout:o.value&&l.value?o.value==="max-content"?"auto":"fixed":r.value||a.value||n.value||t.value||s.value.horizontal||s.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const L=Symbol("TABLE_TOKEN"),Ae=Symbol("tableBodyToken"),mt=Symbol("tableBodyRowToken"),me=F({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:l,columnWidthMap:o,mergedSelectableMenus:r,mergedPrefixCls:n}=M(L),s=b(()=>{const{isFixedHolder:a,columns:i}=e;return i||(a?l.value:t.value)});return()=>{if(s.value.every(c=>!c.width&&!c.type))return;const a=n.value,i=s.value.map(c=>{var y;const{key:d,type:v}=c,h=(y=c.width)!=null?y:o.value[d],g=v?ce({[`${a}-col-${v}`]:!0,[`${a}-col-with-dropdown`]:v==="selectable"&&r.value.length>0}):void 0,p={width:X(h),minWidth:X(c.minWidth),maxWidth:X(c.maxWidth)};return m("col",{key:d,class:g,style:p},null)});return m("colgroup",null,[i])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const bl={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},Sl={columns:{type:Array,required:!0}},xl={column:{type:Object,required:!0}},Cl={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},wl={column:{type:Object,required:!0},colIndex:{type:Number,required:!0},colSpan:Number,rowSpan:Number},kl={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},Bl={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},Kl={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},El=F({props:Bl,setup(e){const{slots:t,config:l,locale:o,mergedPrefixCls:r}=M(L),n=b(()=>{var f;return(f=e.filterable.multiple)!=null?f:l.columnBase.filterable.multiple}),s=b(()=>{var f;return(f=e.filterable.footer)!=null?f:l.columnBase.filterable.footer}),a=e.activeFilterBy,[i,c]=ke(()=>a);V(()=>e.activeFilterBy,f=>c(f));const[d,v]=ke(!1),h=f=>{v(f),f||e.onUpdateFilterBy(i.value)},g=()=>{v(!1),e.onUpdateFilterBy(i.value)},p=()=>{c(a)},y=f=>{const u=`${r.value}-filterable-menu-label`,S=n.value?He:nt;return m("span",{class:u},[m(S,{checked:f.selected,disabled:f.disabled},null),m("span",{class:`${u}-content`},[f.label])])},C=()=>{const f=[],{customMenu:u,menus:S}=e.filterable;return ve(u)?f.push(u({selectedKeys:i.value,setSelectedKeys:c})):j(u)&&t[u]?f.push(t[u]({selectedKeys:i.value,setSelectedKeys:c})):f.push(Tl(S,n,i,c,y)),s.value&&f.push($l(o,r,g,p)),f},w=b(()=>{const f=`${r.value}-filterable-trigger`;return ce({[f]:!0,[`${f}-active`]:e.activeFilterBy.length>0})}),K=()=>{const{customTrigger:f}=e.filterable;return ve(f)?f():j(f)&&t[f]?t[f]():m("span",{class:w.value,onClick:u=>u.stopPropagation()},[m(be,{name:"filter-filled"},null)])};return()=>{const f={visible:d.value,hideOnClick:!s.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":h};return m(Ye,f,{default:K,overlay:C})}}}),Tl=(e,t,l,o,r)=>{const n={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:l.value,"onUpdate:selectedKeys":o};return m(Ze,n,{itemLabel:r})},$l=(e,t,l,o)=>{const{filterConfirm:r,filterReset:n}=e.table;return m("div",{class:`${t.value}-filterable-trigger-footer`},[m(Le,{mode:"primary",size:"xs",onClick:l},{default:()=>[r]}),m(Le,{size:"xs",onClick:o},{default:()=>[n]})])},Il=F({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:l,currentPageRowKeys:o,currentPageAllSelected:r,currentPageSomeSelected:n,handleHeadSelectChange:s,mergedSelectableMenus:a,handleSelectableMenuClick:i}=M(L),c=b(()=>{const C=t.value.size;return C===0||C===o.value.disabledRowKeys.length}),[d,v]=ke(!1),h={"onUpdate:visible":v,trigger:"click"},g=()=>m(Ze,{dataSource:a.value,onClick:i},null),p=()=>m(be,{class:`${e.value}-selectable-trigger`,name:"down",rotate:d.value?180:0},null),y=()=>{if(a.value.length!==0)return m(Ye,h,{default:p,overlay:g})};return()=>{const{multiple:C}=l.value;if(C)return m("span",{class:`${e.value}-cell-triggers`},[m(He,{checked:r.value,indeterminate:n.value,disabled:c.value,onChange:s},null),y()])}}}),Rl=F({props:Kl,setup(e){const{locale:t,mergedPrefixCls:l}=M(L);return()=>{const{activeOrderBy:o,sortable:r}=e,{orders:n,nextTooltip:s}=r,a=s&&Ol(t.table,n,o),i=Pl(l,n,o);return a?m(Tt,{title:a},{default:()=>[i]}):i}}});function Ol(e,t,l){const o=l?t[t.indexOf(l)+1]:t[0],{sortCancel:r,sortAsc:n,sortDesc:s}=e;return o?o==="ascend"?n:s:r}function Pl(e,t,l){const o=e.value,r=`${o}-sortable-trigger-active`,n=t.includes("ascend")&&m(be,{name:"caret-up-filled",class:l==="ascend"?r:void 0},null),s=t.includes("descend")&&m(be,{name:"caret-down-filled",class:l==="descend"?r:void 0},null);return m("span",{class:`${o}-sortable-trigger`},[n,s])}const Wl=F({props:xl,setup(e){const{props:t,slots:l,mergedPrefixCls:o,fixedColumnKeys:r,columnOffsetsWithScrollBar:n,isSticky:s,handleSort:a,activeOrderByMap:i,activeFilterByMap:c,mergedRows:d,handleFilter:v}=M(L),h=b(()=>{const{type:f,ellipsis:u}=e.column,S=f||u!=null?u:t.ellipsis;return Qe(S)&&S.head===!1?void 0:S}),g=b(()=>{const{type:f,align:u,fixed:S,hasChildren:B,key:k,sortable:E,filterable:x}=e.column,$=o.value;let I={[`${$}-cell`]:!0,[`${$}-cell-${f}`]:!!f,[`${$}-cell-filterable`]:!!x,[`${$}-cell-sortable`]:!!E,[`${$}-cell-align-center`]:B||(u==null?void 0:u.title)==="center",[`${$}-cell-align-end`]:!B&&(u==null?void 0:u.title)==="end",[`${$}-cell-ellipsis`]:!!h.value};if(S){const{lastStartKey:W,firstEndKey:P}=r.value;I={...I,[`${$}-fix-start`]:S==="start",[`${$}-fix-start-last`]:W===k,[`${$}-fix-end`]:S==="end",[`${$}-fix-end-first`]:P===k,[`${$}-fix-sticky`]:s.value}}return ce(I)}),p=b(()=>{var I;const{key:f,fixed:u}=e.column,{offsetIndexMap:S}=d.value;if(!u)return;const{starts:B,ends:k}=n.value,E=Object.values(u==="start"?B:k),x=S[f][u==="start"?"colStart":"colEnd"],$=X((I=E.find(W=>W.index===x))==null?void 0:I.offset);return{position:"sticky",left:u==="start"?$:void 0,right:u==="end"?$:void 0}}),y=b(()=>i[e.column.key]),C=b(()=>c[e.column.key]||$t),w=f=>{const{key:u,filterable:S}=e.column;v(u,S,f)},K=()=>{const{key:f,sortable:u}=e.column;u&&a(f,u)};return()=>{var P,z,A;const{column:f}=e,{type:u,titleColSpan:S,titleRowSpan:B}=f;if(u==="scroll-bar")return m("th",{class:g.value,style:p.value,colspan:S===1?void 0:S,rowspan:B===1?void 0:B,onClick:K},null);const k=o.value;let E,x;if(u==="selectable")x=m(Il,null,null);else{const{title:le,customTitle:U,sortable:Z,filterable:ne}=f,re=h.value;x=Hl(le,U,l),E=rt(re,x,le);const J=zl(Z,y,ne,C,w);J.length>0?x=m("span",{class:`${k}-cell-triggers`},[m("span",{class:`${k}-cell-title`},[x]),J]):re&&(x=m("span",{class:`${k}-cell-title`},[x]))}const $=(P=t.customAdditional)==null?void 0:P.headCell,I=$?$({column:f}):void 0,W=(A=(z=t.customTag)==null?void 0:z.headCell)!=null?A:"th";return m(W,ye({class:g.value,style:p.value,colSpan:S===1?void 0:S,rowSpan:B===1?void 0:B,title:E},I,{onClick:K}),{default:()=>[x]})}}});function Hl(e,t,l){let o=e;return ve(t)?o=t({title:e}):j(t)&&l[t]&&(o=l[t]({title:e})),o}function zl(e,t,l,o,r){const n=[];return e&&n.push(m(Rl,{activeOrderBy:t.value,sortable:e},null)),l&&n.push(m(El,{activeFilterBy:o.value,filterable:l,onUpdateFilterBy:r},null)),n}function Ml(e){return e.map(t=>bt(t)).filter(Boolean)}function bt(e){if(e.titleColSpan!==0)return m(Wl,{key:e.key,column:e},null)}const Fl=F({props:Sl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:o}=M(L);return()=>{var i,c,d;const{columns:r}=e,n=(i=l.customAdditional)==null?void 0:i.headRow,s=n?n({columns:r}):void 0,a=(d=(c=l.customTag)==null?void 0:c.headRow)!=null?d:"tr";return m(a,ye({class:`${o.value}-row`},s),{default:()=>{var v;return[(v=t.default)==null?void 0:v.call(t)]}})}}});function St(e,t,l){return m(Fl,{columns:e,key:t},{default:()=>[l]})}const Oe=F({setup(e,{slots:t}){const{props:l,mergedRows:o,mergedPrefixCls:r}=M(L);return()=>{var d,v,h;let n;const{rows:s}=o.value,a=(d=l.customAdditional)==null?void 0:d.head,i=a?a({rows:s}):void 0,c=(h=(v=l.customTag)==null?void 0:v.head)!=null?h:"thead";return t.default?n=t.default():n=s.map((g,p)=>{const y=Ml(g);return St(g,p,y)}),m(c,ye({class:`${r.value}-thead`},i),{default:()=>[n]})}}}),Al=F({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:l,mergedVirtual:o,mergedVirtualColWidth:r,getVirtualColWidth:n,headerVirtualScrollRef:s,handleScroll:a,scrollHeadRef:i,scrollWidth:c,flattedData:d,flattedColumns:v,fixedColumns:h,mergedRows:g,isSticky:p}=M(L);Ll(i,a);const y=b(()=>c.value==="max-content"),C=b(()=>d.value.length>0),w=b(()=>{const u=l.value;return{[`${u}-fixed-holder`]:!0,[`${u}-sticky-holder`]:p.value}}),K=b(()=>{const u=p.value,{offsetTop:S,offsetBottom:B}=e;return{overflow:"hidden",top:u?X(S):void 0,bottom:u?X(B):void 0}}),f=b(()=>o.value.horizontal?g.value.rows.map((u,S)=>({key:S,data:u})):[]);return()=>{const u=C.value||!y.value;if(o.value.horizontal){const S=(I,{renderedData:W})=>{let P=[];if(u){const z=[];W.forEach(A=>{z.push(...A.data)}),P=Fe(z)}return m("table",{style:{tableLayout:"fixed"}},[u&&m(me,{columns:P,isFixedHolder:!0},null),m(Oe,null,{default:()=>[I]})])},B=({item:I,index:W,children:P})=>St(I.data,W,P),k=({item:I})=>bt(I),E=(I,W)=>{const{fixedStartColumns:P,fixedEndColumns:z}=h.value;return at(I,W,v.value,d.value,P,z,!0)},{virtualBufferSize:x,virtualBufferOffset:$}=t;return m("div",{class:w.value,style:K.value},[m(Je,{ref:s,dataSource:f.value,colModifier:E,getKey:"key",height:0,width:"100%",colWidth:r.value,getColWidth:n,rowRender:B,colRender:k,contentRender:S,virtual:{horizontal:!0,vertical:!1},bufferSize:x,bufferOffset:$},null)])}return m("div",{class:w.value,style:K.value,ref:i},[m("table",{style:{tableLayout:"fixed"}},[u&&m(me,{isFixedHolder:!0},null),m(Oe,null,null)])])}}});function Ll(e,t){const l=n=>{if(!n.shiftKey)return;const s=n.deltaY,a=n.currentTarget;if(s){const i=a.scrollLeft+s;t(n,i)}},o=n=>{pe(n,"wheel",l,{passive:!0})},r=n=>{de(n,"wheel",l)};Be(()=>{V(e,(n,s)=>{r(s),o(n)},{immediate:!0})}),he(()=>r(e.value))}const Nl=F({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:l,mergedSticky:o,stickyScrollLeft:r,setStickyScrollLeft:n}=M(L),s=O(!1),a=O(!1),i=O(0),c=O(0),d=O(0),v=b(()=>{const f=c.value,u=d.value;return u&&f*(f/u)});tt(()=>{const f=te(t);if(f&&s.value){const{clientWidth:u,scrollWidth:S,scrollLeft:B}=f;n(B/S*u),c.value=u,d.value=S}});const h=b(()=>({height:$e(),width:c.value,bottom:o.value.offsetScroll})),g=b(()=>{const f=e.value;return{[`${f}-sticky-scrollbar-thumb`]:!0,[`${f}-sticky-scrollbar-thumb-active`]:a.value}}),p=b(()=>({width:`${v.value}px`,transform:`translate3d(${r.value}px, 0, 0)`})),y=()=>a.value=!1,C=f=>{i.value=f.pageX-r.value,a.value=!0,f.preventDefault()},w=f=>{if(!a.value)return;const{buttons:u}=f||window.event;if(u===0){a.value=!1;return}let S=f.pageX-i.value;S<=0&&(S=0);const B=c.value,k=d.value,E=v.value;S+E>=B&&(S=B-E);const x=S/B*(k+2);l(f,x)},K=()=>{const f=te(t),u=Ne(f).top,S=u+f.offsetHeight,{container:B,offsetScroll:k}=o.value,E=B===window?document.documentElement.scrollTop+window.innerHeight:Ne(B).top+B.clientHeight;S-$e()<=E||u>=E-k?s.value=!1:s.value=!0};return Be(()=>{pe(document.body,"mouseup",y),pe(document.body,"mousemove",w),pe(window,"resize",K),V(()=>o.value.container,(f,u)=>{de(u,"scroll",K),pe(f,"scroll",K)},{immediate:!0}),K()}),he(()=>{de(document.body,"mouseup",y),de(document.body,"mousemove",w),de(window,"resize",K),de(o.value.container,"scroll",K)}),()=>!t.value||!s.value||d.value<=c.value||!v.value?null:m("div",{class:`${e.value}-sticky-scrollbar`,style:h.value},[m("div",{class:g.value,style:p.value,onMousedown:C},null)])}}),Dl=F({setup(e,{slots:t}){const{mergedPrefixCls:l}=M(L);return()=>{var o;return m("tbody",{class:`${l.value}-tbody`},[(o=t.default)==null?void 0:o.call(t)])}}}),Pe=F({props:{columns:Array,isEmpty:Boolean},setup(e,{slots:t}){const{mergedPrefixCls:l,hasFixed:o,scrollHorizontalOverflowed:r,scrollBarColumn:n}=M(L),{mainTableWidth:s}=M(Ae),a=b(()=>{var i,c;return(c=(i=e.columns)==null?void 0:i.length)!=null?c:1});return()=>{let i=t.default();if(e.isEmpty?r.value:o.value){const c=n.value;i=m("div",{class:`${l.value}-fixed-row`,style:{width:X(s.value-(c?c.width:0)),position:"sticky",left:0,overflow:"hidden"}},[i])}return m("tr",null,[m("td",{colspan:a.value},[i])])}}}),_l=F({props:kl,setup(e){const t=O();return Ie(t,o=>{const{contentRect:{width:r}}=o;e.changeColumnWidth(e.cellKey,r)}),he(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>m("td",{ref:t,style:{padding:0,border:0,height:0}},[m("div",{style:{height:0,overflow:"hidden"}},[_t(" ")])])}}),Vl=F({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=M(L),{changeColumnWidth:l}=M(Ae);return()=>{var r;const o=(r=e.columns)==null?void 0:r.map(n=>{const{key:s}=n;return m(_l,{key:s,cellKey:s,changeColumnWidth:l},null)});return m("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[o])}}}),jl=F({props:wl,setup(e){const{props:t,slots:l,config:o,mergedPrefixCls:r,mergedEmptyCell:n,activeOrderByMap:s,fixedColumnKeys:a,columnOffsets:i,isSticky:c,isTreeData:d,expandable:v,selectable:h,mergedPagination:g}=M(L),p=M(mt),y=p.props,C=b(()=>s[e.column.key]),w=Ul(p,e),K=b(()=>a.value.lastStartKey===e.column.key),f=b(()=>a.value.firstEndKey===e.column.key),u=b(()=>{const{type:k,ellipsis:E}=e.column;return k||E!=null?E:t.ellipsis}),S=b(()=>{const{fixed:k,align:E}=e.column,x=r.value;let $={[`${x}-cell`]:!0,[`${x}-cell-sorted`]:!!C.value,[`${x}-cell-align-${E.cell}`]:!!E&&E.cell!="start",[`${x}-cell-ellipsis`]:!!u.value};return k&&($={...$,[`${x}-fix-start`]:k==="start",[`${x}-fix-start-last`]:K.value,[`${x}-fix-end`]:k==="end",[`${x}-fix-end-first`]:f.value,[`${x}-fix-sticky`]:c.value}),ce($)}),B=b(()=>{const{fixed:k}=e.column;if(!k)return;const{starts:E,ends:x}=i.value,I=X((k==="start"?E:x)[e.column.key].offset);return{position:"sticky",left:k==="start"?I:void 0,right:k==="end"?I:void 0}});return()=>{var A,le,U;const{column:k}=e,{type:E}=k;let x,$;if(E==="selectable")x=Gl(p,l,h,o,g);else if(E==="indexable")x=xt(p,l,k,g);else{const Z=w.value;if(x=ql(p,e,l,Z),$=rt(u.value,x,Z),!E&&(fe(x)||x==="")){const ne=l.emptyCell||n.value;x=ve(ne)?ne({column:k,record:y.record,rowIndex:y.rowIndex}):ne}}e.column.fixed&&u.value&&(K.value||f.value)&&(x=m("span",{class:`${r.value}-cell-content`},[x]));const I=(A=t.customAdditional)==null?void 0:A.bodyCell,W=I?I({column:k,record:y.record,rowIndex:y.rowIndex}):void 0,P=(U=(le=t.customTag)==null?void 0:le.bodyCell)!=null?U:"td",z=E==="expandable"?m("div",{class:`${r.value}-expandable-wrapper`},[Xl(p,l,v,d,r.value),!It(x)&&m("span",{class:`${r.value}-expandable-trigger-gap`},null),x]):x;return m(P,ye({class:S.value,style:B.value,title:$,colSpan:e.colSpan,rowSpan:e.rowSpan},W),{default:()=>[z]})}}});function Ul(e,t){return b(()=>{const{props:{record:l}}=e,{column:o}=t,r=We(o.dataKey);if(r.length<=0)return;let n=l;for(let s=0;s<r.length&&n;s++){const a=r[s];n=n[a]}return n})}function ql(e,t,l,o){const{props:{record:r,rowIndex:n}}=e,{column:s}=t,{customCell:a}=s,i=j(a)?l[a]:a;return i?i({value:o,record:r,rowIndex:n}):o}function Xl(e,t,l,o,r){var E;const{icon:n,customIcon:s,indent:a,showLine:i}=l.value,{props:{record:c,expanded:d,level:v=0,hasPrevSibling:h,hasNextSibling:g,showLineIndentIndexList:p},expandDisabled:y,handleExpend:C}=e,w=v>0,K=o.value&&i&&a;let f;const u=(E=j(s)?t[s]:s)!=null?E:n;ve(u)?f=u({expanded:!!d,record:c}):f=j(u)?m(be,{name:u,rotate:d?90:0},null):u;const S=a?`width: ${X(a)}`:void 0,B={[`${r}-expandable-trigger`]:!0,[`${r}-expandable-trigger-show-line`]:K,[`${r}-expandable-trigger-disabled`]:y.value},k=[];if(a)for(let x=0;x<v;x++)k.push(m("div",{class:{[`${r}-expandable-indent`]:!0,[`${r}-expandable-indent-show-line`]:K&&p.includes(x)},style:S},null));return[...k,m("span",{class:B,style:S},[m("button",{class:`${r}-expandable-trigger-button`,type:"button",onClick:y.value?void 0:C},[f]),K&&[m("span",{class:`${r}-expandable-trigger-line-right`},null),(h||w)&&m("span",{class:`${r}-expandable-trigger-line-top`},null),g&&m("span",{class:`${r}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function Gl(e,t,l,o,r){const{props:{record:n,rowIndex:s},isSelected:a,isIndeterminate:i,selectDisabled:c,isHover:d,handleSelect:v}=e,{showIndex:h,multiple:g,customCell:p}=l.value,y=w=>{w.stopPropagation(),!g&&a.value&&!c.value&&v&&v()};if(!a.value&&!d&&h)return xt(e,t,o.columnIndexable,r);const C=j(p)?t[p]:p;if(g){const w={checked:a.value,disabled:c.value,indeterminate:i.value,onChange:v,onClick:y};return C?C({...w,record:n,rowIndex:s}):m(He,w,null)}else{const w={checked:a.value,disabled:c.value,onChange:v,onClick:y};return C?C({...w,record:n,rowIndex:s}):m(nt,w,null)}}function xt(e,t,l,o){const{props:{record:r,rowIndex:n},selectDisabled:s}=e,{customCell:a}=l,{pageIndex:i=1,pageSize:c=0}=o.value||{},d=j(a)?t[a]:a;if(!d)return;const v=s.value?"cursor: not-allowed":"cursor: pointer";return m("span",{style:v},[d({record:r,rowIndex:n,pageIndex:i,pageSize:c})])}function Yl(e,t,l){const o=[];return e.forEach((r,n)=>{const s=Ct(r,t,l,n);s&&o.push(s)}),o}function Ct(e,t,l,o){const{colSpan:r,rowSpan:n}=e,s=r==null?void 0:r(t,l),a=n==null?void 0:n(t,l);return s===0||a===0?void 0:m(jl,{colSpan:s===1?void 0:s,rowSpan:a===1?void 0:a,colIndex:o,column:e},null)}const Zl=F({props:Cl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:o,expandable:r,handleExpandChange:n,checkExpandDisabled:s,selectable:a,selectedRowKeys:i,indeterminateRowKeys:c,handleSelectChange:d,currentPageRowKeys:v}=M(L),{expandDisabled:h,handleExpend:g,selectDisabled:p,handleSelect:y,isHover:C,attrs:w}=Jl(e,r,s,n,a,d,v),K=b(()=>i.value.includes(e.rowKey)),f=b(()=>c.value.includes(e.rowKey)),u=b(()=>{const S=`${o.value}-row`,{level:B,expanded:k}=e;return ce({[`${S}`]:!0,[`${S}-level-${B}`]:!!B,[`${S}-selected`]:K.value,[`${S}-expanded`]:k})});return ze(mt,{props:e,expandDisabled:h,handleExpend:g,isSelected:K,isIndeterminate:f,selectDisabled:p,handleSelect:y,isHover:C}),()=>{var E,x,$;const S=(E=l.customAdditional)==null?void 0:E.bodyRow,B=S?S({record:e.record,rowIndex:e.rowIndex}):void 0,k=($=(x=l.customTag)==null?void 0:x.bodyRow)!=null?$:"tr";return m(k,ye({class:u.value},w.value,B),{default:()=>{var I;return[(I=t.default)==null?void 0:I.call(t)]}})}}});function Jl(e,t,l,o,r,n,s){const a=b(()=>l(e.rowData)),i=b(()=>{var u;return(u=t.value)==null?void 0:u.trigger}),c=()=>{const{rowKey:u,record:S}=e;o(u,S)},d=b(()=>s.value.disabledRowKeys.includes(e.rowKey)),v=b(()=>{var u;return(u=r.value)==null?void 0:u.trigger}),h=b(()=>{var u;return(u=r.value)==null?void 0:u.showIndex}),g=O(!1),p=()=>{const{rowKey:u,record:S}=e;n(u,S)},y=()=>{i.value==="click"&&c(),v.value==="click"&&p()},C=()=>{i.value==="dblclick"&&c(),v.value==="dblclick"&&p()},w=()=>g.value=!0,K=()=>g.value=!1,f=b(()=>{const u=a.value,S=i.value,B=d.value,k=v.value,E=!u&&S==="click"||!B&&k==="click",x=!u&&S==="dblclick"||!B&&k==="dblclick",$=!B&&h.value;let I="";return E||x?I="pointer":(u&&S||B&&k)&&(I="not-allowed"),{style:I?`cursor: ${I}`:void 0,onClick:E?y:void 0,onDblclick:x?C:void 0,onMouseenter:$?w:void 0,onMouseleave:$?K:void 0}});return{expandDisabled:a,handleExpend:c,selectDisabled:d,handleSelect:p,isHover:g,attrs:f}}function qe(e,t,l,o,r,n,s){const{children:a,expanded:i,level:c,hasPrevSibling:d,hasNextSibling:v,showLineIndentIndexList:h,record:g,rowKey:p}=e,y={key:p,expanded:i,level:c,hasPrevSibling:d,hasNextSibling:v,showLineIndentIndexList:h,hasChildren:!!(a!=null&&a.length),record:g,rowData:e,rowIndex:l,rowKey:p},C=m(Zl,y,{default:()=>[s]}),w=i&&Ql(y,o,t,r,n);return w?[C,w]:C}function Ql(e,t,l,o,r){const{customExpand:n}=o||{},{record:s,rowIndex:a}=e;let i;return ve(n)?i=n({record:s,rowIndex:a}):j(n)&&t[n]&&(i=t[n]({record:s,rowIndex:a})),i&&m(Pe,{class:`${r}-expanded-row`,columns:l},{default:()=>[i]})}const en=F({setup(){const{props:e,slots:t,expandable:l,mergedPrefixCls:o,mergedInsetShadow:r,mergedVirtual:n,mergedVirtualItemHeight:s,mergedVirtualColWidth:a,mergedAutoHeight:i,columnWidths:c,changeColumnWidth:d,flattedData:v,flattedColumns:h,fixedColumns:g,getVirtualColWidth:p,isSticky:y,mergedSticky:C,virtualScrollRef:w,scrollBodyRef:K,scrollContentRef:f,handleScroll:u,pingedStart:S,pingedEnd:B,scrollWidth:k,scrollHeight:E,scrollHorizontalOverflowed:x,scrollVerticalOverflowed:$,hasFixed:I,tableLayout:W}=M(L),P=O(),z=O(0),A=b(()=>i.value||!!k.value||y.value||n.value.horizontal);ze(Ae,{mainTableWidth:z,changeColumnWidth:(T,H)=>{Pt(P.value)&&d(T,H)}});const U=()=>{const T=te(K);T&&u({currentTarget:T})},Z=T=>{const{offsetWidth:H}=T.target;H!==z.value&&(z.value=H)};Be(()=>{U(),V([()=>e.dataSource,k],([,H])=>{H&&U()}),V(c,et(()=>{var N;((N=te(K))==null?void 0:N.scrollLeft)===0&&U()},16)),Rt(P.value,Z)}),he(()=>Ot(P.value,Z));const ne=b(()=>{const T=o.value;return ce({[`${T}-container`]:!0,[`${T}-ping-start`]:S.value,[`${T}-ping-end`]:B.value,[`${T}-fixed-layout`]:W.value==="fixed",[`${T}-fixed-column`]:I.value,[`${T}-inset-shadow`]:r.value,[`${T}-scroll-horizontal`]:x.value,[`${T}-scroll-vertical`]:$.value})}),re=b(()=>{var se;const T=E.value,H=n.value.horizontal?"hidden":"auto",N=n.value.vertical?"hidden":"auto",D=(se=e.scroll)==null?void 0:se.fullHeight;return{overflowX:H,overflowY:N,[D?"height":"maxHeight"]:T}}),J=b(()=>({tableLayout:W.value,width:k.value,minWidth:k.value?"100%":void 0})),Ke=(T,H,N)=>{_(e.onScrolledChange,T,H,N.map(D=>D.record))},Ee=b(()=>!n.value.vertical&&!n.value.horizontal?[]:v.value.map(T=>({...T,data:h.value}))),R=T=>{if(!(!A.value||!T))return m(Vl,{columns:T},null)},oe=T=>{if(t.alert)return m(Pe,{class:`${o.value}-alert-row`,columns:T},{default:()=>[t.alert()]})},G=T=>{if(!(v.value.length>0))return m(Pe,{class:`${o.value}-empty-row`,columns:T,isEmpty:!0},{default:()=>[m(Wt,{empty:e.empty},t)]})},Q=(T,H,N)=>{let D;if(N)D=N;else if(H!=null&&H.length){const se=[];H.forEach((xe,Ce)=>{const Te=Yl(T!=null?T:[],xe,Ce);se.push(...We(qe(xe,T,Ce,t,l.value,o.value,Te)))}),D=se}return m(Dl,null,{default:()=>[oe(T),R(T),G(T),D]})},ae=()=>Q(h.value,v.value),Se=(T,H)=>Q(T,void 0,H);return()=>{const T=o.value,H=i.value,N=n.value,D=t.default?t.default():[];if(H||E.value||y.value||N.horizontal){const{offsetTop:se}=C.value;if(e.headless||D.push(m(Al,{offsetTop:se},null)),N.vertical&&(e.scroll||H)||!N.vertical&&N.horizontal){const xe=({item:q,index:Y,children:ee})=>qe(q,q.data,Y,t,l.value,T,ee),Ce=({row:q,item:Y,index:ee,rowIndex:ue})=>Ct(Y,q,ue,ee),Te=(q,{renderedData:Y})=>{var ue;const ee=v.value.length?(ue=Y[0])==null?void 0:ue.data:h.value;return m("table",{ref:f,class:`${T}-table`,style:J.value},[ee?m(me,{columns:ee},null):void 0,Se(ee,q),!1])},kt=(q,Y)=>{const{fixedStartColumns:ee,fixedEndColumns:ue}=g.value;return at(q,Y,h.value,v.value,ee,ue,!1)},{scroll:ie,onScrolledBottom:Bt}=e;D.push(m(Je,{ref:w,class:`${T}-body-virtual-scroll`,dataSource:Ee.value,colModifier:kt,fullHeight:ie==null?void 0:ie.fullHeight,getKey:q=>{var Y;return(Y=q.rowKey)!=null?Y:q.key},height:i.value?"100%":ie==null?void 0:ie.height,width:"100%",rowHeight:s.value,colWidth:a.value,getColWidth:p,rowRender:xe,colRender:Ce,contentRender:Te,virtual:n.value,scrollMode:e.virtualScrollMode,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:u,onScrolledBottom:Bt,onScrolledChange:Ke},null))}else D.push(m("div",{ref:K,class:`${T}-content`,style:re.value,onScroll:u},[m("table",{ref:f,class:`${T}-table`,style:J.value},[m(me,null,null),ae(),!1])]));y.value&&D.push(m(Nl,null,null))}else D.push(m("div",{ref:K,class:`${T}-content`,style:re.value,onScroll:u},[m("table",{ref:f,class:`${T}-table`,style:J.value},[m(me,null,null),!e.headless&&m(Oe,null,null),ae(),!1])]));return m("div",{ref:P,class:ne.value},[D])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tn(e,t){return e.footer?m("div",{class:`${t}-footer`},[e.footer()]):null}function ln(e,t,l,o){var s,a;let r=null,n=null;if(t!==null){const{position:i}=t,[c,d]=Vt(i).split("-"),v=`${o}-pagination ${o}-pagination-${d}`,h=(a=(s=e.pagination)==null?void 0:s.call(e,{total:l.length,...t}))!=null?a:m(Ut,ye({class:v,total:l.length},t),null);r=c==="top"?h:null,n=c==="bottom"?h:null}return[r,n]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function wt(e,t){const{getGreyColors:l}=t,o=l(),{fontSizeSm:r,heightMd:n,paddingSizeSm:s,paddingSizeMd:a,paddingSizeLg:i,colorTextTitleSecondary:c,colorEmphasizedContainerBg:d,colorBorder:v,colorIconInfo:h,colorPrimary:g,colorContainerBg:p,colorContainerBgHover:y,colorInfoContainerBg:C}=e;return{fontSizeSm:r,fontSizeMd:r,fontSizeLg:r,headRowHeightSm:n,headRowHeightMd:n,headRowHeightLg:n,cellPaddingHorizontalSm:s,cellPaddingHorizontalMd:a,cellPaddingHorizontalLg:i,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:c,headBgColor:d,headSeparatorColor:v,headIconColor:h,headIconColorActive:g,headIconBgColorHover:l().l30,insetShadowStart:`inset 10px 0 8px -8px ${De(o.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${De(o.d50,.12)}`,bodyRowBgColorHover:y,bodyRowBgColorSelected:p,bodyRowBgColorExpanded:C,bodyRowBgColorTreeExpanded:C,bodyCellVerticalAlign:"middle",expandableIconColor:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nn(e,t){const{getGreyColors:l}=t,o=l();return{...wt(e,t),insetShadowStart:`inset 10px 0 8px -8px ${o.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${o.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const on=(e,t,l)=>t==="default"?wt(e,l):nn(e,l),rn={sm:32,md:40,lg:56},an=150,sn=F({name:"IxTable",props:bl,setup(e,{expose:t,slots:l}){const o=we("common"),{globalHashId:r,hashId:n,registerToken:s}=Ht("table");s(on);const a=b(()=>`${o.prefixCls}-table`),i=we("locale"),c=we("table"),d=b(()=>{var R;return(R=e.autoHeight)!=null?R:c.autoHeight}),v=b(()=>{var R;return(R=e.childrenKey)!=null?R:c.childrenKey}),h=zt(e,c),g=b(()=>{var R;return(R=e.emptyCell)!=null?R:c.emptyCell}),p=b(()=>{var R;return(R=e.insetShadow)!=null?R:c.insetShadow}),y=b(()=>{var R;return(R=e.size)!=null?R:c.size}),C=b(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),w=b(()=>{var R;return(R=e.virtualItemHeight)!=null?R:rn[y.value]}),K=b(()=>{var R;return(R=e.virtualColWidth)!=null?R:an}),{mergedPagination:f}=ol(e,c,y),u=pl(e),S=rl(e,u),B=Xt(e,l,c,S.scrollBarSizeOnFixedHolder),k=gl(B.flattedColumns),E=nl(B.flattedColumns),x=ll(e,B.flattedColumns),$=ml(e,B,S,u.isSticky,C,d),{columnWidthMap:I,flattedColumns:W}=B,{activeSorters:P}=k,{activeFilters:z}=E,A=new Map,le=()=>{A.clear(),W.value.forEach(R=>{A.set(R.key,R)})};V(W,()=>{le()},{immediate:!0});const U=tl(e,v,h,P,z,x.expandedRowKeys,f),Z=dl(e,i,B.flattedColumns,U);cl(e,c,f,P,z,S.scrollTo);const re={props:e,slots:l,config:c,locale:i,mergedPrefixCls:a,mergedEmptyCell:g,mergedInsetShadow:p,mergedVirtual:C,mergedVirtualItemHeight:w,mergedVirtualColWidth:K,mergedAutoHeight:d,getVirtualColWidth:(R,oe)=>{var G,Q;return(Q=I.value[oe])!=null?Q:(G=A.get(oe))==null?void 0:G.width},...B,...S,...k,...E,...u,tableLayout:$,mergedPagination:f,...x,...U,...Z};ze(L,re),t({scrollTo:S.scrollTo});const{flattedData:J,filteredData:Ke}=U,Ee=b(()=>{const R=a.value,{borderless:oe=c.borderless,scroll:G}=e;return ce({[r.value]:!!r.value,[n.value]:!!n.value,[R]:!0,[`${R}-auto-height`]:d.value,[`${R}-borderless`]:oe,[`${R}-empty`]:J.value.length===0,[`${R}-full-height`]:G==null?void 0:G.fullHeight,[`${R}-${y.value}`]:!0})});return()=>{const R=a.value,oe=m(Mt,{header:e.header},l),G=tn(l,R),Q=[oe];let ae=[m(en,null,null),G].filter(Boolean);if(J.value.length>0){const[T,H]=ln(l,f.value,Ke.value,R);ae=[T,...ae,H].filter(Boolean)}const Se=cn(e.spin);return Se?Q.push(m(Ft,Se,{default:()=>[ae]})):Q.push(...ae),m("div",{class:Ee.value},[Q])}}});function cn(e){return jt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const hn=sn,yn=Me;export{hn as I,yn as a,qt as g,bl as t};
