import{aN as Z,R as F,bg as le,c as y,q as $,x as Ne,y as $e,bk as Be,P as xe,$ as W,br as Pe,bU as Te,bo as Ee,H as Oe,d as V,i as Q,f as K,N as He,an as qe,af as ye,as as Ce,at as Ue,bs as Re,a5 as _e,al as ze,n as je,Z as We,bq as Ve}from"./index-da4385ef.js";import{u as Ge}from"./useTreeCheckState-b3c55523.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function J(e,n,t){if(t){const l=[],o=e.value;n.forEach(a=>{const d=o.get(a);d&&l.push(d.rawNode)}),F(t,n,l)}}function we(e,n){const t=[],{children:l}=e||{};return l&&l.forEach(o=>{const{key:a}=o;n!=null&&n.includes(a)||t.push(o.key),t.push(...we(o,n))}),t}function Le(e,n,t){const l=[];for(;n&&!Z(n.parentKey);){const{parentKey:o}=n;t!=null&&t.includes(n.parentKey)||l.push(o),n=e.get(o)}return l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Xe(e,n,t,l,o){const[a,d]=le(e,"checkedKeys",()=>[]),c=y(()=>({data:n.value,dataMap:t.value,parentKeyMap:l.value,depthMap:o.value})),f=$("children"),s=$(r=>r.key),g=y(()=>e.cascaderStrategy),h=$(r=>!!r.checkDisabled),{checkStateResolver:i,isChecked:C,isIndeterminate:m,toggle:N}=Ge(a,c,f,s,g,h),I=r=>{const{checked:k,checkedKeys:v}=N(r);r.checkDisabled||w(k,r.rawNode,v)},w=(r,k,v)=>{const{onCheck:D,onCheckedChange:u}=e;F(D,r,k),d(v),J(t,v,u)};return Ne(g,()=>{const r=i.appendKeys([],a.value);d(r),J(t,r,e.onCheckedChange)}),{checkedKeys:a,isChecked:C,isIndeterminate:m,handleCheck:I}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ye(e,n,t,l){const o=$({}),a=(i,C)=>{o.value[i]=C},d=i=>o.value[i],c=y(()=>{const i=new Map,C=new Map,m=new Map;return{mergedNodes:Ae(e.dataSource,d,{props:e,childrenKey:n.value,getKey:t.value,labelKey:l.value,parentKey:void 0,parentLevel:-1,parentsDisabled:[]},{dataKeyMap:i,parentKeyMap:C,depthMap:m}),dataKeyMap:i,parentKeyMap:C,depthMap:m}}),f=y(()=>c.value.mergedNodes),s=y(()=>c.value.dataKeyMap),g=y(()=>c.value.parentKeyMap),h=y(()=>c.value.depthMap);return{mergedNodes:f,mergedNodeMap:s,parentKeyMap:g,depthMap:h,setLoadedNodes:a}}function Ze(e,{expandedKeys:n},t,l){const o=y(()=>{const{searchValue:c}=t,f=new Map(n.value.map((h,i)=>[h,i])),s=new Map(l.value.map((h,i)=>[h,i])),g=new Map;return c&&!s.size?{flattedNodes:[],flattenedNodeMap:g}:f.size||s.size?{flattedNodes:en(e.value,f,s,g),flattenedNodeMap:g}:{flattedNodes:e.value.map(h=>{const i={...h,expanded:!1,level:0};return g.set(i.key,i),i}),flattenedNodeMap:g}}),a=y(()=>o.value.flattedNodes),d=y(()=>o.value.flattenedNodeMap);return{flattedNodes:a,flattenedNodeMap:d}}function Ae(e,n,t,l){const{props:o,childrenKey:a,getKey:d,labelKey:c,parentKey:f,parentLevel:s,parentsDisabled:g}=t,{cascaderStrategy:h,disabled:i,loadChildren:C}=o,{dataKeyMap:m,parentKeyMap:N,depthMap:I}=l,w=!!C;return e.map((r,k)=>{var T,B,P;const v=d(r),D=Je(r,i),u=(T=r[a])!=null?T:n(v),p=r[c],S=s+1,L=u&&Ae(u,n,{props:o,childrenKey:a,getKey:d,labelKey:c,parentKey:v,parentLevel:S,parentsDisabled:[D,...g!=null?g:[]]},l),M=Qe(D,g!=null?g:[],(B=L==null?void 0:L.map(q=>({check:q.checkDisabled,drag:q.dragDisabled,drop:q.dropDisabled,select:q.selectDisabled})))!=null?B:[],h!=="off"),U={label:p,key:v,children:L,isFirst:k===0,isLeaf:(P=r.isLeaf)!=null?P:!(u!=null&&u.length||w),isLast:k===e.length-1,parentKey:f,expanded:!1,level:S,rawNode:r,checkDisabled:M.check,dragDisabled:M.drag,dropDisabled:M.drop,selectDisabled:M.select};return m.set(v,U),N.set(v,f),I.set(v,S),U})}function Je(e,n){const t=e.disabled||{};if(t===!0)return{check:!0,drag:!0,drop:!0,select:!0};let{check:l,drag:o,drop:a,select:d}=t;if(n){const c=n(e)||{};if(c===!0)return{check:!0,drag:!0,drop:!0,select:!0};l=l||c.check,o=o||c.drag,a=a||c.drop,d=d||c.select}return{check:l,drag:o,drop:a,select:d}}function Qe(e,n,t,l){const o=a=>e[a]||l&&(n.some(d=>!!d[a])||!!t.length&&t.every(d=>!!d[a]));return{check:o("check"),drag:o("drag"),drop:o("drop"),select:o("select")}}function Fe(e=[],n){const t=[],l=e.length;return e.forEach((o,a)=>{o.isFirst=a===0,o.isLast=a===l-1,n.has(o.key)||n.size==0?(o.hidden=!1,t.push(o)):o.hidden=!0,Fe(o.children,n).length>0&&(o.hidden=!1,t.push(o))}),t.length&&(t[0].isFirst=!0,t[t.length-1].isLast=!0),t}function en(e,n,t,l){const o=[],a=[];return Fe(e,t),e.forEach(d=>{for(a.push({...d});a.length;){const c=a.pop();if(c){const{children:f,key:s,hidden:g}=c,h=n.has(s);if(c.expanded=h,!g&&o.push(c),l.set(c.key,c),f&&h)for(let i=f.length;i>0;i--)!f[i-1].hidden&&a.push(f[i-1])}}}),o}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nn(e,n,{expandedKeys:t,setExpandedKeys:l}){const o=y(()=>{var u;return(u=e.draggableIcon)!=null?u:n.draggableIcon}),a=$(),d=$(),c=$(),f=$(),s=$();let g;const h=()=>{g&&(clearTimeout(g),g=void 0)};$e(()=>h());const i=()=>{Z(a.value)||(a.value=void 0,d.value=void 0)},C=()=>{Z(c.value)||(c.value=void 0,f.value=void 0,s.value=void 0)},m=(u,p)=>{var S,L;return{evt:u,node:p.rawNode,dragNode:(S=a.value)==null?void 0:S.rawNode,dropNode:(L=c.value)==null?void 0:L.rawNode,dropType:s.value}},N=u=>{w(u,void 0),window.removeEventListener("dragend",N)},I=(u,p)=>{a.value=p,d.value=we(p),an(p.key,t.value,l),window.addEventListener("dragend",N),F(e.onDragstart,m(u,p))},w=(u,p)=>{p&&F(e.onDragend,m(u,p)),i(),C()},r=async(u,p)=>{const S=a.value;if(S){h(),S.key!==p.key&&(g=setTimeout(()=>{var M;a.value&&((M=p.children)!=null&&M.length)&&tn(p.key,t.value,l),g=void 0},1e3));const L=await me(p,S,d.value,u,e.droppable);L?(c.value=p,f.value=L!=="inside"?p.parentKey:void 0,s.value=L):C()}F(e.onDragenter,m(u,p))},k=async(u,p)=>{const S=a.value;if(S){const L=await me(p,S,d.value,u,e.droppable);L?(c.value=p,f.value=L!=="inside"?p.parentKey:void 0,s.value=L):C()}F(e.onDragover,m(u,p))},v=(u,p)=>{const S=c.value;(S==null?void 0:S.key)===p.key&&!u.currentTarget.contains(u.relatedTarget)&&C(),F(e.onDragleave,m(u,p))},D=(u,p)=>{s.value||C(),F(e.onDrop,m(u,p)),i(),C()};return{draggableIcon:o,dragKey:y(()=>{var u;return(u=a.value)==null?void 0:u.key}),dropKey:y(()=>{var u;return(u=c.value)==null?void 0:u.key}),dropParentKey:f,dropType:s,handleDragstart:I,handleDragend:w,handleDragenter:r,handleDragover:k,handleDragleave:v,handleDrop:D}}function tn(e,n,t){n.indexOf(e)===-1&&t([...n,e])}function an(e,n,t){const l=n.indexOf(e);if(l!==-1){const o=[...n];o.splice(l,1),t(o)}}async function me(e,n,t,l,o){const{key:a,children:d=[]}=e;if(n.key===a||t&&t.includes(a))return!1;const{clientY:c}=l,{top:f,height:s}=l.target.getBoundingClientRect(),g=c<f+s/2;let h;if(o){const i={evt:l,isTopHalf:g,dragNode:n.rawNode,dropNode:e.rawNode};h=await o(i)}return(h===void 0||h===!0)&&(d.length>0?h="inside":g?h="before":h="after"),h}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function on(e,n,t,{expandedKeys:l,handleExpand:o},{activeKey:a,handleSelect:d}){const c=$(!1);return{focused:c,handleFocus:i=>{c.value=!0,F(e.onFocus,i)},handleBlur:i=>{c.value=!0,F(e.onBlur,i)},handleKeydown:i=>{switch(i.code){case"ArrowUp":case"ArrowDown":i.preventDefault()}F(e.onKeydown,i)},handleKeyup:i=>{const C=i.code,m=a.value,N=t.value,I=N.length;if(m===void 0)["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(C)&&ve(a,N,0,I);else{const w=t.value,r=w.findIndex(k=>k.key===m);if(r===-1)return;switch(C){case"Enter":case"NumpadEnter":d(m);break;case"ArrowDown":ve(a,w,r+1,I);break;case"ArrowUp":ve(a,w,r-1,0,!0);break;case"ArrowLeft":{const{rawNode:k,key:v,parentKey:D}=w[r];if(k.isLeaf||!l.value.includes(v)){const u=D?n.value.get(D):void 0;u&&(a.value=u.key)}else o(v,k)}break;case"ArrowRight":{const{rawNode:k,key:v}=w[r];if(!l.value.includes(v))o(v,k);else for(let D=r+1;D<I;D++){const u=w[D];a.value=u.key;break}}break}}F(e.onKeyup,i)}}}function ve(e,n,t,l,o=!1){let a=t;for(;o?a>=l:a<l;){const d=n[a];if(d.selectDisabled)o?a--:a++;else{e.value=d.key;return}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ln(e,n,t,l,o,a){const d=y(()=>{var r;return(r=e.expandIcon)!=null?r:n.expandIcon}),[c,f]=le(e,"expandedKeys",()=>[]),[s,g]=le(e,"loadedKeys",()=>[]),h=$([]),i=({key:r,expanded:k,node:v})=>{if(Be(d.value))return xe(W,{name:d.value,rotate:k?90:0});if(Pe(d.value))return d.value({key:r,expanded:k,node:v});if(Te(d.value))return xe(W,{name:k?d.value[0]:d.value[1]})},C=r=>{if(!r||r.length<=0)return;const{onExpandedChange:k}=e,v=l.value,D=new Set(c.value);r.forEach(p=>{Le(v,v.get(p)).forEach(S=>D.add(S))});const u=[...D];f(u),J(l,u,k)};Ne(o,C);const m=async(r,k)=>{var L;const{loadChildren:v}=e;if(h.value.includes(r))return;const D=t.value;if(!((L=k==null?void 0:k[D])!=null&&L.length)){if(!v||h.value.includes(r)||s.value.includes(r))return;h.value.push(r);const M=await v(k);h.value.splice(h.value.indexOf(r),1);const T=l.value.get(r);if(M!=null&&M.length){a(r,M),T.rawNode[D]=M;const B=[...s.value,r];g(B),F(e.onLoaded,B,k)}else return}const u=c.value.indexOf(r),p=u>=0,S=[...c.value];p?S.splice(u,1):S.push(r),N(p,k,S)},N=(r,k,v)=>{const{onExpand:D,onExpandedChange:u}=e;F(D,!r,k),f(v),J(l,v,u)},I=()=>{const r=[],k=[];l.value.forEach(v=>{v.isLeaf||(r.push(v.key),k.push(v.rawNode))}),F(e.onExpandedChange,r,k),f(r)},w=()=>{F(e.onExpandedChange,[],[]),f([])};return o.value.length&&C(o.value),{expandIconRenderer:i,expandedKeys:c,setExpandedKeys:f,expandAll:I,collapseAll:w,handleExpand:m,loadingKeys:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rn(e,n,t){const l=dn(e,t);return{searchedKeys:y(()=>{const{searchValue:a}=e;if(!a)return Ee;const d=l.value,c=[];return n.value.forEach(f=>{d(f.rawNode,a)&&c.push(f.key)}),c})}}function dn(e,n){return y(()=>{var t;return(t=e.searchFn)!=null?t:cn(n.value)})}function cn(e){return(n,t)=>{const l=n[e];return l?l.toLowerCase().includes(t.toLowerCase()):!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function sn(e,n){const[t,l]=le(e,"selectedKeys",()=>[]),o=y(()=>e.selectable==="multiple"),a=$();Oe(()=>{const s=t.value,g=s.length;a.value=g>0?s[g-1]:void 0});const d=y(()=>{const s=a.value;return s!==void 0?n.value.get(s):void 0}),c=s=>{const h=n.value.get(s);if(!h)return;const i=t.value.indexOf(s),C=i>-1;let m=[...t.value];o.value?C?m.splice(i,1):m.push(s):m=C?[]:[s],f(C,h.rawNode,m)},f=(s,g,h)=>{var N;const{onSelect:i,onSelectedChange:C}=e,m=h.includes((N=g.key)!=null?N:"")?!0:!s;F(i,m,g),l(h),J(n,h,C)};return{activeKey:a,activeNode:d,selectedKeys:t,handleSelect:c}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const G=Symbol("treeToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const un={autoHeight:{type:Boolean,default:void 0},checkedKeys:Array,expandedKeys:Array,indeterminateKeys:Array,loadedKeys:Array,selectedKeys:Array,blocked:{type:Boolean,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},childrenKey:String,checkOnClick:{type:Boolean,default:!1},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:Function,draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:Function,empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},height:Number,labelKey:String,leafLineIcon:String,loadChildren:Function,searchFn:Function,searchValue:String,selectable:{type:[Boolean,String],default:!0},showLine:{type:Boolean,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualItemHeight:{type:Number,default:32},"onUpdate:checkedKeys":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],"onUpdate:selectedKeys":[Function,Array],onCheck:[Function,Array],onCheckedChange:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onSelect:[Function,Array],onSelectedChange:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onKeydown:[Function,Array],onKeyup:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},hn={node:{type:Object,required:!0},isLeaf:{type:Boolean,required:!0},isFirst:{type:Boolean,required:!0},isLast:{type:Boolean,required:!0},label:String,level:{type:Number,required:!0},rawNode:{type:Object,required:!0},expanded:{type:Boolean,required:!0},children:Array,parentKey:[String,Number,Symbol],checkDisabled:{type:Boolean,default:void 0},dragDisabled:{type:Boolean,default:void 0},dropDisabled:{type:Boolean,default:void 0},selectDisabled:{type:Boolean,default:void 0}},gn={node:{type:Object,required:!0},checkDisabled:{type:Boolean,default:void 0}},fn={expanded:{type:Boolean,required:!0},hasTopLine:{type:Boolean,default:void 0},hasBottomLine:{type:Boolean,default:void 0},isLeaf:{type:Boolean,default:void 0},nodeKey:{type:[String,Number,Symbol],required:!0},rawNode:{type:Object,required:!0}},vn={disabled:{type:Boolean,default:void 0},node:{type:Object,required:!0},nodeKey:{type:[String,Number,Symbol],required:!0},label:String,selected:{type:Boolean,default:void 0}};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const yn=V({props:gn,setup(e){const{mergedPrefixCls:n,isChecked:t,isIndeterminate:l,handleCheck:o}=Q(G),a=y(()=>t(e.node.key)),d=y(()=>l(e.node.key)),c=()=>o(e.node);return()=>K(He,{class:`${n.value}-node-checkbox`,checked:a.value,disabled:e.checkDisabled,indeterminate:d.value,onChange:c},null)}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const pn=V({props:vn,setup(e,{slots:n}){const{props:t,mergedPrefixCls:l,mergedCheckOnClick:o,handleSelect:a,handleCheck:d,searchedKeys:c}=Q(G),f=y(()=>c.value.includes(e.nodeKey)),s=h=>{e.disabled||(a(e.nodeKey),o.value&&d(e.node)),F(t.onNodeClick,h,e.node.rawNode)},g=h=>{F(t.onNodeContextmenu,h,e.node.rawNode)};return()=>{var u,p;const{nodeKey:h,label:i,node:C,selected:m}=e,{rawNode:N}=C,{prefix:I,suffix:w}=N,r={key:h,selected:m,node:N},k=((u=n.prefix)==null?void 0:u.call(n,r))||I&&K(W,{name:I},null),v=((p=n.suffix)==null?void 0:p.call(n,r))||w&&K(W,{name:w},null),D=`${l.value}-node-content`;return K("span",{class:D,onClick:s,onContextmenu:g},[k&&K("span",{class:`${D}-prefix`},[k]),K("span",{class:`${D}-label`},[bn(n.label,i,N,t.searchValue,f.value,D)]),v&&K("span",{class:`${D}-suffix`},[v])])}}});function bn(e,n,t,l,o,a){if(e)return e({node:t,searchValue:l,searched:o});if(o&&n&&l){const d=n.toUpperCase().indexOf(l.toUpperCase());if(d>-1){const c=d+l.length,f=n.substring(0,d),s=n.substring(c),g=K("span",{class:`${a}-label-highlight`},[n.substring(d,c)]);return[f,g,s]}}return n}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const kn=V({props:fn,setup(e,{slots:n}){const{mergedPrefixCls:t,expandIconRenderer:l,loadingKeys:o,handleExpand:a}=Q(G),d=y(()=>o.value.includes(e.nodeKey)),c=y(()=>{const s=`${t.value}-node-expand`;return qe({[s]:!0,[`${s}-noop`]:e.isLeaf})}),f=s=>{a(e.nodeKey,e.rawNode),s.stopPropagation()};return()=>{var h,i;const s=`${t.value}-node-expand`;let g;if(d.value)g=K(W,{name:"loading"},null);else if(!e.isLeaf){const{expanded:C,nodeKey:m,rawNode:N}=e;g=(i=(h=n.expandIcon)!=null?h:l)==null?void 0:i({key:m,expanded:C,node:N})}return K("span",{class:c.value,onClick:f,role:"button","aria-label":e.expanded?"collapse-all":"expand-all","aria-expanded":e.isLeaf?void 0:String(e.expanded)},[e.hasTopLine&&K("div",{class:`${s}-top-line`},null),g,e.hasBottomLine&&K("div",{class:`${s}-bottom-line`},null)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const xn=({level:e,noopIdentUnitArr:n,prefixCls:t})=>{const l=[];for(let o=0;o<e;o++)l.push(K("span",{key:o,class:n.includes(o)?`${t}-node-indent-noop-unit`:`${t}-node-indent-unit`},null));return K("span",{"aria-hidden":!0,class:`${t}-node-indent`},[l])},Cn=xn;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const mn=V({setup(e,{slots:n}){const{props:t,mergedPrefixCls:l}=Q(G);return()=>{const o=`${l.value}-node-leaf`;let a;return n.leafLineIcon?a=n.leafLineIcon():t.leafLineIcon?a=K(W,{name:t.leafLineIcon},null):a=K("span",{class:`${o}-line`},null),K("span",{class:o},[a])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ke=V({props:hn,setup(e,{slots:n}){const{props:t,flattenedNodeMap:l,mergedPrefixCls:o,mergedShowLine:a,activeKey:d,selectedKeys:c,draggableIcon:f,dragKey:s,dropKey:g,dropParentKey:h,dropType:i,handleDragstart:C,handleDragend:m,handleDragenter:N,handleDragover:I,handleDragleave:w,handleDrop:r,isChecked:k}=Q(G),v=y(()=>e.node.key),D=y(()=>d.value===v.value),u=y(()=>a.value&&e.isLast),p=y(()=>a.value&&!e.isLeaf&&(!e.isFirst||e.level!==0)),S=y(()=>a.value&&!e.isLeaf&&!e.isLast),L=y(()=>c.value.includes(v.value)),M=y(()=>k(e.node.key)),U=y(()=>e.selectDisabled||!t.selectable),T=y(()=>s.value===v.value),B=y(()=>g.value===v.value),P=y(()=>h.value===v.value),q=y(()=>B.value&&i.value==="before"),ee=y(()=>B.value&&i.value==="inside"),ne=y(()=>B.value&&i.value==="after"),re=y(()=>{const x=`${o.value}-node`;return{[x]:!0,[`${x}-active`]:D.value,[`${x}-last`]:u.value,[`${x}-disabled`]:U.value,[`${x}-selected`]:L.value,[`${x}-expanded`]:e.expanded,[`${x}-dragging`]:T.value,[`${x}-dropping`]:B.value,[`${x}-drop-parent`]:P.value,[`${x}-drop-before`]:q.value,[`${x}-drop-inside`]:ee.value,[`${x}-drop-after`]:ne.value}}),de=x=>{var R;x.stopPropagation(),C(x,e.node),(R=x.dataTransfer)==null||R.setData("text/plain","")},ce=x=>{x.stopPropagation(),m(x,e.node)},se=x=>{x.preventDefault(),x.stopPropagation(),N(x,e.node)},ie=x=>{x.preventDefault(),x.stopPropagation(),I(x,e.node)},ue=x=>{x.stopPropagation(),w(x,e.node)},he=x=>{x.stopPropagation(),r(x,e.node)};return()=>{var pe,be;const x=l.value,{isLeaf:R,label:X,level:Y,rawNode:te,expanded:ae,checkDisabled:b,dragDisabled:A,dropDisabled:O,node:E}=e,{checkable:_,draggable:z}=t,H=z&&!A,ge=(be=(pe=n.draggableIcon)==null?void 0:pe.call(n))!=null?be:K(W,{name:f.value},null),fe=x.get(v.value),oe=[];a.value&&Le(x,fe).reverse().forEach((Ie,Me)=>{var ke;(ke=x.get(Ie))!=null&&ke.isLast&&oe.push(Me)});const j=t.customAdditional?t.customAdditional({node:te,level:Y}):void 0;return K("div",ye({class:re.value,"aria-grabbed":T.value||void 0,"aria-label":X,"aria-selected":String(M.value),"aria-expanded":R?void 0:String(ae),"aria-level":Y,role:"treeitem",draggable:H||void 0,title:X,onDragstart:H?de:void 0,onDragend:H?ce:void 0,onDragenter:H?se:void 0,onDragover:H?ie:void 0,onDragleave:H?ue:void 0,onDrop:H&&!O?he:void 0},j),[K(Cn,{level:Y,noopIdentUnitArr:oe,prefixCls:o.value},null),H?K("span",{class:`${o.value}-node-draggable-icon`,role:"img"},[ge]):z&&K("span",{class:`${o.value}-node-draggable-icon-noop`},null),R&&a.value?K(mn,null,n):K(kn,{expanded:ae,hasTopLine:p.value,hasBottomLine:S.value,isLeaf:R,nodeKey:v.value,rawNode:te},n),_&&K(yn,{checkDisabled:b,node:E},null),K(pn,{disabled:U.value,node:E,nodeKey:v.value,label:X,selected:L.value},n)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function De(e){const{heightMd:n,heightSm:t,marginSizeXs:l,colorPrimaryHover:o,colorPrimaryText:a,colorContainerBgHover:d,colorContainerBg:c,colorIconInfo:f}=e;return{dropLineWidth:2,dropLineColor:o,bgColor:c,nodeBgColorHover:d,nodeBgColorSelected:c,nodeColorSelected:a,nodePaddingHorizontal:l,nodePaddingVertical:"0px",nodeContentHeight:n,nodeContentLabelHighlightColor:a,nodeContentPrefixMarginRight:l,nodeCheckboxMarginRight:l,nodeIconWidth:t,expandIconColor:f}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Kn=(e,n)=>De(e);/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Se={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},Dn=V({name:"IxTree",props:un,setup(e,{attrs:n,expose:t,slots:l}){const o=Ce("common"),{globalHashId:a,hashId:d,registerToken:c}=Ue("tree");c(Kn);const f=y(()=>`${o.prefixCls}-tree`),s=Ce("tree"),g=y(()=>{var b;return(b=e.autoHeight)!=null?b:s.autoHeight}),h=y(()=>{var b;return(b=e.childrenKey)!=null?b:s.childrenKey}),i=Re(e,s),C=y(()=>{var b;return(b=e.labelKey)!=null?b:s.labelKey}),m=y(()=>{var b;return(b=e.showLine)!=null?b:s.showLine}),N=y(()=>{var b;return(b=e.blocked)!=null?b:s.blocked}),I=y(()=>e.checkable&&e.checkOnClick),{mergedNodes:w,mergedNodeMap:r,parentKeyMap:k,depthMap:v,setLoadedNodes:D}=Ye(e,h,i,C),{searchedKeys:u}=rn(e,r,C),p=ln(e,s,h,r,u,D),{flattedNodes:S,flattenedNodeMap:L}=Ze(w,p,e,u),M=Xe(e,w,r,k,v),U=nn(e,s,p),T=sn(e,r),{handleCheck:B}=M;_e(G,{props:e,config:s,flattedNodes:S,flattenedNodeMap:L,mergedPrefixCls:f,mergedNodeMap:r,mergedGetKey:i,mergedShowLine:m,mergedCheckOnClick:I,searchedKeys:u,...M,...p,...U,...T});const P=$(),q=$(),{activeKey:ee}=T,{focused:ne,handleFocus:re,handleBlur:de,handleKeydown:ce,handleKeyup:se}=on(e,r,S,p,T),ie=y(()=>{const b=f.value;return{[a.value]:!!a.value,[d.value]:!!d.value,[b]:!0,[`${b}-active`]:!Z(ee.value),[`${b}-blocked`]:N.value,[`${b}-virtual`]:e.virtual,[`${b}-auto-height`]:g.value,[`${b}-focused`]:ne.value,[`${b}-show-line`]:m.value,[`${b}-empty`]:!S.value.length}}),ue=y(()=>{var _,z;const b=ee.value;if(Z(b))return"";const A=r.value;let O=String(b),E=(_=A.get(b))==null?void 0:_.parentKey;for(;E;)O=`${String(E)} > ${O}`,E=(z=A.get(E))==null?void 0:z.parentKey;return O}),he=b=>{var A;(A=P==null?void 0:P.value)==null||A.focus(b)},x=()=>{var b;(b=P==null?void 0:P.value)==null||b.blur()},R=b=>{var A;(A=q.value)==null||A.scrollTo(b)},X=b=>{var A;return(A=r.value.get(b))==null?void 0:A.rawNode},Y=()=>S.value,te=b=>{const A=r.value.get(b);A&&B(A)};t({focus:he,blur:x,expandAll:p.expandAll,collapseAll:p.collapseAll,scrollTo:R,getNode:X,_getFlattedNodes:Y,_handleCheck:te});const ae=(b,A,O)=>{F(e.onScrolledChange,b,A,O.map(E=>E.rawNode))};return()=>{var O;const b=S.value;let A;if(b.length>0){const E=({item:j})=>K(Ke,ye({node:j},j),l),{height:_,virtual:z,virtualItemHeight:H,virtualScrollMode:ge,onScroll:fe,onScrolledBottom:oe}=e;A=z?K(ze,{ref:q,class:`${f.value}-content`,dataSource:b,getKey:"key",height:g.value?"100%":_,rowHeight:H,rowRender:E,virtual:!0,scrollMode:ge,onScroll:fe,onScrolledBottom:oe,onScrolledChange:ae},null):K("div",{class:`${f.value}-content`,style:je(g.value?void 0:{maxHeight:We(_)})},[K("div",{class:`${f.value}-content-inner`},[b.map(j=>K(Ke,ye({node:j},j),l))])])}else A=K(Ve,{empty:e.empty},l);return K("div",{class:ie.value,role:"tree"},[ne.value&&K("span",{style:Se,"aria-live":"assertive"},[ue.value]),K("input",{ref:P,style:Se,tabindex:(O=n.tabIndex)!=null?O:0,onFocus:re,onBlur:de,onKeydown:ce,onKeyup:se,value:"","aria-label":"for screen reader"},null),A])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const wn=Dn;export{wn as I};
