import{d as E,i as F,c as v,ce as ye,f as h,$ as V,bg as ve,X as ce,an as ne,aW as Ce,N as be,k as pe,c5 as ke,R as B,W as X,L as xe,bb as de,x as G,bk as O,P as Z,a0 as oe,au as J,q as te,ao as Se,T as Te,U as Ie,V as we,db as De,Z as se,as as Re,bs as Ke,a5 as ze,af as Pe,bi as Ve,b8 as Fe,I as $e}from"./index-200961bb.js";import{t as Le,g as Ee,T as fe,I as Ae}from"./index-95720a3a.js";import{u as Q}from"./globalConfig-f3272348.js";import{I as Be}from"./index-5472db4c.js";import{I as He}from"./index-ab7d46a1.js";import{u as We,a as _e}from"./index-ec0b7a0f.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const H=Symbol("proTableToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Oe(e,n){const{title:a,type:t}=e;return a||(t?n.layout[t]:"")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Y=E({props:{columns:{type:Array,required:!0},checkedKeys:{type:Array,required:!0},searchValue:{type:String,default:void 0},title:{type:String,default:void 0},onDrop:{type:Function,required:!0},onFixedChange:{type:Function,required:!0},onVisibleChange:{type:Function,required:!0}},setup(e){const{locale:n,mergedPrefixCls:a}=F(H),t=v(()=>new Set(ye(e.columns,"children",s=>s.key,!0))),o=s=>{const l=new Set(s),i=new Set(e.checkedKeys.filter(f=>t.value.has(f)));s.forEach(f=>{i.has(f)&&(l.delete(f),i.delete(f))}),e.onVisibleChange(l,i)},u=s=>{const{dragNode:l,dropNode:i}=s,f=l==null?void 0:l.key,S=i==null?void 0:i.key;!f||!S||e.onDrop(s)},d=(s,l,i)=>{i.preventDefault(),i.stopImmediatePropagation(),e.onFixedChange(l,s)};return()=>{if(e.columns.length===0)return;const s=`${a.value}-layout-tool-tree`,{columns:l,searchValue:i,title:f}=e,{startPin:S,endPin:I,noPin:p}=n.table.layout,T={blocked:!0,cascaderStrategy:"child",checkable:!0,checkedKeys:e.checkedKeys,checkOnClick:!0,draggable:!0,dataSource:l,disabled:Me,empty:"",childrenKey:"children",getKey:"key",labelKey:"title",searchValue:i,searchFn:()=>!0,onCheckedChange:o,onDrop:u},w={label:({node:m})=>Oe(m,n.table),suffix:({node:m})=>{if(m.changeFixed===!1||m.parentKey!=null)return null;const{fixed:k}=m;return k==="start"?[h(V,{name:"vertical-align-center",title:p,onClick:y=>d(void 0,m,y)},null),h(V,{name:"vertical-align-top",rotate:180,title:I,onClick:y=>d("end",m,y)},null)]:k==="end"?[h(V,{name:"vertical-align-top",title:S,onClick:y=>d("start",m,y)},null),h(V,{name:"vertical-align-center",title:p,onClick:y=>d(void 0,m,y)},null)]:[h(V,{name:"vertical-align-top",title:S,onClick:y=>d("start",m,y)},null),h(V,{name:"vertical-align-top",rotate:180,title:I,onClick:y=>d("end",m,y)},null)]}};return h("div",{class:s},[f&&h("div",{class:`${s}-title`},[f]),h(He,T,w)])}}});function Me(e){const{changeIndex:n,changeVisible:a}=e;return n!==!1&&a!==!1?!1:{check:a===!1,select:a===!1,drag:n===!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ne={...Le,columns:{type:Array,default:()=>[]},layoutTool:{type:[Boolean,Object],default:!0},toolbar:{type:Array,default:void 0},dndSortable:{type:[Boolean,Object]},columnDndSortable:{type:[Boolean,Object]},onColumnsChange:[Function,Array],onDndSortReorder:[Function,Array],onDndSortChange:[Function,Array]},qe={changeSize:{type:Boolean,default:void 0},className:{type:String,default:void 0},placeholder:{type:String,default:void 0},resetable:{type:Boolean,default:void 0},searchable:{type:Boolean,default:void 0},searchValue:{type:String,default:void 0},visible:{type:Boolean,default:void 0},"onUpdate:searchValue":[Function,Array],"onUpdate:visible":[Function,Array],onReset:[Function,Array]},Ue={placeholder:{type:String,default:void 0},resetable:{type:Boolean,required:!0},searchable:{type:Boolean,required:!0},searchValue:{type:String,default:void 0},"onUpdate:searchValue":[Function,Array],onReset:[Function,Array]};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */var N=function(e){return e[e.start=0]="start",e[e.center=1]="center",e[e.end=2]="end",e}(N||{});const Ge=E({props:Ue,setup(e){const{locale:n,mergedPrefixCls:a,mergedColumns:t,checkedColumnKeys:o,setMergedColumns:u,mergedColumnMap:d,resetColumns:s}=F(H),l=v(()=>t.value.length!==d.value.size),i=v(()=>t.value.filter(r=>r.visible===!1)),[f,S]=ve(e,"searchValue"),I=v(()=>{var g;const r=(g=f.value)==null?void 0:g.toLowerCase();return ce(t.value,"children",C=>{if(C.layoutable===!1)return!1;if(!r)return!0;const{title:b}=C;return b?b.toLowerCase().includes(r):!1})}),p=v(()=>ee(I.value)),T=r=>{const g=r.target.value;S(g)},w=r=>{B(e.onReset,r)!==!1&&s()},m=r=>{const g=X(t.value,"children",(C,b)=>{var x;const c={...C};return!((x=C.children)!=null&&x.length)&&C.changeVisible!==!1&&C.layoutable!==!1&&b.every(D=>D.layoutable!==!1)&&(c.visible=r),c});u(g)},k=(r,g)=>{const C=X(t.value,"children",(D,$)=>{const K={...D};return(D.key===r.key||$.some(L=>L.key===r.key))&&(K.fixed=g),K}),{startColumns:b,centerColumns:c,endColumns:x}=ee(C);u([...b,...c,...x])},y=(r,g)=>{const C=X(t.value,"children",b=>{const c={...b};return r.has(b.key)&&(c.visible=!0),g.has(b.key)&&(c.visible=!1),c});u(C)},R=(r,g)=>{const{dragNode:C,dropNode:b,dropType:c}=g,x=C==null?void 0:C.key,D=b==null?void 0:b.key;if(!x||!D)return;const{startColumns:$,centerColumns:K,endColumns:L}=ee(t.value),W=[$,K,L].reduce((A,z,P)=>P===r?A.concat(je(z,x,D,c)):A.concat(z),[]);u(W)};return()=>{var re;const{startColumns:r,centerColumns:g,endColumns:C}=p.value,b=r.length>0,c=C.length>0,x=b||c,D=`${a.value}-layout-tool`,$=ne({[`${D}-content`]:!0,[`${D}-with-fixed`]:x,[`${D}-with-children`]:l.value}),{placeholder:K,all:L,reset:W,startPinTitle:A,noPinTitle:z,endPinTitle:P}=n.table.layout,le=t.value.length,j=i.value.length,me=j===0&&le!==0,ge=j>0&&j!==le,M=f.value;return h("div",{class:$},[e.searchable&&h("div",{class:`${D}-search-wrapper`},[h(Ce,{placeholder:(re=e.placeholder)!=null?re:K,size:"sm",suffix:"search",value:M,onInput:T},null)]),h("div",{class:`${D}-select-wrapper`},[h(be,{checked:me,indeterminate:ge,label:L,onChange:m},null),e.resetable&&h(pe,{size:"sm",mode:"link",onClick:w},{default:()=>[W]})]),I.value.length?h("div",{class:`${D}-tree-wrapper`},[b&&h(Y,{key:"start",columns:r,checkedKeys:o.value.start,searchValue:M,title:A,onDrop:_=>R(N.start,_),onFixedChange:k,onVisibleChange:y},null),(!x||g.length>0)&&h(Y,{key:"center",columns:g,checkedKeys:o.value.center,searchValue:M,title:x?z:void 0,onDrop:_=>R(N.center,_),onFixedChange:k,onVisibleChange:y},null),c&&h(Y,{key:"end",columns:C,checkedKeys:o.value.end,searchValue:M,title:P,onDrop:_=>R(N.end,_),onFixedChange:k,onVisibleChange:y},null)]):h(ke,{simple:!0},null)])}}});function ee(e){const n=[],a=[],t=[];return e.forEach(o=>{const{fixed:u}=o;u==="start"?n.push(o):u==="end"?a.push(o):t.push(o)}),{startColumns:n,endColumns:a,centerColumns:t}}function je(e,n,a,t){const o=[...e];let u;if(q(o,n,(d,s,l)=>{u=d,l.splice(s,1)}),t==="inside")q(o,a,d=>{d.children.unshift(u)});else{let d,s=[];q(o,a,(l,i,f)=>{d=i,s=f}),t==="before"?s.splice(d,0,u):s.splice(d+1,0,u)}return o}function q(e,n,a){for(let t=0;t<e.length;t++){const o=e[t];if(o.key===n)return a(o,t,e);"children"in o&&o.children&&q(o.children,n,a)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Xe=[0,4],Ze={sm:"grid-compact",md:"grid-medium",lg:"grid-loose"},he=E({name:"IxProTableLayoutTool",props:qe,setup(e,{slots:n}){const{config:a,locale:t,mergedPrefixCls:o,mergedSize:u,setMergedSize:d}=F(H),s=v(()=>{var f;return(f=e.changeSize)!=null?f:a.layoutTool.changeSize}),l=v(()=>{var f;return(f=e.resetable)!=null?f:a.layoutTool.resetable}),i=v(()=>{var f;return(f=e.searchable)!=null?f:a.layoutTool.searchable});return()=>{var m;const f=`${o.value}-layout-tool`,S=t.table.layout,I=k=>{const y=Ze[k],R=S[k];return h(V,{key:y,class:ne([`${f}-header-icon`,u.value===k?`${f}-header-icon-active`:""]),name:y,title:R,onClick:()=>d(k)},null)},p=s.value?h(xe,null,{default:()=>[I("sm"),I("md"),I("lg")]}):void 0,T={placeholder:e.placeholder,resetable:l.value,searchable:i.value,searchValue:e.searchValue,"onUpdate:searchValue":e["onUpdate:searchValue"],onReset:e.onReset},w={class:ne([f,e.className]),header:{title:S.title,suffix:p},offset:Xe,placement:"bottomEnd",showArrow:!1,trigger:"click",visible:e.visible,"onUpdate:visible":e["onUpdate:visible"]};return h(Be,w,{default:(m=n.default)!=null?m:()=>h("span",{class:`${f}-trigger`},[h(V,{name:"ellipsis"},null)]),content:()=>h(Ge,T,null)})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Je(e,n,a,t,o){const u=v(()=>e.columns),[d,s]=de(U(t.value,u.value,n,a,o.value)),l=v(()=>{const p=new Map,T={start:[],center:[],end:[]},w=ce(d.value,"children",(m,k)=>{var R;const y=m.key;return p.set(y,m),m.visible===!1||k.some(r=>r.visible===!1)?!1:(!((R=m.children)!=null&&R.length)&&m.layoutable!==!1&&k.every(r=>r.layoutable!==!1)&&(ie("start",m,k)?T.start.push(y):ie("end",m,k)?T.end.push(y):T.center.push(y)),!0)},"and");return{map:p,checkedKeys:T,displayColumns:w}}),i=v(()=>l.value.map),f=v(()=>l.value.checkedKeys),S=v(()=>l.value.displayColumns);return G(u,p=>s(U(t.value,p,n,a,o.value))),G(d,p=>{const T=Ye(p,u.value,o.value);B(e.onColumnsChange,T)}),{checkedColumnKeys:f,mergedColumns:d,setMergedColumns:s,mergedColumnMap:i,displayColumns:S,resetColumns:()=>s(U(t.value,u.value,n,a,o.value))}}const ae="__idux-pro-table-dnd-handle__";function ue(e,n,a,t){const{key:o,customCell:u,...d}=t,s=O(u)?n[u]:u;return{key:o,width:40,customCell:l=>s?Z(oe,{class:`${e}-dnd-sortable-drag-handle`},()=>s(l)):Z(oe,{class:`${e}-dnd-sortable-drag-handle`},()=>Z(V,{name:a})),...d,visible:!0,align:{cell:"center"},changeVisible:!1}}function Qe(e,n,a,t){if(!t)return a;const{dragHandleColumn:o,dragHandleIcon:u}=t;if(o===!1)return a;const d=o===!0?ae:o,s=a.findIndex(i=>i.key===d);return s<0?[ue(e,n,u,{key:ae}),...a]:([...a].splice(s,1,ue(e,n,u,a[s])),a)}function Ye(e,n,a){if(!a)return e;const{dragHandleColumn:t}=a;if(t===!1)return e;const o=t===!0?ae:t,u=e.findIndex(l=>l.key===o),d=n.findIndex(l=>l.key===o),s=[...e];return s.splice(u,1,n[d]),s}function U(e,n,a,t,o,u){return Qe(e,t,n.map(d=>en(e,d,a,t,o,u)),o)}function en(e,n,a,t,o,u){var i;const d=Ee(n),l={...n.type==="indexable"?a.columnIndexable:void 0,...n,key:d,parentKey:u};return(i=n.children)!=null&&i.length&&(l.children=U(e,n.children,a,t,o,d)),l}function ie(e,n,a){return n.fixed===e||a.some(t=>t.fixed===e)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nn({mergedColumns:e,setMergedColumns:n,mergedColumnMap:a}){return{hasResizable:v(()=>e.value.some(u=>u.resizable)),onResizeEnd:(u,d,s)=>{const l=a.value.get(u);if(!l)return;const i=l.width,f=O(i)?J(i.replace("px","")):i;if(!f)l.width=d;else{const S=d-s,I=Math.floor(f*d/S*1e3)/1e3,{minWidth:p,maxWidth:T}=l,w=O(p)?J(p.replace("px","")):p,m=O(T)?J(T.replace("px",""),Number.MAX_SAFE_INTEGER):T;w&&I<w?l.width=w:m&&I>m?l.width=m:l.width=I}n([...e.value])}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const tn=E({props:["column","onClick","onResizeEnd"],setup(e,{slots:n}){const a=te(),t=i=>{B(e.onResizeEnd,e.column.key,i.width,i.offsetWidth)},o=Se({maxWidth:e.column.maxWidth,minWidth:e.column.minWidth,onResizeEnd:t}),{resizing:u,position:d}=We(a,o),s=te(!u.value);G(u,i=>{i?s.value=!1:setTimeout(()=>s.value=!0)});const l=i=>{s.value&&B(e.onClick,i)};return()=>{var f,S;if(!e.column.resizable)return h("th",{onClick:l},[(f=n.default)==null?void 0:f.call(n)]);const i=[h(_e,{placement:"end"},null)];if(u.value){const{width:I,height:p}=d.value;i.push(h("div",{class:"cdk-resizable-preview",style:`width:${I}px;height:${p}px`},null))}return h("th",{ref:a,onClick:l},[(S=n.default)==null?void 0:S.call(n),i])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const an=E({inheritAttrs:!1,setup(e,{slots:n}){const{props:a,mergedDndSortable:t,mergedGetKey:o}=F(H),{isCheckDisabled:u,expandable:d,mergedChildrenKey:s,scrollBodyRef:l,isTreeData:i,expandedRowKeys:f,setRowExpanded:S}=F(fe),I=v(()=>{if(!t.value)return!1;const{canDrag:c}=t.value;return c!=null?c:({sourceKey:x})=>!u(x)}),p=v(()=>{var c;return t.value?(c=t.value.canDrop)!=null?c:!0:!1}),T=v(()=>{var c;return t.value?(c=t.value.isSticky)!=null?c:!0:!1}),w=c=>f.value.includes(c);let m=null,k=!1;const y=v(()=>i.value?"tree":"list"),R=v(()=>{if(i.value)return({key:c})=>{m=c,k=w(c),k&&S(c,!1)}}),r=v(()=>{if(i.value)return({sourceKey:c})=>{m===c&&k&&(S(c,!0),m=null,k=!1)}}),g=v(()=>{if(!(!t.value||!t.value.autoScroll))return l.value});Te(g,{canScroll:!0,allowedAxis:"vertical"});const C=c=>{B(a.onDndSortReorder,c)},b=(c,x)=>{B(a.onDndSortChange,c,x)};return()=>{var c;return h(Ie,{tag:"tbody",dataSource:a.dataSource,getKey:o.value,childrenKey:s.value,canDrag:I.value,canDrop:p.value,isSticky:T.value,strategy:y.value,isTreeItemExpanded:w,treeIndent:(c=d.value)==null?void 0:c.indent,effect:"none",onSortReorder:C,onSortChange:b,onDragStart:R.value,onDrop:r.value},{default:()=>{var x;return[(x=n.default)==null?void 0:x.call(n)]}})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ln=E({props:{itemKey:{type:[String,Number,Symbol],required:!0}},setup(e,{slots:n}){const{draggingOverState:a}=F(De),{isTreeData:t}=F(fe),{mergedPrefixCls:o}=F(H),u=v(()=>{const l=a.value,i=l==null?void 0:l.instruction;return i?t.value?on({instruction:i,key:l.key,itemKey:e.itemKey,prefixCls:o.value}):rn({instruction:i,key:l.key,itemKey:e.itemKey,prefixCls:o.value}):[void 0,void 0]}),d=v(()=>u.value[0]),s=v(()=>u.value[1]);return()=>h(we,{class:d.value,style:s.value,itemKey:e.itemKey,tag:"tr"},{default:()=>{var l;return[(l=n.default)==null?void 0:l.call(n)]}})}});function rn({instruction:e,key:n,itemKey:a,prefixCls:t}){if(n===a){const o=e.edge;return[`${t}-row-dragging-over-${o}`,void 0]}return[void 0,void 0]}function on({instruction:e,key:n,itemKey:a,prefixCls:t}){return e.type==="instruction-blocked"?[void 0,void 0]:n===a?[`${t}-row-dragging-over-tree-${e.type}`,{"--pro-table-dnd-tree-item-indent":sn(e)}]:[void 0,void 0]}function sn(e){if(e.type!=="instruction-blocked")return e.type==="reparent"?se(e.desiredLevel*e.indentPerLevel):se(e.currentLevel*e.indentPerLevel)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const un=E({name:"IxProTable",props:Ne,setup(e,{slots:n,expose:a}){const t=Q("common"),o=Q("table"),u=Re("table"),d=Q("locale"),s=v(()=>`${t.prefixCls}-table`),l=v(()=>{if(!e.dndSortable)return!1;const{autoScroll:r,canDrag:g,canDrop:C,dragHandleColumn:b,dragHandleIcon:c,isSticky:x}=e.dndSortable===!0?{}:e.dndSortable;return{autoScroll:r!=null?r:!0,dragHandleColumn:b!=null?b:!0,dragHandleIcon:c!=null?c:"holder",isSticky:x!=null?x:!0,canDrag:g,canDrop:C}}),i=Ke(e,u),f=Je(e,o,n,s,l),{hasResizable:S,onResizeEnd:I}=nn(f),p=v(()=>{var r;return(r=e.size)!=null?r:u.size}),[T,w]=de(p.value);G(p,w),ze(H,{props:e,config:o,locale:d,mergedPrefixCls:s,mergedSize:T,mergedDndSortable:l,mergedGetKey:i,setMergedSize:w,...f});const m=te();a({scrollTo:r=>{var g;return(g=m.value)==null?void 0:g.scrollTo(r)}});const k=()=>{const{layoutTool:r}=e;if(!r)return null;const g=Fe(r)?r:void 0;return h(he,g,null)},y=()=>{const{toolbar:r}=e;if(r)return r.length<=1?r:h($e,{align:"center",gap:8},{default:()=>[r]})},R=()=>{var C;if(n.header)return n.header();const{header:r,toolbar:g}=e;if(r||g||n.toolbar){const b={suffix:(C=n.toolbar)!=null?C:y},c=O(r)?{title:r}:r;return h(Ve,c,b)}};return()=>{const{customAdditional:r,customTag:g,layoutTool:C,toolbar:b,tableLayout:c,dndSortable:x,columnDndSortable:D,...$}=e,K=S.value,L=c||(K?"fixed":void 0),W={...r,headCell:({column:z})=>{const P=r!=null&&r.headCell?r.headCell({column:z}):void 0;return K?{...P,column:z,onResizeEnd:I}:P},bodyRow:z=>{const P=r!=null&&r.bodyRow?r.bodyRow(z):void 0;return l.value?{...P,itemKey:i.value(z.record)}:P}},A={headCell:K?tn:void 0,body:l.value?an:void 0,bodyRow:l.value?ln:void 0,...g};return h(Ae,Pe({ref:m},$,{class:s.value,columns:f.displayColumns.value,customAdditional:W,customTag:A,size:T.value,tableLayout:L}),{...n,header:R,default:k})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const yn=un,vn=he;export{yn as I,vn as a};
