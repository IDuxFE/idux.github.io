import{am as Xe,an as He,aQ as kt,ao as Ge,m as D,M as we,aK as X,aR as Te,o as ne,D as Ie,Y as Bt,ak as xe,T as Ye,A as Se,S as Qe,c as Le,j as ze,a7 as Kt,at as $t,H as Ze,X as me,U as ce,Z as Ne,aS as Et,E as Tt,G as It,aT as Rt,av as Pt,al as De,N as Ot,aw as Ht,ar as zt,aF as Mt}from"./index-c8d09f7e.js";import{c as x,r as P,w as V,b as Je,f as j,V as Wt,T as Ft,d as ie,z as et,n as de,m as ke,by as At,X as Lt,l as A,y as F,p as re,q as b,i as ue,a8 as fe,N as Nt,an as Dt,D as Me,L as _t,au as Vt}from"./vendor-754a3ca4.js";import{b as tt}from"./GlobalCodeBox-514fb267.js";import{I as jt}from"./index-63442450.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ut(e,t,l){const n=x(()=>{const{fixedStartColumns:r,fixedEndColumns:s,fixedColumnIndexMap:a}=e.value;return _e(r,s.filter(c=>c.type!=="scroll-bar"),a,t.value,l.value-1)}),o=x(()=>{const{fixedStartColumns:r,fixedEndColumns:s,fixedColumnIndexMap:a}=e.value;return _e(r,s,a,t.value,l.value)});return{columnOffsets:n,columnOffsetsWithScrollBar:o}}function _e(e,t,l,n,o){var i,u,f,h,y,p;const r={},s={};let a=0,c=0;for(let g=0;g<e.length;g++){const S=e[g],K=(u=(i=n[S.key])!=null?i:S.width)!=null?u:0;r[S.key]={index:(f=l[S.key])!=null?f:g,offset:a},a+=K}for(let g=0;g<t.length;g++){const S=t[t.length-g-1],K=(y=(h=n[S.key])!=null?h:S.width)!=null?y:0;s[S.key]={index:(p=l[S.key])!=null?p:o-g-1,offset:c},c+=K}return{starts:r,ends:s}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qt(e){const t=P({}),l=(n,o)=>{o===!1?delete t.value[n]:t.value[n]=o};return V(e,n=>{const o=new Set(n.map(r=>r.key));Object.keys(t).forEach(r=>{o.has(r)||delete t.value[r]})}),{measuredColumnWidthMap:t,changeColumnWidth:l}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const lt=Symbol("IxTableColumn"),We=()=>{};We.displayName="IxTableColumn";We[lt]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nt(e,t,l){if(!e||Je(e)&&e.title===!1)return;if(j(t)||Wt(t))return t;const n=Xe(t).find(o=>o.type===Ft);return n?n.children:l}function Xt(e){return"key"in e?e.key:"dataKey"in e?He(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:kt("__IDUX_table_column_key_")}function ot(e,t,l,n,o,r,s=!1){const a=h=>h.filter(y=>y.type!=="scroll-bar"),c=s?o:a(o),i=s?r:a(r);if(!c.length&&!i.length)return;const u=n.findIndex(h=>h.rowKey===e.rowKey),f=h=>{if(t.findIndex(g=>g.key===h.key)>-1)return;const y=l.findIndex(g=>g.key===h.key);let p;return j(h.key)?p=`fix-${u}-${h.key}`:p=`fix-${u}-${y}`,{data:h,index:y,poolKey:p}};return{start:c.map(f).filter(Boolean),end:i.map(f).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Gt(e,t,l,n){const o=x(()=>{var p;const{columns:y}=e;return rt(y&&y.length>0?y:at((p=t.default)==null?void 0:p.call(t)),l)}),{flattedColumns:r,scrollBarColumn:s,flattedColumnsWithScrollBar:a}=Qt(o,n),{fixedColumns:c,fixedColumnKeys:i}=Zt(a),u=x(()=>!!e.ellipsis||r.value.some(y=>y.ellipsis)),f=x(()=>r.value.some(y=>y.fixed)),h=x(()=>Jt(o.value,s.value));return{flattedColumns:r,scrollBarColumn:s,flattedColumnsWithScrollBar:a,fixedColumns:c,fixedColumnKeys:i,hasEllipsis:u,hasFixed:f,mergedRows:h}}function rt(e,t){return e.map(l=>Yt(l,t))}function at(e){const t=[];return Xe(e,{key:lt}).forEach((l,n)=>{const{props:o,children:r}=l,{key:s=n,editable:a,ellipsis:c,...i}=o||{};i.key=s,i.editable=a||a==="",i.ellipsis=c||c==="";const{default:u,cell:f,title:h,expand:y,icon:p}=r||{};u&&(i.children=at(u())),f&&(i.customCell=f),h&&(i.customTitle=h),y&&(i.customExpand=y),p&&(i.customIcon=p),t.push(i)}),t}function pe(e){return j(e)?{title:e,cell:e}:e}function Yt(e,t){var c,i;const{columnBase:l,columnExpandable:n,columnSelectable:o,columnIndexable:r}=t,{align:s=l.align}=e,a=Xt(e);if("type"in e){const{type:u}=e;if(u==="expandable"){const{showLine:f=n.showLine,icon:h=n.icon}=e;return{...e,key:a,align:pe(s),icon:h,showLine:f}}if(u==="selectable"){const{multiple:f=!0,showIndex:h=o.showIndex}=e;return{...e,key:a,align:pe(s),multiple:f,showIndex:h}}if(u==="indexable"){const f=(i=(c=e.align)!=null?c:r.align)!=null?i:l.align;return{...r,...e,align:pe(f),key:a}}return{...e,key:a,align:pe(s)}}else{const{sortable:u,filterable:f,children:h}=e,y={...e,key:a,align:pe(s)};return u&&(y.sortable={...l.sortable,...u}),f&&(y.filterable={...l.filterable,...f}),h!=null&&h.length&&(y.children=rt(h,t)),y}}function Qt(e,t){const l=x(()=>Fe(e.value)),n=x(()=>{const r=t.value,s=l.value;if(r===0||s.length===0)return;const a=s[s.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:a&&a.fixed,width:r}}),o=x(()=>{const r=l.value,s=n.value;return s?[...r,s]:r});return{flattedColumns:l,scrollBarColumn:n,flattedColumnsWithScrollBar:o}}function Fe(e){const t=[];return e.forEach(l=>{const{fixed:n,children:o}=l;if(o!=null&&o.length){let r=Fe(o);n&&(r=r.map(s=>({fixed:n,...s}))),t.push(...r)}else t.push(l)}),t}function Zt(e){const t=x(()=>{const n=[],o=[],r={};return e.value.forEach((s,a)=>{const{key:c,fixed:i}=s;i==="start"?(n.push(s),r[c]=a):i==="end"&&(o.push(s),r[c]=a)}),{fixedStartColumns:n,fixedEndColumns:o,fixedColumnIndexMap:r}}),l=x(()=>{var r,s;const{fixedStartColumns:n,fixedEndColumns:o}=t.value;return{lastStartKey:(r=n[n.length-1])==null?void 0:r.key,firstEndKey:(s=o[0])==null?void 0:s.key}});return{fixedColumns:t,fixedColumnKeys:l}}function Jt(e,t){const l=[],n={};function o(a,c,i){var h;(h=l[i])!=null||(l[i]=[]);let u=c;return a.map(y=>{var B;let p=(B=y.titleColSpan)!=null?B:1,g=!1;const S=y.children;if(S!=null&&S.length){g=!0;const v=o(S,u,i+1);ie(y.titleColSpan)&&(p=v.reduce((d,m)=>d+m))}const K=u+p-1;return l[i].push({...y,titleColSpan:p,colStart:u,colEnd:K,hasChildren:g}),n[y.key]={colStart:u,colEnd:K},u+=p,p})}const r=t?[...e,t]:e;o(r,0,0);const s=l.length;return l.forEach((a,c)=>{a.forEach(i=>{i.hasChildren||(i.titleRowSpan=s-c)})}),{rows:l,offsetIndexMap:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function el(e,t,l,n,o,r,s){const a=x(()=>{const g=t.value,S=l.value;return e.dataSource.map((K,B)=>st(K,S,g,B,e.dataSource.length))}),c=x(()=>{const g=new Map;return Re(a.value,g),g}),i=x(()=>it(a.value,o.value,r.value)),u=x(()=>ct(i.value,n.value,r.value)),f=x(()=>{const g=s.value,S=u.value;if(g===null||!g.pageSize)return S;{const{total:K}=g;if(K&&S.length<K)return S;const B=g.pageSize,v=(g.pageIndex-1)*B;return S.slice(v,v+B)}}),h=x(()=>{const g=new Map;return Re(f.value,g),g}),y=x(()=>{const g=r.value;return g.length>0?ut(f.value,g,0):f.value});return{isTreeData:x(()=>a.value.some(g=>{var S;return(S=g.children)==null?void 0:S.length})),filteredData:i,flattedData:y,mergedMap:c,paginatedMap:h}}function st(e,t,l,n,o,r){var i;const s=t(e),a={record:e,rowKey:s,parentKey:r==null?void 0:r[0].rowKey,showLineIndentIndexList:(i=[...r!=null?r:[]].reverse())==null?void 0:i.reduce((u,f,h)=>(f.hasNextSibling&&u.push(h),u),[]),hasPrevSibling:n>0,hasNextSibling:n<o-1},c=e[l];return c&&(a.children=c.map((u,f)=>st(u,t,l,f,c.length,[a,...r!=null?r:[]]))),a}function Re(e,t){e.forEach(l=>{const{rowKey:n,children:o}=l;t.set(n,l),o&&Re(o,t)})}function ct(e,t,l){const n=t.filter(s=>s.sorter),o=n.length;if(o===0)return e;const r=e.slice();return r.forEach(s=>{l.includes(s.rowKey)&&s.children&&s.children.length>0&&(s.children=ct(s.children,t,l))}),r.sort((s,a)=>{for(let c=0;c<o;c++){const{orderBy:i,sorter:u}=n[c],f=u(s.record,a.record);if(f!==0)return i==="ascend"?f:-f}return 0})}function it(e,t,l){const n=t.filter(o=>o.filter);return n.length===0?e:e.map(o=>{const r=n.every(({filter:u,filterBy:f})=>u(f,o.record)),{rowKey:s,children:a}=o,c=l.includes(s);let i=o;if(c&&a&&a.length){const u=it(a,t,l);u.length!==a.length&&(i={...o,children:u})}return r||c&&i.children&&i.children.length?i:null}).filter(o=>o!==null)}function ut(e,t,l){return e.reduce((n,o)=>{const{children:r,parentKey:s,record:a,rowKey:c,hasPrevSibling:i,hasNextSibling:u,showLineIndentIndexList:f}=o,h=t.includes(c);if(n.push({children:r,parentKey:s,record:a,rowKey:c,level:l,expanded:h,hasPrevSibling:i,hasNextSibling:u,showLineIndentIndexList:f}),h&&o.children){const y=ut(o.children,t,l+1);n.push(...y)}return n},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tl(e,t){const l=x(()=>t.value.find(a=>"type"in a&&a.type==="expandable")),[n,o]=Ge(e,"expandedRowKeys",()=>[]);return{expandable:l,expandedRowKeys:n,setExpandedRowKeys:o,checkExpandDisabled:a=>{if(!l.value)return!0;const{disabled:c,customExpand:i}=l.value,{record:u}=a;return c!=null&&c(u)?!0:!(i||a.children&&a.children.length>0)},handleExpandChange:(a,c)=>{const{onChange:i,onExpand:u}=l.value||{},f=[...n.value],h=f.indexOf(a),y=h>=0;y?f.splice(h,1):f.push(a),D(u,!y,c),o(f),D(i,f)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ll(e){const t=x(()=>e.value.filter(r=>r.filterable)),l=et({}),n=P([]);return V(t,(r,s)=>{r.forEach(a=>{const{key:c,filterable:i}=a,u=i.filterBy;if(u||l[c]===void 0){l[c]=u||[];return}const f=s?s.find(y=>y.key===c):void 0;(f==null?void 0:f.filterable.filterBy)&&(l[c]=[])}),n.value=Ve(r,l)},{immediate:!0}),{activeFilters:n,activeFilterByMap:l,handleFilter:(r,s,a)=>{const{onChange:c}=s;l[r]=a,n.value=Ve(t.value,l),D(c,a,n.value)}}}function Ve(e,t){return e.map(l=>{const{key:n,filterable:o}=l,{filter:r,filterBy:s=t[n]}=o;return{key:n,filter:r,filterBy:s}}).filter(l=>l.filter&&l.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nl(e,t,l){var i,u,f,h,y;const n=we("pagination"),o=x(()=>{const{pagination:p}=e;return p===!1?null:p===!0?{}:p}),r=P((u=(i=o.value)==null?void 0:i.pageIndex)!=null?u:1),s=P((y=(h=(f=o.value)==null?void 0:f.pageSize)!=null?h:t.pagination.pageSize)!=null?y:n.pageSize),a=(p,g)=>{var S;r.value=p,s.value=g,D((S=o.value)==null?void 0:S.onChange,p,g)};return{mergedPagination:x(()=>{var g,S;const p=o.value;return p===null?null:{...t.pagination,size:l.value,...p,pageIndex:(g=p.pageIndex)!=null?g:r.value,pageSize:(S=p.pageSize)!=null?S:s.value,onChange:a}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ol(e,{setStickyScrollLeft:t}){const l=P(),n=P(),o=P(),r=P(),s=P(),a=P();V(l,d=>{d&&(r.value=d.getHolderElement())},{immediate:!0}),V(n,d=>{d&&(o.value=d.getHolderElement(),o.value.style.overflow="hidden")},{immediate:!0});const{handleScroll:c,pingedStart:i,pingedEnd:u}=rl(e,l,n,o,r,a,t),{scrollHorizontalOverflowed:f,scrollVerticalOverflowed:h}=al(r,s),y=x(()=>{var d;return X((d=e.scroll)==null?void 0:d.width)}),p=x(()=>{var d;return X((d=e.scroll)==null?void 0:d.height)}),g=x(()=>Te(ne(r))),S=x(()=>h.value?g.value:0),K=x(()=>i.value&&f.value),B=x(()=>u.value&&f.value);return{virtualScrollRef:l,headerVirtualScrollRef:n,scrollHeadRef:o,scrollBodyRef:r,scrollContentRef:s,scrollFootRef:a,handleScroll:c,scrollTo:d=>{var m;e.virtual?(m=l.value)==null||m.scrollTo(d):typeof d=="number"&&Bt({target:ne(r),top:d,duration:200})},pingedStart:K,pingedEnd:B,scrollWidth:y,scrollHeight:p,scrollBarSize:g,scrollBarSizeOnFixedHolder:S,scrollHorizontalOverflowed:f,scrollVerticalOverflowed:h}}function rl(e,t,l,n,o,r,s){const a=P(!1),c=P(!1);let i;const u=()=>{i&&(clearTimeout(i),i=void 0)};de(()=>u());const f=P(),h=K=>{f.value=K,u(),i=setTimeout(()=>{f.value=void 0,i=void 0},100)},y=(K,B)=>{B&&B.scrollLeft!==K&&(B.scrollLeft=K)},p=(K,B)=>{B&&B.scrollTo({left:K})},g=K=>{const B=ne(o);if(!B)return;const{clientWidth:v,scrollWidth:d}=B;s(K/d*v||0)};return{handleScroll:(K,B)=>{const v=K==null?void 0:K.currentTarget,d=B!=null?B:v.scrollLeft,m=f.value;if((!m||m===v)&&(h(v),l.value?p(d,l.value):y(d,n.value),t.value?p(d,t.value):y(d,ne(o)),y(d,r.value),g(d)),v){const{scrollWidth:E,clientWidth:w}=v;a.value=d>1,c.value=E-w-d>1}(K==null?void 0:K.type)==="scroll"&&D(e.onScroll,K)},pingedStart:a,pingedEnd:c}}function al(e,t){const l=P(!1),n=P(!1),o=()=>{const a=ne(e.value);a?(l.value=a.scrollWidth>a.clientWidth,n.value=a.scrollHeight>a.clientHeight):(l.value=!1,n.value=!1)};let r=[];const s=()=>r.forEach(a=>a());return ke(()=>{r=[Ie(e,o),Ie(t,o)]}),de(()=>s()),{scrollHorizontalOverflowed:l,scrollVerticalOverflowed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function sl(e,t,l,n,o,r){const s=x(()=>{var u;return(u=e.scrollToTopOnChange)!=null?u:t.scrollToTopOnChange});let a=[];const c=()=>{a=[V([()=>{var u;return(u=l.value)==null?void 0:u.pageIndex},()=>{var u;return(u=l.value)==null?void 0:u.pageSize}],()=>r(0)),V([o,n],([u,f],[h,y])=>{(!cl(u,h)||!il(f,y))&&r(0)})]},i=()=>{a.forEach(u=>u())};V(s,u=>{i(),u&&c()},{immediate:!0})}function cl(e,t){return e.length===t.length&&e.every(l=>{const n=t.find(o=>o.key===l.key);return n?l.filter===n.filter&&l.filterBy.length===n.filterBy.length&&l.filterBy.every(o=>n.filterBy.includes(o)):!1})}function il(e,t){return e.length===t.length&&e.every(l=>{const n=t.find(o=>o.key===l.key);return n?l.sorter===n.sorter&&l.orderBy===n.orderBy&&l.multiple===n.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ul(e,t,l,{mergedMap:n,paginatedMap:o}){const r=x(()=>l.value.find(v=>"type"in v&&v.type==="selectable")),[s,a]=Ge(e,"selectedRowKeys",()=>[]),c=x(()=>{const{disabled:v}=r.value||{},d=[],m=[];return o.value.forEach((E,w)=>{v!=null&&v(E.record)?m.push(w):d.push(w)}),{enabledRowKeys:d,disabledRowKeys:m}}),i=x(()=>{const v=new Set,d=s.value,{disabledRowKeys:m}=c.value,E=n.value;return d.forEach(w=>{const{parentKey:$}=E.get(w)||{};if(!ie($)){let C=E.get($);if(C&&!d.includes(C.rowKey))for(;C&&!ie(C==null?void 0:C.rowKey);)m.includes(C.rowKey)||v.add(C.rowKey),C=ie(C.parentKey)?void 0:E.get(C.parentKey)}}),[...v]}),u=x(()=>{const v=s.value,{disabledRowKeys:d}=c.value;let m=0;return o.value.forEach((E,w)=>{!d.includes(w)&&v.includes(w)&&m++},0),m}),f=x(()=>{const v=o.value.size,d=c.value.disabledRowKeys.length;return v===0||v===d?!1:v===d+u.value}),h=x(()=>!f.value&&u.value>0),y=new Map,p=v=>{a(v);const d=n.value,{onChange:m}=r.value||{};if(m){const E=[];y.forEach((w,$)=>{v.includes($)||y.delete($)}),v.forEach(w=>{let $=d.get(w);$?y.set(w,$):$=y.get(w),$&&E.push($.record)}),D(m,v,E)}},g=(v,d)=>{const m=n.value,{disabledRowKeys:E}=c.value,{multiple:w,onSelect:$}=r.value||{};let C=[...s.value];const k=C.indexOf(v),R=k>=0;if(w){const O=m.get(v),z=dt(O,E);if(R){C.splice(k,1);const M=dl(m,O,E);C=C.filter(_=>!M.includes(_)&&!z.includes(_))}else C.push(v),C.push(...z);fl(m,O,C,E)}else C=R?[]:[v];D($,!R,d),p(C)},S=()=>{const{enabledRowKeys:v}=c.value,d=new Set(s.value);f.value?v.forEach(m=>d.delete(m)):v.forEach(m=>d.add(m)),p([...d])},K=vl(r,t),B=hl(r,n,o,s,p);return{selectable:r,selectedRowKeys:s,indeterminateRowKeys:i,currentPageRowKeys:c,currentPageAllSelected:f,currentPageSomeSelected:h,handleSelectChange:g,handleHeadSelectChange:S,mergedSelectableMenus:K,handleSelectableMenuClick:B}}function dt(e,t){const l=[],{children:n}=e||{};return n&&n.forEach(o=>{const{rowKey:r}=o;t.includes(r)||l.push(o.rowKey),l.push(...dt(o,t))}),l}function dl(e,t,l){const n=[];for(;t!=null&&t.parentKey;){const{parentKey:o}=t;l.includes(t.parentKey)||n.push(o),t=e.get(o)}return n}function fl(e,t,l,n){let o=!0;for(;o&&t&&!ie(t.parentKey);){const r=e.get(t.parentKey);if(r&&!n.includes(t.parentKey)){o=r.children.every(a=>n.includes(a.rowKey)||l.includes(a.rowKey));const s=l.findIndex(a=>a===t.parentKey);o?s<0&&l.push(t.parentKey):s>-1&&l.splice(s,1)}t=r}}const ft=Symbol("IDUX_TABLE_KEY_selectable-all"),vt=Symbol("IDUX_TABLE_KEY_selectable-invert"),ht=Symbol("IDUX_TABLE_KEY_selectable-none"),yt=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function vl(e,t){return x(()=>{const{menus:l}=e.value||{};if(!l||l.length===0)return[];const{selectAll:n,selectInvert:o,selectNone:r,selectPageInvert:s}=t.table;return l.map(a=>j(a)?a==="all"?{type:"item",key:ft,label:n}:a==="invert"?{type:"item",key:vt,label:o}:a==="none"?{type:"item",key:ht,label:r}:a==="pageInvert"?{type:"item",key:yt,label:s}:{type:"item",key:a,label:a}:a)})}function hl(e,t,l,n,o){const r=()=>{const{disabled:u,onSelectAll:f}=e.value||{},h=[];t.value.forEach((y,p)=>{u!=null&&u(y.record)||h.push(p)}),D(f,h),o(h)},s=()=>{const{disabled:u,onSelectInvert:f}=e.value||{},h=[...n.value];t.value.forEach((y,p)=>{if(u!=null&&u(y.record))return;const g=h.indexOf(p);g>=0?h.splice(g,1):h.push(p)}),o(h),D(f,h)},a=()=>{const{onSelectNone:u}=e.value||{};D(u),o([])},c=()=>{const{disabled:u,onSelectPageInvert:f}=e.value||{},h=[],y=n.value;l.value.forEach((p,g)=>{u!=null&&u(p.record)||y.includes(g)||h.push(g)}),D(f,h),o(h)},i=new Map([[ft,r],[vt,s],[ht,a],[yt,c]]);return u=>{const f=u.key;if(At(f)&&i.has(f)){i.get(f)();return}const{disabled:h,onMenuClick:y}=e.value||{};if(!y)return;const p=[];l.value.forEach((g,S)=>{h!=null&&h(g.record)||p.push(S)}),D(y,u,p)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function yl(e){const t=x(()=>e.value.filter(s=>s.sortable)),l=x(()=>t.value.some(s=>s.sortable.multiple!==void 0)),n=et({}),o=P([]);return V(t,(s,a)=>{s.forEach(c=>{const{key:i,sortable:u}=c,f=u.orderBy;if(f||n[i]===void 0){n[i]=f;return}const h=a?a.find(p=>p.key===i):void 0;(h==null?void 0:h.sortable.orderBy)&&(n[i]=void 0)}),o.value=Ue(s,n)},{immediate:!0}),{activeSorters:o,activeOrderByMap:n,handleSort:(s,a)=>{const{orders:c,onChange:i}=a,u=n[s],f=u?je(c,u):je(c);l.value?n[s]=f:Object.keys(n).forEach(h=>{s===h?n[h]=f:n[h]=void 0}),o.value=Ue(t.value,n),D(i,f,o.value)}}}function je(e,t){return t?e[e.indexOf(t)+1]:e[0]}function Ue(e,t){return e.map(l=>{const{key:n,sortable:o}=l,{multiple:r=0,orderBy:s=t[n],sorter:a}=o;return{key:n,multiple:r,orderBy:s,sorter:a}}).filter(l=>l.orderBy).sort((l,n)=>n.multiple-l.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function gl(e){const t=x(()=>!!e.sticky),l=x(()=>{const{sticky:r}=e,{offsetTop:s=0,offsetBottom:a=0,offsetScroll:c=0,container:i=window}=Lt(r)?r:{};return{offsetTop:s,offsetBottom:a,offsetScroll:c,container:i}}),[n,o]=xe(0);return{isSticky:t,mergedSticky:l,stickyScrollLeft:n,setStickyScrollLeft:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function pl(e,{hasEllipsis:t,hasFixed:l},{scrollWidth:n,scrollHeight:o},r,s,a){return x(()=>e.tableLayout?e.tableLayout:n.value&&l.value?n.value==="max-content"?"auto":"fixed":o.value||a.value||r.value||t.value||s.value.horizontal||s.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const L=Symbol("TABLE_TOKEN"),gt=Symbol("tableBodyToken"),pt=Symbol("tableBodyRowToken"),be=A({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:l,measuredColumnWidthMap:n,mergedSelectableMenus:o,mergedPrefixCls:r}=F(L),s=x(()=>{const{isFixedHolder:a,columns:c}=e;return c||(a?l.value:t.value)});return()=>{if(s.value.every(i=>!i.width&&!i.type))return;const a=r.value,c=s.value.map(i=>{var g;const{key:u,type:f}=i,h=e.isFixedHolder&&(g=n.value[u])!=null?g:i.width,y=f?re({[`${a}-col-${f}`]:!0,[`${a}-col-with-dropdown`]:f==="selectable"&&o.value.length>0}):void 0,p={width:X(h),minWidth:X(i.minWidth),maxWidth:X(i.maxWidth)};return b("col",{key:u,class:y,style:p},null)});return b("colgroup",null,[c])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ml={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},bl={columns:{type:Array,required:!0}},xl={column:{type:Object,required:!0}},Sl={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},Cl={column:{type:Object,required:!0},isLast:{type:Boolean,required:!0},colSpan:Number,rowSpan:Number},wl={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},kl={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},Bl={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},Kl=A({props:kl,setup(e){const{slots:t,config:l,locale:n,mergedPrefixCls:o}=F(L),r=x(()=>{var v;return(v=e.filterable.multiple)!=null?v:l.columnBase.filterable.multiple}),s=x(()=>{var v;return(v=e.filterable.footer)!=null?v:l.columnBase.filterable.footer}),a=e.activeFilterBy,[c,i]=xe(()=>a);V(()=>e.activeFilterBy,v=>i(v));const[u,f]=xe(!1),h=v=>{f(v),v||e.onUpdateFilterBy(c.value)},y=()=>{f(!1),e.onUpdateFilterBy(c.value)},p=()=>{i(a)},g=v=>{const d=`${o.value}-filterable-menu-label`,m=r.value?ze:tt;return b("span",{class:d},[b(m,{checked:v.selected,disabled:v.disabled},null),b("span",{class:`${d}-content`},[v.label])])},S=()=>{const v=[],{customMenu:d,menus:m}=e.filterable;return ue(d)?v.push(d({selectedKeys:c.value,setSelectedKeys:i})):j(d)&&t[d]?v.push(t[d]({selectedKeys:c.value,setSelectedKeys:i})):v.push($l(m,r,c,i,g)),s.value&&v.push(El(n,o,y,p)),v},K=x(()=>{const v=`${o.value}-filterable-trigger`;return re({[v]:!0,[`${v}-active`]:e.activeFilterBy.length>0})}),B=()=>{const{customTrigger:v}=e.filterable;return ue(v)?v():j(v)&&t[v]?t[v]():b("span",{class:K.value,onClick:d=>d.stopPropagation()},[b(Se,{name:"filter-filled"},null)])};return()=>{const v={visible:u.value,hideOnClick:!s.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":h};return b(Ye,v,{default:B,overlay:S})}}}),$l=(e,t,l,n,o)=>{const r={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:l.value,"onUpdate:selectedKeys":n};return b(Qe,r,{itemLabel:o})},El=(e,t,l,n)=>{const{filterConfirm:o,filterReset:r}=e.table;return b("div",{class:`${t.value}-filterable-trigger-footer`},[b(Le,{mode:"primary",size:"xs",onClick:l},{default:()=>[o]}),b(Le,{size:"xs",onClick:n},{default:()=>[r]})])},Tl=A({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:l,currentPageRowKeys:n,currentPageAllSelected:o,currentPageSomeSelected:r,handleHeadSelectChange:s,mergedSelectableMenus:a,handleSelectableMenuClick:c}=F(L),i=x(()=>{const S=t.value.size;return S===0||S===n.value.disabledRowKeys.length}),[u,f]=xe(!1),h={"onUpdate:visible":f,trigger:"click"},y=()=>b(Qe,{dataSource:a.value,onClick:c},null),p=()=>b(Se,{class:`${e.value}-selectable-trigger`,name:"down",rotate:u.value?180:0},null),g=()=>{if(a.value.length!==0)return b(Ye,h,{default:p,overlay:y})};return()=>{const{multiple:S}=l.value;if(S)return b("span",{class:`${e.value}-cell-triggers`},[b(ze,{checked:o.value,indeterminate:r.value,disabled:i.value,onChange:s},null),g()])}}}),Il=A({props:Bl,setup(e){const{locale:t,mergedPrefixCls:l}=F(L);return()=>{const{activeOrderBy:n,sortable:o}=e,{orders:r,nextTooltip:s}=o,a=s&&Rl(t.table,r,n),c=Pl(l,r,n);return a?b(Kt,{title:a},{default:()=>[c]}):c}}});function Rl(e,t,l){const n=l?t[t.indexOf(l)+1]:t[0],{sortCancel:o,sortAsc:r,sortDesc:s}=e;return n?n==="ascend"?r:s:o}function Pl(e,t,l){const n=e.value,o=`${n}-sortable-trigger-active`,r=t.includes("ascend")&&b(Se,{name:"caret-up-filled",class:l==="ascend"?o:void 0},null),s=t.includes("descend")&&b(Se,{name:"caret-down-filled",class:l==="descend"?o:void 0},null);return b("span",{class:`${n}-sortable-trigger`},[r,s])}const Ol=A({props:xl,setup(e){const{props:t,slots:l,mergedPrefixCls:n,fixedColumnKeys:o,columnOffsetsWithScrollBar:r,isSticky:s,handleSort:a,activeOrderByMap:c,activeFilterByMap:i,mergedRows:u,handleFilter:f}=F(L),h=x(()=>{const{type:v,ellipsis:d}=e.column,m=v||d!=null?d:t.ellipsis;return Je(m)&&m.head===!1?void 0:m}),y=x(()=>{const{type:v,align:d,fixed:m,hasChildren:E,key:w,sortable:$,filterable:C}=e.column,k=n.value;let R={[`${k}-cell`]:!0,[`${k}-cell-${v}`]:!!v,[`${k}-cell-filterable`]:!!C,[`${k}-cell-sortable`]:!!$,[`${k}-cell-align-center`]:E||(d==null?void 0:d.title)==="center",[`${k}-cell-align-end`]:!E&&(d==null?void 0:d.title)==="end",[`${k}-cell-ellipsis`]:!!h.value};if(m){const{lastStartKey:O,firstEndKey:z}=o.value;R={...R,[`${k}-fix-start`]:m==="start",[`${k}-fix-start-last`]:O===w,[`${k}-fix-end`]:m==="end",[`${k}-fix-end-first`]:z===w,[`${k}-fix-sticky`]:s.value}}return re(R)}),p=x(()=>{var R;const{key:v,fixed:d}=e.column,{offsetIndexMap:m}=u.value;if(!d)return;const{starts:E,ends:w}=r.value,$=Object.values(d==="start"?E:w),C=m[v][d==="start"?"colStart":"colEnd"],k=X((R=$.find(O=>O.index===C))==null?void 0:R.offset);return{position:"sticky",left:d==="start"?k:void 0,right:d==="end"?k:void 0}}),g=x(()=>c[e.column.key]),S=x(()=>i[e.column.key]||$t),K=v=>{const{key:d,filterable:m}=e.column;f(d,m,v)},B=()=>{const{key:v,sortable:d}=e.column;d&&a(v,d)};return()=>{var z,M,_;const{column:v}=e,{type:d,titleColSpan:m,titleRowSpan:E}=v;if(d==="scroll-bar")return b("th",{class:y.value,style:p.value,colspan:m===1?void 0:m,rowspan:E===1?void 0:E,onClick:B},null);const w=n.value;let $,C;if(d==="selectable")C=b(Tl,null,null);else{const{title:Z,customTitle:G,sortable:Y,filterable:le}=v,U=h.value;C=Hl(Z,G,l),$=nt(U,C,Z);const J=zl(Y,g,le,S,K);J.length>0?C=b("span",{class:`${w}-cell-triggers`},[b("span",{class:`${w}-cell-title`},[C]),J]):U&&(C=b("span",{class:`${w}-cell-title`},[C]))}const k=(z=t.customAdditional)==null?void 0:z.headCell,R=k?k({column:v}):void 0,O=(_=(M=t.customTag)==null?void 0:M.headCell)!=null?_:"th";return b(O,fe({class:y.value,style:p.value,colSpan:m===1?void 0:m,rowSpan:E===1?void 0:E,title:$},R,{onClick:B}),{default:()=>[C]})}}});function Hl(e,t,l){let n=e;return ue(t)?n=t({title:e}):j(t)&&l[t]&&(n=l[t]({title:e})),n}function zl(e,t,l,n,o){const r=[];return e&&r.push(b(Il,{activeOrderBy:t.value,sortable:e},null)),l&&r.push(b(Kl,{activeFilterBy:n.value,filterable:l,onUpdateFilterBy:o},null)),r}function Ml(e){return e.map(t=>mt(t)).filter(Boolean)}function mt(e){if(e.titleColSpan!==0)return b(Ol,{key:e.key,column:e},null)}const Wl=A({props:bl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:n}=F(L);return()=>{var c,i,u;const{columns:o}=e,r=(c=l.customAdditional)==null?void 0:c.headRow,s=r?r({columns:o}):void 0,a=(u=(i=l.customTag)==null?void 0:i.headRow)!=null?u:"tr";return b(a,fe({class:`${n.value}-row`},s),{default:()=>{var f;return[(f=t.default)==null?void 0:f.call(t)]}})}}});function bt(e,t,l){return b(Wl,{columns:e,key:t},{default:()=>[l]})}const Pe=A({setup(e,{slots:t}){const{props:l,mergedRows:n,mergedPrefixCls:o}=F(L);return()=>{var u,f,h;let r;const{rows:s}=n.value,a=(u=l.customAdditional)==null?void 0:u.head,c=a?a({rows:s}):void 0,i=(h=(f=l.customTag)==null?void 0:f.head)!=null?h:"thead";return t.default?r=t.default():r=s.map((y,p)=>{const g=Ml(y);return bt(y,p,g)}),b(i,fe({class:`${o.value}-thead`},c),{default:()=>[r]})}}}),Fl=A({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:l,mergedVirtual:n,mergedVirtualColWidth:o,getVirtualColWidth:r,headerVirtualScrollRef:s,handleScroll:a,scrollHeadRef:c,scrollWidth:i,flattedData:u,flattedColumns:f,fixedColumns:h,mergedRows:y,isSticky:p}=F(L);Al(c,a);const g=x(()=>i.value==="max-content"),S=x(()=>u.value.length>0),K=x(()=>{const d=l.value;return{[`${d}-fixed-holder`]:!0,[`${d}-sticky-holder`]:p.value}}),B=x(()=>{const d=p.value,{offsetTop:m,offsetBottom:E}=e;return{overflow:"hidden",top:d?X(m):void 0,bottom:d?X(E):void 0}}),v=x(()=>n.value.horizontal?y.value.rows.map((d,m)=>({key:m,data:d})):[]);return()=>{const d=S.value||!g.value;if(n.value.horizontal){const m=(R,{renderedData:O})=>{let z=[];if(d){const M=[];O.forEach(_=>{M.push(..._.data)}),z=Fe(M)}return b("table",{style:{tableLayout:"fixed"}},[d&&b(be,{columns:z,isFixedHolder:!0},null),b(Pe,null,{default:()=>[R]})])},E=({item:R,index:O,children:z})=>bt(R.data,O,z),w=({item:R})=>mt(R),$=(R,O)=>{const{fixedStartColumns:z,fixedEndColumns:M}=h.value;return ot(R,O,f.value,u.value,z,M,!0)},{virtualBufferSize:C,virtualBufferOffset:k}=t;return b("div",{class:K.value,style:B.value},[b(Ze,{ref:s,dataSource:v.value,colModifier:$,getKey:"key",height:0,width:"100%",colWidth:o.value,getColWidth:r,rowRender:E,colRender:w,contentRender:m,virtual:{horizontal:!0,vertical:!1},bufferSize:C,bufferOffset:k},null)])}return b("div",{class:K.value,style:B.value,ref:c},[b("table",{style:{tableLayout:"fixed"}},[d&&b(be,{isFixedHolder:!0},null),b(Pe,null,null)])])}}});function Al(e,t){const l=r=>{if(!r.shiftKey)return;const s=r.deltaY,a=r.currentTarget;if(s){const c=a.scrollLeft+s;t(r,c)}},n=r=>{me(r,"wheel",l,{passive:!0})},o=r=>{ce(r,"wheel",l)};ke(()=>{V(e,(r,s)=>{o(s),n(r)},{immediate:!0})}),de(()=>o(e.value))}const Ll=A({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:l,mergedSticky:n,stickyScrollLeft:o,setStickyScrollLeft:r}=F(L),s=P(!1),a=P(!1),c=P(0),i=P(0),u=P(0),f=x(()=>{const v=i.value,d=u.value;return d&&v*(v/d)});Nt(()=>{const v=ne(t);if(v&&s.value){const{clientWidth:d,scrollWidth:m,scrollLeft:E}=v;r(E/m*d),i.value=d,u.value=m}});const h=x(()=>({height:Te(),width:i.value,bottom:n.value.offsetScroll})),y=x(()=>{const v=e.value;return{[`${v}-sticky-scrollbar-thumb`]:!0,[`${v}-sticky-scrollbar-thumb-active`]:a.value}}),p=x(()=>({width:`${f.value}px`,transform:`translate3d(${o.value}px, 0, 0)`})),g=()=>a.value=!1,S=v=>{c.value=v.pageX-o.value,a.value=!0,v.preventDefault()},K=v=>{if(!a.value)return;const{buttons:d}=v||window.event;if(d===0){a.value=!1;return}let m=v.pageX-c.value;m<=0&&(m=0);const E=i.value,w=u.value,$=f.value;m+$>=E&&(m=E-$);const C=m/E*(w+2);l(v,C)},B=()=>{const v=ne(t),d=Ne(v).top,m=d+v.offsetHeight,{container:E,offsetScroll:w}=n.value,$=E===window?document.documentElement.scrollTop+window.innerHeight:Ne(E).top+E.clientHeight;m-Te()<=$||d>=$-w?s.value=!1:s.value=!0};return ke(()=>{me(document.body,"mouseup",g),me(document.body,"mousemove",K),me(window,"resize",B),V(()=>n.value.container,(v,d)=>{ce(d,"scroll",B),me(v,"scroll",B)},{immediate:!0}),B()}),de(()=>{ce(document.body,"mouseup",g),ce(document.body,"mousemove",K),ce(window,"resize",B),ce(n.value.container,"scroll",B)}),()=>!t.value||!s.value||u.value<=i.value||!f.value?null:b("div",{class:`${e.value}-sticky-scrollbar`,style:h.value},[b("div",{class:y.value,style:p.value,onMousedown:S},null)])}}),Nl=A({setup(e,{slots:t}){const{mergedPrefixCls:l}=F(L);return()=>{var n;return b("tbody",{class:`${l.value}-tbody`},[(n=t.default)==null?void 0:n.call(t)])}}}),Oe=A({props:{columns:Array,isEmpty:Boolean},setup(e,{slots:t}){const{clientWidth:l,mergedPrefixCls:n,hasFixed:o,scrollHorizontalOverflowed:r,scrollBarColumn:s}=F(L),a=x(()=>{var c,i;return(i=(c=e.columns)==null?void 0:c.length)!=null?i:1});return()=>{let c=t.default();if(e.isEmpty?r.value:o.value){const i=s.value;c=b("div",{class:`${n.value}-fixed-row`,style:{width:X(l.value-(i?i.width:0)),position:"sticky",left:0,overflow:"hidden"}},[c])}return b("tr",null,[b("td",{colspan:a.value},[c])])}}}),Dl=A({props:wl,setup(e){const t=P();return Ie(t,n=>{const{contentRect:{width:o}}=n;e.changeColumnWidth(e.cellKey,o)}),de(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>b("td",{ref:t,style:{padding:0,border:0,height:0}},[b("div",{style:{height:0,overflow:"hidden"}},[Dt(" ")])])}}),_l=A({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=F(L),{changeColumnWidth:l}=F(gt);return()=>{var o;const n=(o=e.columns)==null?void 0:o.map(r=>{const{key:s}=r;return b(Dl,{key:s,cellKey:s,changeColumnWidth:l},null)});return b("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[n])}}}),Vl=A({props:Cl,setup(e){const{props:t,slots:l,config:n,mergedPrefixCls:o,mergedEmptyCell:r,activeOrderByMap:s,fixedColumnKeys:a,columnOffsets:c,isSticky:i,isTreeData:u,expandable:f,selectable:h,mergedPagination:y}=F(L),p=F(pt),g=p.props,S=x(()=>s[e.column.key]),K=jl(p,e),B=x(()=>a.value.lastStartKey===e.column.key),v=x(()=>a.value.firstEndKey===e.column.key),d=x(()=>{const{type:w,ellipsis:$}=e.column;return w||$!=null?$:t.ellipsis}),m=x(()=>{const{fixed:w,align:$,type:C}=e.column,k=o.value;let R={[`${k}-cell`]:!0,[`${k}-cell-sorted`]:!!S.value,[`${k}-cell-align-${$.cell}`]:!!$&&$.cell!="start",[`${k}-cell-ellipsis`]:!!d.value,[`${k}-cell-${C}`]:!!C,[`${k}-cell-last`]:!!e.isLast};return w&&(R={...R,[`${k}-fix-start`]:w==="start",[`${k}-fix-start-last`]:B.value,[`${k}-fix-end`]:w==="end",[`${k}-fix-end-first`]:v.value,[`${k}-fix-sticky`]:i.value}),re(R)}),E=x(()=>{const{fixed:w}=e.column;if(!w)return;const{starts:$,ends:C}=c.value,R=X((w==="start"?$:C)[e.column.key].offset);return{position:"sticky",left:w==="start"?R:void 0,right:w==="end"?R:void 0}});return()=>{var Z,G,Y;const{column:w}=e,$=o.value,{type:C}=w;let k,R;if(C==="selectable")k=Xl(p,l,h,n,y,$);else if(C==="indexable")k=xt(p,l,w,y,$);else{const le=K.value;if(k=Ul(p,e,l,le),R=nt(d.value,k,le),!C&&(ie(k)||k==="")){const U=l.emptyCell||r.value;k=ue(U)?U({column:w,record:g.record,rowIndex:g.rowIndex}):U}}e.column.fixed&&d.value&&(B.value||v.value)&&(k=b("span",{class:`${$}-cell-content`},[k]));const O=(Z=t.customAdditional)==null?void 0:Z.bodyCell,z=O?O({column:w,record:g.record,rowIndex:g.rowIndex}):void 0,M=(Y=(G=t.customTag)==null?void 0:G.bodyCell)!=null?Y:"td",_=C==="expandable"?b("div",{class:`${$}-expandable-wrapper`},[ql(p,l,f,u,$),!Et(k)&&b("span",{class:`${$}-expandable-trigger-gap`},null),k]):k;return b(M,fe({class:m.value,style:E.value,title:R,colSpan:e.colSpan,rowSpan:e.rowSpan},z),{default:()=>[_]})}}});function jl(e,t){return x(()=>{const{props:{record:l}}=e,{column:n}=t,o=He(n.dataKey);if(o.length<=0)return;let r=l;for(let s=0;s<o.length&&r;s++){const a=o[s];r=r[a]}return r})}function Ul(e,t,l,n){const{props:{record:o,rowIndex:r}}=e,{column:s}=t,{customCell:a}=s,c=j(a)?l[a]:a;return c?c({value:n,record:o,rowIndex:r}):n}function ql(e,t,l,n,o){var C;const{icon:r,customIcon:s,indent:a,showLine:c}=l.value,{props:{record:i,expanded:u,level:f=0,hasPrevSibling:h,hasNextSibling:y,showLineIndentIndexList:p},expandDisabled:g,handleExpend:S}=e,K=f>0,B=n.value&&c&&a;let v;const d=(C=j(s)?t[s]:s)!=null?C:r;ue(d)?v=d({expanded:!!u,record:i}):v=j(d)?b(Se,{name:d,rotate:u?90:0},null):d;const m=a?`width: ${X(a)}`:void 0,E={[`${o}-expandable-trigger`]:!0,[`${o}-expandable-trigger-show-line`]:B,[`${o}-expandable-trigger-disabled`]:g.value},w=[];if(a)for(let k=0;k<f;k++)w.push(b("div",{class:{[`${o}-expandable-indent`]:!0,[`${o}-expandable-indent-show-line`]:B&&p.includes(k)},style:m},null));const $=k=>{k.preventDefault(),k.stopImmediatePropagation(),g.value||S()};return[...w,b("span",{class:E,style:m},[b("button",{class:`${o}-expandable-trigger-button`,type:"button",onClick:$},[v]),B&&[b("span",{class:`${o}-expandable-trigger-line-right`},null),(h||K)&&b("span",{class:`${o}-expandable-trigger-line-top`},null),y&&b("span",{class:`${o}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function Xl(e,t,l,n,o,r){const{props:{record:s,rowIndex:a},isSelected:c,isIndeterminate:i,selectDisabled:u,isHover:f,handleSelect:h}=e,{showIndex:y,multiple:p,customCell:g}=l.value,S=B=>{B.stopPropagation(),!p&&c.value&&!u.value&&h&&h()};if(!c.value&&!f.value&&y)return xt(e,t,n.columnIndexable,o,r);const K=j(g)?t[g]:g;if(p){const B={checked:c.value,disabled:u.value,indeterminate:i.value,onChange:h,onClick:S};return K?K({...B,record:s,rowIndex:a}):b(ze,B,null)}else{const B={checked:c.value,disabled:u.value,onChange:h,onClick:S};return K?K({...B,record:s,rowIndex:a}):b(tt,B,null)}}function xt(e,t,l,n,o){const{props:{record:r,rowIndex:s},selectDisabled:a}=e,{customCell:c}=l,{pageIndex:i=1,pageSize:u=0}=n.value||{},f=j(c)?t[c]:c;if(!f)return;const h=[`${o}-indexable-label`,a.value&&`${o}-indexable-label-disabled`];return b("span",{class:h},[f({record:r,rowIndex:s,pageIndex:i,pageSize:u})])}function Gl(e,t,l){const n=[];return e.forEach((o,r)=>{const s=St(o,t,l,r===e.length-1);s&&n.push(s)}),n}function St(e,t,l,n){const{colSpan:o,rowSpan:r}=e,s=o==null?void 0:o(t,l),a=r==null?void 0:r(t,l);return s===0||a===0?void 0:b(Vl,{colSpan:s===1?void 0:s,rowSpan:a===1?void 0:a,isLast:n,column:e},null)}const Yl=A({props:Sl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:n,expandable:o,handleExpandChange:r,checkExpandDisabled:s,selectable:a,selectedRowKeys:c,indeterminateRowKeys:i,handleSelectChange:u,currentPageRowKeys:f}=F(L),{expandDisabled:h,handleExpend:y,selectDisabled:p,handleSelect:g,isHover:S,attrs:K}=Ql(e,o,s,r,a,u,f),B=x(()=>c.value.includes(e.rowKey)),v=x(()=>i.value.includes(e.rowKey)),d=x(()=>{const m=`${n.value}-row`,{level:E,expanded:w}=e;return re({[`${m}`]:!0,[`${m}-level-${E}`]:!!E,[`${m}-selected`]:B.value,[`${m}-expanded`]:w})});return Me(pt,{props:e,expandDisabled:h,handleExpend:y,isSelected:B,isIndeterminate:v,selectDisabled:p,handleSelect:g,isHover:S}),()=>{var $,C,k;const m=($=l.customAdditional)==null?void 0:$.bodyRow,E=m?m({record:e.record,rowIndex:e.rowIndex}):void 0,w=(k=(C=l.customTag)==null?void 0:C.bodyRow)!=null?k:"tr";return b(w,fe({class:d.value},K.value,E),{default:()=>{var R;return[(R=t.default)==null?void 0:R.call(t)]}})}}});function Ql(e,t,l,n,o,r,s){const a=x(()=>l(e.rowData)),c=x(()=>{var d;return(d=t.value)==null?void 0:d.trigger}),i=()=>{const{rowKey:d,record:m}=e;n(d,m)},u=x(()=>s.value.disabledRowKeys.includes(e.rowKey)),f=x(()=>{var d;return(d=o.value)==null?void 0:d.trigger}),h=x(()=>{var d;return(d=o.value)==null?void 0:d.showIndex}),y=P(!1),p=()=>{const{rowKey:d,record:m}=e;r(d,m)},g=()=>{c.value==="click"&&i(),f.value==="click"&&p()},S=()=>{c.value==="dblclick"&&i(),f.value==="dblclick"&&p()},K=()=>y.value=!0,B=()=>y.value=!1,v=x(()=>{const d=a.value,m=c.value,E=u.value,w=f.value,$=!d&&m==="click"||!E&&w==="click",C=!d&&m==="dblclick"||!E&&w==="dblclick",k=!E&&h.value;let R="";return $||C?R="pointer":(d&&m||E&&w)&&(R="not-allowed"),{style:R?`cursor: ${R}`:void 0,onClick:$?g:void 0,onDblclick:C?S:void 0,onMouseenter:k?K:void 0,onMouseleave:k?B:void 0}});return{expandDisabled:a,handleExpend:i,selectDisabled:u,handleSelect:p,isHover:y,attrs:v}}function qe(e,t,l,n,o,r,s){const{children:a,expanded:c,level:i,hasPrevSibling:u,hasNextSibling:f,showLineIndentIndexList:h,record:y,rowKey:p}=e,g={key:p,expanded:c,level:i,hasPrevSibling:u,hasNextSibling:f,showLineIndentIndexList:h,hasChildren:!!(a!=null&&a.length),record:y,rowData:e,rowIndex:l,rowKey:p},S=b(Yl,g,{default:()=>[s]}),K=c&&Zl(g,n,t,o,r);return K?[S,K]:S}function Zl(e,t,l,n,o){const{customExpand:r}=n||{},{record:s,rowIndex:a}=e;let c;return ue(r)?c=r({record:s,rowIndex:a}):j(r)&&t[r]&&(c=t[r]({record:s,rowIndex:a})),c&&b(Oe,{class:`${o}-expanded-row`,columns:l},{default:()=>[c]})}const Jl=A({setup(){const{props:e,slots:t,clientWidth:l,setClientWidth:n,expandable:o,mergedPrefixCls:r,mergedInsetShadow:s,mergedVirtual:a,mergedVirtualItemHeight:c,mergedVirtualColWidth:i,mergedAutoHeight:u,changeColumnWidth:f,flattedData:h,flattedColumns:y,fixedColumns:p,getVirtualColWidth:g,isSticky:S,mergedSticky:K,virtualScrollRef:B,scrollBodyRef:v,scrollContentRef:d,handleScroll:m,pingedStart:E,pingedEnd:w,scrollWidth:$,scrollHeight:C,scrollHorizontalOverflowed:k,scrollVerticalOverflowed:R,hasFixed:O,tableLayout:z}=F(L),M=P(),_=x(()=>u.value||!!$.value||S.value||a.value.horizontal);Me(gt,{changeColumnWidth:(I,T)=>{Rt(M.value)&&f(I,T)}});const G=()=>{const I=ne(v);I&&m({currentTarget:I})},Y=I=>{const{offsetWidth:T}=I.target;T!==l.value&&n(T)};ke(()=>{G(),V([()=>e.dataSource,$],([,I])=>{I&&G()}),Tt(M.value,Y)}),de(()=>It(M.value,Y));const le=x(()=>{const I=r.value;return re({[`${I}-container`]:!0,[`${I}-ping-start`]:E.value,[`${I}-ping-end`]:w.value,[`${I}-fixed-layout`]:z.value==="fixed",[`${I}-fixed-column`]:O.value,[`${I}-inset-shadow`]:s.value,[`${I}-scroll-horizontal`]:k.value,[`${I}-scroll-vertical`]:R.value})}),U=x(()=>{var N;const I=C.value,T=a.value.horizontal?"hidden":"auto",W=a.value.vertical?"hidden":"auto",H=(N=e.scroll)==null?void 0:N.fullHeight;return{overflowX:T,overflowY:W,[H?"height":"maxHeight"]:I}}),J=x(()=>({tableLayout:z.value,width:$.value,minWidth:$.value?"100%":void 0})),ve=(I,T,W)=>{D(e.onScrolledChange,I,T,W.map(H=>H.record))},Be=x(()=>!a.value.vertical&&!a.value.horizontal?[]:h.value.map(I=>({...I,data:y.value}))),he=I=>{if(!(!_.value||!I))return b(_l,{columns:I},null)},Ke=I=>{if(t.alert)return b(Oe,{class:`${r.value}-alert-row`,columns:I},{default:()=>[t.alert()]})},Ae=I=>{if(!(h.value.length>0))return b(Oe,{class:`${r.value}-empty-row`,columns:I,isEmpty:!0},{default:()=>[b(Pt,{empty:e.empty},t)]})},Ce=(I,T,W)=>{let H;if(W)H=W;else if(T!=null&&T.length){const N=[];T.forEach((ee,oe)=>{const ge=Gl(I!=null?I:[],ee.record,oe);N.push(...He(qe(ee,I,oe,t,o.value,r.value,ge)))}),H=N}return b(Nl,null,{default:()=>[Ke(I),he(I),Ae(I),H]})},ye=()=>Ce(y.value,h.value),$e=(I,T)=>Ce(I,void 0,T);return()=>{const I=r.value,T=u.value,W=a.value,H=t.default?t.default():[];if(T||C.value||S.value||W.horizontal){const{offsetTop:N}=K.value;if(e.headless||H.push(b(Fl,{offsetTop:N},null)),W.vertical&&(e.scroll||T)||!W.vertical&&W.horizontal){const ee=({item:q,index:Q,children:te})=>qe(q,q.data,Q,t,o.value,I,te),oe=({row:q,item:Q,index:te,rowIndex:se})=>St(Q,q.record,se,te===q.data.length-1),ge=(q,{renderedData:Q})=>{var se;const te=h.value.length?(se=Q[0])==null?void 0:se.data:y.value;return b("table",{ref:d,class:`${I}-table`,style:J.value},[te?b(be,{columns:te},null):void 0,$e(te,q),!1])},Ee=(q,Q)=>{const{fixedStartColumns:te,fixedEndColumns:se}=p.value;return ot(q,Q,y.value,h.value,te,se,!1)},{scroll:ae,onScrolledBottom:wt}=e;H.push(b(Ze,{ref:B,class:`${I}-body-virtual-scroll`,dataSource:Be.value,colModifier:Ee,fullHeight:ae==null?void 0:ae.fullHeight,getKey:q=>{var Q;return(Q=q.rowKey)!=null?Q:q.key},height:u.value?"100%":ae==null?void 0:ae.height,width:"100%",rowHeight:c.value,colWidth:i.value,getColWidth:g,rowRender:ee,colRender:oe,contentRender:ge,virtual:a.value,scrollMode:e.virtualScrollMode,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:m,onScrolledBottom:wt,onScrolledChange:ve},null))}else H.push(b("div",{ref:v,class:`${I}-content`,style:U.value,onScroll:m},[b("table",{ref:d,class:`${I}-table`,style:J.value},[b(be,null,null),ye(),!1])]));S.value&&H.push(b(Ll,null,null))}else H.push(b("div",{ref:v,class:`${I}-content`,style:U.value,onScroll:m},[b("table",{ref:d,class:`${I}-table`,style:J.value},[b(be,null,null),!e.headless&&b(Pe,null,null),ye(),!1])]));return b("div",{ref:M,class:le.value},[H])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function en(e,t){return e.footer?b("div",{class:`${t}-footer`},[e.footer()]):null}function tn(e,t,l,n){var s,a;let o=null,r=null;if(t!==null){const{position:c}=t,[i,u]=_t(c).split("-"),f=`${n}-pagination ${n}-pagination-${u}`,h=(a=(s=e.pagination)==null?void 0:s.call(e,{total:l.length,...t}))!=null?a:b(jt,fe({class:f,total:l.length},t),null);o=i==="top"?h:null,r=i==="bottom"?h:null}return[o,r]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ct(e,t){const{getGreyColors:l}=t,n=l(),{fontSizeSm:o,heightMd:r,paddingSizeSm:s,paddingSizeMd:a,paddingSizeLg:c,colorTextTitleSecondary:i,colorEmphasizedContainerBg:u,colorBorder:f,colorIconInfo:h,colorPrimary:y,colorContainerBg:p,colorContainerBgHover:g,colorInfoContainerBg:S}=e;return{fontSizeSm:o,fontSizeMd:o,fontSizeLg:o,headRowHeightSm:r,headRowHeightMd:r,headRowHeightLg:r,cellPaddingHorizontalSm:s,cellPaddingHorizontalMd:a,cellPaddingHorizontalLg:c,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:i,headBgColor:u,headSeparatorColor:f,headIconColor:h,headIconColorActive:y,headIconBgColorHover:l().l30,insetShadowStart:`inset 10px 0 8px -8px ${De(n.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${De(n.d50,.12)}`,bodyRowBgColorHover:g,bodyRowBgColorSelected:p,bodyRowBgColorExpanded:S,bodyRowBgColorTreeExpanded:S,bodyCellVerticalAlign:"middle",expandableIconColor:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ln(e,t){const{getGreyColors:l}=t,n=l();return{...Ct(e,t),insetShadowStart:`inset 10px 0 8px -8px ${n.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${n.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const nn=(e,t,l)=>t==="default"?Ct(e,l):ln(e,l),on={sm:32,md:40,lg:56},rn=150,an=A({name:"IxTable",props:ml,setup(e,{expose:t,slots:l}){const n=we("common"),{globalHashId:o,hashId:r,registerToken:s}=Ot("table");s(nn);const a=x(()=>`${n.prefixCls}-table`),c=we("locale"),i=we("table"),[u,f]=xe(0),h=x(()=>{var T;return(T=e.autoHeight)!=null?T:i.autoHeight}),y=x(()=>{var T;return(T=e.childrenKey)!=null?T:i.childrenKey}),p=Ht(e,i),g=x(()=>{var T;return(T=e.emptyCell)!=null?T:i.emptyCell}),S=x(()=>{var T;return(T=e.insetShadow)!=null?T:i.insetShadow}),K=x(()=>{var T;return(T=e.size)!=null?T:i.size}),B=x(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),v=x(()=>{var T;return(T=e.virtualItemHeight)!=null?T:on[K.value]}),d=x(()=>{var T;return(T=e.virtualColWidth)!=null?T:rn}),{mergedPagination:m}=nl(e,i,K),E=gl(e),w=ol(e,E),$=Gt(e,l,i,w.scrollBarSizeOnFixedHolder),{flattedColumns:C,flattedColumnsWithScrollBar:k,fixedColumns:R}=$,O=qt(C),{measuredColumnWidthMap:z}=O,M=x(()=>k.value.length),_=Ut(R,z,M),Z=yl(C),G=ll(C),Y=tl(e,C),le=pl(e,$,w,E.isSticky,B,h),{activeSorters:U}=Z,{activeFilters:J}=G,ve=new Map,Be=()=>{ve.clear(),C.value.forEach(T=>{ve.set(T.key,T)})};V(C,()=>{Be()},{immediate:!0});const he=el(e,y,p,U,J,Y.expandedRowKeys,m),Ke=ul(e,c,$.flattedColumns,he);sl(e,i,m,U,J,w.scrollTo);const Ce={props:e,slots:l,config:i,locale:c,clientWidth:u,setClientWidth:f,mergedPrefixCls:a,mergedEmptyCell:g,mergedInsetShadow:S,mergedVirtual:B,mergedVirtualItemHeight:v,mergedVirtualColWidth:d,mergedAutoHeight:h,getVirtualColWidth:(T,W)=>{var H,N;return(N=z.value[W])!=null?N:(H=ve.get(W))==null?void 0:H.width},...$,...O,..._,...w,...Z,...G,...E,tableLayout:le,mergedPagination:m,...Y,...he,...Ke};Me(L,Ce),t({scrollTo:w.scrollTo});const{flattedData:ye,filteredData:$e}=he,I=x(()=>{const T=a.value,{borderless:W=i.borderless,scroll:H}=e;return re({[o.value]:!!o.value,[r.value]:!!r.value,[T]:!0,[`${T}-auto-height`]:h.value,[`${T}-borderless`]:W,[`${T}-empty`]:ye.value.length===0,[`${T}-full-height`]:H==null?void 0:H.fullHeight,[`${T}-${K.value}`]:!0})});return()=>{const T=a.value,W=b(zt,{header:e.header},l),H=en(l,T),N=[W];let ee=[b(Jl,null,null),H].filter(Boolean);if(ye.value.length>0){const[ge,Ee]=tn(l,m.value,$e.value,T);ee=[ge,...ee,Ee].filter(Boolean)}const oe=sn(e.spin);return oe?N.push(b(Mt,oe,{default:()=>[ee]})):N.push(...ee),b("div",{class:I.value},[N])}}});function sn(e){return Vt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const vn=an,hn=We;export{vn as I,hn as a,Xt as g,ml as t};
