import{O as Xe,P as We,aR as Kt,ao as Ge,m as _,M as Be,aL as X,aS as $e,o as te,D as Ie,a2 as Et,K as ke,Z as Ye,A as be,Y as Ze,c as Le,j as He,ab as Tt,at as $t,H as Je,a1 as pe,$ as de,a3 as Ne,aT as It,E as Rt,G as Pt,aU as Ot,av as Wt,L as De,N as Ht,aw as zt,ar as Mt,aG as Ft}from"./index-8abf4cd4.js";import{b as Qe,f as U,Y as At,T as Lt,c as b,r as P,w as V,N as et,M as tt,d as fe,y as lt,X as he,m as Se,bq as Nt,a1 as Dt,l as F,x as M,n as ce,p as m,i as ve,ad as ye,an as _t,B as ze,K as Vt,au as jt}from"./vendor-1c4f0380.js";import{b as nt}from"./GlobalCodeBox-f139d73b.js";import{I as Ut}from"./index-001689c5.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ot=Symbol("IxTableColumn"),Me=()=>{};Me.displayName="IxTableColumn";Me[ot]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rt(e,t,l){if(!e||Qe(e)&&e.title===!1)return;if(U(t)||At(t))return t;const n=Xe(t).find(r=>r.type===Lt);return n?n.children:l}function qt(e){return"key"in e?e.key:"dataKey"in e?We(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:Kt("__IDUX_table_column_key_")}function at(e,t,l,n,r,o,a=!1){const s=h=>h.filter(g=>g.type!=="scroll-bar"),u=a?r:s(r),c=a?o:s(o);if(!u.length&&!c.length)return;const d=n.findIndex(h=>h.rowKey===e.rowKey),f=h=>{if(t.findIndex(y=>y.key===h.key)>-1)return;const g=l.findIndex(y=>y.key===h.key);return{data:h,index:g,poolKey:`fix-${d}-${g}`}};return{start:u.map(f).filter(Boolean),end:c.map(f).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Xt(e,t,l,n){const r=b(()=>{var v;const{columns:i}=e;return st(i&&i.length>0?i:ct((v=t.default)==null?void 0:v.call(t)),l)}),{flattedColumns:o,scrollBarColumn:a,flattedColumnsWithScrollBar:s}=Yt(r,n),{fixedColumns:u,fixedColumnKeys:c}=Zt(s),d=b(()=>!!e.ellipsis||o.value.some(i=>i.ellipsis)),f=b(()=>o.value.some(i=>i.fixed)),h=b(()=>s.value.length),{columnWidthMap:g,columnWidths:y,changeColumnWidth:p}=Jt(o),{columnOffsets:C,columnOffsetsWithScrollBar:K}=Qt(u,g,h),E=b(()=>el(r.value,a.value));return{flattedColumns:o,scrollBarColumn:a,flattedColumnsWithScrollBar:s,fixedColumns:u,fixedColumnKeys:c,hasEllipsis:d,hasFixed:f,columnWidthMap:g,columnWidths:y,changeColumnWidth:p,columnOffsets:C,columnOffsetsWithScrollBar:K,mergedRows:E}}function st(e,t){return e.map(l=>Gt(l,t))}function ct(e){const t=[];return Xe(e,{key:ot}).forEach((l,n)=>{const{props:r,children:o}=l,{key:a=n,editable:s,ellipsis:u,...c}=r||{};c.key=a,c.editable=s||s==="",c.ellipsis=u||u==="";const{default:d,cell:f,title:h,expand:g,icon:y}=o||{};d&&(c.children=ct(d())),f&&(c.customCell=f),h&&(c.customTitle=h),g&&(c.customExpand=g),y&&(c.customIcon=y),t.push(c)}),t}function ge(e){return U(e)?{title:e,cell:e}:e}function Gt(e,t){var u,c;const{columnBase:l,columnExpandable:n,columnSelectable:r,columnIndexable:o}=t,{align:a=l.align}=e,s=qt(e);if("type"in e){const{type:d}=e;if(d==="expandable"){const{showLine:f=n.showLine,icon:h=n.icon}=e;return{...e,key:s,align:ge(a),icon:h,showLine:f}}if(d==="selectable"){const{multiple:f=!0,showIndex:h=r.showIndex}=e;return{...e,key:s,align:ge(a),multiple:f,showIndex:h}}if(d==="indexable"){const f=(c=(u=e.align)!=null?u:o.align)!=null?c:l.align;return{...o,...e,align:ge(f),key:s}}return{...e,key:s,align:ge(a)}}else{const{sortable:d,filterable:f,children:h}=e,g={...e,key:s,align:ge(a)};return d&&(g.sortable={...l.sortable,...d}),f&&(g.filterable={...l.filterable,...f}),h!=null&&h.length&&(g.children=st(h,t)),g}}function Yt(e,t){const l=b(()=>Fe(e.value)),n=b(()=>{const o=t.value,a=l.value;if(o===0||a.length===0)return;const s=a[a.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:s&&s.fixed,width:o}}),r=b(()=>{const o=l.value,a=n.value;return a?[...o,a]:o});return{flattedColumns:l,scrollBarColumn:n,flattedColumnsWithScrollBar:r}}function Fe(e){const t=[];return e.forEach(l=>{const{fixed:n,children:r}=l;if(r!=null&&r.length){let o=Fe(r);n&&(o=o.map(a=>({fixed:n,...a}))),t.push(...o)}else t.push(l)}),t}function Zt(e){const t=b(()=>{const n=[],r=[];return e.value.forEach(o=>{const{fixed:a}=o;a==="start"?n.push(o):a==="end"&&r.push(o)}),{fixedStartColumns:n,fixedEndColumns:r}}),l=b(()=>{var o,a;const{fixedStartColumns:n,fixedEndColumns:r}=t.value;return{lastStartKey:(o=n[n.length-1])==null?void 0:o.key,firstEndKey:(a=r[0])==null?void 0:a.key}});return{fixedColumns:t,fixedColumnKeys:l}}function Jt(e){const t=P({}),l=P(),n=P([]);return V(l,et(o=>{n.value=o?o.split("-").filter(Boolean).map(Number):[]},16)),tt(()=>{const o=e.value;l.value=o.map(a=>t.value[a.key]).join("-")}),{columnWidthMap:t,columnWidths:n,changeColumnWidth:(o,a)=>{a===!1?delete t.value[o]:t.value[o]=a}}}function Qt(e,t,l){const n=b(()=>_e(e.value.fixedStartColumns,e.value.fixedEndColumns.filter(o=>o.type!=="scroll-bar"),t.value,l.value-1)),r=b(()=>_e(e.value.fixedStartColumns,e.value.fixedEndColumns,t.value,l.value));return{columnOffsets:n,columnOffsetsWithScrollBar:r}}function _e(e,t,l,n){var u,c,d,f;const r={},o={};let a=0,s=0;for(let h=0;h<e.length;h++){const g=e[h],y=(c=(u=l[g.key])!=null?u:g.width)!=null?c:0;r[g.key]={index:h,offset:a},a+=y}for(let h=0;h<t.length;h++){const g=t[t.length-h-1],y=(f=(d=l[g.key])!=null?d:g.width)!=null?f:0;o[g.key]={index:n-h-1,offset:s},s+=y}return{starts:r,ends:o}}function el(e,t){const l=[],n={};function r(s,u,c){var h;(h=l[c])!=null||(l[c]=[]);let d=u;return s.map(g=>{var E;let y=(E=g.titleColSpan)!=null?E:1,p=!1;const C=g.children;if(C!=null&&C.length){p=!0;const i=r(C,d,c+1);fe(g.titleColSpan)&&(y=i.reduce((v,S)=>v+S))}const K=d+y-1;return l[c].push({...g,titleColSpan:y,colStart:d,colEnd:K,hasChildren:p}),n[g.key]={colStart:d,colEnd:K},d+=y,y})}const o=t?[...e,t]:e;r(o,0,0);const a=l.length;return l.forEach((s,u)=>{s.forEach(c=>{c.hasChildren||(c.titleRowSpan=a-u)})}),{rows:l,offsetIndexMap:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tl(e,t,l,n,r,o,a){const s=b(()=>{const p=t.value,C=l.value;return e.dataSource.map((K,E)=>it(K,C,p,E,e.dataSource.length))}),u=b(()=>{const p=new Map;return Re(s.value,p),p}),c=b(()=>dt(s.value,r.value,o.value)),d=b(()=>ut(c.value,n.value,o.value)),f=b(()=>{const p=a.value,C=d.value;if(p===null||!p.pageSize)return C;{const{total:K}=p;if(K&&C.length<K)return C;const E=p.pageSize,i=(p.pageIndex-1)*E;return C.slice(i,i+E)}}),h=b(()=>{const p=new Map;return Re(f.value,p),p}),g=b(()=>{const p=o.value;return p.length>0?ft(f.value,p,0):f.value});return{isTreeData:b(()=>s.value.some(p=>{var C;return(C=p.children)==null?void 0:C.length})),filteredData:c,flattedData:g,mergedMap:u,paginatedMap:h}}function it(e,t,l,n,r,o){var c;const a=t(e),s={record:e,rowKey:a,parentKey:o==null?void 0:o[0].rowKey,showLineIndentIndexList:(c=[...o!=null?o:[]].reverse())==null?void 0:c.reduce((d,f,h)=>(f.hasNextSibling&&d.push(h),d),[]),hasPrevSibling:n>0,hasNextSibling:n<r-1},u=e[l];return u&&(s.children=u.map((d,f)=>it(d,t,l,f,u.length,[s,...o!=null?o:[]]))),s}function Re(e,t){e.forEach(l=>{const{rowKey:n,children:r}=l;t.set(n,l),r&&Re(r,t)})}function ut(e,t,l){const n=t.filter(a=>a.sorter),r=n.length;if(r===0)return e;const o=e.slice();return o.forEach(a=>{l.includes(a.rowKey)&&a.children&&a.children.length>0&&(a.children=ut(a.children,t,l))}),o.sort((a,s)=>{for(let u=0;u<r;u++){const{orderBy:c,sorter:d}=n[u],f=d(a.record,s.record);if(f!==0)return c==="ascend"?f:-f}return 0})}function dt(e,t,l){const n=t.filter(r=>r.filter);return n.length===0?e:e.map(r=>{const o=n.every(({filter:d,filterBy:f})=>d(f,r.record)),{rowKey:a,children:s}=r,u=l.includes(a);let c=r;if(u&&s&&s.length){const d=dt(s,t,l);d.length!==s.length&&(c={...r,children:d})}return o||u&&c.children&&c.children.length?c:null}).filter(r=>r!==null)}function ft(e,t,l){return e.reduce((n,r)=>{const{children:o,parentKey:a,record:s,rowKey:u,hasPrevSibling:c,hasNextSibling:d,showLineIndentIndexList:f}=r,h=t.includes(u);if(n.push({children:o,parentKey:a,record:s,rowKey:u,level:l,expanded:h,hasPrevSibling:c,hasNextSibling:d,showLineIndentIndexList:f}),h&&r.children){const g=ft(r.children,t,l+1);n.push(...g)}return n},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ll(e,t){const l=b(()=>t.value.find(s=>"type"in s&&s.type==="expandable")),[n,r]=Ge(e,"expandedRowKeys",()=>[]);return{expandable:l,expandedRowKeys:n,setExpandedRowKeys:r,checkExpandDisabled:s=>{if(!l.value)return!0;const{disabled:u,customExpand:c}=l.value,{record:d}=s;return u!=null&&u(d)?!0:!(c||s.children&&s.children.length>0)},handleExpandChange:(s,u)=>{const{onChange:c,onExpand:d}=l.value||{},f=[...n.value],h=f.indexOf(s),g=h>=0;g?f.splice(h,1):f.push(s),_(d,!g,u),r(f),_(c,f)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nl(e){const t=b(()=>e.value.filter(o=>o.filterable)),l=lt({}),n=P([]);return V(t,(o,a)=>{o.forEach(s=>{const{key:u,filterable:c}=s,d=c.filterBy;if(d||l[u]===void 0){l[u]=d||[];return}const f=a?a.find(g=>g.key===u):void 0;(f==null?void 0:f.filterable.filterBy)&&(l[u]=[])}),n.value=Ve(o,l)},{immediate:!0}),{activeFilters:n,activeFilterByMap:l,handleFilter:(o,a,s)=>{const{onChange:u}=a;l[o]=s,n.value=Ve(t.value,l),_(u,s,n.value)}}}function Ve(e,t){return e.map(l=>{const{key:n,filterable:r}=l,{filter:o,filterBy:a=t[n]}=r;return{key:n,filter:o,filterBy:a}}).filter(l=>l.filter&&l.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ol(e,t,l){var c,d,f,h,g;const n=Be("pagination"),r=b(()=>{const{pagination:y}=e;return y===!1?null:y===!0?{}:y}),o=P((d=(c=r.value)==null?void 0:c.pageIndex)!=null?d:1),a=P((g=(h=(f=r.value)==null?void 0:f.pageSize)!=null?h:t.pagination.pageSize)!=null?g:n.pageSize),s=(y,p)=>{var C;o.value=y,a.value=p,_((C=r.value)==null?void 0:C.onChange,y,p)};return{mergedPagination:b(()=>{var p,C;const y=r.value;return y===null?null:{...t.pagination,size:l.value,...y,pageIndex:(p=y.pageIndex)!=null?p:o.value,pageSize:(C=y.pageSize)!=null?C:a.value,onChange:s}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rl(e,{setStickyScrollLeft:t}){const l=P(),n=P(),r=P(),o=P(),a=P();V(l,i=>{i&&(r.value=i.getHolderElement())});const{handleScroll:s,pingedStart:u,pingedEnd:c}=al(e,n,r,a,t),{scrollHorizontalOverflowed:d,scrollVerticalOverflowed:f}=sl(r,o),h=b(()=>{var i;return X((i=e.scroll)==null?void 0:i.width)}),g=b(()=>{var i;return X((i=e.scroll)==null?void 0:i.height)}),y=b(()=>$e(te(r))),p=b(()=>f.value?y.value:0),C=b(()=>u.value&&d.value),K=b(()=>c.value&&d.value);return{virtualScrollRef:l,scrollHeadRef:n,scrollBodyRef:r,scrollContentRef:o,scrollFootRef:a,handleScroll:s,scrollTo:i=>{var v;e.virtual?(v=l.value)==null||v.scrollTo(i):typeof i=="number"&&Et({target:te(r),top:i,duration:200})},pingedStart:C,pingedEnd:K,scrollWidth:h,scrollHeight:g,scrollBarSize:y,scrollBarSizeOnFixedHolder:p,scrollHorizontalOverflowed:d,scrollVerticalOverflowed:f}}function al(e,t,l,n,r){const o=P(!1),a=P(!1);let s;const u=()=>{s&&(clearTimeout(s),s=void 0)};he(()=>u());const c=P(),d=y=>{c.value=y,u(),s=setTimeout(()=>{c.value=void 0,s=void 0},100)},f=(y,p)=>{p&&p.scrollLeft!==y&&(p.scrollLeft=y)},h=y=>{const p=te(l);if(!p)return;const{clientWidth:C,scrollWidth:K}=p;r(y/K*C||0)};return{handleScroll:(y,p)=>{const C=y==null?void 0:y.currentTarget,K=p!=null?p:C.scrollLeft,E=c.value;if((!E||E===C)&&(d(C),f(K,t.value),f(K,te(l)),f(K,n.value),h(K)),C){const{scrollWidth:i,clientWidth:v}=C;o.value=K>1,a.value=i-v-K>1}(y==null?void 0:y.type)==="scroll"&&_(e.onScroll,y)},pingedStart:o,pingedEnd:a}}function sl(e,t){const l=P(!1),n=P(!1),r=()=>{const s=te(e.value);s?(l.value=s.scrollWidth>s.clientWidth,n.value=s.scrollHeight>s.clientHeight):(l.value=!1,n.value=!1)};let o=[];const a=()=>o.forEach(s=>s());return Se(()=>{o=[Ie(e,r),Ie(t,r)]}),he(()=>a()),{scrollHorizontalOverflowed:l,scrollVerticalOverflowed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function cl(e,t,l,n,r,o){const a=b(()=>{var d;return(d=e.scrollToTopOnChange)!=null?d:t.scrollToTopOnChange});let s=[];const u=()=>{s=[V([()=>{var d;return(d=l.value)==null?void 0:d.pageIndex},()=>{var d;return(d=l.value)==null?void 0:d.pageSize}],()=>o(0)),V([r,n],([d,f],[h,g])=>{(!il(d,h)||!ul(f,g))&&o(0)})]},c=()=>{s.forEach(d=>d())};V(a,d=>{c(),d&&u()},{immediate:!0})}function il(e,t){return e.length===t.length&&e.every(l=>{const n=t.find(r=>r.key===l.key);return n?l.filter===n.filter&&l.filterBy.length===n.filterBy.length&&l.filterBy.every(r=>n.filterBy.includes(r)):!1})}function ul(e,t){return e.length===t.length&&e.every(l=>{const n=t.find(r=>r.key===l.key);return n?l.sorter===n.sorter&&l.orderBy===n.orderBy&&l.multiple===n.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dl(e,t,l,{mergedMap:n,paginatedMap:r}){const o=b(()=>l.value.find(i=>"type"in i&&i.type==="selectable")),[a,s]=Ge(e,"selectedRowKeys",()=>[]),u=b(()=>{const{disabled:i}=o.value||{},v=[],S=[];return r.value.forEach((B,w)=>{i!=null&&i(B.record)?S.push(w):v.push(w)}),{enabledRowKeys:v,disabledRowKeys:S}}),c=b(()=>{const i=new Set,v=a.value,{disabledRowKeys:S}=u.value,B=n.value;return v.forEach(w=>{const{parentKey:k}=B.get(w)||{};if(!fe(k)){let x=B.get(k);if(x&&!v.includes(x.rowKey))for(;x&&!fe(x==null?void 0:x.rowKey);)S.includes(x.rowKey)||i.add(x.rowKey),x=fe(x.parentKey)?void 0:B.get(x.parentKey)}}),[...i]}),d=b(()=>{const i=a.value,{disabledRowKeys:v}=u.value;let S=0;return r.value.forEach((B,w)=>{!v.includes(w)&&i.includes(w)&&S++},0),S}),f=b(()=>{const i=r.value.size,v=u.value.disabledRowKeys.length;return i===0||i===v?!1:i===v+d.value}),h=b(()=>!f.value&&d.value>0),g=new Map,y=i=>{s(i);const v=n.value,{onChange:S}=o.value||{};if(S){const B=[];g.forEach((w,k)=>{i.includes(k)||g.delete(k)}),i.forEach(w=>{let k=v.get(w);k?g.set(w,k):k=g.get(w),k&&B.push(k.record)}),_(S,i,B)}},p=(i,v)=>{const S=n.value,{disabledRowKeys:B}=u.value,{multiple:w,onSelect:k}=o.value||{};let x=[...a.value];const $=x.indexOf(i),I=$>=0;if(w){const W=S.get(i),O=vt(W,B);if(I){x.splice($,1);const z=fl(S,W,B);x=x.filter(A=>!z.includes(A)&&!O.includes(A))}else x.push(i),x.push(...O);vl(S,W,x,B)}else x=I?[]:[i];_(k,!I,v),y(x)},C=()=>{const{enabledRowKeys:i}=u.value,v=new Set(a.value);f.value?i.forEach(S=>v.delete(S)):i.forEach(S=>v.add(S)),y([...v])},K=hl(o,t),E=yl(o,n,r,a,y);return{selectable:o,selectedRowKeys:a,indeterminateRowKeys:c,currentPageRowKeys:u,currentPageAllSelected:f,currentPageSomeSelected:h,handleSelectChange:p,handleHeadSelectChange:C,mergedSelectableMenus:K,handleSelectableMenuClick:E}}function vt(e,t){const l=[],{children:n}=e||{};return n&&n.forEach(r=>{const{rowKey:o}=r;t.includes(o)||l.push(r.rowKey),l.push(...vt(r,t))}),l}function fl(e,t,l){const n=[];for(;t!=null&&t.parentKey;){const{parentKey:r}=t;l.includes(t.parentKey)||n.push(r),t=e.get(r)}return n}function vl(e,t,l,n){let r=!0;for(;r&&t&&!fe(t.parentKey);){const o=e.get(t.parentKey);if(o&&!n.includes(t.parentKey)){r=o.children.every(s=>n.includes(s.rowKey)||l.includes(s.rowKey));const a=l.findIndex(s=>s===t.parentKey);r?a<0&&l.push(t.parentKey):a>-1&&l.splice(a,1)}t=o}}const ht=Symbol("IDUX_TABLE_KEY_selectable-all"),yt=Symbol("IDUX_TABLE_KEY_selectable-invert"),gt=Symbol("IDUX_TABLE_KEY_selectable-none"),pt=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function hl(e,t){return b(()=>{const{menus:l}=e.value||{};if(!l||l.length===0)return[];const{selectAll:n,selectInvert:r,selectNone:o,selectPageInvert:a}=t.table;return l.map(s=>U(s)?s==="all"?{type:"item",key:ht,label:n}:s==="invert"?{type:"item",key:yt,label:r}:s==="none"?{type:"item",key:gt,label:o}:s==="pageInvert"?{type:"item",key:pt,label:a}:{type:"item",key:s,label:s}:s)})}function yl(e,t,l,n,r){const o=()=>{const{disabled:d,onSelectAll:f}=e.value||{},h=[];t.value.forEach((g,y)=>{d!=null&&d(g.record)||h.push(y)}),_(f,h),r(h)},a=()=>{const{disabled:d,onSelectInvert:f}=e.value||{},h=[...n.value];t.value.forEach((g,y)=>{if(d!=null&&d(g.record))return;const p=h.indexOf(y);p>=0?h.splice(p,1):h.push(y)}),r(h),_(f,h)},s=()=>{const{onSelectNone:d}=e.value||{};_(d),r([])},u=()=>{const{disabled:d,onSelectPageInvert:f}=e.value||{},h=[],g=n.value;l.value.forEach((y,p)=>{d!=null&&d(y.record)||g.includes(p)||h.push(p)}),_(f,h),r(h)},c=new Map([[ht,o],[yt,a],[gt,s],[pt,u]]);return d=>{const f=d.key;if(Nt(f)&&c.has(f)){c.get(f)();return}const{disabled:h,onMenuClick:g}=e.value||{};if(!g)return;const y=[];l.value.forEach((p,C)=>{h!=null&&h(p.record)||y.push(C)}),_(g,d,y)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function gl(e){const t=b(()=>e.value.filter(a=>a.sortable)),l=b(()=>t.value.some(a=>a.sortable.multiple!==void 0)),n=lt({}),r=P([]);return V(t,(a,s)=>{a.forEach(u=>{const{key:c,sortable:d}=u,f=d.orderBy;if(f||n[c]===void 0){n[c]=f;return}const h=s?s.find(y=>y.key===c):void 0;(h==null?void 0:h.sortable.orderBy)&&(n[c]=void 0)}),r.value=Ue(a,n)},{immediate:!0}),{activeSorters:r,activeOrderByMap:n,handleSort:(a,s)=>{const{orders:u,onChange:c}=s,d=n[a],f=d?je(u,d):je(u);l.value?n[a]=f:Object.keys(n).forEach(h=>{a===h?n[h]=f:n[h]=void 0}),r.value=Ue(t.value,n),_(c,f,r.value)}}}function je(e,t){return t?e[e.indexOf(t)+1]:e[0]}function Ue(e,t){return e.map(l=>{const{key:n,sortable:r}=l,{multiple:o=0,orderBy:a=t[n],sorter:s}=r;return{key:n,multiple:o,orderBy:a,sorter:s}}).filter(l=>l.orderBy).sort((l,n)=>n.multiple-l.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function pl(e){const t=b(()=>!!e.sticky),l=b(()=>{const{sticky:o}=e,{offsetTop:a=0,offsetBottom:s=0,offsetScroll:u=0,container:c=window}=Dt(o)?o:{};return{offsetTop:a,offsetBottom:s,offsetScroll:u,container:c}}),[n,r]=ke(0);return{isSticky:t,mergedSticky:l,stickyScrollLeft:n,setStickyScrollLeft:r}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ml(e,{hasEllipsis:t,hasFixed:l},{scrollWidth:n,scrollHeight:r},o,a,s){return b(()=>e.tableLayout?e.tableLayout:n.value&&l.value?n.value==="max-content"?"auto":"fixed":r.value||s.value||o.value||t.value||a.value.horizontal||a.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const L=Symbol("TABLE_TOKEN"),Ae=Symbol("tableBodyToken"),mt=Symbol("tableBodyRowToken"),me=F({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:l,columnWidthMap:n,mergedSelectableMenus:r,mergedPrefixCls:o}=M(L),a=b(()=>{const{isFixedHolder:s,columns:u}=e;return u||(s?l.value:t.value)});return()=>{if(a.value.every(c=>!c.width&&!c.type))return;const s=o.value,u=a.value.map(c=>{var p;const{key:d,type:f}=c,h=(p=c.width)!=null?p:n.value[d],g=f?ce({[`${s}-col-${f}`]:!0,[`${s}-col-with-dropdown`]:f==="selectable"&&r.value.length>0}):void 0,y={width:X(h),minWidth:X(c.minWidth),maxWidth:X(c.maxWidth)};return m("col",{key:d,class:g,style:y},null)});return m("colgroup",null,[u])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const bl={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},Sl={columns:{type:Array,required:!0}},xl={column:{type:Object,required:!0}},Cl={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},wl={column:{type:Object,required:!0},colIndex:{type:Number,required:!0},colSpan:Number,rowSpan:Number},Bl={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},kl={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},Kl={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},El=F({props:kl,setup(e){const{slots:t,config:l,locale:n,mergedPrefixCls:r}=M(L),o=b(()=>{var i;return(i=e.filterable.multiple)!=null?i:l.columnBase.filterable.multiple}),a=b(()=>{var i;return(i=e.filterable.footer)!=null?i:l.columnBase.filterable.footer}),s=e.activeFilterBy,[u,c]=ke(()=>s);V(()=>e.activeFilterBy,i=>c(i));const[d,f]=ke(!1),h=i=>{f(i),i||e.onUpdateFilterBy(u.value)},g=()=>{f(!1),e.onUpdateFilterBy(u.value)},y=()=>{c(s)},p=i=>{const v=`${r.value}-filterable-menu-label`,S=o.value?He:nt;return m("span",{class:v},[m(S,{checked:i.selected,disabled:i.disabled},null),m("span",{class:`${v}-content`},[i.label])])},C=()=>{const i=[],{customMenu:v,menus:S}=e.filterable;return ve(v)?i.push(v({selectedKeys:u.value,setSelectedKeys:c})):U(v)&&t[v]?i.push(t[v]({selectedKeys:u.value,setSelectedKeys:c})):i.push(Tl(S,o,u,c,p)),a.value&&i.push($l(n,r,g,y)),i},K=b(()=>{const i=`${r.value}-filterable-trigger`;return ce({[i]:!0,[`${i}-active`]:e.activeFilterBy.length>0})}),E=()=>{const{customTrigger:i}=e.filterable;return ve(i)?i():U(i)&&t[i]?t[i]():m("span",{class:K.value,onClick:v=>v.stopPropagation()},[m(be,{name:"filter-filled"},null)])};return()=>{const i={visible:d.value,hideOnClick:!a.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":h};return m(Ye,i,{default:E,overlay:C})}}}),Tl=(e,t,l,n,r)=>{const o={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:l.value,"onUpdate:selectedKeys":n};return m(Ze,o,{itemLabel:r})},$l=(e,t,l,n)=>{const{filterConfirm:r,filterReset:o}=e.table;return m("div",{class:`${t.value}-filterable-trigger-footer`},[m(Le,{mode:"primary",size:"xs",onClick:l},{default:()=>[r]}),m(Le,{size:"xs",onClick:n},{default:()=>[o]})])},Il=F({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:l,currentPageRowKeys:n,currentPageAllSelected:r,currentPageSomeSelected:o,handleHeadSelectChange:a,mergedSelectableMenus:s,handleSelectableMenuClick:u}=M(L),c=b(()=>{const C=t.value.size;return C===0||C===n.value.disabledRowKeys.length}),[d,f]=ke(!1),h={"onUpdate:visible":f,trigger:"click"},g=()=>m(Ze,{dataSource:s.value,onClick:u},null),y=()=>m(be,{class:`${e.value}-selectable-trigger`,name:"down",rotate:d.value?180:0},null),p=()=>{if(s.value.length!==0)return m(Ye,h,{default:y,overlay:g})};return()=>{const{multiple:C}=l.value;if(C)return m("span",{class:`${e.value}-cell-triggers`},[m(He,{checked:r.value,indeterminate:o.value,disabled:c.value,onChange:a},null),p()])}}}),Rl=F({props:Kl,setup(e){const{locale:t,mergedPrefixCls:l}=M(L);return()=>{const{activeOrderBy:n,sortable:r}=e,{orders:o,nextTooltip:a}=r,s=a&&Pl(t.table,o,n),u=Ol(l,o,n);return s?m(Tt,{title:s},{default:()=>[u]}):u}}});function Pl(e,t,l){const n=l?t[t.indexOf(l)+1]:t[0],{sortCancel:r,sortAsc:o,sortDesc:a}=e;return n?n==="ascend"?o:a:r}function Ol(e,t,l){const n=e.value,r=`${n}-sortable-trigger-active`,o=t.includes("ascend")&&m(be,{name:"caret-up-filled",class:l==="ascend"?r:void 0},null),a=t.includes("descend")&&m(be,{name:"caret-down-filled",class:l==="descend"?r:void 0},null);return m("span",{class:`${n}-sortable-trigger`},[o,a])}const Wl=F({props:xl,setup(e){const{props:t,slots:l,mergedPrefixCls:n,fixedColumnKeys:r,columnOffsetsWithScrollBar:o,isSticky:a,handleSort:s,activeOrderByMap:u,activeFilterByMap:c,mergedRows:d,handleFilter:f}=M(L),h=b(()=>{const{type:i,ellipsis:v}=e.column,S=i||v!=null?v:t.ellipsis;return Qe(S)&&S.head===!1?void 0:S}),g=b(()=>{const{type:i,align:v,fixed:S,hasChildren:B,key:w,sortable:k,filterable:x}=e.column,$=n.value;let I={[`${$}-cell`]:!0,[`${$}-cell-${i}`]:!!i,[`${$}-cell-filterable`]:!!x,[`${$}-cell-sortable`]:!!k,[`${$}-cell-align-center`]:B||(v==null?void 0:v.title)==="center",[`${$}-cell-align-end`]:!B&&(v==null?void 0:v.title)==="end",[`${$}-cell-ellipsis`]:!!h.value};if(S){const{lastStartKey:W,firstEndKey:O}=r.value;I={...I,[`${$}-fix-start`]:S==="start",[`${$}-fix-start-last`]:W===w,[`${$}-fix-end`]:S==="end",[`${$}-fix-end-first`]:O===w,[`${$}-fix-sticky`]:a.value}}return ce(I)}),y=b(()=>{var I;const{key:i,fixed:v}=e.column,{offsetIndexMap:S}=d.value;if(!v)return;const{starts:B,ends:w}=o.value,k=Object.values(v==="start"?B:w),x=S[i][v==="start"?"colStart":"colEnd"],$=X((I=k.find(W=>W.index===x))==null?void 0:I.offset);return{position:"sticky",left:v==="start"?$:void 0,right:v==="end"?$:void 0}}),p=b(()=>u[e.column.key]),C=b(()=>c[e.column.key]||$t),K=i=>{const{key:v,filterable:S}=e.column;f(v,S,i)},E=()=>{const{key:i,sortable:v}=e.column;v&&s(i,v)};return()=>{var O,z,A;const{column:i}=e,{type:v,titleColSpan:S,titleRowSpan:B}=i;if(v==="scroll-bar")return m("th",{class:g.value,style:y.value,colspan:S===1?void 0:S,rowspan:B===1?void 0:B,onClick:E},null);const w=n.value;let k,x;if(v==="selectable")x=m(Il,null,null);else{const{title:le,customTitle:j,sortable:Z,filterable:ne}=i,re=h.value;x=Hl(le,j,l),k=rt(re,x,le);const J=zl(Z,p,ne,C,K);J.length>0?x=m("span",{class:`${w}-cell-triggers`},[m("span",{class:`${w}-cell-title`},[x]),J]):re&&(x=m("span",{class:`${w}-cell-title`},[x]))}const $=(O=t.customAdditional)==null?void 0:O.headCell,I=$?$({column:i}):void 0,W=(A=(z=t.customTag)==null?void 0:z.headCell)!=null?A:"th";return m(W,ye({class:g.value,style:y.value,colSpan:S===1?void 0:S,rowSpan:B===1?void 0:B,title:k},I,{onClick:E}),{default:()=>[x]})}}});function Hl(e,t,l){let n=e;return ve(t)?n=t({title:e}):U(t)&&l[t]&&(n=l[t]({title:e})),n}function zl(e,t,l,n,r){const o=[];return e&&o.push(m(Rl,{activeOrderBy:t.value,sortable:e},null)),l&&o.push(m(El,{activeFilterBy:n.value,filterable:l,onUpdateFilterBy:r},null)),o}function Ml(e){return e.map(t=>bt(t)).filter(Boolean)}function bt(e){if(e.titleColSpan!==0)return m(Wl,{key:e.key,column:e},null)}const Fl=F({props:Sl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:n}=M(L);return()=>{var u,c,d;const{columns:r}=e,o=(u=l.customAdditional)==null?void 0:u.headRow,a=o?o({columns:r}):void 0,s=(d=(c=l.customTag)==null?void 0:c.headRow)!=null?d:"tr";return m(s,ye({class:`${n.value}-row`},a),{default:()=>{var f;return[(f=t.default)==null?void 0:f.call(t)]}})}}});function St(e,t,l){return m(Fl,{columns:e,key:t},{default:()=>[l]})}const Pe=F({setup(e,{slots:t}){const{props:l,mergedRows:n,mergedPrefixCls:r}=M(L);return()=>{var d,f,h;let o;const{rows:a}=n.value,s=(d=l.customAdditional)==null?void 0:d.head,u=s?s({rows:a}):void 0,c=(h=(f=l.customTag)==null?void 0:f.head)!=null?h:"thead";return t.default?o=t.default():o=a.map((g,y)=>{const p=Ml(g);return St(g,y,p)}),m(c,ye({class:`${r.value}-thead`},u),{default:()=>[o]})}}}),Al=F({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:l,mergedVirtual:n,mergedVirtualColWidth:r,getVirtualColWidth:o,scrollHeadRef:a,handleScroll:s,scrollWidth:u,flattedData:c,flattedColumns:d,fixedColumns:f,mergedRows:h,isSticky:g}=M(L),y=P();Se(()=>{V(y,v=>{v&&(a.value=v.getHolderElement(),a.value.style.overflow="hidden")},{immediate:!0})}),Ll(a,s);const p=b(()=>u.value==="max-content"),C=b(()=>c.value.length>0),K=b(()=>{const v=l.value;return{[`${v}-fixed-holder`]:!0,[`${v}-sticky-holder`]:g.value}}),E=b(()=>{const v=g.value,{offsetTop:S,offsetBottom:B}=e;return{overflow:"hidden",top:v?X(S):void 0,bottom:v?X(B):void 0}}),i=b(()=>n.value.horizontal?h.value.rows.map((v,S)=>({key:S,data:v})):[]);return()=>{const v=C.value||!p.value;if(n.value.horizontal){const S=(I,{renderedData:W})=>{let O=[];if(v){const z=[];W.forEach(A=>{z.push(...A.data)}),O=Fe(z)}return m("table",{style:{tableLayout:"fixed"}},[v&&m(me,{columns:O,isFixedHolder:!0},null),m(Pe,null,{default:()=>[I]})])},B=({item:I,index:W,children:O})=>St(I.data,W,O),w=({item:I})=>bt(I),k=(I,W)=>{const{fixedStartColumns:O,fixedEndColumns:z}=f.value;return at(I,W,d.value,c.value,O,z,!0)},{virtualBufferSize:x,virtualBufferOffset:$}=t;return m("div",{class:K.value,style:E.value},[m(Je,{ref:y,dataSource:i.value,colModifier:k,getKey:"key",height:0,width:"100%",colWidth:r.value,getColWidth:o,rowRender:B,colRender:w,contentRender:S,virtual:{horizontal:!0,vertical:!1},bufferSize:x,bufferOffset:$},null)])}return m("div",{class:K.value,style:E.value,ref:a},[m("table",{style:{tableLayout:"fixed"}},[v&&m(me,{isFixedHolder:!0},null),m(Pe,null,null)])])}}});function Ll(e,t){const l=o=>{if(!o.shiftKey)return;const a=o.deltaY,s=o.currentTarget;if(a){const u=s.scrollLeft+a;t(o,u)}},n=o=>{pe(o,"wheel",l,{passive:!0})},r=o=>{de(o,"wheel",l)};Se(()=>{V(e,(o,a)=>{r(a),n(o)},{immediate:!0})}),he(()=>r(e.value))}const Nl=F({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:l,mergedSticky:n,stickyScrollLeft:r,setStickyScrollLeft:o}=M(L),a=P(!1),s=P(!1),u=P(0),c=P(0),d=P(0),f=b(()=>{const i=c.value,v=d.value;return v&&i*(i/v)});tt(()=>{const i=te(t);if(i&&a.value){const{clientWidth:v,scrollWidth:S,scrollLeft:B}=i;o(B/S*v),c.value=v,d.value=S}});const h=b(()=>({height:$e(),width:c.value,bottom:n.value.offsetScroll})),g=b(()=>{const i=e.value;return{[`${i}-sticky-scrollbar-thumb`]:!0,[`${i}-sticky-scrollbar-thumb-active`]:s.value}}),y=b(()=>({width:`${f.value}px`,transform:`translate3d(${r.value}px, 0, 0)`})),p=()=>s.value=!1,C=i=>{u.value=i.pageX-r.value,s.value=!0,i.preventDefault()},K=i=>{if(!s.value)return;const{buttons:v}=i||window.event;if(v===0){s.value=!1;return}let S=i.pageX-u.value;S<=0&&(S=0);const B=c.value,w=d.value,k=f.value;S+k>=B&&(S=B-k);const x=S/B*(w+2);l(i,x)},E=()=>{const i=te(t),v=Ne(i).top,S=v+i.offsetHeight,{container:B,offsetScroll:w}=n.value,k=B===window?document.documentElement.scrollTop+window.innerHeight:Ne(B).top+B.clientHeight;S-$e()<=k||v>=k-w?a.value=!1:a.value=!0};return Se(()=>{pe(document.body,"mouseup",p),pe(document.body,"mousemove",K),pe(window,"resize",E),V(()=>n.value.container,(i,v)=>{de(v,"scroll",E),pe(i,"scroll",E)},{immediate:!0}),E()}),he(()=>{de(document.body,"mouseup",p),de(document.body,"mousemove",K),de(window,"resize",E),de(n.value.container,"scroll",E)}),()=>!t.value||!a.value||d.value<=c.value||!f.value?null:m("div",{class:`${e.value}-sticky-scrollbar`,style:h.value},[m("div",{class:g.value,style:y.value,onMousedown:C},null)])}}),Dl=F({setup(e,{slots:t}){const{mergedPrefixCls:l}=M(L);return()=>{var n;return m("tbody",{class:`${l.value}-tbody`},[(n=t.default)==null?void 0:n.call(t)])}}}),Oe=F({props:{columns:Array,isEmpty:Boolean},setup(e,{slots:t}){const{mergedPrefixCls:l,hasFixed:n,scrollHorizontalOverflowed:r,scrollBarColumn:o}=M(L),{mainTableWidth:a}=M(Ae),s=b(()=>{var u,c;return(c=(u=e.columns)==null?void 0:u.length)!=null?c:1});return()=>{let u=t.default();if(e.isEmpty?r.value:n.value){const c=o.value;u=m("div",{class:`${l.value}-fixed-row`,style:{width:X(a.value-(c?c.width:0)),position:"sticky",left:0,overflow:"hidden"}},[u])}return m("tr",null,[m("td",{colspan:s.value},[u])])}}}),_l=F({props:Bl,setup(e){const t=P();return Ie(t,n=>{const{contentRect:{width:r}}=n;e.changeColumnWidth(e.cellKey,r)}),he(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>m("td",{ref:t,style:{padding:0,border:0,height:0}},[m("div",{style:{height:0,overflow:"hidden"}},[_t("Â ")])])}}),Vl=F({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=M(L),{changeColumnWidth:l}=M(Ae);return()=>{var r;const n=(r=e.columns)==null?void 0:r.map(o=>{const{key:a}=o;return m(_l,{key:a,cellKey:a,changeColumnWidth:l},null)});return m("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[n])}}}),jl=F({props:wl,setup(e){const{props:t,slots:l,config:n,mergedPrefixCls:r,mergedEmptyCell:o,activeOrderByMap:a,fixedColumnKeys:s,columnOffsets:u,isSticky:c,isTreeData:d,expandable:f,selectable:h,mergedPagination:g}=M(L),y=M(mt),p=y.props,C=b(()=>a[e.column.key]),K=Ul(y,e),E=b(()=>s.value.lastStartKey===e.column.key),i=b(()=>s.value.firstEndKey===e.column.key),v=b(()=>{const{type:w,ellipsis:k}=e.column;return w||k!=null?k:t.ellipsis}),S=b(()=>{const{fixed:w,align:k}=e.column,x=r.value;let $={[`${x}-cell`]:!0,[`${x}-cell-sorted`]:!!C.value,[`${x}-cell-align-${k.cell}`]:!!k&&k.cell!="start",[`${x}-cell-ellipsis`]:!!v.value};return w&&($={...$,[`${x}-fix-start`]:w==="start",[`${x}-fix-start-last`]:E.value,[`${x}-fix-end`]:w==="end",[`${x}-fix-end-first`]:i.value,[`${x}-fix-sticky`]:c.value}),ce($)}),B=b(()=>{const{fixed:w}=e.column;if(!w)return;const{starts:k,ends:x}=u.value,I=X((w==="start"?k:x)[e.column.key].offset);return{position:"sticky",left:w==="start"?I:void 0,right:w==="end"?I:void 0}});return()=>{var A,le,j;const{column:w}=e,{type:k}=w;let x,$;if(k==="selectable")x=Gl(y,l,h,n,g);else if(k==="indexable")x=xt(y,l,w,g);else{const Z=K.value;if(x=ql(y,e,l,Z),$=rt(v.value,x,Z),!k&&(fe(x)||x==="")){const ne=l.emptyCell||o.value;x=ve(ne)?ne({column:w,record:p.record,rowIndex:p.rowIndex}):ne}}e.column.fixed&&v.value&&(E.value||i.value)&&(x=m("span",{class:`${r.value}-cell-content`},[x]));const I=(A=t.customAdditional)==null?void 0:A.bodyCell,W=I?I({column:w,record:p.record,rowIndex:p.rowIndex}):void 0,O=(j=(le=t.customTag)==null?void 0:le.bodyCell)!=null?j:"td",z=k==="expandable"?m("div",{class:`${r.value}-expandable-wrapper`},[Xl(y,l,f,d,r.value),!It(x)&&m("span",{class:`${r.value}-expandable-trigger-gap`},null),x]):x;return m(O,ye({class:S.value,style:B.value,title:$,colSpan:e.colSpan,rowSpan:e.rowSpan},W),{default:()=>[z]})}}});function Ul(e,t){return b(()=>{const{props:{record:l}}=e,{column:n}=t,r=We(n.dataKey);if(r.length<=0)return;let o=l;for(let a=0;a<r.length&&o;a++){const s=r[a];o=o[s]}return o})}function ql(e,t,l,n){const{props:{record:r,rowIndex:o}}=e,{column:a}=t,{customCell:s}=a,u=U(s)?l[s]:s;return u?u({value:n,record:r,rowIndex:o}):n}function Xl(e,t,l,n,r){var k;const{icon:o,customIcon:a,indent:s,showLine:u}=l.value,{props:{record:c,expanded:d,level:f=0,hasPrevSibling:h,hasNextSibling:g,showLineIndentIndexList:y},expandDisabled:p,handleExpend:C}=e,K=f>0,E=n.value&&u&&s;let i;const v=(k=U(a)?t[a]:a)!=null?k:o;ve(v)?i=v({expanded:!!d,record:c}):i=U(v)?m(be,{name:v,rotate:d?90:0},null):v;const S=s?`width: ${X(s)}`:void 0,B={[`${r}-expandable-trigger`]:!0,[`${r}-expandable-trigger-show-line`]:E,[`${r}-expandable-trigger-disabled`]:p.value},w=[];if(s)for(let x=0;x<f;x++)w.push(m("div",{class:{[`${r}-expandable-indent`]:!0,[`${r}-expandable-indent-show-line`]:E&&y.includes(x)},style:S},null));return[...w,m("span",{class:B,style:S},[m("button",{class:`${r}-expandable-trigger-button`,type:"button",onClick:p.value?void 0:C},[i]),E&&[m("span",{class:`${r}-expandable-trigger-line-right`},null),(h||K)&&m("span",{class:`${r}-expandable-trigger-line-top`},null),g&&m("span",{class:`${r}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function Gl(e,t,l,n,r){const{props:{record:o,rowIndex:a},isSelected:s,isIndeterminate:u,selectDisabled:c,isHover:d,handleSelect:f}=e,{showIndex:h,multiple:g,customCell:y}=l.value,p=K=>{K.stopPropagation(),!g&&s.value&&!c.value&&f&&f()};if(!s.value&&!d&&h)return xt(e,t,n.columnIndexable,r);const C=U(y)?t[y]:y;if(g){const K={checked:s.value,disabled:c.value,indeterminate:u.value,onChange:f,onClick:p};return C?C({...K,record:o,rowIndex:a}):m(He,K,null)}else{const K={checked:s.value,disabled:c.value,onChange:f,onClick:p};return C?C({...K,record:o,rowIndex:a}):m(nt,K,null)}}function xt(e,t,l,n){const{props:{record:r,rowIndex:o},selectDisabled:a}=e,{customCell:s}=l,{pageIndex:u=1,pageSize:c=0}=n.value||{},d=U(s)?t[s]:s;if(!d)return;const f=a.value?"cursor: not-allowed":"cursor: pointer";return m("span",{style:f},[d({record:r,rowIndex:o,pageIndex:u,pageSize:c})])}function Yl(e,t,l){const n=[];return e.forEach((r,o)=>{const a=Ct(r,t,l,o);a&&n.push(a)}),n}function Ct(e,t,l,n){const{colSpan:r,rowSpan:o}=e,a=r==null?void 0:r(t,l),s=o==null?void 0:o(t,l);return a===0||s===0?void 0:m(jl,{colSpan:a===1?void 0:a,rowSpan:s===1?void 0:s,colIndex:n,column:e},null)}const Zl=F({props:Cl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:n,expandable:r,handleExpandChange:o,checkExpandDisabled:a,selectable:s,selectedRowKeys:u,indeterminateRowKeys:c,handleSelectChange:d,currentPageRowKeys:f}=M(L),{expandDisabled:h,handleExpend:g,selectDisabled:y,handleSelect:p,isHover:C,attrs:K}=Jl(e,r,a,o,s,d,f),E=b(()=>u.value.includes(e.rowKey)),i=b(()=>c.value.includes(e.rowKey)),v=b(()=>{const S=`${n.value}-row`,{level:B,expanded:w}=e;return ce({[`${S}`]:!0,[`${S}-level-${B}`]:!!B,[`${S}-selected`]:E.value,[`${S}-expanded`]:w})});return ze(mt,{props:e,expandDisabled:h,handleExpend:g,isSelected:E,isIndeterminate:i,selectDisabled:y,handleSelect:p,isHover:C}),()=>{var k,x,$;const S=(k=l.customAdditional)==null?void 0:k.bodyRow,B=S?S({record:e.record,rowIndex:e.rowIndex}):void 0,w=($=(x=l.customTag)==null?void 0:x.bodyRow)!=null?$:"tr";return m(w,ye({class:v.value},K.value,B),{default:()=>{var I;return[(I=t.default)==null?void 0:I.call(t)]}})}}});function Jl(e,t,l,n,r,o,a){const s=b(()=>l(e.rowData)),u=b(()=>{var v;return(v=t.value)==null?void 0:v.trigger}),c=()=>{const{rowKey:v,record:S}=e;n(v,S)},d=b(()=>a.value.disabledRowKeys.includes(e.rowKey)),f=b(()=>{var v;return(v=r.value)==null?void 0:v.trigger}),h=b(()=>{var v;return(v=r.value)==null?void 0:v.showIndex}),g=P(!1),y=()=>{const{rowKey:v,record:S}=e;o(v,S)},p=()=>{u.value==="click"&&c(),f.value==="click"&&y()},C=()=>{u.value==="dblclick"&&c(),f.value==="dblclick"&&y()},K=()=>g.value=!0,E=()=>g.value=!1,i=b(()=>{const v=s.value,S=u.value,B=d.value,w=f.value,k=!v&&S==="click"||!B&&w==="click",x=!v&&S==="dblclick"||!B&&w==="dblclick",$=!B&&h.value;let I="";return k||x?I="pointer":(v&&S||B&&w)&&(I="not-allowed"),{style:I?`cursor: ${I}`:void 0,onClick:k?p:void 0,onDblclick:x?C:void 0,onMouseenter:$?K:void 0,onMouseleave:$?E:void 0}});return{expandDisabled:s,handleExpend:c,selectDisabled:d,handleSelect:y,isHover:g,attrs:i}}function qe(e,t,l,n,r,o,a){const{children:s,expanded:u,level:c,hasPrevSibling:d,hasNextSibling:f,showLineIndentIndexList:h,record:g,rowKey:y}=e,p={key:y,expanded:u,level:c,hasPrevSibling:d,hasNextSibling:f,showLineIndentIndexList:h,hasChildren:!!(s!=null&&s.length),record:g,rowData:e,rowIndex:l,rowKey:y},C=m(Zl,p,{default:()=>[a]}),K=u&&Ql(p,n,t,r,o);return K?[C,K]:C}function Ql(e,t,l,n,r){const{customExpand:o}=n||{},{record:a,rowIndex:s}=e;let u;return ve(o)?u=o({record:a,rowIndex:s}):U(o)&&t[o]&&(u=t[o]({record:a,rowIndex:s})),u&&m(Oe,{class:`${r}-expanded-row`,columns:l},{default:()=>[u]})}const en=F({setup(){const{props:e,slots:t,expandable:l,mergedPrefixCls:n,mergedInsetShadow:r,mergedVirtual:o,mergedVirtualItemHeight:a,mergedVirtualColWidth:s,mergedAutoHeight:u,columnWidths:c,changeColumnWidth:d,flattedData:f,flattedColumns:h,fixedColumns:g,getVirtualColWidth:y,isSticky:p,mergedSticky:C,virtualScrollRef:K,scrollBodyRef:E,scrollContentRef:i,handleScroll:v,pingedStart:S,pingedEnd:B,scrollWidth:w,scrollHeight:k,scrollHorizontalOverflowed:x,scrollVerticalOverflowed:$,hasFixed:I,tableLayout:W}=M(L),O=P(),z=P(0),A=b(()=>u.value||!!w.value||p.value||o.value.horizontal);ze(Ae,{mainTableWidth:z,changeColumnWidth:(T,H)=>{Ot(O.value)&&d(T,H)}});const j=()=>{const T=te(E);T&&v({currentTarget:T})},Z=T=>{const{offsetWidth:H}=T.target;H!==z.value&&(z.value=H)};Se(()=>{j(),V([()=>e.dataSource,w],([,H])=>{H&&j()}),V(c,et(()=>{var N;((N=te(E))==null?void 0:N.scrollLeft)===0&&j()},16)),Rt(O.value,Z)}),he(()=>Pt(O.value,Z));const ne=b(()=>{const T=n.value;return ce({[`${T}-container`]:!0,[`${T}-ping-start`]:S.value,[`${T}-ping-end`]:B.value,[`${T}-fixed-layout`]:W.value==="fixed",[`${T}-fixed-column`]:I.value,[`${T}-inset-shadow`]:r.value,[`${T}-scroll-horizontal`]:x.value,[`${T}-scroll-vertical`]:$.value})}),re=b(()=>{var se;const T=k.value,H=o.value.horizontal?"hidden":"auto",N=o.value.vertical?"hidden":"auto",D=(se=e.scroll)==null?void 0:se.fullHeight;return{overflowX:H,overflowY:N,[D?"height":"maxHeight"]:T}}),J=b(()=>({tableLayout:W.value,width:w.value,minWidth:w.value?"100%":void 0})),Ke=(T,H,N)=>{_(e.onScrolledChange,T,H,N.map(D=>D.record))},Ee=b(()=>!o.value.vertical&&!o.value.horizontal?[]:f.value.map(T=>({...T,data:h.value}))),R=T=>{if(!(!A.value||!T))return m(Vl,{columns:T},null)},oe=T=>{if(t.alert)return m(Oe,{class:`${n.value}-alert-row`,columns:T},{default:()=>[t.alert()]})},G=T=>{if(!(f.value.length>0))return m(Oe,{class:`${n.value}-empty-row`,columns:T,isEmpty:!0},{default:()=>[m(Wt,{empty:e.empty},t)]})},Q=(T,H,N)=>{let D;if(N)D=N;else if(H!=null&&H.length){const se=[];H.forEach((Ce,we)=>{const Te=Yl(T!=null?T:[],Ce,we);se.push(...We(qe(Ce,T,we,t,l.value,n.value,Te)))}),D=se}return m(Dl,null,{default:()=>[oe(T),R(T),G(T),D]})},ae=()=>Q(h.value,f.value),xe=(T,H)=>Q(T,void 0,H);return()=>{const T=n.value,H=u.value,N=o.value,D=t.default?t.default():[];if(H||k.value||p.value||N.horizontal){const{offsetTop:se}=C.value;if(e.headless||D.push(m(Al,{offsetTop:se},null)),N.vertical&&(e.scroll||H)||!N.vertical&&N.horizontal){const Ce=({item:q,index:Y,children:ee})=>qe(q,q.data,Y,t,l.value,T,ee),we=({row:q,item:Y,index:ee,rowIndex:ue})=>Ct(Y,q,ue,ee),Te=(q,{renderedData:Y})=>{var ue;const ee=f.value.length?(ue=Y[0])==null?void 0:ue.data:h.value;return m("table",{ref:i,class:`${T}-table`,style:J.value},[ee?m(me,{columns:ee},null):void 0,xe(ee,q),!1])},Bt=(q,Y)=>{const{fixedStartColumns:ee,fixedEndColumns:ue}=g.value;return at(q,Y,h.value,f.value,ee,ue,!1)},{scroll:ie,onScrolledBottom:kt}=e;D.push(m(Je,{ref:K,class:`${T}-body-virtual-scroll`,dataSource:Ee.value,colModifier:Bt,fullHeight:ie==null?void 0:ie.fullHeight,getKey:q=>{var Y;return(Y=q.rowKey)!=null?Y:q.key},height:u.value?"100%":ie==null?void 0:ie.height,width:"100%",rowHeight:a.value,colWidth:s.value,getColWidth:y,rowRender:Ce,colRender:we,contentRender:Te,virtual:o.value,scrollMode:e.virtualScrollMode,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:v,onScrolledBottom:kt,onScrolledChange:Ke},null))}else D.push(m("div",{ref:E,class:`${T}-content`,style:re.value,onScroll:v},[m("table",{ref:i,class:`${T}-table`,style:J.value},[m(me,null,null),ae(),!1])]));p.value&&D.push(m(Nl,null,null))}else D.push(m("div",{ref:E,class:`${T}-content`,style:re.value,onScroll:v},[m("table",{ref:i,class:`${T}-table`,style:J.value},[m(me,null,null),!e.headless&&m(Pe,null,null),ae(),!1])]));return m("div",{ref:O,class:ne.value},[D])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tn(e,t){return e.footer?m("div",{class:`${t}-footer`},[e.footer()]):null}function ln(e,t,l,n){var a,s;let r=null,o=null;if(t!==null){const{position:u}=t,[c,d]=Vt(u).split("-"),f=`${n}-pagination ${n}-pagination-${d}`,h=(s=(a=e.pagination)==null?void 0:a.call(e,{total:l.length,...t}))!=null?s:m(Ut,ye({class:f,total:l.length},t),null);r=c==="top"?h:null,o=c==="bottom"?h:null}return[r,o]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function wt(e,t){const{getGreyColors:l}=t,n=l(),{fontSizeSm:r,heightMd:o,paddingSizeSm:a,paddingSizeMd:s,paddingSizeLg:u,colorTextTitleSecondary:c,colorEmphasizedContainerBg:d,colorBorder:f,colorIconInfo:h,colorPrimary:g,colorContainerBg:y,colorContainerBgHover:p,colorInfoContainerBg:C}=e;return{fontSizeSm:r,fontSizeMd:r,fontSizeLg:r,headRowHeightSm:o,headRowHeightMd:o,headRowHeightLg:o,cellPaddingHorizontalSm:a,cellPaddingHorizontalMd:s,cellPaddingHorizontalLg:u,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:c,headBgColor:d,headSeparatorColor:f,headIconColor:h,headIconColorActive:g,headIconBgColorHover:l().l30,insetShadowStart:`inset 10px 0 8px -8px ${De(n.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${De(n.d50,.12)}`,bodyRowBgColorHover:p,bodyRowBgColorSelected:y,bodyRowBgColorExpanded:C,bodyRowBgColorTreeExpanded:C,bodyCellVerticalAlign:"middle",expandableIconColor:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nn(e,t){const{getGreyColors:l}=t,n=l();return{...wt(e,t),insetShadowStart:`inset 10px 0 8px -8px ${n.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${n.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const on=(e,t,l)=>t==="default"?wt(e,l):nn(e,l),rn={sm:32,md:40,lg:56},an=150,sn=F({name:"IxTable",props:bl,setup(e,{expose:t,slots:l}){const n=Be("common"),{globalHashId:r,hashId:o,registerToken:a}=Ht("table");a(on);const s=b(()=>`${n.prefixCls}-table`),u=Be("locale"),c=Be("table"),d=b(()=>{var R;return(R=e.autoHeight)!=null?R:c.autoHeight}),f=b(()=>{var R;return(R=e.childrenKey)!=null?R:c.childrenKey}),h=zt(e,c),g=b(()=>{var R;return(R=e.emptyCell)!=null?R:c.emptyCell}),y=b(()=>{var R;return(R=e.insetShadow)!=null?R:c.insetShadow}),p=b(()=>{var R;return(R=e.size)!=null?R:c.size}),C=b(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),K=b(()=>{var R;return(R=e.virtualItemHeight)!=null?R:rn[p.value]}),E=b(()=>{var R;return(R=e.virtualColWidth)!=null?R:an}),{mergedPagination:i}=ol(e,c,p),v=pl(e),S=rl(e,v),B=Xt(e,l,c,S.scrollBarSizeOnFixedHolder),w=gl(B.flattedColumns),k=nl(B.flattedColumns),x=ll(e,B.flattedColumns),$=ml(e,B,S,v.isSticky,C,d),{columnWidthMap:I,flattedColumns:W}=B,{activeSorters:O}=w,{activeFilters:z}=k,A=new Map,le=()=>{A.clear(),W.value.forEach(R=>{A.set(R.key,R)})};V(W,()=>{le()},{immediate:!0});const j=tl(e,f,h,O,z,x.expandedRowKeys,i),Z=dl(e,u,B.flattedColumns,j);cl(e,c,i,O,z,S.scrollTo);const re={props:e,slots:l,config:c,locale:u,mergedPrefixCls:s,mergedEmptyCell:g,mergedInsetShadow:y,mergedVirtual:C,mergedVirtualItemHeight:K,mergedVirtualColWidth:E,mergedAutoHeight:d,getVirtualColWidth:(R,oe)=>{var G,Q;return(Q=I.value[oe])!=null?Q:(G=A.get(oe))==null?void 0:G.width},...B,...S,...w,...k,...v,tableLayout:$,mergedPagination:i,...x,...j,...Z};ze(L,re),t({scrollTo:S.scrollTo});const{flattedData:J,filteredData:Ke}=j,Ee=b(()=>{const R=s.value,{borderless:oe=c.borderless,scroll:G}=e;return ce({[r.value]:!!r.value,[o.value]:!!o.value,[R]:!0,[`${R}-auto-height`]:d.value,[`${R}-borderless`]:oe,[`${R}-empty`]:J.value.length===0,[`${R}-full-height`]:G==null?void 0:G.fullHeight,[`${R}-${p.value}`]:!0})});return()=>{const R=s.value,oe=m(Mt,{header:e.header},l),G=tn(l,R),Q=[oe];let ae=[m(en,null,null),G].filter(Boolean);if(J.value.length>0){const[T,H]=ln(l,i.value,Ke.value,R);ae=[T,...ae,H].filter(Boolean)}const xe=cn(e.spin);return xe?Q.push(m(Ft,xe,{default:()=>[ae]})):Q.push(...ae),m("div",{class:Ee.value},[Q])}}});function cn(e){return jt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const hn=sn,yn=Me;export{hn as I,yn as a,qt as g,bl as t};
