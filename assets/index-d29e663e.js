import{am as qe,an as Oe,aQ as wt,ao as Xe,m as X,M as Be,aK as te,aR as Ee,o as re,D as Ie,Y as kt,ak as Ce,T as Ge,A as we,S as Ye,c as De,j as Pe,a7 as Bt,at as $t,H as Qe,X as Se,U as ve,Z as Ae,aS as Tt,E as Kt,G as Et,aT as It,av as Mt,al as Fe,N as Rt,aw as Ot,ar as Pt,aF as zt}from"./index-9cb41eac.js";import{c as g,r as P,w as j,b as Ze,f as G,U as Ht,T as Wt,d as Je,z as et,n as ye,m as $e,by as Dt,W as At,l as N,y as L,p as ie,q as m,i as he,a7 as ge,M as Ft,an as _t,D as ze,L as Lt,au as Nt}from"./vendor-fe119cfa.js";import{t as _e,u as Vt}from"./useTreeCheckState-6f6c6f23.js";import{b as tt}from"./GlobalCodeBox-c6f44430.js";import{I as jt}from"./index-92bb74bf.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ut(e,t,l){const o=g(()=>{const{fixedStartColumns:n,fixedEndColumns:s,fixedColumnIndexMap:r}=e.value;return Le(n,s.filter(i=>i.type!=="scroll-bar"),r,t.value,l.value-1)}),a=g(()=>{const{fixedStartColumns:n,fixedEndColumns:s,fixedColumnIndexMap:r}=e.value;return Le(n,s,r,t.value,l.value)});return{columnOffsets:o,columnOffsetsWithScrollBar:a}}function Le(e,t,l,o,a){var c,u,y,h,b,S;const n={},s={};let r=0,i=0;for(let C=0;C<e.length;C++){const x=e[C],k=(u=(c=o[x.key])!=null?c:x.width)!=null?u:0;n[x.key]={index:(y=l[x.key])!=null?y:C,offset:r},r+=k}for(let C=0;C<t.length;C++){const x=t[t.length-C-1],k=(b=(h=o[x.key])!=null?h:x.width)!=null?b:0;s[x.key]={index:(S=l[x.key])!=null?S:a-C-1,offset:i},i+=k}return{starts:n,ends:s}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qt(e){const t=P({}),l=(o,a)=>{a===!1?delete t.value[o]:t.value[o]=a};return j(e,o=>{const a=new Set(o.map(n=>n.key));Object.keys(t).forEach(n=>{a.has(n)||delete t.value[n]})}),{measuredColumnWidthMap:t,changeColumnWidth:l}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const lt=Symbol("IxTableColumn"),He=()=>{};He.displayName="IxTableColumn";He[lt]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nt(e,t,l){if(!e||Ze(e)&&e.title===!1)return;if(G(t)||Ht(t))return t;const o=qe(t).find(a=>a.type===Wt);return o?o.children:l}function Xt(e){return"key"in e?e.key:"dataKey"in e?Oe(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:wt("__IDUX_table_column_key_")}function ot(e,t,l,o,a,n,s=!1){const r=h=>h.filter(b=>b.type!=="scroll-bar"),i=s?a:r(a),c=s?n:r(n);if(!i.length&&!c.length)return;const u=o.findIndex(h=>h.rowKey===e.rowKey),y=h=>{if(t.findIndex(C=>C.key===h.key)>-1)return;const b=l.findIndex(C=>C.key===h.key);let S;return G(h.key)?S=`fix-${u}-${h.key}`:S=`fix-${u}-${b}`,{data:h,index:b,poolKey:S}};return{start:i.map(y).filter(Boolean),end:c.map(y).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Gt(e,t,l,o){const a=g(()=>{var S;const{columns:b}=e;return at(b&&b.length>0?b:rt((S=t.default)==null?void 0:S.call(t)),l)}),{flattedColumns:n,scrollBarColumn:s,flattedColumnsWithScrollBar:r}=Qt(a,o),{fixedColumns:i,fixedColumnKeys:c}=Zt(r),u=g(()=>!!e.ellipsis||n.value.some(b=>b.ellipsis)),y=g(()=>n.value.some(b=>b.fixed)),h=g(()=>Jt(a.value,s.value));return{flattedColumns:n,scrollBarColumn:s,flattedColumnsWithScrollBar:r,fixedColumns:i,fixedColumnKeys:c,hasEllipsis:u,hasFixed:y,mergedRows:h}}function at(e,t){return e.map(l=>Yt(l,t))}function rt(e){const t=[];return qe(e,{key:lt}).forEach((l,o)=>{const{props:a,children:n}=l,{key:s=o,editable:r,ellipsis:i,...c}=a||{};c.key=s,c.editable=r||r==="",c.ellipsis=i||i==="";const{default:u,cell:y,title:h,expand:b,icon:S}=n||{};u&&(c.children=rt(u())),y&&(c.customCell=y),h&&(c.customTitle=h),b&&(c.customExpand=b),S&&(c.customIcon=S),t.push(c)}),t}function be(e){return G(e)?{title:e,cell:e}:e}function Yt(e,t){var i,c;const{columnBase:l,columnExpandable:o,columnSelectable:a,columnIndexable:n}=t,{align:s=l.align}=e,r=Xt(e);if("type"in e){const{type:u}=e;if(u==="expandable"){const{showLine:y=o.showLine,icon:h=o.icon}=e;return{...e,key:r,align:be(s),icon:h,showLine:y}}if(u==="selectable"){const{multiple:y=!0,showIndex:h=a.showIndex}=e;return{...e,key:r,align:be(s),multiple:y,showIndex:h}}if(u==="indexable"){const y=(c=(i=e.align)!=null?i:n.align)!=null?c:l.align;return{...n,...e,align:be(y),key:r}}return{...e,key:r,align:be(s)}}else{const{sortable:u,filterable:y,children:h}=e,b={...e,key:r,align:be(s)};return u&&(b.sortable={...l.sortable,...u}),y&&(b.filterable={...l.filterable,...y}),h!=null&&h.length&&(b.children=at(h,t)),b}}function Qt(e,t){const l=g(()=>We(e.value)),o=g(()=>{const n=t.value,s=l.value;if(n===0||s.length===0)return;const r=s[s.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:r&&r.fixed,width:n}}),a=g(()=>{const n=l.value,s=o.value;return s?[...n,s]:n});return{flattedColumns:l,scrollBarColumn:o,flattedColumnsWithScrollBar:a}}function We(e){const t=[];return e.forEach(l=>{const{fixed:o,children:a}=l;if(a!=null&&a.length){let n=We(a);o&&(n=n.map(s=>({fixed:o,...s}))),t.push(...n)}else t.push(l)}),t}function Zt(e){const t=g(()=>{const o=[],a=[],n={};return e.value.forEach((s,r)=>{const{key:i,fixed:c}=s;c==="start"?(o.push(s),n[i]=r):c==="end"&&(a.push(s),n[i]=r)}),{fixedStartColumns:o,fixedEndColumns:a,fixedColumnIndexMap:n}}),l=g(()=>{var n,s;const{fixedStartColumns:o,fixedEndColumns:a}=t.value;return{lastStartKey:(n=o[o.length-1])==null?void 0:n.key,firstEndKey:(s=a[0])==null?void 0:s.key}});return{fixedColumns:t,fixedColumnKeys:l}}function Jt(e,t){const l=[],o={};function a(r,i,c){var h;(h=l[c])!=null||(l[c]=[]);let u=i;return r.map(b=>{var p;let S=(p=b.titleColSpan)!=null?p:1,C=!1;const x=b.children;if(x!=null&&x.length){C=!0;const d=a(x,u,c+1);Je(b.titleColSpan)&&(S=d.reduce((f,v)=>f+v))}const k=u+S-1;return l[c].push({...b,titleColSpan:S,colStart:u,colEnd:k,hasChildren:C}),o[b.key]={colStart:u,colEnd:k},u+=S,S})}const n=t?[...e,t]:e;a(n,0,0);const s=l.length;return l.forEach((r,i)=>{r.forEach(c=>{c.hasChildren||(c.titleRowSpan=s-i)})}),{rows:l,offsetIndexMap:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function el(e,t,l,o,a,n,s){const r=g(()=>{const p=t.value,d=l.value;return e.dataSource.map((f,v)=>st(f,d,p,v,e.dataSource.length))}),i=g(()=>{const p=new Map,d=new Map,f=new Map;return _e(r.value,"children",(v,B)=>{var $;p.set(v.rowKey,v),d.set(v.rowKey,($=B[0])==null?void 0:$.rowKey),f.set(v.rowKey,B.length)}),{dataKeyMap:p,parentKeyMap:d,depthMap:f}}),c=g(()=>i.value.dataKeyMap),u=g(()=>i.value.parentKeyMap),y=g(()=>i.value.depthMap),h=g(()=>it(r.value,a.value,n.value)),b=g(()=>ct(h.value,o.value,n.value)),S=g(()=>{const p=s.value,d=b.value;if(p===null||!p.pageSize)return d;{const{total:f}=p;if(f&&d.length<f)return d;const v=p.pageSize,B=(p.pageIndex-1)*v;return d.slice(B,B+v)}}),C=g(()=>{const p=new Map;return _e(S.value,"children",d=>{p.set(d.rowKey,d)}),p}),x=g(()=>{const p=n.value;return p.length>0?ut(S.value,p,0):S.value});return{isTreeData:g(()=>r.value.some(p=>{var d;return(d=p.children)==null?void 0:d.length})),filteredData:h,flattedData:x,mergedData:r,mergedMap:c,paginatedData:S,paginatedMap:C,parentKeyMap:u,depthMap:y}}function st(e,t,l,o,a,n){var c;const s=t(e),r={record:e,rowKey:s,parentKey:n==null?void 0:n[0].rowKey,showLineIndentIndexList:(c=[...n!=null?n:[]].reverse())==null?void 0:c.reduce((u,y,h)=>(y.hasNextSibling&&u.push(h),u),[]),hasPrevSibling:o>0,hasNextSibling:o<a-1},i=e[l];return i&&(r.children=i.map((u,y)=>st(u,t,l,y,i.length,[r,...n!=null?n:[]]))),r}function ct(e,t,l){const o=t.filter(s=>s.sorter),a=o.length;if(a===0)return e;const n=e.slice();return n.forEach(s=>{l.includes(s.rowKey)&&s.children&&s.children.length>0&&(s.children=ct(s.children,t,l))}),n.sort((s,r)=>{for(let i=0;i<a;i++){const{orderBy:c,sorter:u}=o[i],y=u(s.record,r.record);if(y!==0)return c==="ascend"?y:-y}return 0})}function it(e,t,l){const o=t.filter(a=>a.filter);return o.length===0?e:e.map(a=>{const n=o.every(({filter:u,filterBy:y})=>u(y,a.record)),{rowKey:s,children:r}=a,i=l.includes(s);let c=a;if(i&&r&&r.length){const u=it(r,t,l);u.length!==r.length&&(c={...a,children:u})}return n||i&&c.children&&c.children.length?c:null}).filter(a=>a!==null)}function ut(e,t,l){return e.reduce((o,a)=>{const{children:n,parentKey:s,record:r,rowKey:i,hasPrevSibling:c,hasNextSibling:u,showLineIndentIndexList:y}=a,h=t.includes(i);if(o.push({children:n,parentKey:s,record:r,rowKey:i,level:l,expanded:h,hasPrevSibling:c,hasNextSibling:u,showLineIndentIndexList:y}),h&&a.children){const b=ut(a.children,t,l+1);o.push(...b)}return o},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tl(e,t){const l=g(()=>t.value.find(r=>"type"in r&&r.type==="expandable")),[o,a]=Xe(e,"expandedRowKeys",()=>[]);return{expandable:l,expandedRowKeys:o,setExpandedRowKeys:a,checkExpandDisabled:r=>{if(!l.value)return!0;const{disabled:i,customExpand:c}=l.value,{record:u}=r;return i!=null&&i(u)?!0:!(c||r.children&&r.children.length>0)},handleExpandChange:(r,i)=>{const{onChange:c,onExpand:u}=l.value||{},y=[...o.value],h=y.indexOf(r),b=h>=0;b?y.splice(h,1):y.push(r),X(u,!b,i),a(y),X(c,y)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ll(e){const t=g(()=>e.value.filter(n=>n.filterable)),l=et({}),o=P([]);return j(t,(n,s)=>{n.forEach(r=>{const{key:i,filterable:c}=r,u=c.filterBy;if(u||l[i]===void 0){l[i]=u||[];return}const y=s?s.find(b=>b.key===i):void 0;(y==null?void 0:y.filterable.filterBy)&&(l[i]=[])}),o.value=Ne(n,l)},{immediate:!0}),{activeFilters:o,activeFilterByMap:l,handleFilter:(n,s,r)=>{const{onChange:i}=s;l[n]=r,o.value=Ne(t.value,l),X(i,r,o.value)}}}function Ne(e,t){return e.map(l=>{const{key:o,filterable:a}=l,{filter:n,filterBy:s=t[o]}=a;return{key:o,filter:n,filterBy:s}}).filter(l=>l.filter&&l.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nl(e,t,l){var c,u,y,h,b;const o=Be("pagination"),a=g(()=>{const{pagination:S}=e;return S===!1?null:S===!0?{}:S}),n=P((u=(c=a.value)==null?void 0:c.pageIndex)!=null?u:1),s=P((b=(h=(y=a.value)==null?void 0:y.pageSize)!=null?h:t.pagination.pageSize)!=null?b:o.pageSize),r=(S,C)=>{var x;n.value=S,s.value=C,X((x=a.value)==null?void 0:x.onChange,S,C)};return{mergedPagination:g(()=>{var C,x;const S=a.value;return S===null?null:{...t.pagination,size:l.value,...S,pageIndex:(C=S.pageIndex)!=null?C:n.value,pageSize:(x=S.pageSize)!=null?x:s.value,onChange:r}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ol(e,{setStickyScrollLeft:t}){const l=P(),o=P(),a=P(),n=P(),s=P(),r=P();j(l,v=>{v&&(n.value=v.getHolderElement())},{immediate:!0}),j(o,v=>{v&&(a.value=v.getHolderElement(),a.value.style.overflow="hidden")},{immediate:!0});const i=sl(n,s),{handleScroll:c,pingedStart:u,pingedEnd:y}=al(e,l,o,a,n,r,i,t),{scrollHorizontalOverflowed:h,scrollVerticalOverflowed:b}=rl(n,i),S=g(()=>{var v;return te((v=e.scroll)==null?void 0:v.width)}),C=g(()=>{var v;return te((v=e.scroll)==null?void 0:v.height)}),x=g(()=>Ee(re(n))),k=g(()=>b.value?x.value:0),p=g(()=>u.value&&h.value),d=g(()=>y.value&&h.value);return{virtualScrollRef:l,headerVirtualScrollRef:o,scrollHeadRef:a,scrollBodyRef:n,scrollContentRef:s,scrollFootRef:r,handleScroll:c,scrollTo:v=>{var B;e.virtual?(B=l.value)==null||B.scrollTo(v):typeof v=="number"&&kt({target:re(n),top:v,duration:200})},pingedStart:p,pingedEnd:d,scrollWidth:S,scrollHeight:C,scrollBarSize:x,scrollBarSizeOnFixedHolder:k,scrollHorizontalOverflowed:h,scrollVerticalOverflowed:b}}function al(e,t,l,o,a,n,s,r){const i=P(!1),c=P(!1);let u;const y=()=>{u&&(clearTimeout(u),u=void 0)};ye(()=>y());const h=P(),b=p=>{h.value=p,y(),u=setTimeout(()=>{h.value=void 0,u=void 0},100)},S=(p,d)=>{d&&d.scrollLeft!==p&&(d.scrollLeft=p)},C=(p,d)=>{d&&d.scrollTo({left:p})},x=p=>{const d=re(a);if(!d)return;const{clientWidth:f,scrollWidth:v}=d;r(p/v*f||0)},k=(p,d)=>{const f=p==null?void 0:p.currentTarget,v=d!=null?d:f.scrollLeft,B=h.value;if((!B||B===f)&&(b(f),l.value?C(v,l.value):S(v,o.value),t.value?C(v,t.value):S(v,re(a)),S(v,n.value),x(v)),f){const{scrollWidth:$,clientWidth:T}=f;i.value=v>1,c.value=$-T-v>1}(p==null?void 0:p.type)==="scroll"&&X(e.onScroll,p)};return j(s,()=>{const p=re(a);p&&k({currentTarget:p})}),{handleScroll:k,pingedStart:i,pingedEnd:c}}function rl(e,t){const l=P(!1),o=P(!1);return j(t,()=>{const n=re(e.value);n?(l.value=n.scrollWidth>n.clientWidth,o.value=n.scrollHeight>n.clientHeight):(l.value=!1,o.value=!1)}),{scrollHorizontalOverflowed:l,scrollVerticalOverflowed:o}}function sl(e,t){const l=P(!1),o=()=>{l.value=!l.value};let a=[];const n=()=>a.forEach(s=>s());return $e(()=>{a=[Ie(e,o),Ie(t,o)]}),ye(()=>n()),l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function cl(e,t,l,o,a,n){const s=g(()=>{var u;return(u=e.scrollToTopOnChange)!=null?u:t.scrollToTopOnChange});let r=[];const i=()=>{r=[j([()=>{var u;return(u=l.value)==null?void 0:u.pageIndex},()=>{var u;return(u=l.value)==null?void 0:u.pageSize}],()=>n(0)),j([a,o],([u,y],[h,b])=>{(!il(u,h)||!ul(y,b))&&n(0)})]},c=()=>{r.forEach(u=>u())};j(s,u=>{c(),u&&i()},{immediate:!0})}function il(e,t){return e.length===t.length&&e.every(l=>{const o=t.find(a=>a.key===l.key);return o?l.filter===o.filter&&l.filterBy.length===o.filterBy.length&&l.filterBy.every(a=>o.filterBy.includes(a)):!1})}function ul(e,t){return e.length===t.length&&e.every(l=>{const o=t.find(a=>a.key===l.key);return o?l.sorter===o.sorter&&l.orderBy===o.orderBy&&l.multiple===o.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dl(e,t,l,{mergedData:o,mergedMap:a,paginatedData:n,paginatedMap:s,parentKeyMap:r,depthMap:i}){const c=g(()=>l.value.find(M=>"type"in M&&M.type==="selectable")),[u,y]=Xe(e,"selectedRowKeys",()=>[]),h=g(()=>({data:o.value,dataMap:a.value,parentKeyMap:r.value,depthMap:i.value})),b=P("children"),S=P(M=>M.rowKey),C=g(()=>{var M;return(M=c.value)!=null&&M.multiple?e.cascaderStrategy:"off"}),x=g(()=>{var z;const M=(z=c.value)==null?void 0:z.disabled;return O=>!!(M!=null&&M(O.record))}),k=Vt(u,h,b,S,C,x),{isCheckDisabled:p,isChecked:d,isIndeterminate:f,toggle:v,getAllCheckedKeys:B,getAllUncheckedKeys:$}=k,T=g(()=>{const M=[],z=[];return s.value.forEach((O,D)=>{p(D)?z.push(D):M.push(D)}),{enabledRowKeys:M,disabledRowKeys:z}}),I=g(()=>{let M=!!s.value.size,z=!!s.value.size,O=!1;for(const D of s.value.keys())d(D)||f(D)?O=!0:(z=!1,p(D)||(M=!1));return!z&&!O&&(M=!1),{checked:M,allSelected:z,someSelected:O}}),w=g(()=>I.value.checked),R=g(()=>!I.value.allSelected&&I.value.someSelected),H=new Map,W=M=>{y(M);const z=a.value,{onChange:O}=c.value||{};if(O){const D=[];H.forEach((Z,U)=>{M.includes(U)||H.delete(U)}),M.forEach(Z=>{let U=z.get(Z);U?H.set(Z,U):U=H.get(Z),U&&D.push(U.record)}),X(O,M,D)}},F=(M,z)=>{const D=a.value.get(M);if(!D)return;const{multiple:Z,onSelect:U}=c.value||{};let ne=[...u.value],se;if(Z){const{checked:ke,checkedKeys:ue}=v(D);se=ke,ne=ue}else se=!d(M),ne=se?[M]:[];X(U,se,z),W(ne)},Y=()=>{const{disabledRowKeys:M}=T.value;let z;w.value?z=$(n.value,M.filter(O=>d(O)),!0):z=B(n.value,M.filter(O=>!d(O)),!0),W(z)},ee=fl(c,t),Q=vl(c,k,a,s,u,W);return{selectable:c,selectedRowKeys:u,isChecked:d,isIndeterminate:f,isCheckDisabled:p,currentPageRowKeys:T,currentPageAllSelected:w,currentPageSomeSelected:R,handleSelectChange:F,handleHeadSelectChange:Y,mergedSelectableMenus:ee,handleSelectableMenuClick:Q}}const dt=Symbol("IDUX_TABLE_KEY_selectable-all"),ft=Symbol("IDUX_TABLE_KEY_selectable-invert"),vt=Symbol("IDUX_TABLE_KEY_selectable-none"),ht=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function fl(e,t){return g(()=>{const{menus:l}=e.value||{};if(!l||l.length===0)return[];const{selectAll:o,selectInvert:a,selectNone:n,selectPageInvert:s}=t.table;return l.map(r=>G(r)?r==="all"?{type:"item",key:dt,label:o}:r==="invert"?{type:"item",key:ft,label:a}:r==="none"?{type:"item",key:vt,label:n}:r==="pageInvert"?{type:"item",key:ht,label:s}:{type:"item",key:r,label:r}:r)})}function vl(e,t,l,o,a,n){const{checkDisabledKeySet:s,checkStateResolver:r,getAllCheckedKeys:i,isChecked:c,isCheckDisabled:u}=t,y=()=>{const{onSelectAll:x}=e.value||{},k=i([...s.value].filter(p=>!c(p)));X(x,k),n(k)},h=()=>{const{onSelectInvert:x}=e.value||{},k=[],p=[];l.value.forEach((f,v)=>{u(v)||(c(v)?p.push(v):k.push(v))});const d=r.removeKeys(r.appendKeys(a.value,k),p);n(d),X(x,d)},b=()=>{const{onSelectNone:x}=e.value||{};X(x),n([])},S=()=>{const{onSelectPageInvert:x}=e.value||{},k=[],p=[];o.value.forEach((f,v)=>{u(v)||(c(v)?p.push(v):k.push(v))});const d=r.removeKeys(r.appendKeys(a.value,k),p);n(d),X(x,d)},C=new Map([[dt,y],[ft,h],[vt,b],[ht,S]]);return x=>{const k=x.key;if(Dt(k)&&C.has(k)){C.get(k)();return}const{onMenuClick:p}=e.value||{};if(!p)return;const d=[];o.value.forEach((f,v)=>{u(v)||d.push(v)}),X(p,x,d)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function hl(e){const t=g(()=>e.value.filter(s=>s.sortable)),l=g(()=>t.value.some(s=>s.sortable.multiple!==void 0)),o=et({}),a=P([]);return j(t,(s,r)=>{s.forEach(i=>{const{key:c,sortable:u}=i,y=u.orderBy;if(y||o[c]===void 0){o[c]=y;return}const h=r?r.find(S=>S.key===c):void 0;(h==null?void 0:h.sortable.orderBy)&&(o[c]=void 0)}),a.value=je(s,o)},{immediate:!0}),{activeSorters:a,activeOrderByMap:o,handleSort:(s,r)=>{const{orders:i,onChange:c}=r,u=o[s],y=u?Ve(i,u):Ve(i);l.value?o[s]=y:Object.keys(o).forEach(h=>{s===h?o[h]=y:o[h]=void 0}),a.value=je(t.value,o),X(c,y,a.value)}}}function Ve(e,t){return t?e[e.indexOf(t)+1]:e[0]}function je(e,t){return e.map(l=>{const{key:o,sortable:a}=l,{multiple:n=0,orderBy:s=t[o],sorter:r}=a;return{key:o,multiple:n,orderBy:s,sorter:r}}).filter(l=>l.orderBy).sort((l,o)=>o.multiple-l.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function yl(e){const t=g(()=>!!e.sticky),l=g(()=>{const{sticky:n}=e,{offsetTop:s=0,offsetBottom:r=0,offsetScroll:i=0,container:c=window}=At(n)?n:{};return{offsetTop:s,offsetBottom:r,offsetScroll:i,container:c}}),[o,a]=Ce(0);return{isSticky:t,mergedSticky:l,stickyScrollLeft:o,setStickyScrollLeft:a}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function gl(e,{hasEllipsis:t,hasFixed:l},{scrollWidth:o,scrollHeight:a},n,s,r){return g(()=>e.tableLayout?e.tableLayout:o.value&&l.value?o.value==="max-content"?"auto":"fixed":a.value||r.value||n.value||t.value||s.value.horizontal||s.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const V=Symbol("TABLE_TOKEN"),yt=Symbol("tableBodyToken"),gt=Symbol("tableBodyRowToken"),xe=N({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:l,measuredColumnWidthMap:o,mergedSelectableMenus:a,mergedPrefixCls:n}=L(V),s=g(()=>{const{isFixedHolder:r,columns:i}=e;return i||(r?l.value:t.value)});return()=>{if(s.value.every(c=>!c.width&&!c.type))return;const r=n.value,i=s.value.map(c=>{var C;const{key:u,type:y}=c,h=e.isFixedHolder&&(C=o.value[u])!=null?C:c.width,b=y?ie({[`${r}-col-${y}`]:!0,[`${r}-col-with-dropdown`]:y==="selectable"&&a.value.length>0}):void 0,S={width:te(h),minWidth:te(c.minWidth),maxWidth:te(c.maxWidth)};return m("col",{key:u,class:b,style:S},null)});return m("colgroup",null,[i])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const pl={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"all"},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},ml={columns:{type:Array,required:!0}},bl={column:{type:Object,required:!0}},Sl={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},xl={column:{type:Object,required:!0},isLast:{type:Boolean,required:!0},colSpan:Number,rowSpan:Number},Cl={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},wl={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},kl={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},Bl=N({props:wl,setup(e){const{slots:t,config:l,locale:o,mergedPrefixCls:a}=L(V),n=g(()=>{var d;return(d=e.filterable.multiple)!=null?d:l.columnBase.filterable.multiple}),s=g(()=>{var d;return(d=e.filterable.footer)!=null?d:l.columnBase.filterable.footer}),r=e.activeFilterBy,[i,c]=Ce(()=>r);j(()=>e.activeFilterBy,d=>c(d));const[u,y]=Ce(!1),h=d=>{y(d),d||e.onUpdateFilterBy(i.value)},b=()=>{y(!1),e.onUpdateFilterBy(i.value)},S=()=>{c(r)},C=d=>{const f=`${a.value}-filterable-menu-label`,v=n.value?Pe:tt;return m("span",{class:f},[m(v,{checked:d.selected,disabled:d.disabled},null),m("span",{class:`${f}-content`},[d.label])])},x=()=>{const d=[],{customMenu:f,menus:v}=e.filterable;return he(f)?d.push(f({selectedKeys:i.value,setSelectedKeys:c})):G(f)&&t[f]?d.push(t[f]({selectedKeys:i.value,setSelectedKeys:c})):d.push($l(v,n,i,c,C)),s.value&&d.push(Tl(o,a,b,S)),d},k=g(()=>{const d=`${a.value}-filterable-trigger`;return ie({[d]:!0,[`${d}-active`]:e.activeFilterBy.length>0})}),p=()=>{const{customTrigger:d}=e.filterable;return he(d)?d():G(d)&&t[d]?t[d]():m("span",{class:k.value,onClick:f=>f.stopPropagation()},[m(we,{name:"filter-filled"},null)])};return()=>{const d={visible:u.value,hideOnClick:!s.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":h};return m(Ge,d,{default:p,overlay:x})}}}),$l=(e,t,l,o,a)=>{const n={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:l.value,"onUpdate:selectedKeys":o};return m(Ye,n,{itemLabel:a})},Tl=(e,t,l,o)=>{const{filterConfirm:a,filterReset:n}=e.table;return m("div",{class:`${t.value}-filterable-trigger-footer`},[m(De,{mode:"primary",size:"xs",onClick:l},{default:()=>[a]}),m(De,{size:"xs",onClick:o},{default:()=>[n]})])},Kl=N({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:l,currentPageRowKeys:o,currentPageAllSelected:a,currentPageSomeSelected:n,handleHeadSelectChange:s,mergedSelectableMenus:r,handleSelectableMenuClick:i}=L(V),c=g(()=>{const x=t.value.size;return x===0||x===o.value.disabledRowKeys.length}),[u,y]=Ce(!1),h={"onUpdate:visible":y,trigger:"click"},b=()=>m(Ye,{dataSource:r.value,onClick:i},null),S=()=>m(we,{class:`${e.value}-selectable-trigger`,name:"down",rotate:u.value?180:0},null),C=()=>{if(r.value.length!==0)return m(Ge,h,{default:S,overlay:b})};return()=>{const{multiple:x}=l.value;if(x)return m("span",{class:`${e.value}-cell-triggers`},[m(Pe,{checked:a.value,indeterminate:n.value,disabled:c.value,onChange:s},null),C()])}}}),El=N({props:kl,setup(e){const{locale:t,mergedPrefixCls:l}=L(V);return()=>{const{activeOrderBy:o,sortable:a}=e,{orders:n,nextTooltip:s}=a,r=s&&Il(t.table,n,o),i=Ml(l,n,o);return r?m(Bt,{title:r},{default:()=>[i]}):i}}});function Il(e,t,l){const o=l?t[t.indexOf(l)+1]:t[0],{sortCancel:a,sortAsc:n,sortDesc:s}=e;return o?o==="ascend"?n:s:a}function Ml(e,t,l){const o=e.value,a=`${o}-sortable-trigger-active`,n=t.includes("ascend")&&m(we,{name:"caret-up-filled",class:l==="ascend"?a:void 0},null),s=t.includes("descend")&&m(we,{name:"caret-down-filled",class:l==="descend"?a:void 0},null);return m("span",{class:`${o}-sortable-trigger`},[n,s])}const Rl=N({props:bl,setup(e){const{props:t,slots:l,mergedPrefixCls:o,fixedColumnKeys:a,columnOffsetsWithScrollBar:n,isSticky:s,handleSort:r,activeOrderByMap:i,activeFilterByMap:c,mergedRows:u,handleFilter:y}=L(V),h=g(()=>{const{type:d,ellipsis:f}=e.column,v=d||f!=null?f:t.ellipsis;return Ze(v)&&v.head===!1?void 0:v}),b=g(()=>{const{type:d,align:f,fixed:v,hasChildren:B,key:$,sortable:T,filterable:I}=e.column,w=o.value;let R={[`${w}-cell`]:!0,[`${w}-cell-${d}`]:!!d,[`${w}-cell-filterable`]:!!I,[`${w}-cell-sortable`]:!!T,[`${w}-cell-align-center`]:B||(f==null?void 0:f.title)==="center",[`${w}-cell-align-end`]:!B&&(f==null?void 0:f.title)==="end",[`${w}-cell-ellipsis`]:!!h.value};if(v){const{lastStartKey:H,firstEndKey:W}=a.value;R={...R,[`${w}-fix-start`]:v==="start",[`${w}-fix-start-last`]:H===$,[`${w}-fix-end`]:v==="end",[`${w}-fix-end-first`]:W===$,[`${w}-fix-sticky`]:s.value}}return ie(R)}),S=g(()=>{var R;const{key:d,fixed:f}=e.column,{offsetIndexMap:v}=u.value;if(!f)return;const{starts:B,ends:$}=n.value,T=Object.values(f==="start"?B:$),I=v[d][f==="start"?"colStart":"colEnd"],w=te((R=T.find(H=>H.index===I))==null?void 0:R.offset);return{position:"sticky",left:f==="start"?w:void 0,right:f==="end"?w:void 0}}),C=g(()=>i[e.column.key]),x=g(()=>c[e.column.key]||$t),k=d=>{const{key:f,filterable:v}=e.column;y(f,v,d)},p=()=>{const{key:d,sortable:f}=e.column;f&&r(d,f)};return()=>{var W,F,Y;const{column:d}=e,{type:f,titleColSpan:v,titleRowSpan:B}=d;if(f==="scroll-bar")return m("th",{class:b.value,style:S.value,colspan:v===1?void 0:v,rowspan:B===1?void 0:B,onClick:p},null);const $=o.value;let T,I;if(f==="selectable")I=m(Kl,null,null);else{const{title:ee,customTitle:Q,sortable:M,filterable:z}=d,O=h.value;I=Ol(ee,Q,l),T=nt(O,I,ee);const D=Pl(M,C,z,x,k);D.length>0?I=m("span",{class:`${$}-cell-triggers`},[m("span",{class:`${$}-cell-title`},[I]),D]):O&&(I=m("span",{class:`${$}-cell-title`},[I]))}const w=(W=t.customAdditional)==null?void 0:W.headCell,R=w?w({column:d}):void 0,H=(Y=(F=t.customTag)==null?void 0:F.headCell)!=null?Y:"th";return m(H,ge({class:b.value,style:S.value,colSpan:v===1?void 0:v,rowSpan:B===1?void 0:B,title:T},R,{onClick:p}),{default:()=>[I]})}}});function Ol(e,t,l){let o=e;return he(t)?o=t({title:e}):G(t)&&l[t]&&(o=l[t]({title:e})),o}function Pl(e,t,l,o,a){const n=[];return e&&n.push(m(El,{activeOrderBy:t.value,sortable:e},null)),l&&n.push(m(Bl,{activeFilterBy:o.value,filterable:l,onUpdateFilterBy:a},null)),n}function zl(e){return e.map(t=>pt(t)).filter(Boolean)}function pt(e){if(e.titleColSpan!==0)return m(Rl,{key:e.key,column:e},null)}const Hl=N({props:ml,setup(e,{slots:t}){const{props:l,mergedPrefixCls:o}=L(V);return()=>{var i,c,u;const{columns:a}=e,n=(i=l.customAdditional)==null?void 0:i.headRow,s=n?n({columns:a}):void 0,r=(u=(c=l.customTag)==null?void 0:c.headRow)!=null?u:"tr";return m(r,ge({class:`${o.value}-row`},s),{default:()=>{var y;return[(y=t.default)==null?void 0:y.call(t)]}})}}});function mt(e,t,l){return m(Hl,{columns:e,key:t},{default:()=>[l]})}const Me=N({setup(e,{slots:t}){const{props:l,mergedRows:o,mergedPrefixCls:a}=L(V);return()=>{var u,y,h;let n;const{rows:s}=o.value,r=(u=l.customAdditional)==null?void 0:u.head,i=r?r({rows:s}):void 0,c=(h=(y=l.customTag)==null?void 0:y.head)!=null?h:"thead";return t.default?n=t.default():n=s.map((b,S)=>{const C=zl(b);return mt(b,S,C)}),m(c,ge({class:`${a.value}-thead`},i),{default:()=>[n]})}}}),Wl=N({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:l,mergedVirtual:o,mergedVirtualColWidth:a,getVirtualColWidth:n,headerVirtualScrollRef:s,handleScroll:r,scrollHeadRef:i,scrollWidth:c,flattedData:u,flattedColumns:y,fixedColumns:h,mergedRows:b,isSticky:S}=L(V);Dl(i,r);const C=g(()=>c.value==="max-content"),x=g(()=>u.value.length>0),k=g(()=>{const f=l.value;return{[`${f}-fixed-holder`]:!0,[`${f}-sticky-holder`]:S.value}}),p=g(()=>{const f=S.value,{offsetTop:v,offsetBottom:B}=e;return{overflow:"hidden",top:f?te(v):void 0,bottom:f?te(B):void 0}}),d=g(()=>o.value.horizontal?b.value.rows.map((f,v)=>({key:v,data:f})):[]);return()=>{const f=x.value||!C.value;if(o.value.horizontal){const v=(R,{renderedData:H})=>{let W=[];if(f){const F=[];H.forEach(Y=>{F.push(...Y.data)}),W=We(F)}return m("table",{style:{tableLayout:"fixed"}},[f&&m(xe,{columns:W,isFixedHolder:!0},null),m(Me,null,{default:()=>[R]})])},B=({item:R,index:H,children:W})=>mt(R.data,H,W),$=({item:R})=>pt(R),T=(R,H)=>{const{fixedStartColumns:W,fixedEndColumns:F}=h.value;return ot(R,H,y.value,u.value,W,F,!0)},{virtualBufferSize:I,virtualBufferOffset:w}=t;return m("div",{class:k.value,style:p.value},[m(Qe,{ref:s,dataSource:d.value,colModifier:T,getKey:"key",height:0,width:"100%",colWidth:a.value,getColWidth:n,rowRender:B,colRender:$,contentRender:v,virtual:{horizontal:!0,vertical:!1},bufferSize:I,bufferOffset:w},null)])}return m("div",{class:k.value,style:p.value,ref:i},[m("table",{style:{tableLayout:"fixed"}},[f&&m(xe,{isFixedHolder:!0},null),m(Me,null,null)])])}}});function Dl(e,t){const l=n=>{if(!n.shiftKey)return;const s=n.deltaY,r=n.currentTarget;if(s){const i=r.scrollLeft+s;t(n,i)}},o=n=>{Se(n,"wheel",l,{passive:!0})},a=n=>{ve(n,"wheel",l)};$e(()=>{j(e,(n,s)=>{a(s),o(n)},{immediate:!0})}),ye(()=>a(e.value))}const Al=N({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:l,mergedSticky:o,stickyScrollLeft:a,setStickyScrollLeft:n}=L(V),s=P(!1),r=P(!1),i=P(0),c=P(0),u=P(0),y=g(()=>{const d=c.value,f=u.value;return f&&d*(d/f)});Ft(()=>{const d=re(t);if(d&&s.value){const{clientWidth:f,scrollWidth:v,scrollLeft:B}=d;n(B/v*f),c.value=f,u.value=v}});const h=g(()=>({height:Ee(),width:c.value,bottom:o.value.offsetScroll})),b=g(()=>{const d=e.value;return{[`${d}-sticky-scrollbar-thumb`]:!0,[`${d}-sticky-scrollbar-thumb-active`]:r.value}}),S=g(()=>({width:`${y.value}px`,transform:`translate3d(${a.value}px, 0, 0)`})),C=()=>r.value=!1,x=d=>{i.value=d.pageX-a.value,r.value=!0,d.preventDefault()},k=d=>{if(!r.value)return;const{buttons:f}=d||window.event;if(f===0){r.value=!1;return}let v=d.pageX-i.value;v<=0&&(v=0);const B=c.value,$=u.value,T=y.value;v+T>=B&&(v=B-T);const I=v/B*($+2);l(d,I)},p=()=>{const d=re(t),f=Ae(d).top,v=f+d.offsetHeight,{container:B,offsetScroll:$}=o.value,T=B===window?document.documentElement.scrollTop+window.innerHeight:Ae(B).top+B.clientHeight;v-Ee()<=T||f>=T-$?s.value=!1:s.value=!0};return $e(()=>{Se(document.body,"mouseup",C),Se(document.body,"mousemove",k),Se(window,"resize",p),j(()=>o.value.container,(d,f)=>{ve(f,"scroll",p),Se(d,"scroll",p)},{immediate:!0}),p()}),ye(()=>{ve(document.body,"mouseup",C),ve(document.body,"mousemove",k),ve(window,"resize",p),ve(o.value.container,"scroll",p)}),()=>!t.value||!s.value||u.value<=c.value||!y.value?null:m("div",{class:`${e.value}-sticky-scrollbar`,style:h.value},[m("div",{class:b.value,style:S.value,onMousedown:x},null)])}}),Fl=N({setup(e,{slots:t}){const{mergedPrefixCls:l}=L(V);return()=>{var o;return m("tbody",{class:`${l.value}-tbody`},[(o=t.default)==null?void 0:o.call(t)])}}}),Re=N({props:{columns:Array,isEmpty:Boolean},setup(e,{slots:t}){const{clientWidth:l,mergedPrefixCls:o,hasFixed:a,scrollHorizontalOverflowed:n,scrollBarColumn:s}=L(V),r=g(()=>{var i,c;return(c=(i=e.columns)==null?void 0:i.length)!=null?c:1});return()=>{let i=t.default();if(e.isEmpty?n.value:a.value){const c=s.value;i=m("div",{class:`${o.value}-fixed-row`,style:{width:te(l.value-(c?c.width:0)),position:"sticky",left:0,overflow:"hidden"}},[i])}return m("tr",null,[m("td",{colspan:r.value},[i])])}}}),_l=N({props:Cl,setup(e){const t=P();return Ie(t,o=>{const{contentRect:{width:a}}=o;e.changeColumnWidth(e.cellKey,a)}),ye(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>m("td",{ref:t,style:{padding:0,border:0,height:0}},[m("div",{style:{height:0,overflow:"hidden"}},[_t("Â ")])])}}),Ll=N({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=L(V),{changeColumnWidth:l}=L(yt);return()=>{var a;const o=(a=e.columns)==null?void 0:a.map(n=>{const{key:s}=n;return m(_l,{key:s,cellKey:s,changeColumnWidth:l},null)});return m("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[o])}}}),Nl=N({props:xl,setup(e){const{props:t,slots:l,config:o,mergedPrefixCls:a,mergedEmptyCell:n,activeOrderByMap:s,fixedColumnKeys:r,columnOffsets:i,isSticky:c,isTreeData:u,expandable:y,selectable:h,mergedPagination:b}=L(V),S=L(gt),C=S.props,x=g(()=>s[e.column.key]),k=Vl(S,e),p=g(()=>r.value.lastStartKey===e.column.key),d=g(()=>r.value.firstEndKey===e.column.key),f=g(()=>{const{type:$,ellipsis:T}=e.column;return $||T!=null?T:t.ellipsis}),v=g(()=>{const{fixed:$,align:T,type:I}=e.column,w=a.value;let R={[`${w}-cell`]:!0,[`${w}-cell-sorted`]:!!x.value,[`${w}-cell-align-${T.cell}`]:!!T&&T.cell!="start",[`${w}-cell-ellipsis`]:!!f.value,[`${w}-cell-${I}`]:!!I,[`${w}-cell-last`]:!!e.isLast};return $&&(R={...R,[`${w}-fix-start`]:$==="start",[`${w}-fix-start-last`]:p.value,[`${w}-fix-end`]:$==="end",[`${w}-fix-end-first`]:d.value,[`${w}-fix-sticky`]:c.value}),ie(R)}),B=g(()=>{const{fixed:$}=e.column;if(!$)return;const{starts:T,ends:I}=i.value,R=te(($==="start"?T:I)[e.column.key].offset);return{position:"sticky",left:$==="start"?R:void 0,right:$==="end"?R:void 0}});return()=>{var ee,Q,M;const{column:$}=e,T=a.value,{type:I}=$;let w,R;if(I==="selectable")w=ql(S,l,h,o,b,T);else if(I==="indexable")w=bt(S,l,$,b,T);else{const z=k.value;if(w=jl(S,e,l,z),R=nt(f.value,w,z),!I&&(Je(w)||w==="")){const O=l.emptyCell||n.value;w=he(O)?O({column:$,record:C.record,rowIndex:C.rowIndex}):O}}e.column.fixed&&f.value&&(p.value||d.value)&&(w=m("span",{class:`${T}-cell-content`},[w]));const H=(ee=t.customAdditional)==null?void 0:ee.bodyCell,W=H?H({column:$,record:C.record,rowIndex:C.rowIndex}):void 0,F=(M=(Q=t.customTag)==null?void 0:Q.bodyCell)!=null?M:"td",Y=I==="expandable"?m("div",{class:`${T}-expandable-wrapper`},[Ul(S,l,y,u,T),!Tt(w)&&m("span",{class:`${T}-expandable-trigger-gap`},null),w]):w;return m(F,ge({class:v.value,style:B.value,title:R,colSpan:e.colSpan,rowSpan:e.rowSpan},W),{default:()=>[Y]})}}});function Vl(e,t){return g(()=>{const{props:{record:l}}=e,{column:o}=t,a=Oe(o.dataKey);if(a.length<=0)return;let n=l;for(let s=0;s<a.length&&n;s++){const r=a[s];n=n[r]}return n})}function jl(e,t,l,o){const{props:{record:a,rowIndex:n}}=e,{column:s}=t,{customCell:r}=s,i=G(r)?l[r]:r;return i?i({value:o,record:a,rowIndex:n}):o}function Ul(e,t,l,o,a){var I;const{icon:n,customIcon:s,indent:r,showLine:i}=l.value,{props:{record:c,expanded:u,level:y=0,hasPrevSibling:h,hasNextSibling:b,showLineIndentIndexList:S},expandDisabled:C,handleExpend:x}=e,k=y>0,p=o.value&&i&&r;let d;const f=(I=G(s)?t[s]:s)!=null?I:n;he(f)?d=f({expanded:!!u,record:c}):d=G(f)?m(we,{name:f,rotate:u?90:0},null):f;const v=r?`width: ${te(r)}`:void 0,B={[`${a}-expandable-trigger`]:!0,[`${a}-expandable-trigger-show-line`]:p,[`${a}-expandable-trigger-disabled`]:C.value},$=[];if(r)for(let w=0;w<y;w++)$.push(m("div",{class:{[`${a}-expandable-indent`]:!0,[`${a}-expandable-indent-show-line`]:p&&S.includes(w)},style:v},null));const T=w=>{w.preventDefault(),w.stopImmediatePropagation(),C.value||x()};return[...$,m("span",{class:B,style:v},[m("button",{class:`${a}-expandable-trigger-button`,type:"button",onClick:T},[d]),p&&[m("span",{class:`${a}-expandable-trigger-line-right`},null),(h||k)&&m("span",{class:`${a}-expandable-trigger-line-top`},null),b&&m("span",{class:`${a}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function ql(e,t,l,o,a,n){const{props:{record:s,rowIndex:r},isSelected:i,isIndeterminate:c,selectDisabled:u,isHover:y,handleSelect:h}=e,{showIndex:b,multiple:S,customCell:C}=l.value,x=p=>{p.stopPropagation(),!S&&i.value&&!u.value&&h&&h()};if(!i.value&&!y.value&&b)return bt(e,t,o.columnIndexable,a,n);const k=G(C)?t[C]:C;if(S){const p={checked:i.value,disabled:u.value,indeterminate:c.value,onChange:h,onClick:x};return k?k({...p,record:s,rowIndex:r}):m(Pe,p,null)}else{const p={checked:i.value,disabled:u.value,onChange:h,onClick:x};return k?k({...p,record:s,rowIndex:r}):m(tt,p,null)}}function bt(e,t,l,o,a){const{props:{record:n,rowIndex:s},selectDisabled:r}=e,{customCell:i}=l,{pageIndex:c=1,pageSize:u=0}=o.value||{},y=G(i)?t[i]:i;if(!y)return;const h=[`${a}-indexable-label`,r.value&&`${a}-indexable-label-disabled`];return m("span",{class:h},[y({record:n,rowIndex:s,pageIndex:c,pageSize:u})])}function Xl(e,t,l){const o=[];return e.forEach((a,n)=>{const s=St(a,t,l,n===e.length-1);s&&o.push(s)}),o}function St(e,t,l,o){const{colSpan:a,rowSpan:n}=e,s=a==null?void 0:a(t,l),r=n==null?void 0:n(t,l);if(s===0||r===0)return;const i={key:e.key,colSpan:s===1?void 0:s,rowSpan:r===1?void 0:r,isLast:o,column:e};return m(Nl,i,null)}const Gl=N({props:Sl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:o,expandable:a,isChecked:n,isIndeterminate:s,isCheckDisabled:r,handleExpandChange:i,checkExpandDisabled:c,selectable:u,handleSelectChange:y}=L(V),{expandDisabled:h,handleExpend:b,selectDisabled:S,handleSelect:C,isHover:x,attrs:k}=Yl(e,a,c,i,u,y,r),p=g(()=>n(e.rowKey)),d=g(()=>s(e.rowKey)),f=g(()=>{const v=`${o.value}-row`,{level:B,expanded:$}=e;return ie({[`${v}`]:!0,[`${v}-level-${B}`]:!!B,[`${v}-selected`]:p.value,[`${v}-expanded`]:$})});return ze(gt,{props:e,expandDisabled:h,handleExpend:b,isSelected:p,isIndeterminate:d,selectDisabled:S,handleSelect:C,isHover:x}),()=>{var T,I,w;const v=(T=l.customAdditional)==null?void 0:T.bodyRow,B=v?v({record:e.record,rowIndex:e.rowIndex}):void 0,$=(w=(I=l.customTag)==null?void 0:I.bodyRow)!=null?w:"tr";return m($,ge({class:f.value},k.value,B),{default:()=>{var R;return[(R=t.default)==null?void 0:R.call(t)]}})}}});function Yl(e,t,l,o,a,n,s){const r=g(()=>l(e.rowData)),i=g(()=>{var f;return(f=t.value)==null?void 0:f.trigger}),c=()=>{const{rowKey:f,record:v}=e;o(f,v)},u=g(()=>s(e.rowKey)),y=g(()=>{var f;return(f=a.value)==null?void 0:f.trigger}),h=g(()=>{var f;return(f=a.value)==null?void 0:f.showIndex}),b=P(!1),S=()=>{const{rowKey:f,record:v}=e;n(f,v)},C=()=>{i.value==="click"&&c(),y.value==="click"&&S()},x=()=>{i.value==="dblclick"&&c(),y.value==="dblclick"&&S()},k=()=>b.value=!0,p=()=>b.value=!1,d=g(()=>{const f=r.value,v=i.value,B=u.value,$=y.value,T=!f&&v==="click"||!B&&$==="click",I=!f&&v==="dblclick"||!B&&$==="dblclick",w=!B&&h.value;let R="";return T||I?R="pointer":(f&&v||B&&$)&&(R="not-allowed"),{style:R?`cursor: ${R}`:void 0,onClick:T?C:void 0,onDblclick:I?x:void 0,onMouseenter:w?k:void 0,onMouseleave:w?p:void 0}});return{expandDisabled:r,handleExpend:c,selectDisabled:u,handleSelect:S,isHover:b,attrs:d}}function Ue(e,t,l,o,a,n,s){const{children:r,expanded:i,level:c,hasPrevSibling:u,hasNextSibling:y,showLineIndentIndexList:h,record:b,rowKey:S}=e,C={key:S,expanded:i,level:c,hasPrevSibling:u,hasNextSibling:y,showLineIndentIndexList:h,hasChildren:!!(r!=null&&r.length),record:b,rowData:e,rowIndex:l,rowKey:S},x=m(Gl,C,{default:()=>[s]}),k=i&&Ql(C,o,t,a,n);return k?[x,k]:x}function Ql(e,t,l,o,a){const{customExpand:n}=o||{},{record:s,rowIndex:r}=e;let i;return he(n)?i=n({record:s,rowIndex:r}):G(n)&&t[n]&&(i=t[n]({record:s,rowIndex:r})),i&&m(Re,{class:`${a}-expanded-row`,columns:l},{default:()=>[i]})}const Zl=N({setup(){const{props:e,slots:t,clientWidth:l,setClientWidth:o,expandable:a,mergedPrefixCls:n,mergedInsetShadow:s,mergedVirtual:r,mergedVirtualItemHeight:i,mergedVirtualColWidth:c,mergedAutoHeight:u,changeColumnWidth:y,flattedData:h,flattedColumns:b,fixedColumns:S,getVirtualColWidth:C,isSticky:x,mergedSticky:k,virtualScrollRef:p,scrollBodyRef:d,scrollContentRef:f,handleScroll:v,pingedStart:B,pingedEnd:$,scrollWidth:T,scrollHeight:I,scrollHorizontalOverflowed:w,scrollVerticalOverflowed:R,hasFixed:H,tableLayout:W}=L(V),F=P(),Y=g(()=>u.value||!!T.value||x.value||r.value.horizontal);ze(yt,{changeColumnWidth:(E,K)=>{It(F.value)&&y(E,K)}});const Q=()=>{const E=re(d);E&&v({currentTarget:E})},M=E=>{const{offsetWidth:K}=E.target;K!==l.value&&o(K)};$e(()=>{Q(),j([()=>e.dataSource,T],([,E])=>{E&&Q()}),Kt(F.value,M)}),ye(()=>Et(F.value,M));const z=g(()=>{const E=n.value;return ie({[`${E}-container`]:!0,[`${E}-ping-start`]:B.value,[`${E}-ping-end`]:$.value,[`${E}-fixed-layout`]:W.value==="fixed",[`${E}-fixed-column`]:H.value,[`${E}-inset-shadow`]:s.value,[`${E}-scroll-horizontal`]:w.value,[`${E}-scroll-vertical`]:R.value})}),O=g(()=>{var q;const E=I.value,K=r.value.horizontal?"hidden":"auto",_=r.value.vertical?"hidden":"auto",A=(q=e.scroll)==null?void 0:q.fullHeight;return{overflowX:K,overflowY:_,[A?"height":"maxHeight"]:E}}),D=g(()=>({tableLayout:W.value,width:T.value,minWidth:T.value?"100%":void 0})),Z=(E,K,_)=>{X(e.onScrolledChange,E,K,_.map(A=>A.record))},U=g(()=>!r.value.vertical&&!r.value.horizontal?[]:h.value.map(E=>({...E,data:b.value}))),ne=E=>{if(!(!Y.value||!E))return m(Ll,{columns:E},null)},se=E=>{if(t.alert)return m(Re,{class:`${n.value}-alert-row`,columns:E},{default:()=>[t.alert()]})},ke=E=>{if(!(h.value.length>0))return m(Re,{class:`${n.value}-empty-row`,columns:E,isEmpty:!0},{default:()=>[m(Mt,{empty:e.empty},t)]})},ue=(E,K,_)=>{let A;if(_)A=_;else if(K!=null&&K.length){const q=[];K.forEach((oe,ce)=>{const me=Xl(E!=null?E:[],oe.record,ce);q.push(...Oe(Ue(oe,E,ce,t,a.value,n.value,me)))}),A=q}return m(Fl,null,{default:()=>[se(E),ne(E),ke(E),A]})},pe=()=>ue(b.value,h.value),Te=(E,K)=>ue(E,void 0,K);return()=>{const E=n.value,K=u.value,_=r.value,A=t.default?t.default():[];if(K||I.value||x.value||_.horizontal){const{offsetTop:q}=k.value;if(e.headless||A.push(m(Wl,{offsetTop:q},null)),_.vertical&&(e.scroll||K)||!_.vertical&&_.horizontal){const oe=({item:J,index:le,children:ae})=>Ue(J,J.data,le,t,a.value,E,ae),ce=({row:J,item:le,index:ae,rowIndex:fe})=>St(le,J.record,fe,ae===J.data.length-1),me=(J,{renderedData:le})=>{var fe;const ae=h.value.length?(fe=le[0])==null?void 0:fe.data:b.value;return m("table",{ref:f,class:`${E}-table`,style:D.value},[ae?m(xe,{columns:ae},null):void 0,Te(ae,J),!1])},Ke=(J,le)=>{const{fixedStartColumns:ae,fixedEndColumns:fe}=S.value;return ot(J,le,b.value,h.value,ae,fe,!1)},{scroll:de,onScrolledBottom:Ct}=e;A.push(m(Qe,{ref:p,class:`${E}-body-virtual-scroll`,dataSource:U.value,colModifier:Ke,fullHeight:de==null?void 0:de.fullHeight,getKey:J=>{var le;return(le=J.rowKey)!=null?le:J.key},height:u.value?"100%":de==null?void 0:de.height,width:"100%",rowHeight:i.value,colWidth:c.value,getColWidth:C,rowRender:oe,colRender:ce,contentRender:me,virtual:r.value,scrollMode:e.virtualScrollMode,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:v,onScrolledBottom:Ct,onScrolledChange:Z},null))}else A.push(m("div",{ref:d,class:`${E}-content`,style:O.value,onScroll:v},[m("table",{ref:f,class:`${E}-table`,style:D.value},[m(xe,null,null),pe(),!1])]));x.value&&A.push(m(Al,null,null))}else A.push(m("div",{ref:d,class:`${E}-content`,style:O.value,onScroll:v},[m("table",{ref:f,class:`${E}-table`,style:D.value},[m(xe,null,null),!e.headless&&m(Me,null,null),pe(),!1])]));return m("div",{ref:F,class:z.value},[A])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Jl(e,t){return e.footer?m("div",{class:`${t}-footer`},[e.footer()]):null}function en(e,t,l,o){var s,r;let a=null,n=null;if(t!==null){const{position:i}=t,[c,u]=Lt(i).split("-"),y=`${o}-pagination ${o}-pagination-${u}`,h=(r=(s=e.pagination)==null?void 0:s.call(e,{total:l.length,...t}))!=null?r:m(jt,ge({class:y,total:l.length},t),null);a=c==="top"?h:null,n=c==="bottom"?h:null}return[a,n]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function xt(e,t){const{getGreyColors:l}=t,o=l(),{fontSizeSm:a,heightMd:n,paddingSizeSm:s,paddingSizeMd:r,paddingSizeLg:i,colorTextTitleSecondary:c,colorEmphasizedContainerBg:u,colorBorder:y,colorIconInfo:h,colorPrimary:b,colorContainerBg:S,colorContainerBgHover:C,colorInfoContainerBg:x}=e;return{fontSizeSm:a,fontSizeMd:a,fontSizeLg:a,headRowHeightSm:n,headRowHeightMd:n,headRowHeightLg:n,cellPaddingHorizontalSm:s,cellPaddingHorizontalMd:r,cellPaddingHorizontalLg:i,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:c,headBgColor:u,headSeparatorColor:y,headIconColor:h,headIconColorActive:b,headIconBgColorHover:l().l30,insetShadowStart:`inset 10px 0 8px -8px ${Fe(o.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${Fe(o.d50,.12)}`,bodyRowBgColorHover:C,bodyRowBgColorSelected:S,bodyRowBgColorExpanded:x,bodyRowBgColorTreeExpanded:x,bodyCellVerticalAlign:"middle",expandableIconColor:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tn(e,t){const{getGreyColors:l}=t,o=l();return{...xt(e,t),insetShadowStart:`inset 10px 0 8px -8px ${o.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${o.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ln=(e,t,l)=>t==="default"?xt(e,l):tn(e,l),nn={sm:32,md:40,lg:56},on=150,an=N({name:"IxTable",props:pl,setup(e,{expose:t,slots:l}){const o=Be("common"),{globalHashId:a,hashId:n,registerToken:s}=Rt("table");s(ln);const r=g(()=>`${o.prefixCls}-table`),i=Be("locale"),c=Be("table"),[u,y]=Ce(0),h=g(()=>{var K;return(K=e.autoHeight)!=null?K:c.autoHeight}),b=g(()=>{var K;return(K=e.childrenKey)!=null?K:c.childrenKey}),S=Ot(e,c),C=g(()=>{var K;return(K=e.emptyCell)!=null?K:c.emptyCell}),x=g(()=>{var K;return(K=e.insetShadow)!=null?K:c.insetShadow}),k=g(()=>{var K;return(K=e.size)!=null?K:c.size}),p=g(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),d=g(()=>{var K;return(K=e.virtualItemHeight)!=null?K:nn[k.value]}),f=g(()=>{var K;return(K=e.virtualColWidth)!=null?K:on}),{mergedPagination:v}=nl(e,c,k),B=yl(e),$=ol(e,B),T=Gt(e,l,c,$.scrollBarSizeOnFixedHolder),{flattedColumns:I,flattedColumnsWithScrollBar:w,fixedColumns:R}=T,H=qt(I),{measuredColumnWidthMap:W}=H,F=g(()=>w.value.length),Y=Ut(R,W,F),ee=hl(I),Q=ll(I),M=tl(e,I),z=gl(e,T,$,B.isSticky,p,h),{activeSorters:O}=ee,{activeFilters:D}=Q,Z=new Map,U=()=>{Z.clear(),I.value.forEach(K=>{Z.set(K.key,K)})};j(I,()=>{U()},{immediate:!0});const ne=el(e,b,S,O,D,M.expandedRowKeys,v),se=dl(e,i,T.flattedColumns,ne);cl(e,c,v,O,D,$.scrollTo);const ue={props:e,slots:l,config:c,locale:i,clientWidth:u,setClientWidth:y,mergedPrefixCls:r,mergedEmptyCell:C,mergedInsetShadow:x,mergedVirtual:p,mergedVirtualItemHeight:d,mergedVirtualColWidth:f,mergedAutoHeight:h,getVirtualColWidth:(K,_)=>{var A,q;return(q=W.value[_])!=null?q:(A=Z.get(_))==null?void 0:A.width},...T,...H,...Y,...$,...ee,...Q,...B,tableLayout:z,mergedPagination:v,...M,...ne,...se};ze(V,ue),t({scrollTo:$.scrollTo});const{flattedData:pe,filteredData:Te}=ne,E=g(()=>{const K=r.value,{borderless:_=c.borderless,scroll:A}=e;return ie({[a.value]:!!a.value,[n.value]:!!n.value,[K]:!0,[`${K}-auto-height`]:h.value,[`${K}-borderless`]:_,[`${K}-empty`]:pe.value.length===0,[`${K}-full-height`]:A==null?void 0:A.fullHeight,[`${K}-${k.value}`]:!0})});return()=>{const K=r.value,_=m(Pt,{header:e.header},l),A=Jl(l,K),q=[_];let oe=[m(Zl,null,null),A].filter(Boolean);if(pe.value.length>0){const[me,Ke]=en(l,v.value,Te.value,K);oe=[me,...oe,Ke].filter(Boolean)}const ce=rn(e.spin);return ce?q.push(m(zt,ce,{default:()=>[oe]})):q.push(...oe),m("div",{class:E.value},[q])}}});function rn(e){return Nt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const vn=an,hn=He;export{vn as I,hn as a,Xt as g,pl as t};
