import{N as Fe,m as b,al as re,aP as Ne,c as Ke,ac as ke,L as Z,ar as Be,K as De,r as Le,a9 as Ee,ad as Me,ae as Re,as as Ve,at as Oe,au as Pe,aA as Te}from"./index-a6e3e890.js";import{c as C,an as ee,t as ze,x as ce,l as we,r as ae,z as A,i as He,w as $e,q as Ge,A as Ue,a3 as oe}from"./vendor-0058e572.js";import{I as je}from"./index-a9414003.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qe(e,l,t,c){return{mergedNodeMap:C(()=>{const d=new Map,r=de(e,e.dataSource,l.value,t.value,c.value);return le(r,d),d})}}function de(e,l,t,c,s,d){const{treeDisabled:r,loadChildren:u}=e;return l.map(x=>se(x,t,c,s,r,!!u,d))}function se(e,l,t,c,s,d,r){var K;const u=t(e),{check:x,drag:i,drop:f,select:g}=_e(e,s),F=e[l],N=e[c],p=F==null?void 0:F.map(k=>se(k,l,t,c,s,d,u));return{children:p,label:N,key:u,isLeaf:(K=e.isLeaf)!=null?K:!(p!=null&&p.length||d),parentKey:r,rawData:e,checkDisabled:x,dragDisabled:i,dropDisabled:f,selectDisabled:g}}function _e(e,l){const t=e.disabled;if(ee(t))return{check:t,drag:t,drop:t,select:t};{let{drag:c,drop:s,select:d}=t!=null?t:{},r;if(l){const u=l(e);ee(u)?(r!=null||(r=u),c!=null||(c=u),s!=null||(s=u),d!=null||(d=u)):(c!=null||(c=u.drag),s!=null||(s=u.drop),d!=null||(d=u.select),r!=null||(r=u.select))}return{check:r,drag:c,drop:s,select:d}}}function le(e,l){e.forEach(t=>{const{key:c,children:s}=t;l.set(c,t),s&&le(s,l)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function We(e,l,t){const c=C(()=>Fe(l.value)),s=C(()=>{const i=t.value;return c.value.map(f=>i.get(f)).filter(Boolean)}),d=i=>{const f=e.multiple?i:i[0],g=ze(l.value);f!==g&&(l.setValue(f),b(e.onChange,f,g))};return{selectedValue:c,selectedNodes:s,changeSelected:i=>{!e.multiple&&!i.length||d(i)},handleRemove:i=>{d(c.value.filter(f=>i!==f))},handleClear:i=>{d([]),b(e.onClear,i)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ue=Symbol("treeSelectToken"),Xe=ce({setup(){const{config:e,props:l,slots:t,locale:c,mergedPrefixCls:s,mergedChildrenKey:d,mergedGetKey:r,mergedLabelKey:u,mergedNodeMap:x,inputValue:i,setInputValue:f,treeRef:g,expandedKeys:F,setExpandedKeys:N,selectedValue:p,changeSelected:K,handleNodeClick:k}=we(ue),[z,w]=re(l,"loadedKeys",()=>[]),m=ae(!1),L=C(()=>l.multiple&&l.checkable),H=C(()=>L.value?l.cascaderStrategy:"off"),$=(n,o,y)=>{const{onScrolledChange:h}=l;b(h,n,o,y.map(I=>I.rawData))},O=n=>{n.stopPropagation()},P=(n,o)=>{const{onCheck:y}=l;b(y,n,o),k()},G=(n,o)=>{var h;const{onSelect:y}=l;!l.multiple&&((h=p.value)==null?void 0:h[0])!==o.key&&b(y,n,o),k()},U=(n,o)=>{const{onExpand:y}=l;b(y,n,o)},j=(n,o)=>{const{onExpandedChange:y}=l;b(y,n,o),N(n)},q=n=>{var y,h;const o=m.value;o?(y=g.value)==null||y.expandAll():(h=g.value)==null||h.collapseAll(),m.value=!o,n.stopPropagation()},_=async(n,o)=>{const y=d.value,h=u.value,I=r.value,B=o[y],M=I(o),R=x.value,D=R.get(M);if(B.length&&D){const V=de(l,B,y,I,h,M);le(V,R),D.rawData[y]=B,D.children=V,w(n),b(l.onLoaded,n,o)}},W=C(()=>{var n;return(n=l.clearIcon)!=null?n:e.clearIcon}),X=n=>{const{value:o}=n.target;f(o),l.searchable&&b(l.onSearch,o)},E=()=>{f(""),l.searchable&&b(l.onSearch,"")};return()=>{const{customAdditional:n,dataSource:o,draggable:y,draggableIcon:h,empty:I,expandIcon:B,multiple:M,leafLineIcon:R,virtual:D,virtualItemHeight:V,searchable:J,showLine:a,searchPlaceholder:v,onDragstart:S,onDragend:T,onDragenter:ie,onDragleave:ye,onDragover:fe,onDrop:ve,onNodeClick:ge,onNodeContextmenu:pe,onScroll:he,onScrolledBottom:me,droppable:Se,treeDisabled:be,loadChildren:Ce,searchFn:Q,overlayRender:te,overlayHeight:xe}=l,Ae=s.value,Ie={label:t.treeLabel,prefix:t.treePrefix,suffix:t.treeSuffix,leafLineIcon:t.leafLineIcon,empty:t.empty,expandIcon:t.expandIcon,draggableIcon:t.draggableIcon},Y=[A(je,{ref:g,blocked:!0,checkOnClick:!0,checkedKeys:p.value,customAdditional:n,expandedKeys:F.value,loadedKeys:z.value,labelKey:u.value,checkable:L.value,cascaderStrategy:H.value,childrenKey:d.value,dataSource:o,draggable:y,draggableIcon:h,droppable:Se,disabled:be,empty:I,expandIcon:B,getKey:r.value,height:xe,loadChildren:Ce,leafLineIcon:R,virtual:D,virtualItemHeight:V,selectable:M?"multiple":!0,selectedKeys:p.value,searchValue:Q!==!1?i.value:void 0,searchFn:He(Q)?Q:void 0,showLine:a,onClick:O,onCheck:P,onDragstart:S,onDragend:T,onDragenter:ie,onDragleave:ye,onDragover:fe,onDrop:ve,onNodeClick:ge,onNodeContextmenu:pe,onExpand:U,onSelect:G,onLoaded:_,onCheckedChange:K,onSelectedChange:L.value?Ne:K,onExpandedChange:j,onScroll:he,onScrolledBottom:me,onScrolledChange:$},Ie)];if(J==="overlay"){const ne=i.value;Y.unshift(A("div",{class:`${Ae}-overlay-search-wrapper`},[A(Ke,{size:"xs",shape:"square",title:m.value?c.treeSelect.expandAll:c.treeSelect.collapseAll,icon:m.value?"expand-all":"collapse-all",onClick:q},null),A(ke,{clearable:!0,clearIcon:W.value,clearVisible:!!ne,size:"sm",suffix:"search",value:ne,placeholder:v,onClear:E,onInput:X},null)]))}return A("div",null,[te?te(Y):Y])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Je={control:{type:[String,Number,Object,Array],default:void 0},value:{type:null,default:void 0},open:{type:Boolean,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:{type:Function,default:void 0},empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},leafLineIcon:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},offset:Array,overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},searchPlaceholder:{type:String,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},showLine:{type:Boolean,default:void 0},status:String,suffix:{type:String,default:void 0},treeDisabled:{type:Function,default:void 0},virtual:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},"onUpdate:value":[Function,Array],"onUpdate:open":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],onCheck:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onSearch:[Function,Array],onSelect:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array],overlayHeight:{type:Number,default:256}},Qe=ce({name:"IxTreeSelect",inheritAttrs:!1,props:Je,setup(e,{attrs:l,expose:t,slots:c}){const s=Z("common"),d=Z("locale"),r=Z("treeSelect"),u=C(()=>`${s.prefixCls}-tree-select`),x=C(()=>{var a;return(a=e.childrenKey)!=null?a:r.childrenKey}),i=Be(e,r),f=C(()=>{var a;return(a=e.labelKey)!=null?a:r.labelKey}),g=ae(),[F,N]=De(""),p=()=>{var a;return(a=g.value)==null?void 0:a.focus()},K=()=>{var a;return(a=g.value)==null?void 0:a.blur()},k=()=>{var a;e.searchable==="overlay"?N(""):(a=g.value)==null||a.clearInput()},[z,w]=re(e,"expandedKeys",()=>[]),{accessor:m,control:L}=Le();Ee(L);const H=Me(e,r),$=Re(e,L),{mergedNodeMap:O}=qe(e,x,i,f),{selectedValue:P,selectedNodes:G,changeSelected:U,handleRemove:j,handleClear:q}=We(e,m,O),{overlayRef:_,overlayStyle:W,updateOverlay:X,overlayOpened:E,setOverlayOpened:n}=Ve(e,r,g),o=ae();t({focus:p,blur:K,collapseAll:()=>{var a;return(a=o.value)==null?void 0:a.collapseAll()},expandAll:()=>{var a;return(a=o.value)==null?void 0:a.expandAll()},scrollTo:a=>{var v;(v=o.value)==null||v.scrollTo(a)},getNode:a=>{var v;return o.value?o.value.getNode(a):(v=O.value.get(a))==null?void 0:v.rawData}}),$e(E,a=>{a&&p(),k()});const h=()=>{e.searchable!=="overlay"&&p()},I=()=>{e.multiple?k():n(!1)},B=()=>m.markAsBlurred(),M=a=>{p(),j(a)};Ge(ue,{props:e,slots:c,config:r,locale:d,mergedPrefixCls:u,mergedChildrenKey:x,mergedGetKey:i,mergedLabelKey:f,expandedKeys:z,mergedNodeMap:O,inputValue:F,setInputValue:N,treeRef:o,accessor:m,setExpandedKeys:w,overlayOpened:E,setOverlayOpened:n,handleNodeClick:I,selectedValue:P,changeSelected:U});const R=C(()=>{const{overlayClassName:a,multiple:v}=e,S=u.value;return Ue({[`${S}-overlay`]:!0,[`${S}-overlay-multiple`]:v,[a||""]:!!a})}),D=()=>A(Pe,oe({ref:g,className:u.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:r,dataSource:G.value,disabled:m.disabled,maxLabel:e.maxLabel,multiple:e.multiple,opened:E.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:H.value,status:$.value,suffix:e.suffix,value:P.value,onBlur:B,onClear:q,onInputValueChange:N,onItemRemove:M,onOpenedChange:n,onResize:X,onSearch:e.onSearch},l),c),V=a=>{const{spin:v}=e,S=ee(v)?{spinning:v}:v;return S?A(Te,S,{default:()=>[a]}):a},J=()=>V(A(Xe,{onClick:h},null));return()=>{var S,T;const a={class:R.value,style:W.value,clickOutside:!0,container:(S=e.overlayContainer)!=null?S:r.overlayContainer,containerFallback:`.${u.value}-overlay-container`,disabled:m.disabled||e.readonly,offset:(T=e.offset)!=null?T:r.offset,placement:"bottomStart",transitionName:`${s.prefixCls}-slide-auto`,trigger:"manual",triggerId:l.id,visible:E.value,"onUpdate:visible":n},v={default:D,content:J};return A(Oe,oe({ref:_},a),v)}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const aa=Qe;export{aa as I};
