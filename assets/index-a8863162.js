import{m as F,av as oe,t as j,aA as Ie,j as Me,T as be,U as Be,aD as $e,P as Pe,s as Te,aC as Ee}from"./index-65f16f37.js";import{u as Oe}from"./useTreeCheckState-8930aad0.js";import{d as Q,c as b,r as $,w as De,p as He,f as qe,y as ke,i as Ue,k as ze,N as _e,m as W,z as Y,v as K,q as je,a7 as ye,E as Re,Q as We}from"./vendor-97d35b92.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function X(e,n,t){if(t){const l=[],o=e.value;n.forEach(a=>{const d=o.get(a);d&&l.push(d.rawNode)}),F(t,n,l)}}function we(e,n){const t=[],{children:l}=e||{};return l&&l.forEach(o=>{const{key:a}=o;n!=null&&n.includes(a)||t.push(o.key),t.push(...we(o,n))}),t}function Se(e,n,t){const l=[];for(;n&&!Q(n.parentKey);){const{parentKey:o}=n;t!=null&&t.includes(n.parentKey)||l.push(o),n=e.get(o)}return l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ve(e,n,t,l,o){const[a,d]=oe(e,"checkedKeys",()=>[]),c=b(()=>({data:n.value,dataMap:t.value,parentKeyMap:l.value,depthMap:o.value})),f=$("children"),s=$(r=>r.key),v=b(()=>e.cascaderStrategy),h=$(r=>!!r.checkDisabled),{checkStateResolver:i,isChecked:x,isIndeterminate:m,toggle:S}=Oe(a,c,f,s,v,h),M=r=>{const{checked:g,checkedKeys:k}=S(r);r.checkDisabled||N(g,r.rawNode,k)},N=(r,g,k)=>{const{onCheck:w,onCheckedChange:u}=e;F(w,r,g),d(k),X(t,k,u)};return De(v,()=>{const r=i.appendKeys([],a.value);d(r),X(t,r,e.onCheckedChange)}),{checkedKeys:a,isChecked:x,isIndeterminate:m,handleCheck:M}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ge(e,n,t,l){const o=$({}),a=(i,x)=>{o.value[i]=x},d=i=>o.value[i],c=b(()=>{const i=new Map,x=new Map,m=new Map;return{mergedNodes:Ne(e.dataSource,d,{props:e,childrenKey:n.value,getKey:t.value,labelKey:l.value,parentKey:void 0,parentLevel:-1,parentsDisabled:[]},{dataKeyMap:i,parentKeyMap:x,depthMap:m}),dataKeyMap:i,parentKeyMap:x,depthMap:m}}),f=b(()=>c.value.mergedNodes),s=b(()=>c.value.dataKeyMap),v=b(()=>c.value.parentKeyMap),h=b(()=>c.value.depthMap);return{mergedNodes:f,mergedNodeMap:s,parentKeyMap:v,depthMap:h,setLoadedNodes:a}}function Qe(e,{expandedKeys:n},t,l){const o=b(()=>{const{searchValue:c}=t,f=new Map(n.value.map((h,i)=>[h,i])),s=new Map(l.value.map((h,i)=>[h,i])),v=new Map;return c&&!s.size?{flattedNodes:[],flattenedNodeMap:v}:f.size||s.size?{flattedNodes:Je(e.value,f,s,v),flattenedNodeMap:v}:{flattedNodes:e.value.map(h=>{const i={...h,expanded:!1,level:0};return v.set(i.key,i),i}),flattenedNodeMap:v}}),a=b(()=>o.value.flattedNodes),d=b(()=>o.value.flattenedNodeMap);return{flattedNodes:a,flattenedNodeMap:d}}function Ne(e,n,t,l){const{props:o,childrenKey:a,getKey:d,labelKey:c,parentKey:f,parentLevel:s,parentsDisabled:v}=t,{cascaderStrategy:h,disabled:i,loadChildren:x}=o,{dataKeyMap:m,parentKeyMap:S,depthMap:M}=l,N=!!x;return e.map((r,g)=>{var O,q,P;const k=d(r),w=Xe(r,i),u=(O=r[a])!=null?O:n(k),y=r[c],D=s+1,L=u&&Ne(u,n,{props:o,childrenKey:a,getKey:d,labelKey:c,parentKey:k,parentLevel:D,parentsDisabled:[w,...v!=null?v:[]]},l),I=Ye(w,v!=null?v:[],(q=L==null?void 0:L.map(U=>({check:U.checkDisabled,drag:U.dragDisabled,drop:U.dropDisabled,select:U.selectDisabled})))!=null?q:[],h!=="off"),E={label:y,key:k,children:L,isFirst:g===0,isLeaf:(P=r.isLeaf)!=null?P:!(u!=null&&u.length||N),isLast:g===e.length-1,parentKey:f,expanded:!1,level:D,rawNode:r,checkDisabled:I.check,dragDisabled:I.drag,dropDisabled:I.drop,selectDisabled:I.select};return m.set(k,E),S.set(k,f),M.set(k,D),E})}function Xe(e,n){const t=e.disabled||{};if(t===!0)return{check:!0,drag:!0,drop:!0,select:!0};let{check:l,drag:o,drop:a,select:d}=t;if(n){const c=n(e)||{};if(c===!0)return{check:!0,drag:!0,drop:!0,select:!0};l=l||c.check,o=o||c.drag,a=a||c.drop,d=d||c.select}return{check:l,drag:o,drop:a,select:d}}function Ye(e,n,t,l){const o=a=>e[a]||l&&(n.some(d=>!!d[a])||!!t.length&&t.every(d=>!!d[a]));return{check:o("check"),drag:o("drag"),drop:o("drop"),select:o("select")}}function Le(e=[],n){const t=[],l=e.length;return e.forEach((o,a)=>{o.isFirst=a===0,o.isLast=a===l-1,n.has(o.key)||n.size==0?(o.hidden=!1,t.push(o)):o.hidden=!0,Le(o.children,n).length>0&&(o.hidden=!1,t.push(o))}),t.length&&(t[0].isFirst=!0,t[t.length-1].isLast=!0),t}function Je(e,n,t,l){const o=[],a=[];return Le(e,t),e.forEach(d=>{for(a.push({...d});a.length;){const c=a.pop();if(c){const{children:f,key:s,hidden:v}=c,h=n.has(s);if(c.expanded=h,!v&&o.push(c),l.set(c.key,c),f&&h)for(let i=f.length;i>0;i--)!f[i-1].hidden&&a.push(f[i-1])}}}),o}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ze(e,n,{expandedKeys:t,setExpandedKeys:l}){const o=b(()=>{var u;return(u=e.draggableIcon)!=null?u:n.draggableIcon}),a=$(),d=$(),c=$(),f=$(),s=$();let v;const h=()=>{v&&(clearTimeout(v),v=void 0)};He(()=>h());const i=()=>{Q(a.value)||(a.value=void 0,d.value=void 0)},x=()=>{Q(c.value)||(c.value=void 0,f.value=void 0,s.value=void 0)},m=(u,y)=>{var D,L;return{evt:u,node:y.rawNode,dragNode:(D=a.value)==null?void 0:D.rawNode,dropNode:(L=c.value)==null?void 0:L.rawNode,dropType:s.value}},S=u=>{N(u,void 0),window.removeEventListener("dragend",S)},M=(u,y)=>{a.value=y,d.value=we(y),nn(y.key,t.value,l),window.addEventListener("dragend",S),F(e.onDragstart,m(u,y))},N=(u,y)=>{y&&F(e.onDragend,m(u,y)),i(),x()},r=async(u,y)=>{const D=a.value;if(D){h(),D.key!==y.key&&(v=setTimeout(()=>{var I;a.value&&((I=y.children)!=null&&I.length)&&en(y.key,t.value,l),v=void 0},1e3));const L=await Ce(y,D,d.value,u,e.droppable);L?(c.value=y,f.value=L!=="inside"?y.parentKey:void 0,s.value=L):x()}F(e.onDragenter,m(u,y))},g=async(u,y)=>{const D=a.value;if(D){const L=await Ce(y,D,d.value,u,e.droppable);L?(c.value=y,f.value=L!=="inside"?y.parentKey:void 0,s.value=L):x()}F(e.onDragover,m(u,y))},k=(u,y)=>{const D=c.value;(D==null?void 0:D.key)===y.key&&!u.currentTarget.contains(u.relatedTarget)&&x(),F(e.onDragleave,m(u,y))},w=(u,y)=>{s.value||x(),F(e.onDrop,m(u,y)),i(),x()};return{draggableIcon:o,dragKey:b(()=>{var u;return(u=a.value)==null?void 0:u.key}),dropKey:b(()=>{var u;return(u=c.value)==null?void 0:u.key}),dropParentKey:f,dropType:s,handleDragstart:M,handleDragend:N,handleDragenter:r,handleDragover:g,handleDragleave:k,handleDrop:w}}function en(e,n,t){n.indexOf(e)===-1&&t([...n,e])}function nn(e,n,t){const l=n.indexOf(e);if(l!==-1){const o=[...n];o.splice(l,1),t(o)}}async function Ce(e,n,t,l,o){const{key:a,children:d=[]}=e;if(n.key===a||t&&t.includes(a))return!1;const{clientY:c}=l,{top:f,height:s}=l.target.getBoundingClientRect(),v=c<f+s/2;let h;if(o){const i={evt:l,isTopHalf:v,dragNode:n.rawNode,dropNode:e.rawNode};h=await o(i)}return(h===void 0||h===!0)&&(d.length>0?h="inside":v?h="before":h="after"),h}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tn(e,n,t,{expandedKeys:l,handleExpand:o},{activeKey:a,handleSelect:d}){const c=$(!1);return{focused:c,handleFocus:i=>{c.value=!0,F(e.onFocus,i)},handleBlur:i=>{c.value=!0,F(e.onBlur,i)},handleKeydown:i=>{switch(i.code){case"ArrowUp":case"ArrowDown":i.preventDefault()}F(e.onKeydown,i)},handleKeyup:i=>{const x=i.code,m=a.value,S=t.value,M=S.length;if(m===void 0)["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(x)&&ge(a,S,0,M);else{const N=t.value,r=N.findIndex(g=>g.key===m);if(r===-1)return;switch(x){case"Enter":case"NumpadEnter":d(m);break;case"ArrowDown":ge(a,N,r+1,M);break;case"ArrowUp":ge(a,N,r-1,0,!0);break;case"ArrowLeft":{const{rawNode:g,key:k,parentKey:w}=N[r];if(g.isLeaf||!l.value.includes(k)){const u=w?n.value.get(w):void 0;u&&(a.value=u.key)}else o(k,g)}break;case"ArrowRight":{const{rawNode:g,key:k}=N[r];if(!l.value.includes(k))o(k,g);else for(let w=r+1;w<M;w++){const u=N[w];a.value=u.key;break}}break}}F(e.onKeyup,i)}}}function ge(e,n,t,l,o=!1){let a=t;for(;o?a>=l:a<l;){const d=n[a];if(d.selectDisabled)o?a--:a++;else{e.value=d.key;return}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function an(e,n,t,l,o,a){const d=b(()=>{var r;return(r=e.expandIcon)!=null?r:n.expandIcon}),[c,f]=oe(e,"expandedKeys",()=>[]),[s,v]=oe(e,"loadedKeys",()=>[]),h=$([]),i=({key:r,expanded:g,node:k})=>{if(qe(d.value))return ke(j,{name:d.value,rotate:g?90:0});if(Ue(d.value))return d.value({key:r,expanded:g,node:k});if(ze(d.value))return ke(j,{name:g?d.value[0]:d.value[1]})},x=r=>{if(!r||r.length<=0)return;const{onExpandedChange:g}=e,k=l.value,w=new Set(c.value);r.forEach(y=>{Se(k,k.get(y)).forEach(D=>w.add(D))});const u=[...w];f(u),X(l,u,g)};De(o,x);const m=async(r,g)=>{var L;const{loadChildren:k}=e;if(h.value.includes(r))return;const w=t.value;if(!((L=g==null?void 0:g[w])!=null&&L.length)){if(!k||h.value.includes(r)||s.value.includes(r))return;h.value.push(r);const I=await k(g);h.value.splice(h.value.indexOf(r),1);const O=l.value.get(r);if(I!=null&&I.length){a(r,I),O.rawNode[w]=I;const q=[...s.value,r];v(q),F(e.onLoaded,q,g)}else return}const u=c.value.indexOf(r),y=u>=0,D=[...c.value];y?D.splice(u,1):D.push(r),S(y,g,D)},S=(r,g,k)=>{const{onExpand:w,onExpandedChange:u}=e;F(w,!r,g),f(k),X(l,k,u)},M=()=>{const r=[],g=[];l.value.forEach(k=>{k.isLeaf||(r.push(k.key),g.push(k.rawNode))}),F(e.onExpandedChange,r,g),f(r)},N=()=>{F(e.onExpandedChange,[],[]),f([])};return o.value.length&&x(o.value),{expandIconRenderer:i,expandedKeys:c,setExpandedKeys:f,expandAll:M,collapseAll:N,handleExpand:m,loadingKeys:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function on(e,n,t){const l=ln(e,t);return{searchedKeys:b(()=>{const{searchValue:a}=e;if(!a)return Ie;const d=l.value,c=[];return n.value.forEach(f=>{d(f.rawNode,a)&&c.push(f.key)}),c})}}function ln(e,n){return b(()=>{var t;return(t=e.searchFn)!=null?t:rn(n.value)})}function rn(e){return(n,t)=>{const l=n[e];return l?l.toLowerCase().includes(t.toLowerCase()):!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dn(e,n){const[t,l]=oe(e,"selectedKeys",()=>[]),o=b(()=>e.selectable==="multiple"),a=$();_e(()=>{const s=t.value,v=s.length;a.value=v>0?s[v-1]:void 0});const d=b(()=>{const s=a.value;return s!==void 0?n.value.get(s):void 0}),c=s=>{const h=n.value.get(s);if(!h)return;const i=t.value.indexOf(s),x=i>-1;let m=[...t.value];o.value?x?m.splice(i,1):m.push(s):m=x?[]:[s],f(x,h.rawNode,m)},f=(s,v,h)=>{var S;const{onSelect:i,onSelectedChange:x}=e,m=h.includes((S=v.key)!=null?S:"")?!0:!s;F(i,m,v),l(h),X(n,h,x)};return{activeKey:a,activeNode:d,selectedKeys:t,handleSelect:c}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const V=Symbol("treeToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const cn={autoHeight:{type:Boolean,default:void 0},checkedKeys:Array,expandedKeys:Array,indeterminateKeys:Array,loadedKeys:Array,selectedKeys:Array,blocked:{type:Boolean,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},childrenKey:String,checkOnClick:{type:Boolean,default:!1},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:Function,draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:Function,empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},height:Number,labelKey:String,leafLineIcon:String,loadChildren:Function,searchFn:Function,searchValue:String,selectable:{type:[Boolean,String],default:!0},showLine:{type:Boolean,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualItemHeight:{type:Number,default:32},"onUpdate:checkedKeys":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],"onUpdate:selectedKeys":[Function,Array],onCheck:[Function,Array],onCheckedChange:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onSelect:[Function,Array],onSelectedChange:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onKeydown:[Function,Array],onKeyup:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},sn={node:{type:Object,required:!0},isLeaf:{type:Boolean,required:!0},isFirst:{type:Boolean,required:!0},isLast:{type:Boolean,required:!0},label:String,level:{type:Number,required:!0},rawNode:{type:Object,required:!0},expanded:{type:Boolean,required:!0},children:Array,parentKey:[String,Number,Symbol],checkDisabled:{type:Boolean,default:void 0},dragDisabled:{type:Boolean,default:void 0},dropDisabled:{type:Boolean,default:void 0},selectDisabled:{type:Boolean,default:void 0}},un={node:{type:Object,required:!0},checkDisabled:{type:Boolean,default:void 0}},hn={expanded:{type:Boolean,required:!0},hasTopLine:{type:Boolean,default:void 0},hasBottomLine:{type:Boolean,default:void 0},isLeaf:{type:Boolean,default:void 0},nodeKey:{type:[String,Number,Symbol],required:!0},rawNode:{type:Object,required:!0}},vn={disabled:{type:Boolean,default:void 0},node:{type:Object,required:!0},nodeKey:{type:[String,Number,Symbol],required:!0},label:String,selected:{type:Boolean,default:void 0}},fn=W({props:un,setup(e){const{mergedPrefixCls:n,isChecked:t,isIndeterminate:l,handleCheck:o}=Y(V),a=b(()=>t(e.node.key)),d=b(()=>l(e.node.key)),c=()=>o(e.node);return()=>K(Me,{class:`${n.value}-node-checkbox`,checked:a.value,disabled:e.checkDisabled,indeterminate:d.value,onChange:c},null)}}),gn=W({props:vn,setup(e,{slots:n}){const{props:t,mergedPrefixCls:l,mergedCheckOnClick:o,handleSelect:a,handleCheck:d,searchedKeys:c}=Y(V),f=b(()=>c.value.includes(e.nodeKey)),s=h=>{e.disabled||(a(e.nodeKey),o.value&&d(e.node)),F(t.onNodeClick,h,e.node.rawNode)},v=h=>{F(t.onNodeContextmenu,h,e.node.rawNode)};return()=>{var u,y;const{nodeKey:h,label:i,node:x,selected:m}=e,{rawNode:S}=x,{prefix:M,suffix:N}=S,r={key:h,selected:m,node:S},g=((u=n.prefix)==null?void 0:u.call(n,r))||M&&K(j,{name:M},null),k=((y=n.suffix)==null?void 0:y.call(n,r))||N&&K(j,{name:N},null),w=`${l.value}-node-content`;return K("span",{class:w,onClick:s,onContextmenu:v},[g&&K("span",{class:`${w}-prefix`},[g]),K("span",{class:`${w}-label`},[yn(n.label,i,S,t.searchValue,f.value,w)]),k&&K("span",{class:`${w}-suffix`},[k])])}}});function yn(e,n,t,l,o,a){if(e)return e({node:t,searchValue:l,searched:o});if(o&&n&&l){const d=n.toUpperCase().indexOf(l.toUpperCase());if(d>-1){const c=d+l.length,f=n.substring(0,d),s=n.substring(c),v=K("span",{class:`${a}-label-highlight`},[n.substring(d,c)]);return[f,v,s]}}return n}const pn=W({props:hn,setup(e,{slots:n}){const{mergedPrefixCls:t,expandIconRenderer:l,loadingKeys:o,handleExpand:a}=Y(V),d=b(()=>o.value.includes(e.nodeKey)),c=b(()=>{const s=`${t.value}-node-expand`;return je({[s]:!0,[`${s}-noop`]:e.isLeaf})}),f=s=>{a(e.nodeKey,e.rawNode),s.stopPropagation()};return()=>{var h,i;const s=`${t.value}-node-expand`;let v;if(d.value)v=K(j,{name:"loading"},null);else if(!e.isLeaf){const{expanded:x,nodeKey:m,rawNode:S}=e;v=(i=(h=n.expandIcon)!=null?h:l)==null?void 0:i({key:m,expanded:x,node:S})}return K("span",{class:c.value,onClick:f},[e.hasTopLine&&K("div",{class:`${s}-top-line`},null),v,e.hasBottomLine&&K("div",{class:`${s}-bottom-line`},null)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const bn=({level:e,noopIdentUnitArr:n,prefixCls:t})=>{const l=[];for(let o=0;o<e;o++)l.push(K("span",{key:o,class:n.includes(o)?`${t}-node-indent-noop-unit`:`${t}-node-indent-unit`},null));return K("span",{"aria-hidden":!0,class:`${t}-node-indent`},[l])},kn=bn,Cn=W({setup(e,{slots:n}){const{props:t,mergedPrefixCls:l}=Y(V);return()=>{const o=`${l.value}-node-leaf`;let a;return n.leafLineIcon?a=n.leafLineIcon():t.leafLineIcon?a=K(j,{name:t.leafLineIcon},null):a=K("span",{class:`${o}-line`},null),K("span",{class:o},[a])}}}),xe=W({props:sn,setup(e,{slots:n}){const{props:t,flattenedNodeMap:l,mergedPrefixCls:o,mergedShowLine:a,activeKey:d,selectedKeys:c,draggableIcon:f,dragKey:s,dropKey:v,dropParentKey:h,dropType:i,handleDragstart:x,handleDragend:m,handleDragenter:S,handleDragover:M,handleDragleave:N,handleDrop:r}=Y(V),g=b(()=>e.node.key),k=b(()=>d.value===g.value),w=b(()=>a.value&&e.isLast),u=b(()=>a.value&&!e.isLeaf&&(!e.isFirst||e.level!==0)),y=b(()=>a.value&&!e.isLeaf&&!e.isLast),D=b(()=>c.value.includes(g.value)),L=b(()=>e.selectDisabled||!t.selectable),I=b(()=>s.value===g.value),E=b(()=>v.value===g.value),O=b(()=>h.value===g.value),q=b(()=>E.value&&i.value==="before"),P=b(()=>E.value&&i.value==="inside"),U=b(()=>E.value&&i.value==="after"),J=b(()=>{const C=`${o.value}-node`;return{[C]:!0,[`${C}-active`]:k.value,[`${C}-last`]:w.value,[`${C}-disabled`]:L.value,[`${C}-selected`]:D.value,[`${C}-expanded`]:e.expanded,[`${C}-dragging`]:I.value,[`${C}-dropping`]:E.value,[`${C}-drop-parent`]:O.value,[`${C}-drop-before`]:q.value,[`${C}-drop-inside`]:P.value,[`${C}-drop-after`]:U.value}}),Z=C=>{var _;C.stopPropagation(),x(C,e.node),(_=C.dataTransfer)==null||_.setData("text/plain","")},le=C=>{C.stopPropagation(),m(C,e.node)},re=C=>{C.preventDefault(),C.stopPropagation(),S(C,e.node)},de=C=>{C.preventDefault(),C.stopPropagation(),M(C,e.node)},ce=C=>{C.stopPropagation(),N(C,e.node)},se=C=>{C.stopPropagation(),r(C,e.node)};return()=>{var ae,z;const C=l.value,{isLeaf:_,label:G,level:ee,rawNode:ne,expanded:ie,checkDisabled:ue,dragDisabled:he,dropDisabled:p,node:A}=e,{checkable:H,draggable:T}=t,B=T&&!he,R=(z=(ae=n.draggableIcon)==null?void 0:ae.call(n))!=null?z:K(j,{name:f.value},null),ve=C.get(g.value),te=[];a.value&&Se(C,ve).reverse().forEach((Ae,Fe)=>{var pe;(pe=C.get(Ae))!=null&&pe.isLast&&te.push(Fe)});const fe=t.customAdditional?t.customAdditional({node:ne,level:ee}):void 0;return K("div",ye({class:J.value,"aria-grabbed":I.value||void 0,"aria-label":G,"aria-selected":D.value,draggable:B||void 0,title:G,onDragstart:B?Z:void 0,onDragend:B?le:void 0,onDragenter:B?re:void 0,onDragover:B?de:void 0,onDragleave:B?ce:void 0,onDrop:B&&!p?se:void 0},fe),[K(kn,{level:ee,noopIdentUnitArr:te,prefixCls:o.value},null),B?K("span",{class:`${o.value}-node-draggable-icon`},[R]):T&&K("span",{class:`${o.value}-node-draggable-icon-noop`},null),_&&a.value?K(Cn,null,n):K(pn,{expanded:ie,hasTopLine:u.value,hasBottomLine:y.value,isLeaf:_,nodeKey:g.value,rawNode:ne},n),H&&K(fn,{checkDisabled:ue,node:A},null),K(gn,{disabled:L.value,node:A,nodeKey:g.value,label:G,selected:D.value},n)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function me(e){const{heightMd:n,heightSm:t,marginSizeXs:l,colorPrimaryHover:o,colorPrimaryText:a,colorContainerBgHover:d,colorContainerBg:c,colorIconInfo:f}=e;return{dropLineWidth:2,dropLineColor:o,bgColor:c,nodeBgColorHover:d,nodeBgColorSelected:c,nodeColorSelected:a,nodePaddingHorizontal:l,nodePaddingVertical:"0px",nodeContentHeight:n,nodeContentLabelHighlightColor:a,nodeContentPrefixMarginRight:l,nodeCheckboxMarginRight:l,nodeIconWidth:t,expandIconColor:f}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const xn=(e,n)=>me(e),Ke={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},mn=W({name:"IxTree",props:cn,setup(e,{attrs:n,expose:t,slots:l}){const o=be("common"),{globalHashId:a,hashId:d,registerToken:c}=Be("tree");c(xn);const f=b(()=>`${o.prefixCls}-tree`),s=be("tree"),v=b(()=>{var p;return(p=e.autoHeight)!=null?p:s.autoHeight}),h=b(()=>{var p;return(p=e.childrenKey)!=null?p:s.childrenKey}),i=$e(e,s),x=b(()=>{var p;return(p=e.labelKey)!=null?p:s.labelKey}),m=b(()=>{var p;return(p=e.showLine)!=null?p:s.showLine}),S=b(()=>{var p;return(p=e.blocked)!=null?p:s.blocked}),M=b(()=>e.checkable&&e.checkOnClick),{mergedNodes:N,mergedNodeMap:r,parentKeyMap:g,depthMap:k,setLoadedNodes:w}=Ge(e,h,i,x),{searchedKeys:u}=on(e,r,x),y=an(e,s,h,r,u,w),{flattedNodes:D,flattenedNodeMap:L}=Qe(N,y,e,u),I=Ve(e,N,r,g,k),E=Ze(e,s,y),O=dn(e,r),{handleCheck:q}=I;Re(V,{props:e,config:s,flattedNodes:D,flattenedNodeMap:L,mergedPrefixCls:f,mergedNodeMap:r,mergedGetKey:i,mergedShowLine:m,mergedCheckOnClick:M,searchedKeys:u,...I,...y,...E,...O});const P=$(),U=$(),{activeKey:J}=O,{focused:Z,handleFocus:le,handleBlur:re,handleKeydown:de,handleKeyup:ce}=tn(e,r,D,y,O),se=b(()=>{const p=f.value;return{[a.value]:!!a.value,[d.value]:!!d.value,[p]:!0,[`${p}-active`]:!Q(J.value),[`${p}-blocked`]:S.value,[`${p}-virtual`]:e.virtual,[`${p}-auto-height`]:v.value,[`${p}-focused`]:Z.value,[`${p}-show-line`]:m.value,[`${p}-empty`]:!D.value.length}}),C=b(()=>{var B,R;const p=J.value;if(Q(p))return"";const A=r.value;let H=String(p),T=(B=A.get(p))==null?void 0:B.parentKey;for(;T;)H=`${String(T)} > ${H}`,T=(R=A.get(T))==null?void 0:R.parentKey;return H}),_=p=>{var A;(A=P==null?void 0:P.value)==null||A.focus(p)},G=()=>{var p;(p=P==null?void 0:P.value)==null||p.blur()},ee=p=>{var A;(A=U.value)==null||A.scrollTo(p)},ne=p=>{var A;return(A=r.value.get(p))==null?void 0:A.rawNode},ie=()=>D.value,ue=p=>{const A=r.value.get(p);A&&q(A)};t({focus:_,blur:G,expandAll:y.expandAll,collapseAll:y.collapseAll,scrollTo:ee,getNode:ne,_getFlattedNodes:ie,_handleCheck:ue});const he=(p,A,H)=>{F(e.onScrolledChange,p,A,H.map(T=>T.rawNode))};return()=>{var H;const p=D.value;let A;if(p.length>0){const T=({item:z})=>K(xe,ye({node:z},z),l),{height:B,virtual:R,virtualItemHeight:ve,virtualScrollMode:te,onScroll:fe,onScrolledBottom:ae}=e;A=R?K(Pe,{ref:U,class:`${f.value}-content`,dataSource:p,getKey:"key",height:v.value?"100%":B,rowHeight:ve,rowRender:T,virtual:!0,scrollMode:te,onScroll:fe,onScrolledBottom:ae,onScrolledChange:he},null):K("div",{class:`${f.value}-content`,style:We(v.value?void 0:{maxHeight:Te(B)})},[K("div",{class:`${f.value}-content-inner`},[p.map(z=>K(xe,ye({node:z},z),l))])])}else A=K(Ee,{empty:e.empty},l);return K("div",{class:se.value,role:"tree"},[Z.value&&K("span",{style:Ke,"aria-live":"assertive"},[C.value]),K("input",{ref:P,style:Ke,tabindex:(H=n.tabIndex)!=null?H:0,onFocus:le,onBlur:re,onKeydown:de,onKeyup:ce,value:"","aria-label":"for screen reader"},null),A])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Sn=mn;export{Sn as I};
