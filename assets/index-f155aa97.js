import{P as Ne,m,ao as ge,aV as ke,c as Ke,ad as Be,M as ce,N as De,aw as Le,K as Me,r as Te,aa as Ee,ae as Pe,af as Ve,ax as ze,ay as Oe,az as Re,aA as $e,aG as we}from"./index-ebff8fb2.js";import{c as C,au as de,t as He,l as pe,y as Ge,r as se,q as x,i as Ue,w as je,m as qe,D as We,p as Xe,ad as fe}from"./vendor-7de7c0f1.js";import{I as _e}from"./index-c76e3d45.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Je(e,n,t,l){return{mergedNodeMap:C(()=>{const o=new Map,s=he(e,e.dataSource,n.value,t.value,l.value);return ue(s,o),o})}}function he(e,n,t,l,r,o){const{treeDisabled:s,loadChildren:y}=e;return n.map(A=>me(A,t,l,r,s,!!y,o))}function me(e,n,t,l,r,o,s){var N;const y=t(e),{check:A,drag:c,drop:f,select:S}=Qe(e,r),F=e[n],D=e[l],p=F==null?void 0:F.map(I=>me(I,n,t,l,r,o,y));return{children:p,label:D,key:y,isLeaf:(N=e.isLeaf)!=null?N:!(p!=null&&p.length||o),parentKey:s,rawData:e,checkDisabled:A,dragDisabled:c,dropDisabled:f,selectDisabled:S}}function Qe(e,n){const t=e.disabled;if(de(t))return{check:t,drag:t,drop:t,select:t};{let{drag:l,drop:r,select:o}=t!=null?t:{},s;if(n){const y=n(e);de(y)?(s!=null||(s=y),l!=null||(l=y),r!=null||(r=y),o!=null||(o=y)):(l!=null||(l=y.drag),r!=null||(r=y.drop),o!=null||(o=y.select),s!=null||(s=y.select))}return{check:s,drag:l,drop:r,select:o}}}function ue(e,n){e.forEach(t=>{const{key:l,children:r}=t;n.set(l,t),r&&ue(r,n)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ye(e,n,t){const l=C(()=>Ne(n.value)),r=C(()=>{const c=t.value;return l.value.map(f=>c.get(f)).filter(Boolean)}),o=c=>{const f=e.multiple?c:c[0],S=He(n.value);f!==S&&(n.setValue(f),m(e.onChange,f,S))};return{selectedValue:l,selectedNodes:r,changeSelected:c=>{!e.multiple&&!c.length||o(c)},handleRemove:c=>{o(l.value.filter(f=>c!==f))},handleClear:c=>{o([]),m(e.onClear,c)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Se=Symbol("treeSelectToken"),Ze=pe({setup(){const{config:e,props:n,slots:t,locale:l,mergedPrefixCls:r,mergedChildrenKey:o,mergedGetKey:s,mergedLabelKey:y,mergedNodeMap:A,inputValue:c,setInputValue:f,treeRef:S,expandedKeys:F,setExpandedKeys:D,selectedValue:p,changeSelected:N,handleNodeClick:I}=Ge(Se),[L,H]=ge(n,"loadedKeys",()=>[]),k=se(!1),V=C(()=>n.multiple&&n.checkable),G=C(()=>V.value?n.cascaderStrategy:"off"),K=(d,u,i)=>{const{onScrolledChange:v}=n;m(v,d,u,i.map(h=>h.rawData))},O=d=>{d.stopPropagation()},U=(d,u)=>{const{onCheck:i}=n;m(i,d,u),I()},j=(d,u)=>{var v;const{onSelect:i}=n;!n.multiple&&((v=p.value)==null?void 0:v[0])!==u.key&&m(i,d,u),I()},z=(d,u)=>{const{onExpand:i}=n;m(i,d,u)},R=(d,u)=>{const{onExpandedChange:i}=n;m(i,d,u),D(d)},q=d=>{var i,v;const u=k.value;u?(i=S.value)==null||i.expandAll():(v=S.value)==null||v.collapseAll(),k.value=!u,d.stopPropagation()},W=async(d,u)=>{const i=o.value,v=y.value,h=s.value,M=u[i],T=h(u),E=A.value,B=E.get(T);if(M.length&&B){const P=he(n,M,i,h,v,T);ue(P,E),B.rawData[i]=M,B.children=P,H(d),m(n.onLoaded,d,u)}},X=C(()=>{var d;return(d=n.clearIcon)!=null?d:e.clearIcon}),_=d=>{const{value:u}=d.target;f(u),n.searchable&&m(n.onSearch,u)},$=()=>{f(""),n.searchable&&m(n.onSearch,"")};return()=>{const{customAdditional:d,dataSource:u,draggable:i,draggableIcon:v,empty:h,expandIcon:M,multiple:T,leafLineIcon:E,virtual:B,virtualItemHeight:P,searchable:J,showLine:Q,searchPlaceholder:Y,onDragstart:Z,onDragend:ee,onDragenter:ae,onDragleave:ne,onDragover:te,onDrop:le,onNodeClick:a,onNodeContextmenu:g,onScroll:b,onScrolledBottom:w,droppable:be,treeDisabled:Ce,loadChildren:xe,searchFn:oe,overlayRender:ie,overlayHeight:Ae}=n,Fe=r.value,Ie={label:t.treeLabel,prefix:t.treePrefix,suffix:t.treeSuffix,leafLineIcon:t.leafLineIcon,empty:t.empty,expandIcon:t.expandIcon,draggableIcon:t.draggableIcon},re=[x(_e,{ref:S,blocked:!0,checkOnClick:!0,checkedKeys:p.value,customAdditional:d,expandedKeys:F.value,loadedKeys:L.value,labelKey:y.value,checkable:V.value,cascaderStrategy:G.value,childrenKey:o.value,dataSource:u,draggable:i,draggableIcon:v,droppable:be,disabled:Ce,empty:h,expandIcon:M,getKey:s.value,height:Ae,loadChildren:xe,leafLineIcon:E,virtual:B,virtualItemHeight:P,selectable:T?"multiple":!0,selectedKeys:p.value,searchValue:oe!==!1?c.value:void 0,searchFn:Ue(oe)?oe:void 0,showLine:Q,onClick:O,onCheck:U,onDragstart:Z,onDragend:ee,onDragenter:ae,onDragleave:ne,onDragover:te,onDrop:le,onNodeClick:a,onNodeContextmenu:g,onExpand:z,onSelect:j,onLoaded:W,onCheckedChange:N,onSelectedChange:V.value?ke:N,onExpandedChange:R,onScroll:b,onScrolledBottom:w,onScrolledChange:K},Ie)];if(J==="overlay"){const ye=c.value;re.unshift(x("div",{class:`${Fe}-overlay-search-wrapper`},[x(Ke,{size:"xs",shape:"square",title:k.value?l.treeSelect.expandAll:l.treeSelect.collapseAll,icon:k.value?"expand-all":"collapse-all",onClick:q},null),x(Be,{clearable:!0,clearIcon:X.value,clearVisible:!!ye,size:"sm",suffix:"search",value:ye,placeholder:Y,onClear:$,onInput:_},null)]))}return x("div",{tabindex:-1},[ie?ie(re):re])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ea={control:{type:[String,Number,Object,Array],default:void 0},value:{type:null,default:void 0},open:{type:Boolean,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:{type:Function,default:void 0},empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},leafLineIcon:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},offset:Array,overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},searchPlaceholder:{type:String,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},showLine:{type:Boolean,default:void 0},status:String,suffix:{type:String,default:void 0},treeDisabled:{type:Function,default:void 0},virtual:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},"onUpdate:value":[Function,Array],"onUpdate:open":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],onCheck:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onSearch:[Function,Array],onSelect:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array],overlayHeight:{type:Number,default:256}};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ve(e){const{fontSizeSm:n,heightMd:t,marginSizeSm:l,paddingSizeXs:r,paddingSizeSm:o,paddingSizeMd:s}=e;return{optionFontSize:n,optionHeight:t,optionPadding:`${o}px ${s}px`,optionMarginLeft:l,optionContainerPadding:`${r}px 0`,optionContainerTreeNodePadding:`0 0 0 ${s}px`,overlaySearchWrapperPadding:`${r}px ${s}px ${o}px`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const aa=(e,n)=>ve(e),na=pe({name:"IxTreeSelect",inheritAttrs:!1,props:ea,setup(e,{attrs:n,expose:t,slots:l}){const r=ce("common"),{globalHashId:o,hashId:s,registerToken:y}=De("treeSelect");y(aa);const A=ce("locale"),c=ce("treeSelect"),f=C(()=>`${r.prefixCls}-tree-select`),S=C(()=>{var a;return(a=e.childrenKey)!=null?a:c.childrenKey}),F=Le(e,c),D=C(()=>{var a;return(a=e.labelKey)!=null?a:c.labelKey}),p=se(),[N,I]=Me(""),L=()=>{var a;return(a=p.value)==null?void 0:a.focus()},H=()=>{var a;return(a=p.value)==null?void 0:a.blur()},k=()=>{var a;e.searchable==="overlay"?I(""):(a=p.value)==null||a.clearInput()},[V,G]=ge(e,"expandedKeys",()=>[]),{accessor:K,control:O}=Te();Ee(O);const U=Pe(e,c),j=Ve(e,O),{mergedNodeMap:z}=Je(e,S,F,D),{selectedValue:R,selectedNodes:q,changeSelected:W,handleRemove:X,handleClear:_}=Ye(e,K,z),{overlayRef:$,overlayStyle:d,updateOverlay:u,overlayOpened:i,setOverlayOpened:v}=ze(e,c,p),h=se();t({focus:L,blur:H,collapseAll:()=>{var a;return(a=h.value)==null?void 0:a.collapseAll()},expandAll:()=>{var a;return(a=h.value)==null?void 0:a.expandAll()},scrollTo:a=>{var g;(g=h.value)==null||g.scrollTo(a)},getNode:a=>{var g;return h.value?h.value.getNode(a):(g=z.value.get(a))==null?void 0:g.rawData}}),je(i,a=>{a&&L(),k()});const T=()=>{e.searchable!=="overlay"&&setTimeout(L)},E=()=>{e.multiple?k():v(!1)},B=a=>{m(e.onFocus,a)},P=a=>{K.markAsBlurred(),v(!1),m(e.onBlur,a)},{focused:J,bindOverlayMonitor:Q,handleFocus:Y,handleBlur:Z}=Oe(B,P);qe(()=>{Q($,i)});const ee=a=>{L(),X(a)};We(Se,{props:e,slots:l,config:c,locale:A,mergedPrefixCls:f,mergedChildrenKey:S,mergedGetKey:F,mergedLabelKey:D,expandedKeys:V,mergedNodeMap:z,inputValue:N,setInputValue:I,treeRef:h,accessor:K,setExpandedKeys:G,overlayOpened:i,setOverlayOpened:v,handleNodeClick:E,selectedValue:R,changeSelected:W});const ae=C(()=>{const{overlayClassName:a,multiple:g}=e,b=f.value;return Xe({[o.value]:!!o.value,[s.value]:!!s.value,[`${b}-overlay`]:!0,[`${b}-overlay-multiple`]:g,[a||""]:!!a})}),ne=()=>x($e,fe({ref:p,className:f.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:c,dataSource:q.value,disabled:K.disabled,focused:J.value,maxLabel:e.maxLabel,multiple:e.multiple,opened:i.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:U.value,status:j.value,suffix:e.suffix,value:R.value,onFocus:Y,onBlur:Z,onClear:_,onInputValueChange:I,onItemRemove:ee,onOpenedChange:v,onResize:u,onSearch:e.onSearch},n),l),te=a=>{const{spin:g}=e,b=de(g)?{spinning:g}:g;return b?x(we,b,{default:()=>[a]}):a},le=()=>te(x(Ze,{onMousedown:T},null));return()=>{var b,w;const a={class:ae.value,style:d.value,clickOutside:!1,container:(b=e.overlayContainer)!=null?b:c.overlayContainer,containerFallback:`.${f.value}-overlay-container`,disabled:K.disabled||e.readonly,offset:(w=e.offset)!=null?w:c.offset,placement:"bottomStart",transitionName:`${r.prefixCls}-slide-auto`,trigger:"manual",triggerId:n.id,visible:i.value,"onUpdate:visible":v},g={default:ne,content:le};return x(Re,fe({ref:$},a),g)}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ra=na;export{ra as I};
