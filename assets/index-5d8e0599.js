import{O as _e,P as $e,aR as xt,ao as je,m as j,M as Se,aL as U,aS as Be,o as Q,D as ke,a2 as Ct,K as xe,Z as Ve,A as ye,Y as Ue,c as He,j as Ie,ab as wt,at as Bt,H as qe,a1 as ve,$ as ce,a3 as ze,av as kt,aT as Kt,E as Tt,G as Et,aU as $t,L as Fe,N as It,aw as Rt,ar as Pt,aG as Ot}from"./index-6cd2cabb.js";import{b as Xe,f as q,X as Wt,T as Ht,c as S,r as O,w as N,N as Ge,M as Ye,d as ie,y as Ze,_ as de,m as ge,bq as zt,a1 as Ft,l as M,x as F,n as le,p as b,i as ue,ad as fe,an as Mt,B as Re,K as At,au as Lt}from"./vendor-4146ff73.js";import{b as Je}from"./GlobalCodeBox-19845310.js";import{I as Nt}from"./index-778f359d.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Qe=Symbol("IxTableColumn"),Pe=()=>{};Pe.displayName="IxTableColumn";Pe[Qe]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function et(e,t,n){if(!e||Xe(e)&&e.title===!1)return;if(q(t)||Wt(t))return t;const o=_e(t).find(l=>l.type===Ht);return o?o.children:n}function Dt(e){return"key"in e?e.key:"dataKey"in e?$e(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:xt("__IDUX_table_column_key_")}function tt(e,t,n,o,l,a,r=!1){const s=v=>v.filter(g=>g.type!=="scroll-bar"),u=r?l:s(l),c=r?a:s(a);if(!u.length&&!c.length)return;const i=o.findIndex(v=>v.rowKey===e.rowKey),d=v=>{if(t.findIndex(y=>y.key===v.key)>-1)return;const g=n.findIndex(y=>y.key===v.key);return{data:v,index:g,poolKey:`fix-${i}-${g}`}};return{start:u.map(d).filter(Boolean),end:c.map(d).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _t(e,t,n,o){const l=S(()=>{var p;const{columns:h}=e;return nt(h&&h.length>0?h:lt((p=t.default)==null?void 0:p.call(t)),n)}),{flattedColumns:a,scrollBarColumn:r,flattedColumnsWithScrollBar:s}=Vt(l,o),{fixedColumns:u,fixedColumnKeys:c}=Ut(s),i=S(()=>!!e.ellipsis||a.value.some(h=>h.ellipsis)),d=S(()=>a.value.some(h=>h.fixed)),v=S(()=>s.value.length),{columnWidthMap:g,columnWidths:y,changeColumnWidth:m,clearColumnWidth:C}=qt(a),{columnOffsets:B,columnOffsetsWithScrollBar:T}=Xt(u,g,v),f=S(()=>Gt(l.value,r.value));return{flattedColumns:a,scrollBarColumn:r,flattedColumnsWithScrollBar:s,fixedColumns:u,fixedColumnKeys:c,hasEllipsis:i,hasFixed:d,columnWidthMap:g,columnWidths:y,changeColumnWidth:m,clearColumnWidth:C,columnOffsets:B,columnOffsetsWithScrollBar:T,mergedRows:f}}function nt(e,t){return e.map(n=>jt(n,t))}function lt(e){const t=[];return _e(e,{key:Qe}).forEach((n,o)=>{const{props:l,children:a}=n,{key:r=o,editable:s,ellipsis:u,...c}=l||{};c.key=r,c.editable=s||s==="",c.ellipsis=u||u==="";const{default:i,cell:d,title:v,expand:g,icon:y}=a||{};i&&(c.children=lt(i())),d&&(c.customCell=d),v&&(c.customTitle=v),g&&(c.customExpand=g),y&&(c.customIcon=y),t.push(c)}),t}function jt(e,t){var u,c;const{columnBase:n,columnExpandable:o,columnSelectable:l,columnIndexable:a}=t,{align:r=n.align}=e,s=Dt(e);if("type"in e){const{type:i}=e;if(i==="expandable"){const{showLine:d=o.showLine,icon:v=o.icon}=e;return{...e,key:s,align:r,icon:v,showLine:d}}if(i==="selectable"){const{multiple:d=!0,showIndex:v=l.showIndex}=e;return{...e,key:s,align:r,multiple:d,showIndex:v}}if(i==="indexable"){const d=(c=(u=e.align)!=null?u:a.align)!=null?c:n.align;return{...a,...e,align:d,key:s}}return{...e,key:s,align:r}}else{const{sortable:i,filterable:d,children:v}=e,g={...e,key:s,align:r};return i&&(g.sortable={...n.sortable,...i}),d&&(g.filterable={...n.filterable,...d}),v!=null&&v.length&&(g.children=nt(v,t)),g}}function Vt(e,t){const n=S(()=>Oe(e.value)),o=S(()=>{const a=t.value,r=n.value;if(a===0||r.length===0)return;const s=r[r.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:s&&s.fixed,width:a}}),l=S(()=>{const a=n.value,r=o.value;return r?[...a,r]:a});return{flattedColumns:n,scrollBarColumn:o,flattedColumnsWithScrollBar:l}}function Oe(e){const t=[];return e.forEach(n=>{const{fixed:o,children:l}=n;if(l!=null&&l.length){let a=Oe(l);o&&(a=a.map(r=>({fixed:o,...r}))),t.push(...a)}else t.push(n)}),t}function Ut(e){const t=S(()=>{const o=[],l=[];return e.value.forEach(a=>{const{fixed:r}=a;r==="start"?o.push(a):r==="end"&&l.push(a)}),{fixedStartColumns:o,fixedEndColumns:l}}),n=S(()=>{var a,r;const{fixedStartColumns:o,fixedEndColumns:l}=t.value;return{lastStartKey:(a=o[o.length-1])==null?void 0:a.key,firstEndKey:(r=l[0])==null?void 0:r.key}});return{fixedColumns:t,fixedColumnKeys:n}}function qt(e){const t=O({}),n=O(),o=O([]);return N(n,Ge(r=>{o.value=r?r.split("-").filter(Boolean).map(Number):[]},16)),Ye(()=>{const r=e.value;n.value=r.map(s=>t.value[s.key]).join("-")}),{columnWidthMap:t,columnWidths:o,changeColumnWidth:(r,s)=>{s===!1?delete t.value[r]:t.value[r]=s},clearColumnWidth:()=>{t.value={}}}}function Xt(e,t,n){const o=S(()=>Me(e.value.fixedStartColumns,e.value.fixedEndColumns.filter(a=>a.type!=="scroll-bar"),t.value,n.value-1)),l=S(()=>Me(e.value.fixedStartColumns,e.value.fixedEndColumns,t.value,n.value));return{columnOffsets:o,columnOffsetsWithScrollBar:l}}function Me(e,t,n,o){var u,c,i,d;const l={},a={};let r=0,s=0;for(let v=0;v<e.length;v++){const g=e[v],y=(c=(u=n[g.key])!=null?u:g.width)!=null?c:0;l[g.key]={index:v,offset:r},r+=y}for(let v=0;v<t.length;v++){const g=t[t.length-v-1],y=(d=(i=n[g.key])!=null?i:g.width)!=null?d:0;a[g.key]={index:o-v-1,offset:s},s+=y}return{starts:l,ends:a}}function Gt(e,t){const n=[],o={};function l(s,u,c){var v;(v=n[c])!=null||(n[c]=[]);let i=u;return s.map(g=>{var T;let y=(T=g.titleColSpan)!=null?T:1,m=!1;const C=g.children;if(C!=null&&C.length){m=!0;const f=l(C,i,c+1);ie(g.titleColSpan)&&(y=f.reduce((h,p)=>h+p))}const B=i+y-1;return n[c].push({...g,titleColSpan:y,colStart:i,colEnd:B,hasChildren:m}),o[g.key]={colStart:i,colEnd:B},i+=y,y})}const a=t?[...e,t]:e;l(a,0,0);const r=n.length;return n.forEach((s,u)=>{s.forEach(c=>{c.hasChildren||(c.titleRowSpan=r-u)})}),{rows:n,offsetIndexMap:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Yt(e,t,n,o,l,a,r){const s=S(()=>{const m=t.value,C=n.value;return e.dataSource.map((B,T)=>ot(B,C,m,T,e.dataSource.length))}),u=S(()=>{const m=new Map;return Ke(s.value,m),m}),c=S(()=>rt(s.value,l.value,a.value)),i=S(()=>at(c.value,o.value,a.value)),d=S(()=>{const m=r.value,C=i.value;if(m===null||!m.pageSize)return C;{const{total:B}=m;if(B&&C.length<B)return C;const T=m.pageSize,f=(m.pageIndex-1)*T;return C.slice(f,f+T)}}),v=S(()=>{const m=new Map;return Ke(d.value,m),m}),g=S(()=>{const m=a.value;return m.length>0?st(d.value,m,0):d.value});return{isTreeData:S(()=>s.value.some(m=>{var C;return(C=m.children)==null?void 0:C.length})),filteredData:c,flattedData:g,mergedMap:u,paginatedMap:v}}function ot(e,t,n,o,l,a){var c;const r=t(e),s={record:e,rowKey:r,parentKey:a==null?void 0:a[0].rowKey,showLineIndentIndexList:(c=[...a!=null?a:[]].reverse())==null?void 0:c.reduce((i,d,v)=>(d.hasNextSibling&&i.push(v),i),[]),hasPrevSibling:o>0,hasNextSibling:o<l-1},u=e[n];return u&&(s.children=u.map((i,d)=>ot(i,t,n,d,u.length,[s,...a!=null?a:[]]))),s}function Ke(e,t){e.forEach(n=>{const{rowKey:o,children:l}=n;t.set(o,n),l&&Ke(l,t)})}function at(e,t,n){const o=t.filter(r=>r.sorter),l=o.length;if(l===0)return e;const a=e.slice();return a.forEach(r=>{n.includes(r.rowKey)&&r.children&&r.children.length>0&&(r.children=at(r.children,t,n))}),a.sort((r,s)=>{for(let u=0;u<l;u++){const{orderBy:c,sorter:i}=o[u],d=i(r.record,s.record);if(d!==0)return c==="ascend"?d:-d}return 0})}function rt(e,t,n){const o=t.filter(l=>l.filter);return o.length===0?e:e.map(l=>{const a=o.every(({filter:i,filterBy:d})=>i(d,l.record)),{rowKey:r,children:s}=l,u=n.includes(r);let c=l;if(u&&s&&s.length){const i=rt(s,t,n);i.length!==s.length&&(c={...l,children:i})}return a||u&&c.children&&c.children.length?c:null}).filter(l=>l!==null)}function st(e,t,n){return e.reduce((o,l)=>{const{children:a,parentKey:r,record:s,rowKey:u,hasPrevSibling:c,hasNextSibling:i,showLineIndentIndexList:d}=l,v=t.includes(u);if(o.push({children:a,parentKey:r,record:s,rowKey:u,level:n,expanded:v,hasPrevSibling:c,hasNextSibling:i,showLineIndentIndexList:d}),v&&l.children){const g=st(l.children,t,n+1);o.push(...g)}return o},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Zt(e,t){const n=S(()=>t.value.find(s=>"type"in s&&s.type==="expandable")),[o,l]=je(e,"expandedRowKeys",()=>[]);return{expandable:n,expandedRowKeys:o,setExpandedRowKeys:l,checkExpandDisabled:s=>{if(!n.value)return!0;const{disabled:u,customExpand:c}=n.value,{record:i}=s;return u!=null&&u(i)?!0:!(c||s.children&&s.children.length>0)},handleExpandChange:(s,u)=>{const{onChange:c,onExpand:i}=n.value||{},d=[...o.value],v=d.indexOf(s),g=v>=0;g?d.splice(v,1):d.push(s),j(i,!g,u),l(d),j(c,d)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Jt(e){const t=S(()=>e.value.filter(a=>a.filterable)),n=Ze({}),o=O([]);return N(t,(a,r)=>{a.forEach(s=>{const{key:u,filterable:c}=s,i=c.filterBy;if(i||n[u]===void 0){n[u]=i||[];return}const d=r?r.find(g=>g.key===u):void 0;(d==null?void 0:d.filterable.filterBy)&&(n[u]=[])}),o.value=Ae(a,n)},{immediate:!0}),{activeFilters:o,activeFilterByMap:n,handleFilter:(a,r,s)=>{const{onChange:u}=r;n[a]=s,o.value=Ae(t.value,n),j(u,s,o.value)}}}function Ae(e,t){return e.map(n=>{const{key:o,filterable:l}=n,{filter:a,filterBy:r=t[o]}=l;return{key:o,filter:a,filterBy:r}}).filter(n=>n.filter&&n.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Qt(e,t,n){var c,i,d,v,g;const o=Se("pagination"),l=S(()=>{const{pagination:y}=e;return y===!1?null:y===!0?{}:y}),a=O((i=(c=l.value)==null?void 0:c.pageIndex)!=null?i:1),r=O((g=(v=(d=l.value)==null?void 0:d.pageSize)!=null?v:t.pagination.pageSize)!=null?g:o.pageSize),s=(y,m)=>{var C;a.value=y,r.value=m,j((C=l.value)==null?void 0:C.onChange,y,m)};return{mergedPagination:S(()=>{var m,C;const y=l.value;return y===null?null:{...t.pagination,size:n.value,...y,pageIndex:(m=y.pageIndex)!=null?m:a.value,pageSize:(C=y.pageSize)!=null?C:r.value,onChange:s}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function en(e,t,{setStickyScrollLeft:n}){const o=O(),l=O(),a=O(),r=O(),s=O();N(o,B=>{B&&(a.value=B.getHolderElement())});const{handleScroll:u,pingedStart:c,pingedEnd:i}=tn(e,l,a,s,n),d=nn(e,t,a,r),v=S(()=>{var B;return U((B=e.scroll)==null?void 0:B.width)}),g=S(()=>{var T;let B=U((T=e.scroll)==null?void 0:T.height);return!B&&t.value&&(e.virtual||d.value)&&(B="auto"),B}),y=S(()=>Be(Q(a))),m=S(()=>g.value?y.value:0);return{virtualScrollRef:o,scrollHeadRef:l,scrollBodyRef:a,scrollContentRef:r,scrollFootRef:s,handleScroll:u,scrollTo:B=>{var T;e.virtual?(T=o.value)==null||T.scrollTo(B):typeof B=="number"&&Ct({target:Q(a),top:B,duration:200})},pingedStart:c,pingedEnd:i,scrollWidth:v,scrollHeight:g,scrollBarSize:y,scrollBarSizeOnFixedHolder:m}}function tn(e,t,n,o,l){const a=O(!1),r=O(!1);let s;const u=()=>{s&&(clearTimeout(s),s=void 0)};de(()=>u());const c=O(),i=y=>{c.value=y,u(),s=setTimeout(()=>{c.value=void 0,s=void 0},100)},d=(y,m)=>{m&&m.scrollLeft!==y&&(m.scrollLeft=y)},v=y=>{const m=Q(n);if(!m)return;const{clientWidth:C,scrollWidth:B}=m;l(y/B*C||0)};return{handleScroll:(y,m)=>{const C=y==null?void 0:y.currentTarget,B=m!=null?m:C.scrollLeft,T=c.value;if((!T||T===C)&&(i(C),d(B,t.value),d(B,Q(n)),d(B,o.value),v(B)),C){const{scrollWidth:f,clientWidth:h}=C;a.value=B>1,r.value=f-h-B>1}(y==null?void 0:y.type)==="scroll"&&j(e.onScroll,y)},pingedStart:a,pingedEnd:r}}function nn(e,t,n,o){const l=O(!0),a=()=>{const u=Q(n.value);u?l.value=u.scrollHeight>u.clientHeight:l.value=!1};let r=[];const s=()=>r.forEach(u=>u());return ge(()=>{N([t,()=>e.virtual],([u,c])=>{s(),u&&!c&&(r=[ke(n,a),ke(o,a)])},{immediate:!0})}),de(()=>s()),l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ln(e,t,n,o,l,a){const r=S(()=>{var i;return(i=e.scrollToTopOnChange)!=null?i:t.scrollToTopOnChange});let s=[];const u=()=>{s=[N([()=>{var i;return(i=n.value)==null?void 0:i.pageIndex},()=>{var i;return(i=n.value)==null?void 0:i.pageSize}],()=>a(0)),N([l,o],([i,d],[v,g])=>{(!on(i,v)||!an(d,g))&&a(0)})]},c=()=>{s.forEach(i=>i())};N(r,i=>{c(),i&&u()},{immediate:!0})}function on(e,t){return e.length===t.length&&e.every(n=>{const o=t.find(l=>l.key===n.key);return o?n.filter===o.filter&&n.filterBy.length===o.filterBy.length&&n.filterBy.every(l=>o.filterBy.includes(l)):!1})}function an(e,t){return e.length===t.length&&e.every(n=>{const o=t.find(l=>l.key===n.key);return o?n.sorter===o.sorter&&n.orderBy===o.orderBy&&n.multiple===o.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rn(e,t,n,{mergedMap:o,paginatedMap:l}){const a=S(()=>n.value.find(f=>"type"in f&&f.type==="selectable")),[r,s]=je(e,"selectedRowKeys",()=>[]),u=S(()=>{const{disabled:f}=a.value||{},h=[],p=[];return l.value.forEach((k,w)=>{f!=null&&f(k.record)?p.push(w):h.push(w)}),{enabledRowKeys:h,disabledRowKeys:p}}),c=S(()=>{const f=new Set,h=r.value,{disabledRowKeys:p}=u.value,k=o.value;return h.forEach(w=>{const{parentKey:K}=k.get(w)||{};if(!ie(K)){let x=k.get(K);if(x&&!h.includes(x.rowKey))for(;x&&!ie(x==null?void 0:x.rowKey);)p.includes(x.rowKey)||f.add(x.rowKey),x=ie(x.parentKey)?void 0:k.get(x.parentKey)}}),[...f]}),i=S(()=>{const f=r.value,{disabledRowKeys:h}=u.value;let p=0;return l.value.forEach((k,w)=>{!h.includes(w)&&f.includes(w)&&p++},0),p}),d=S(()=>{const f=l.value.size,h=u.value.disabledRowKeys.length;return f===0||f===h?!1:f===h+i.value}),v=S(()=>!d.value&&i.value>0),g=new Map,y=f=>{s(f);const h=o.value,{onChange:p}=a.value||{};if(p){const k=[];g.forEach((w,K)=>{f.includes(K)||g.delete(K)}),f.forEach(w=>{let K=h.get(w);K?g.set(w,K):K=g.get(w),K&&k.push(K.record)}),j(p,f,k)}},m=(f,h)=>{const p=o.value,{disabledRowKeys:k}=u.value,{multiple:w,onSelect:K}=a.value||{};let x=[...r.value];const $=x.indexOf(f),R=$>=0;if(w){const P=p.get(f),W=ct(P,k);if(R){x.splice($,1);const A=sn(p,P,k);x=x.filter(z=>!A.includes(z)&&!W.includes(z))}else x.push(f),x.push(...W);cn(p,P,x,k)}else x=R?[]:[f];j(K,!R,h),y(x)},C=()=>{const{enabledRowKeys:f}=u.value,h=new Set(r.value);d.value?f.forEach(p=>h.delete(p)):f.forEach(p=>h.add(p)),y([...h])},B=un(a,t),T=dn(a,o,l,r,y);return{selectable:a,selectedRowKeys:r,indeterminateRowKeys:c,currentPageRowKeys:u,currentPageAllSelected:d,currentPageSomeSelected:v,handleSelectChange:m,handleHeadSelectChange:C,mergedSelectableMenus:B,handleSelectableMenuClick:T}}function ct(e,t){const n=[],{children:o}=e||{};return o&&o.forEach(l=>{const{rowKey:a}=l;t.includes(a)||n.push(l.rowKey),n.push(...ct(l,t))}),n}function sn(e,t,n){const o=[];for(;t!=null&&t.parentKey;){const{parentKey:l}=t;n.includes(t.parentKey)||o.push(l),t=e.get(l)}return o}function cn(e,t,n,o){let l=!0;for(;l&&t&&!ie(t.parentKey);){const a=e.get(t.parentKey);if(a&&!o.includes(t.parentKey)){l=a.children.every(s=>o.includes(s.rowKey)||n.includes(s.rowKey));const r=n.findIndex(s=>s===t.parentKey);l?r<0&&n.push(t.parentKey):r>-1&&n.splice(r,1)}t=a}}const it=Symbol("IDUX_TABLE_KEY_selectable-all"),ut=Symbol("IDUX_TABLE_KEY_selectable-invert"),dt=Symbol("IDUX_TABLE_KEY_selectable-none"),ft=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function un(e,t){return S(()=>{const{menus:n}=e.value||{};if(!n||n.length===0)return[];const{selectAll:o,selectInvert:l,selectNone:a,selectPageInvert:r}=t.table;return n.map(s=>q(s)?s==="all"?{type:"item",key:it,label:o}:s==="invert"?{type:"item",key:ut,label:l}:s==="none"?{type:"item",key:dt,label:a}:s==="pageInvert"?{type:"item",key:ft,label:r}:{type:"item",key:s,label:s}:s)})}function dn(e,t,n,o,l){const a=()=>{const{disabled:i,onSelectAll:d}=e.value||{},v=[];t.value.forEach((g,y)=>{i!=null&&i(g.record)||v.push(y)}),j(d,v),l(v)},r=()=>{const{disabled:i,onSelectInvert:d}=e.value||{},v=[...o.value];t.value.forEach((g,y)=>{if(i!=null&&i(g.record))return;const m=v.indexOf(y);m>=0?v.splice(m,1):v.push(y)}),l(v),j(d,v)},s=()=>{const{onSelectNone:i}=e.value||{};j(i),l([])},u=()=>{const{disabled:i,onSelectPageInvert:d}=e.value||{},v=[],g=o.value;n.value.forEach((y,m)=>{i!=null&&i(y.record)||g.includes(m)||v.push(m)}),j(d,v),l(v)},c=new Map([[it,a],[ut,r],[dt,s],[ft,u]]);return i=>{const d=i.key;if(zt(d)&&c.has(d)){c.get(d)();return}const{disabled:v,onMenuClick:g}=e.value||{};if(!g)return;const y=[];n.value.forEach((m,C)=>{v!=null&&v(m.record)||y.push(C)}),j(g,i,y)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function fn(e){const t=S(()=>e.value.filter(r=>r.sortable)),n=S(()=>t.value.some(r=>r.sortable.multiple!==void 0)),o=Ze({}),l=O([]);return N(t,(r,s)=>{r.forEach(u=>{const{key:c,sortable:i}=u,d=i.orderBy;if(d||o[c]===void 0){o[c]=d;return}const v=s?s.find(y=>y.key===c):void 0;(v==null?void 0:v.sortable.orderBy)&&(o[c]=void 0)}),l.value=Ne(r,o)},{immediate:!0}),{activeSorters:l,activeOrderByMap:o,handleSort:(r,s)=>{const{orders:u,onChange:c}=s,i=o[r],d=i?Le(u,i):Le(u);n.value?o[r]=d:Object.keys(o).forEach(v=>{r===v?o[v]=d:o[v]=void 0}),l.value=Ne(t.value,o),j(c,d,l.value)}}}function Le(e,t){return t?e[e.indexOf(t)+1]:e[0]}function Ne(e,t){return e.map(n=>{const{key:o,sortable:l}=n,{multiple:a=0,orderBy:r=t[o],sorter:s}=l;return{key:o,multiple:a,orderBy:r,sorter:s}}).filter(n=>n.orderBy).sort((n,o)=>o.multiple-n.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function vn(e){const t=S(()=>!!e.sticky),n=S(()=>{const{sticky:a}=e,{offsetTop:r=0,offsetBottom:s=0,offsetScroll:u=0,container:c=window}=Ft(a)?a:{};return{offsetTop:r,offsetBottom:s,offsetScroll:u,container:c}}),[o,l]=xe(0);return{isSticky:t,mergedSticky:n,stickyScrollLeft:o,setStickyScrollLeft:l}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function hn(e,{hasEllipsis:t,hasFixed:n},{scrollWidth:o,scrollHeight:l},a,r,s){return S(()=>e.tableLayout?e.tableLayout:o.value&&n.value?o.value==="max-content"?"auto":"fixed":l.value||s.value||a.value||t.value||r.value.horizontal||r.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const L=Symbol("TABLE_TOKEN"),We=Symbol("tableBodyToken"),vt=Symbol("tableBodyRowToken"),he=M({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:n,columnWidthMap:o,mergedSelectableMenus:l,mergedPrefixCls:a}=F(L),r=S(()=>{const{isFixedHolder:s,columns:u}=e;return u||(s?n.value:t.value)});return()=>{if(r.value.every(c=>!c.width&&!c.type))return;const s=a.value,u=r.value.map(c=>{var m;const{key:i,type:d}=c,v=(m=c.width)!=null?m:o.value[i],g=d?le({[`${s}-col-${d}`]:!0,[`${s}-col-with-dropdown`]:d==="selectable"&&l.value.length>0}):void 0,y={width:U(v),minWidth:U(c.minWidth),maxWidth:U(c.maxWidth)};return b("col",{key:i,class:g,style:y},null)});return b("colgroup",null,[u])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const yn={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},gn={columns:{type:Array,required:!0}},pn={column:{type:Object,required:!0}},mn={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},bn={column:{type:Object,required:!0},colIndex:{type:Number,required:!0},colSpan:Number,rowSpan:Number},Sn={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},xn={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},Cn={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},wn=M({props:xn,setup(e){const{slots:t,config:n,locale:o,mergedPrefixCls:l}=F(L),a=S(()=>{var f;return(f=e.filterable.multiple)!=null?f:n.columnBase.filterable.multiple}),r=S(()=>{var f;return(f=e.filterable.footer)!=null?f:n.columnBase.filterable.footer}),s=e.activeFilterBy,[u,c]=xe(()=>s);N(()=>e.activeFilterBy,f=>c(f));const[i,d]=xe(!1),v=f=>{d(f),f||e.onUpdateFilterBy(u.value)},g=()=>{d(!1),e.onUpdateFilterBy(u.value)},y=()=>{c(s)},m=f=>{const h=`${l.value}-filterable-menu-label`,p=a.value?Ie:Je;return b("span",{class:h},[b(p,{checked:f.selected,disabled:f.disabled},null),b("span",{class:`${h}-content`},[f.label])])},C=()=>{const f=[],{customMenu:h,menus:p}=e.filterable;return ue(h)?f.push(h({selectedKeys:u.value,setSelectedKeys:c})):q(h)&&t[h]?f.push(t[h]({selectedKeys:u.value,setSelectedKeys:c})):f.push(Bn(p,a,u,c,m)),r.value&&f.push(kn(o,l,g,y)),f},B=S(()=>{const f=`${l.value}-filterable-trigger`;return le({[f]:!0,[`${f}-active`]:e.activeFilterBy.length>0})}),T=()=>{const{customTrigger:f}=e.filterable;return ue(f)?f():q(f)&&t[f]?t[f]():b("span",{class:B.value,onClick:h=>h.stopPropagation()},[b(ye,{name:"filter-filled"},null)])};return()=>{const f={visible:i.value,hideOnClick:!r.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":v};return b(Ve,f,{default:T,overlay:C})}}}),Bn=(e,t,n,o,l)=>{const a={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:n.value,"onUpdate:selectedKeys":o};return b(Ue,a,{itemLabel:l})},kn=(e,t,n,o)=>{const{filterConfirm:l,filterReset:a}=e.table;return b("div",{class:`${t.value}-filterable-trigger-footer`},[b(He,{mode:"primary",size:"xs",onClick:n},{default:()=>[l]}),b(He,{size:"xs",onClick:o},{default:()=>[a]})])},Kn=M({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:n,currentPageRowKeys:o,currentPageAllSelected:l,currentPageSomeSelected:a,handleHeadSelectChange:r,mergedSelectableMenus:s,handleSelectableMenuClick:u}=F(L),c=S(()=>{const C=t.value.size;return C===0||C===o.value.disabledRowKeys.length}),[i,d]=xe(!1),v={"onUpdate:visible":d,trigger:"click"},g=()=>b(Ue,{dataSource:s.value,onClick:u},null),y=()=>b(ye,{class:`${e.value}-selectable-trigger`,name:"down",rotate:i.value?180:0},null),m=()=>{if(s.value.length!==0)return b(Ve,v,{default:y,overlay:g})};return()=>{const{multiple:C}=n.value;if(C)return b("span",{class:`${e.value}-cell-triggers`},[b(Ie,{checked:l.value,indeterminate:a.value,disabled:c.value,onChange:r},null),m()])}}}),Tn=M({props:Cn,setup(e){const{locale:t,mergedPrefixCls:n}=F(L);return()=>{const{activeOrderBy:o,sortable:l}=e,{orders:a,nextTooltip:r}=l,s=r&&En(t.table,a,o),u=$n(n,a,o);return s?b(wt,{title:s},{default:()=>[u]}):u}}});function En(e,t,n){const o=n?t[t.indexOf(n)+1]:t[0],{sortCancel:l,sortAsc:a,sortDesc:r}=e;return o?o==="ascend"?a:r:l}function $n(e,t,n){const o=e.value,l=`${o}-sortable-trigger-active`,a=t.includes("ascend")&&b(ye,{name:"caret-up-filled",class:n==="ascend"?l:void 0},null),r=t.includes("descend")&&b(ye,{name:"caret-down-filled",class:n==="descend"?l:void 0},null);return b("span",{class:`${o}-sortable-trigger`},[a,r])}const In=M({props:pn,setup(e){const{props:t,slots:n,mergedPrefixCls:o,fixedColumnKeys:l,columnOffsetsWithScrollBar:a,isSticky:r,handleSort:s,activeOrderByMap:u,activeFilterByMap:c,mergedRows:i,handleFilter:d}=F(L),v=S(()=>{const{type:f,ellipsis:h}=e.column,p=f||h!=null?h:t.ellipsis;return Xe(p)&&p.head===!1?void 0:p}),g=S(()=>{const{type:f,align:h,fixed:p,hasChildren:k,key:w,sortable:K,filterable:x}=e.column,$=o.value;let R={[`${$}-cell`]:!0,[`${$}-cell-${f}`]:!!f,[`${$}-cell-filterable`]:!!x,[`${$}-cell-sortable`]:!!K,[`${$}-cell-align-center`]:k||h==="center",[`${$}-cell-align-end`]:!k&&h==="end",[`${$}-cell-ellipsis`]:!!v.value};if(p){const{lastStartKey:P,firstEndKey:W}=l.value;R={...R,[`${$}-fix-start`]:p==="start",[`${$}-fix-start-last`]:P===w,[`${$}-fix-end`]:p==="end",[`${$}-fix-end-first`]:W===w,[`${$}-fix-sticky`]:r.value}}return le(R)}),y=S(()=>{var R;const{key:f,fixed:h}=e.column,{offsetIndexMap:p}=i.value;if(!h)return;const{starts:k,ends:w}=a.value,K=Object.values(h==="start"?k:w),x=p[f][h==="start"?"colStart":"colEnd"],$=U((R=K.find(P=>P.index===x))==null?void 0:R.offset);return{position:"sticky",left:h==="start"?$:void 0,right:h==="end"?$:void 0}}),m=S(()=>u[e.column.key]),C=S(()=>c[e.column.key]||Bt),B=f=>{const{key:h,filterable:p}=e.column;d(h,p,f)},T=()=>{const{key:f,sortable:h}=e.column;h&&s(f,h)};return()=>{var W,A,z;const{column:f}=e,{type:h,titleColSpan:p,titleRowSpan:k}=f;if(h==="scroll-bar")return b("th",{class:g.value,style:y.value,colspan:p===1?void 0:p,rowspan:k===1?void 0:k,onClick:T},null);const w=o.value;let K,x;if(h==="selectable")x=b(Kn,null,null);else{const{title:V,customTitle:ee,sortable:Z,filterable:I}=f,te=v.value;x=Rn(V,ee,n),K=et(te,x,V);const X=Pn(Z,m,I,C,B);X.length>0?x=b("span",{class:`${w}-cell-triggers`},[b("span",{class:`${w}-cell-title`},[x]),X]):te&&(x=b("span",{class:`${w}-cell-title`},[x]))}const $=(W=t.customAdditional)==null?void 0:W.headCell,R=$?$({column:f}):void 0,P=(z=(A=t.customTag)==null?void 0:A.headCell)!=null?z:"th";return b(P,fe({class:g.value,style:y.value,colSpan:p===1?void 0:p,rowSpan:k===1?void 0:k,title:K},R,{onClick:T}),{default:()=>[x]})}}});function Rn(e,t,n){let o=e;return ue(t)?o=t({title:e}):q(t)&&n[t]&&(o=n[t]({title:e})),o}function Pn(e,t,n,o,l){const a=[];return e&&a.push(b(Tn,{activeOrderBy:t.value,sortable:e},null)),n&&a.push(b(wn,{activeFilterBy:o.value,filterable:n,onUpdateFilterBy:l},null)),a}function On(e){return e.map(t=>ht(t)).filter(Boolean)}function ht(e){if(e.titleColSpan!==0)return b(In,{key:e.key,column:e},null)}const Wn=M({props:gn,setup(e,{slots:t}){const{props:n,mergedPrefixCls:o}=F(L);return()=>{var u,c,i;const{columns:l}=e,a=(u=n.customAdditional)==null?void 0:u.headRow,r=a?a({columns:l}):void 0,s=(i=(c=n.customTag)==null?void 0:c.headRow)!=null?i:"tr";return b(s,fe({class:`${o.value}-row`},r),{default:()=>{var d;return[(d=t.default)==null?void 0:d.call(t)]}})}}});function yt(e,t,n){return b(Wn,{columns:e,key:t},{default:()=>[n]})}const Te=M({setup(e,{slots:t}){const{props:n,mergedRows:o,mergedPrefixCls:l}=F(L);return()=>{var i,d,v;let a;const{rows:r}=o.value,s=(i=n.customAdditional)==null?void 0:i.head,u=s?s({rows:r}):void 0,c=(v=(d=n.customTag)==null?void 0:d.head)!=null?v:"thead";return t.default?a=t.default():a=r.map((g,y)=>{const m=On(g);return yt(g,y,m)}),b(c,fe({class:`${l.value}-thead`},u),{default:()=>[a]})}}}),Hn=M({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:n,mergedVirtual:o,mergedVirtualColWidth:l,scrollHeadRef:a,handleScroll:r,scrollWidth:s,flattedData:u,flattedColumns:c,fixedColumns:i,mergedRows:d,isSticky:v,columnWidths:g}=F(L),y=O();ge(()=>{N(y,p=>{p&&(a.value=p.getHolderElement(),a.value.style.overflow="hidden")},{immediate:!0})}),zn(a,r);const m=S(()=>s.value==="max-content"),C=S(()=>u.value.length>0),B=S(()=>{const p=n.value;return{[`${p}-fixed-holder`]:!0,[`${p}-sticky-holder`]:v.value}}),T=S(()=>{const p=v.value,{offsetTop:k,offsetBottom:w}=e;return{overflow:"hidden",top:p?U(k):void 0,bottom:p?U(w):void 0}}),f=S(()=>({tableLayout:"fixed",visibility:C.value&&s.value&&!g.value.length?"hidden":void 0})),h=S(()=>o.value.horizontal?d.value.rows.map((p,k)=>({key:k,data:p})):[]);return()=>{const p=C.value||!m.value;if(o.value.horizontal){const k=(P,{renderedData:W})=>{let A=[];if(p){const z=[];W.forEach(V=>{z.push(...V.data)}),A=Oe(z)}return b("table",{style:f.value},[p&&b(he,{columns:A,isFixedHolder:!0},null),b(Te,null,{default:()=>[P]})])},w=({item:P,index:W,children:A})=>yt(P.data,W,A),K=({item:P})=>ht(P),x=(P,W)=>{const{fixedStartColumns:A,fixedEndColumns:z}=i.value;return tt(P,W,c.value,u.value,A,z,!0)},{virtualBufferSize:$,virtualBufferOffset:R}=t;return b("div",{class:B.value,style:T.value},[b(qe,{ref:y,dataSource:h.value,colModifier:x,getKey:"key",height:0,width:"100%",colWidth:l.value,rowRender:w,colRender:K,contentRender:k,virtual:{horizontal:!0,vertical:!1},bufferSize:$,bufferOffset:R},null)])}return b("div",{class:B.value,style:T.value,ref:a},[b("table",{style:f.value},[p&&b(he,{isFixedHolder:!0},null),b(Te,null,null)])])}}});function zn(e,t){const n=a=>{if(!a.shiftKey)return;const r=a.deltaY,s=a.currentTarget;if(r){const u=s.scrollLeft+r;t(a,u)}},o=a=>{ve(a,"wheel",n,{passive:!0})},l=a=>{ce(a,"wheel",n)};ge(()=>{N(e,(a,r)=>{l(r),o(a)},{immediate:!0})}),de(()=>l(e.value))}const Fn=M({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:n,mergedSticky:o,stickyScrollLeft:l,setStickyScrollLeft:a}=F(L),r=O(!1),s=O(!1),u=O(0),c=O(0),i=O(0),d=S(()=>{const f=c.value,h=i.value;return h&&f*(f/h)});Ye(()=>{const f=Q(t);if(f&&r.value){const{clientWidth:h,scrollWidth:p,scrollLeft:k}=f;a(k/p*h),c.value=h,i.value=p}});const v=S(()=>({height:Be(),width:c.value,bottom:o.value.offsetScroll})),g=S(()=>{const f=e.value;return{[`${f}-sticky-scrollbar-thumb`]:!0,[`${f}-sticky-scrollbar-thumb-active`]:s.value}}),y=S(()=>({width:`${d.value}px`,transform:`translate3d(${l.value}px, 0, 0)`})),m=()=>s.value=!1,C=f=>{u.value=f.pageX-l.value,s.value=!0,f.preventDefault()},B=f=>{if(!s.value)return;const{buttons:h}=f||window.event;if(h===0){s.value=!1;return}let p=f.pageX-u.value;p<=0&&(p=0);const k=c.value,w=i.value,K=d.value;p+K>=k&&(p=k-K);const x=p/k*(w+2);n(f,x)},T=()=>{const f=Q(t),h=ze(f).top,p=h+f.offsetHeight,{container:k,offsetScroll:w}=o.value,K=k===window?document.documentElement.scrollTop+window.innerHeight:ze(k).top+k.clientHeight;p-Be()<=K||h>=K-w?r.value=!1:r.value=!0};return ge(()=>{ve(document.body,"mouseup",m),ve(document.body,"mousemove",B),ve(window,"resize",T),N(()=>o.value.container,(f,h)=>{ce(h,"scroll",T),ve(f,"scroll",T)},{immediate:!0}),T()}),de(()=>{ce(document.body,"mouseup",m),ce(document.body,"mousemove",B),ce(window,"resize",T),ce(o.value.container,"scroll",T)}),()=>!t.value||!r.value||i.value<=c.value||!d.value?null:b("div",{class:`${e.value}-sticky-scrollbar`,style:v.value},[b("div",{class:g.value,style:y.value,onMousedown:C},null)])}}),Ee=M({props:{isEmpty:Boolean},setup(e,{slots:t}){const{mergedPrefixCls:n,flattedColumns:o,hasFixed:l,scrollWidth:a,scrollBarColumn:r}=F(L),{mainTableWidth:s}=F(We),u=S(()=>o.value.length);return()=>{let c=t.default();if(e.isEmpty?a.value:l.value){const i=r.value;c=b("div",{class:`${n.value}-fixed-row`,style:{width:U(s.value-(i?i.width:0)),position:"sticky",left:0,overflow:"hidden"}},[c])}return b("tr",null,[b("td",{colSpan:u.value},[c])])}}}),Mn=M({setup(e,{slots:t}){const{props:n,slots:o,mergedPrefixCls:l,flattedData:a}=F(L);return()=>{const r=l.value,s=[];return o.alert&&s.push(b(Ee,{class:`${r}-alert-row`},{default:()=>[o.alert()]})),a.value.length>0?t.default&&s.push(...t.default()):s.push(b(Ee,{class:`${r}-empty-row`,isEmpty:!0},{default:()=>[b(kt,{empty:n.empty},o)]})),b("tbody",{class:`${l.value}-tbody`},[s])}}}),An=M({props:Sn,setup(e){const t=O();return ke(t,o=>{const{contentRect:{width:l}}=o;e.changeColumnWidth(e.cellKey,l)}),de(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>b("td",{ref:t,style:{padding:0,border:0,height:0}},[b("div",{style:{height:0,overflow:"hidden"}},[Mt("Â ")])])}}),Ln=M({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=F(L),{changeColumnWidth:n}=F(We);return()=>{var l;const o=(l=e.columns)==null?void 0:l.map(a=>{const{key:r}=a;return b(An,{key:r,cellKey:r,changeColumnWidth:n},null)});return b("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[o])}}}),Nn=M({props:bn,setup(e){const{props:t,slots:n,config:o,mergedPrefixCls:l,mergedEmptyCell:a,activeOrderByMap:r,fixedColumnKeys:s,columnOffsets:u,isSticky:c,isTreeData:i,expandable:d,selectable:v,mergedPagination:g}=F(L),y=F(vt),m=y.props,C=S(()=>r[e.column.key]),B=Dn(y,e),T=S(()=>s.value.lastStartKey===e.column.key),f=S(()=>s.value.firstEndKey===e.column.key),h=S(()=>{const{type:w,ellipsis:K}=e.column;return w||K!=null?K:t.ellipsis}),p=S(()=>{const{fixed:w,align:K}=e.column,x=l.value;let $={[`${x}-cell`]:!0,[`${x}-cell-sorted`]:!!C.value,[`${x}-cell-align-${K}`]:!!K&&K!="start",[`${x}-cell-ellipsis`]:!!h.value};return w&&($={...$,[`${x}-fix-start`]:w==="start",[`${x}-fix-start-last`]:T.value,[`${x}-fix-end`]:w==="end",[`${x}-fix-end-first`]:f.value,[`${x}-fix-sticky`]:c.value}),le($)}),k=S(()=>{const{fixed:w}=e.column;if(!w)return;const{starts:K,ends:x}=u.value,R=U((w==="start"?K:x)[e.column.key].offset);return{position:"sticky",left:w==="start"?R:void 0,right:w==="end"?R:void 0}});return()=>{var z,V,ee;const{column:w}=e,{type:K}=w;let x,$;if(K==="selectable")x=Vn(y,n,v,o,g);else if(K==="indexable")x=gt(y,n,w,g);else{const Z=B.value;if(x=_n(y,e,n,Z),$=et(h.value,x,Z),!K&&(ie(x)||x==="")){const I=n.emptyCell||a.value;x=ue(I)?I({column:w,record:m.record,rowIndex:m.rowIndex}):I}}e.column.fixed&&h.value&&(T.value||f.value)&&(x=b("span",{class:`${l.value}-cell-content`},[x]));const R=(z=t.customAdditional)==null?void 0:z.bodyCell,P=R?R({column:w,record:m.record,rowIndex:m.rowIndex}):void 0,W=(ee=(V=t.customTag)==null?void 0:V.bodyCell)!=null?ee:"td",A=K==="expandable"?b("div",{class:`${l.value}-expandable-wrapper`},[jn(y,n,d,i,l.value),!Kt(x)&&b("span",{class:`${l.value}-expandable-trigger-gap`},null),x]):x;return b(W,fe({class:p.value,style:k.value,title:$,colSpan:e.colSpan,rowSpan:e.rowSpan},P),{default:()=>[A]})}}});function Dn(e,t){return S(()=>{const{props:{record:n}}=e,{column:o}=t,l=$e(o.dataKey);if(l.length<=0)return;let a=n;for(let r=0;r<l.length&&a;r++){const s=l[r];a=a[s]}return a})}function _n(e,t,n,o){const{props:{record:l,rowIndex:a}}=e,{column:r}=t,{customCell:s}=r,u=q(s)?n[s]:s;return u?u({value:o,record:l,rowIndex:a}):o}function jn(e,t,n,o,l){var K;const{icon:a,customIcon:r,indent:s,showLine:u}=n.value,{props:{record:c,expanded:i,level:d=0,hasPrevSibling:v,hasNextSibling:g,showLineIndentIndexList:y},expandDisabled:m,handleExpend:C}=e,B=d>0,T=o.value&&u&&s;let f;const h=(K=q(r)?t[r]:r)!=null?K:a;ue(h)?f=h({expanded:!!i,record:c}):f=q(h)?b(ye,{name:h,rotate:i?90:0},null):h;const p=s?`width: ${U(s)}`:void 0,k={[`${l}-expandable-trigger`]:!0,[`${l}-expandable-trigger-show-line`]:T,[`${l}-expandable-trigger-disabled`]:m.value},w=[];if(s)for(let x=0;x<d;x++)w.push(b("div",{class:{[`${l}-expandable-indent`]:!0,[`${l}-expandable-indent-show-line`]:T&&y.includes(x)},style:p},null));return[...w,b("span",{class:k,style:p},[b("button",{class:`${l}-expandable-trigger-button`,type:"button",onClick:m.value?void 0:C},[f]),T&&[b("span",{class:`${l}-expandable-trigger-line-right`},null),(v||B)&&b("span",{class:`${l}-expandable-trigger-line-top`},null),g&&b("span",{class:`${l}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function Vn(e,t,n,o,l){const{props:{record:a,rowIndex:r},isSelected:s,isIndeterminate:u,selectDisabled:c,isHover:i,handleSelect:d}=e,{showIndex:v,multiple:g,customCell:y}=n.value,m=B=>{B.stopPropagation(),!g&&s.value&&!c.value&&d&&d()};if(!s.value&&!i&&v)return gt(e,t,o.columnIndexable,l);const C=q(y)?t[y]:y;if(g){const B={checked:s.value,disabled:c.value,indeterminate:u.value,onChange:d,onClick:m};return C?C({...B,record:a,rowIndex:r}):b(Ie,B,null)}else{const B={checked:s.value,disabled:c.value,onChange:d,onClick:m};return C?C({...B,record:a,rowIndex:r}):b(Je,B,null)}}function gt(e,t,n,o){const{props:{record:l,rowIndex:a},selectDisabled:r}=e,{customCell:s}=n,{pageIndex:u=1,pageSize:c=0}=o.value||{},i=q(s)?t[s]:s;if(!i)return;const d=r.value?"cursor: not-allowed":"cursor: pointer";return b("span",{style:d},[i({record:l,rowIndex:a,pageIndex:u,pageSize:c})])}function Un(e,t,n){const o=[];return e.forEach((l,a)=>{const r=pt(l,t,n,a);r&&o.push(r)}),o}function pt(e,t,n,o){const{colSpan:l,rowSpan:a}=e,r=l==null?void 0:l(t,n),s=a==null?void 0:a(t,n);return r===0||s===0?void 0:b(Nn,{colSpan:r===1?void 0:r,rowSpan:s===1?void 0:s,colIndex:o,column:e},null)}const qn=M({props:mn,setup(e,{slots:t}){const{props:n,mergedPrefixCls:o,expandable:l,handleExpandChange:a,checkExpandDisabled:r,selectable:s,selectedRowKeys:u,indeterminateRowKeys:c,handleSelectChange:i,currentPageRowKeys:d}=F(L),{expandDisabled:v,handleExpend:g,selectDisabled:y,handleSelect:m,isHover:C,attrs:B}=Xn(e,l,r,a,s,i,d),T=S(()=>u.value.includes(e.rowKey)),f=S(()=>c.value.includes(e.rowKey)),h=S(()=>{const p=`${o.value}-row`,{level:k,expanded:w}=e;return le({[`${p}`]:!0,[`${p}-level-${k}`]:!!k,[`${p}-selected`]:T.value,[`${p}-expanded`]:w})});return Re(vt,{props:e,expandDisabled:v,handleExpend:g,isSelected:T,isIndeterminate:f,selectDisabled:y,handleSelect:m,isHover:C}),()=>{var K,x,$;const p=(K=n.customAdditional)==null?void 0:K.bodyRow,k=p?p({record:e.record,rowIndex:e.rowIndex}):void 0,w=($=(x=n.customTag)==null?void 0:x.bodyRow)!=null?$:"tr";return b(w,fe({class:h.value},B.value,k),{default:()=>{var R;return[(R=t.default)==null?void 0:R.call(t)]}})}}});function Xn(e,t,n,o,l,a,r){const s=S(()=>n(e.rowData)),u=S(()=>{var h;return(h=t.value)==null?void 0:h.trigger}),c=()=>{const{rowKey:h,record:p}=e;o(h,p)},i=S(()=>r.value.disabledRowKeys.includes(e.rowKey)),d=S(()=>{var h;return(h=l.value)==null?void 0:h.trigger}),v=S(()=>{var h;return(h=l.value)==null?void 0:h.showIndex}),g=O(!1),y=()=>{const{rowKey:h,record:p}=e;a(h,p)},m=()=>{u.value==="click"&&c(),d.value==="click"&&y()},C=()=>{u.value==="dblclick"&&c(),d.value==="dblclick"&&y()},B=()=>g.value=!0,T=()=>g.value=!1,f=S(()=>{const h=s.value,p=u.value,k=i.value,w=d.value,K=!h&&p==="click"||!k&&w==="click",x=!h&&p==="dblclick"||!k&&w==="dblclick",$=!k&&v.value;let R="";return K||x?R="pointer":(h&&p||k&&w)&&(R="not-allowed"),{style:R?`cursor: ${R}`:void 0,onClick:K?m:void 0,onDblclick:x?C:void 0,onMouseenter:$?B:void 0,onMouseleave:$?T:void 0}});return{expandDisabled:s,handleExpend:c,selectDisabled:i,handleSelect:y,isHover:g,attrs:f}}function De(e,t,n,o,l,a){const{children:r,expanded:s,level:u,hasPrevSibling:c,hasNextSibling:i,showLineIndentIndexList:d,record:v,rowKey:g}=e,y={key:g,expanded:s,level:u,hasPrevSibling:c,hasNextSibling:i,showLineIndentIndexList:d,hasChildren:!!(r!=null&&r.length),record:v,rowData:e,rowIndex:t,rowKey:g},m=b(qn,y,{default:()=>[a]}),C=s&&Gn(y,n,o,l);return C?[m,C]:m}function Gn(e,t,n,o){const{customExpand:l}=n||{},{record:a,rowIndex:r}=e;let s;return ue(l)?s=l({record:a,rowIndex:r}):q(l)&&t[l]&&(s=t[l]({record:a,rowIndex:r})),s&&b(Ee,{class:`${o}-expanded-row`},{default:()=>[s]})}const Yn=M({setup(){const{props:e,slots:t,expandable:n,mergedPrefixCls:o,mergedInsetShadow:l,mergedVirtual:a,mergedVirtualItemHeight:r,mergedVirtualColWidth:s,mergedAutoHeight:u,columnWidths:c,changeColumnWidth:i,clearColumnWidth:d,flattedData:v,flattedColumns:g,fixedColumns:y,isSticky:m,mergedSticky:C,virtualScrollRef:B,scrollBodyRef:T,scrollContentRef:f,handleScroll:h,pingedStart:p,pingedEnd:k,scrollWidth:w,scrollHeight:K,hasFixed:x,tableLayout:$}=F(L),R=O(),P=O(0),W=S(()=>u.value||!!w.value||m.value||a.value.horizontal);Re(We,{mainTableWidth:P,changeColumnWidth:(E,H)=>{$t(R.value)&&i(E,H)}});const z=()=>{const E=Q(T);E&&h({currentTarget:E})},V=E=>{const{offsetWidth:H}=E.target;H!==P.value&&(P.value=H)};ge(()=>{z(),N(()=>g.value.length,()=>{d()}),N([()=>e.dataSource,w],([,H])=>{H&&z()}),N(c,Ge(()=>{var D;((D=Q(T))==null?void 0:D.scrollLeft)===0&&z()},16)),Tt(R.value,V)}),de(()=>Et(R.value,V));const ee=S(()=>{const E=o.value;return le({[`${E}-container`]:!0,[`${E}-ping-start`]:p.value,[`${E}-ping-end`]:k.value,[`${E}-fixed-layout`]:$.value==="fixed",[`${E}-fixed-column`]:x.value,[`${E}-inset-shadow`]:l.value,[`${E}-scroll-horizontal`]:w.value,[`${E}-scroll-vertical`]:K.value})}),Z=S(()=>{var ne;const E=w.value,H=K.value,D=E?"auto":void 0,_=e.virtual?"hidden":H?"scroll":E?"hidden":void 0,ae=(ne=e.scroll)==null?void 0:ne.fullHeight;return{overflowX:D,overflowY:_,[ae?"height":"maxHeight"]:H}}),I=S(()=>({tableLayout:$.value,width:w.value,minWidth:w.value?"100%":void 0})),te=(E,H,D)=>{j(e.onScrolledChange,E,H,D.map(_=>_.record))},X=S(()=>!a.value.vertical&&!a.value.horizontal?[]:v.value.map(E=>({...E,data:g.value}))),Ce=E=>{if(!(!W.value||!E))return b(Ln,{columns:E},null)},pe=(E,H,D)=>{let _;if(D)_=D;else{const ae=[];H==null||H.forEach((ne,be)=>{const we=Un(E!=null?E:[],ne,be);ae.push(...$e(De(ne,be,t,n.value,o.value,we)))}),_=ae}return b(Mn,null,{default:()=>[Ce(E),_]})},oe=()=>pe(g.value,v.value),me=(E,H)=>pe(E,void 0,H);return()=>{const E=o.value,H=u.value,D=a.value,_=t.default?t.default():[];if(H||K.value||m.value||D.horizontal){const{offsetTop:ae}=C.value;if(e.headless||_.push(b(Hn,{offsetTop:ae},null)),D.vertical&&(e.scroll||H)||!D.vertical&&D.horizontal){const ne=({item:G,index:Y,children:J})=>De(G,Y,t,n.value,E,J),be=({row:G,item:Y,index:J,rowIndex:se})=>pt(Y,G,se,J),we=(G,{renderedData:Y})=>{var se;const J=(se=Y[0])==null?void 0:se.data;return b("table",{ref:f,class:`${E}-table`,style:I.value},[J?b(he,{columns:J},null):void 0,me(J,G),!1])},bt=(G,Y)=>{const{fixedStartColumns:J,fixedEndColumns:se}=y.value;return tt(G,Y,g.value,v.value,J,se,!1)},{scroll:re,onScrolledBottom:St}=e;_.push(b(qe,{ref:B,class:`${E}-body-virtual-scroll`,dataSource:X.value,colModifier:bt,fullHeight:re==null?void 0:re.fullHeight,getKey:G=>{var Y;return(Y=G.rowKey)!=null?Y:G.key},height:u.value?"100%":re==null?void 0:re.height,width:"100%",rowHeight:r.value,colWidth:s.value,rowRender:ne,colRender:be,contentRender:we,virtual:a.value,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:h,onScrolledBottom:St,onScrolledChange:te},null))}else _.push(b("div",{ref:T,class:`${E}-content`,style:Z.value,onScroll:h},[b("table",{ref:f,class:`${E}-table`,style:I.value},[b(he,null,null),oe(),!1])]));m.value&&_.push(b(Fn,null,null))}else _.push(b("div",{ref:T,class:`${E}-content`,style:Z.value,onScroll:h},[b("table",{ref:f,class:`${E}-table`,style:I.value},[b(he,null,null),!e.headless&&b(Te,null,null),oe(),!1])]));return b("div",{ref:R,class:ee.value},[_])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Zn(e,t){return e.footer?b("div",{class:`${t}-footer`},[e.footer()]):null}function Jn(e,t,n,o){var r,s;let l=null,a=null;if(t!==null){const{position:u}=t,[c,i]=At(u).split("-"),d=`${o}-pagination ${o}-pagination-${i}`,v=(s=(r=e.pagination)==null?void 0:r.call(e,{total:n.length,...t}))!=null?s:b(Nt,fe({class:d,total:n.length},t),null);l=c==="top"?v:null,a=c==="bottom"?v:null}return[l,a]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function mt(e,t){const{getGreyColors:n}=t,o=n(),{fontSizeSm:l,heightMd:a,paddingSizeSm:r,paddingSizeMd:s,paddingSizeLg:u,colorTextTitleSecondary:c,colorEmphasizedContainerBg:i,colorBorder:d,colorIconInfo:v,colorPrimary:g,colorContainerBg:y,colorContainerBgHover:m,colorInfoContainerBg:C}=e;return{fontSizeSm:l,fontSizeMd:l,fontSizeLg:l,headRowHeightSm:a,headRowHeightMd:a,headRowHeightLg:a,cellPaddingHorizontalSm:r,cellPaddingHorizontalMd:s,cellPaddingHorizontalLg:u,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:c,headBgColor:i,headSeparatorColor:d,headIconColor:v,headIconColorActive:g,headIconBgColorHover:n().l30,insetShadowStart:`inset 10px 0 8px -8px ${Fe(o.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${Fe(o.d50,.12)}`,bodyRowBgColorHover:m,bodyRowBgColorSelected:y,bodyRowBgColorExpanded:C,bodyRowBgColorTreeExpanded:C,bodyCellVerticalAlign:"middle",expandableIconColor:v}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Qn(e,t){const{getGreyColors:n}=t,o=n();return{...mt(e,t),insetShadowStart:`inset 10px 0 8px -8px ${o.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${o.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const el=(e,t,n)=>t==="default"?mt(e,n):Qn(e,n),tl={sm:32,md:40,lg:56},nl=150,ll=M({name:"IxTable",props:yn,setup(e,{expose:t,slots:n}){const o=Se("common"),{globalHashId:l,hashId:a,registerToken:r}=It("table");r(el);const s=S(()=>`${o.prefixCls}-table`),u=Se("locale"),c=Se("table"),i=S(()=>{var I;return(I=e.autoHeight)!=null?I:c.autoHeight}),d=S(()=>{var I;return(I=e.childrenKey)!=null?I:c.childrenKey}),v=Rt(e,c),g=S(()=>{var I;return(I=e.emptyCell)!=null?I:c.emptyCell}),y=S(()=>{var I;return(I=e.insetShadow)!=null?I:c.insetShadow}),m=S(()=>{var I;return(I=e.size)!=null?I:c.size}),C=S(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),B=S(()=>{var I;return(I=e.virtualItemHeight)!=null?I:tl[m.value]}),T=S(()=>{var I;return(I=e.virtualColWidth)!=null?I:nl}),{mergedPagination:f}=Qt(e,c,m),h=vn(e),p=en(e,i,h),k=_t(e,n,c,p.scrollBarSizeOnFixedHolder),w=fn(k.flattedColumns),K=Jt(k.flattedColumns),x=Zt(e,k.flattedColumns),$=hn(e,k,p,h.isSticky,C,i),{activeSorters:R}=w,{activeFilters:P}=K,W=Yt(e,d,v,R,P,x.expandedRowKeys,f),A=rn(e,u,k.flattedColumns,W);ln(e,c,f,R,P,p.scrollTo);const z={props:e,slots:n,config:c,locale:u,mergedPrefixCls:s,mergedEmptyCell:g,mergedInsetShadow:y,mergedVirtual:C,mergedVirtualItemHeight:B,mergedVirtualColWidth:T,mergedAutoHeight:i,...k,...p,...w,...K,...h,tableLayout:$,mergedPagination:f,...x,...W,...A};Re(L,z),t({scrollTo:p.scrollTo});const{flattedData:V,filteredData:ee}=W,Z=S(()=>{const I=s.value,{borderless:te=c.borderless,scroll:X}=e;return le({[l.value]:!!l.value,[a.value]:!!a.value,[I]:!0,[`${I}-auto-height`]:i.value,[`${I}-borderless`]:te,[`${I}-empty`]:V.value.length===0,[`${I}-full-height`]:X==null?void 0:X.fullHeight,[`${I}-${m.value}`]:!0})});return()=>{const I=s.value,te=b(Pt,{header:e.header},n),X=Zn(n,I),[Ce,pe]=Jn(n,f.value,ee.value,I),oe=[te],me=[Ce,b(Yn,null,null),X,pe].filter(Boolean),E=ol(e.spin);return E?oe.push(b(Ot,E,{default:()=>[me]})):oe.push(...me),b("div",{class:Z.value},[oe])}}});function ol(e){return Lt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const il=ll,ul=Pe;export{il as I,ul as a,Dt as g,yn as t};
