import{av as W,a8 as _,t as $,T as C,U as Z,b4 as ee,b5 as ae,x as te,K as oe,b6 as ne,m as M}from"./index-57842767.js";import{c as u,r as z,N as re,O as F,q as k,v as c,m as j,a6 as R,n as le,p as se,w as q,P as ie,a7 as ue}from"./vendor-95ed6e76.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const P=10,x=1,U=0,ce=.2,ve=90;function de(e,a,t,n,o,r,l){const s=()=>e("next"),g=()=>e("previous"),f=()=>a("left"),m=()=>a("right"),v=()=>t("out"),d=()=>t("in"),p=()=>n(!1);return u(()=>[{key:"goPrevious",icon:"left",opr:g,disabled:r.value.previous,visible:l.value},{key:"goNext",icon:"right",opr:s,disabled:r.value.next,visible:l.value},{key:"rotateLeft",icon:"rotate-left",opr:f,visible:!0},{key:"rotateRight",icon:"rotate-right",opr:m,visible:!0},{key:"zoomOut",icon:"zoom-out",opr:v,disabled:o.value.out,visible:!0},{key:"zoomIn",icon:"zoom-in",opr:d,disabled:o.value.in,visible:!0},{key:"close",icon:"close",opr:p,visible:!0}])}function me(e){const a=z(x),t=z(U),n={left:-1,right:1},o={in:1,out:-1},r=u(()=>{const[v,d]=e.value;return v>x?v:d<x?d:x});re(()=>a.value=r.value);const l=u(()=>{const[v,d]=e.value;return{in:a.value>=d,out:a.value<=v}}),s=u(()=>({transform:`scale(${a.value}) rotate(${t.value}deg)`})),g=F((v="left",d=ve)=>{t.value=t.value+d*n[v]},P),f=F((v,d=ce)=>{l.value[v]||(a.value=a.value+d*o[v])},P);return{transformStyle:s,scaleDisabled:l,rotateHandle:g,scaleHandle:f,resetTransform:()=>{a.value=r.value,t.value=U}}}function ge(e,a){const[t,n]=W(e,"activeIndex",0),o=u(()=>({previous:!a.value&&t.value===0,next:!a.value&&t.value===e.images.length-1})),r=u(()=>e.images.length>1),l=F((s="next")=>{if(s==="next"){if(o.value.next||o.value.previous)return;n(t.value>=e.images.length-1?0:t.value+1);return}n(t.value<=0?e.images.length-1:t.value-1)},P);return{activeIndex:t,switchDisabled:o,switchVisible:r,goHandle:l}}const fe=e=>{const{disabled:a,icon:t,prefixCls:n,opr:o}=e,r=_(),l=u(()=>k({[`${n}-opr-item`]:!0,[`${n}-opr-item-disabled`]:a}));return c($,{class:l.value,name:t,onClick:o,key:r},null)},pe=fe;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const we={visible:{type:Boolean,default:void 0},activeIndex:Number,container:{type:[String,HTMLElement,Function],default:void 0},draggable:{type:Boolean,default:void 0},images:{type:Array,default:()=>[]},zoom:{type:Array,validator:e=>e.length===2},loop:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},zIndex:Number,"onUpdate:visible":[Function,Array],"onUpdate:activeIndex":[Function,Array]},be={src:{type:String,required:!0},preview:{type:Boolean,default:void 0},imageViewer:Object,onLoad:[Function,Array],onError:[Function,Array]};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function H(e){const{colorWhite:a,fontSizeXl:t}=e;return{minWidth:96,minHeight:96,objectFit:"contain",previewBgColor:"rgba(0, 0, 0, 0.5)",previewIconColor:a,previewIconSize:t,viewerBgColor:"rgba(0, 0, 0, 0.45)",viewerOprColor:a,viewerOprColorDisabled:"rgba(255, 255, 255, 0.35)",viewerOprHeight:48,viewerOprMarginBottom:48,viewerOprFontSize:t,viewerOprBgColor:"rgba(0, 0, 0, 0.1)",viewerOprItemMargin:"0 24px"}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const G=(e,a)=>H(e),K=ne?"DOMMouseScroll":"mousewheel",X=j({name:"IxImageViewer",props:we,setup(e){const a=C("common"),{globalHashId:t,hashId:n,registerToken:o}=Z("image");o(G);const r=C("imageViewer"),l=u(()=>`${a.prefixCls}-image-viewer`),s=ee(e,r,a,l),g=u(()=>{var i;return(i=e.draggable)!=null?i:r.draggable}),[f,m]=W(e,"visible",!1),v=ae(R(e,"zIndex"),R(a,"overlayZIndex"),f),d=u(()=>{var i;return(i=e.zoom)!=null?i:r.zoom}),p=u(()=>{var i;return(i=e.loop)!=null?i:r.loop}),S=u(()=>{var i;return(i=e.maskClosable)!=null?i:r.maskClosable}),{transformStyle:L,scaleDisabled:O,rotateHandle:b,scaleHandle:I,resetTransform:V}=me(d),{activeIndex:y,switchDisabled:T,switchVisible:h,goHandle:A}=ge(e,p),J=()=>S.value&&m(!1),Q=de(A,b,I,m,O,T,h),{onWheelScroll:D,onKeydown:B}=Ie(f,m,I,A);le(()=>{window.addEventListener(K,D,{passive:!1,capture:!1}),window.addEventListener("keydown",B,!1)}),se(()=>{window.removeEventListener(K,D),window.removeEventListener("keydown",B)}),q([f,y],([i])=>{i&&V()});const Y=u(()=>`z-index: ${v.value}`),N=()=>{const i=l.value,w=e.images[y.value];return c("img",{draggable:"false",onClick:E=>E.stopImmediatePropagation(),class:`${i}-preview-img`,src:w,style:L.value},null)};return()=>{const i=l.value;return c(oe,{target:s.value,load:f.value},{default:()=>[c(ie,{name:`${a.prefixCls}-zoom`,appear:!0},{default:()=>[f.value&&c("div",{class:[i,t.value,n.value],style:Y.value},[c("div",{class:`${i}-opr`},[Q.value.filter(w=>w.visible).map(w=>{const E={...w,prefixCls:i};return c(pe,E,null)})]),c("div",{class:`${i}-preview`,onClick:J},[g.value?c(te,{mode:"immediate"},{default:()=>[N()]}):N()])])]})]})}}});function Ie(e,a,t,n){const o=s=>{var m;if(!e.value)return;const g=s;g.preventDefault(),((m=g.wheelDelta)!=null?m:-g.detail)>0?t("in",.2):t("out",.2)},r={ArrowUp:()=>t("in",.2),ArrowDown:()=>t("out",.2),ArrowLeft:()=>n("previous"),ArrowRight:()=>n("next"),Escape:()=>a(!1)};return{onWheelScroll:o,onKeydown:s=>{e.value&&(s.preventDefault(),s.code in r&&r[s.code]())}}}const ye=j({name:"IxImage",inheritAttrs:!1,props:be,setup(e,{attrs:a,slots:t}){const{class:n,style:o,...r}=a,l=C("common"),{globalHashId:s,hashId:g,registerToken:f}=Z("image");f(G);const m=u(()=>`${l.prefixCls}-image`),v=C("image"),d=$e(e,v),{status:p,setFailed:S,setLoaded:L}=Se(e),[O,b]=Ce(),{outerClasses:I,overLayerClasses:V,imageClasses:y}=ze(m,s,g,n,p,d);return()=>{var h;const T={visible:O.value,"onUpdate:visible":b,images:[e.src],...(h=e.imageViewer)!=null?h:{}};return c("div",{class:I.value,style:o},[c("div",{class:V.value},[he(e,t,m,p,d,b),xe(t,m,p),ke(t,m,p),c(X,T,null)]),c("img",ue(r,{src:e.src,class:y.value,onLoad:L,onError:S}),null)])}}});function he(e,a,t,n,o,r){var l,s;return n.value==="loaded"&&o.value&&c("span",{class:`${t.value}-preview-wrapper`,onClick:()=>r(!0)},[(s=(l=a.previewIcon)==null?void 0:l.call(a))!=null?s:c($,{class:`${t.value}-preview-icon`,name:"zoom-in"},null)])}function xe(e,a,t){var n,o;return t.value==="loading"&&((o=(n=e.placeholder)==null?void 0:n.call(e))!=null?o:c($,{class:`${a.value}-placeholder`,name:"loading"},null))}function ke(e,a,t){var n,o;return t.value==="failed"&&((o=(n=e.fallback)==null?void 0:n.call(e))!=null?o:c($,{class:`${a.value}-fallback`,name:"file-image"},null))}function Ce(){const e=z(!1);return[e,t=>{e.value=t}]}function ze(e,a,t,n,o,r){const l=u(()=>k([e.value,a.value,t.value,n,`${e.value}-${o.value}`,{[`${e.value}-preview`]:r.value}])),s=u(()=>k(`${e.value}-layer`)),g=u(()=>k([`${e.value}-inner`,{[`${e.value}-inner-hidden`]:o.value!=="loaded"}]));return{outerClasses:l,overLayerClasses:s,imageClasses:g}}function $e(e,a){return u(()=>{var t;return(t=e.preview)!=null?t:a.preview})}function Se(e){const a=z("loading"),t=o=>{a.value="loaded",M(e.onLoad,o)},n=o=>{a.value="failed",M(e.onError,o)};return q(()=>e.src,()=>{a.value="loading"},{immediate:!0}),{status:a,setLoaded:t,setFailed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ve=ye,Te=X;export{Ve as I,Te as a};
