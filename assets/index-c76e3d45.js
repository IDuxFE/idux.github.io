import{m as B,ao as ee,A as z,at as Pe,j as Ee,M as ke,N as Te,aw as Oe,H as He,aL as qe,av as Me}from"./index-ebff8fb2.js";import{d as q,c as x,r as H,n as Ue,w as je,f as ze,x as xe,i as Re,a0 as _e,N as We,l as V,y as Y,q as K,p as Ve,ad as he,D as Ge,P as Xe}from"./vendor-7de7c0f1.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ne(e,n,t){if(t){const l=[],a=e.value;n.forEach(o=>{const r=a.get(o);r&&l.push(r.rawNode)}),B(t,n,l)}}function te(e,n){const t=[],{children:l}=e||{};return l&&l.forEach(a=>{const{key:o}=a;n!=null&&n.includes(o)||t.push(a.key),t.push(...te(a,n))}),t}function ae(e,n,t){const l=[];for(;n&&!q(n.parentKey);){const{parentKey:a}=n;t!=null&&t.includes(n.parentKey)||l.push(a),n=e.get(a)}return l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ye(e,n){const[t,l]=ee(e,"checkedKeys",()=>[]),a=x(()=>{const s=[];return e.checkable&&n.value.forEach((f,i)=>{f.checkDisabled&&s.push(i)}),s}),o=x(()=>e.cascaderStrategy!=="off"?Qe(n.value,t.value,a.value):t.value),r=x(()=>{const s=o.value;if(s.length===0||e.cascaderStrategy==="off")return[];const f=new Set,i=n.value;return s.forEach(u=>{const{parentKey:b}=i.get(u)||{};if(!q(b)){let g=i.get(b);if(g&&!s.includes(g.key))for(f.add(b);g&&!q(g.parentKey);)f.add(g.parentKey),g=i.get(g.parentKey)}}),[...f]}),c=s=>{const f=s.key,i=n.value,u=a.value,b=e.cascaderStrategy,g=b!=="off",w=g?te(s,u):[],F=o.value.indexOf(f);let D=[...o.value];const S=F>-1||!!w.length&&w.every(d=>D.includes(d)||r.value.includes(d));if(S){const d=g?ae(i,s,u):[];D.splice(F,1),D=D.filter(y=>!d.includes(y)&&!w.includes(y))}else D.push(f),g&&Se(i,s,D,u),D.push(...w);h(S,s.rawNode,Je(b,D,i,u))},h=(s,f,i)=>{const{onCheck:u,onCheckedChange:b}=e;B(u,!s,f),l(i),ne(n,i,b)};return{checkedKeys:t,allCheckedKeys:o,checkDisabledKeys:a,indeterminateKeys:r,handleCheck:c}}function Se(e,n,t,l){let a=!0;for(;a&&n&&!q(n.parentKey);){const o=e.get(n.parentKey);o&&!l.includes(n.parentKey)&&(a=o.children.every(r=>l.includes(r.key)||t.includes(r.key)),a&&t.push(n.parentKey)),n=o}}function Je(e,n,t,l){if(e==="off")return[...new Set(n)];let a=[];n=we(t,n,l),l.length&&(a=n.filter(o=>l.includes(o)));for(const o of n){const r=t.get(o);if(r){const c=r.key,h=r.parentKey;e==="parent"?n.includes(h)||a.push(c):e==="child"?r.isLeaf&&a.push(c):a.push(c)}}return[...new Set(a)]}function Qe(e,n,t){let l=[...n],a;for(const o of n){const r=e.get(o),c=r==null?void 0:r.parentKey,h=te(r,t);l=l.concat(h),!q(c)&&a!==c&&(Se(e,r,l,t),a=c)}return l=we(e,[...new Set(l)],t),l}function we(e,n,t){let l=[...n];if(t.length){for(const a of t)if(!l.includes(a)){const o=e.get(a),r=ae(e,o,t);l=l.filter(c=>!r.includes(c))}}return l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ze(e,n,t,l){const a=x(()=>Ae(e,e.dataSource,n.value,t.value,l.value)),o=x(()=>{const r=new Map;return ge(a.value,r),r});return{mergedNodes:a,mergedNodeMap:o}}function en(e,{expandedKeys:n},t,l){return x(()=>{const{searchValue:a}=t,o=new Map(n.value.map((c,h)=>[c,h])),r=new Map(l.value.map((c,h)=>[c,h]));return a&&!r.size?[]:o.size||r.size?an(e.value,o,r):e.value.map(c=>({...c,expanded:!1,level:0}))})}function Ae(e,n,t,l,a,o,r,c){const{cascaderStrategy:h,disabled:s,loadChildren:f}=e,i=q(r)?-1:r;return n.map((u,b)=>Le(u,t,l,a,s,!!f,b===0,b===n.length-1,i,h,c?[c]:[],o))}function Le(e,n,t,l,a,o,r,c,h,s,f,i){var S,d;const u=t(e),b=nn(e,a),g=e[n],w=e[l];h++;const F=g==null?void 0:g.map((y,C)=>Le(y,n,t,l,a,o,C===0,C===g.length-1,h,s,[b,...f],u)),D=tn(b,f,(S=F==null?void 0:F.map(y=>({check:y.checkDisabled,drag:y.dragDisabled,drop:y.dropDisabled,select:y.selectDisabled})))!=null?S:[],s!=="off");return{label:w,key:u,children:F,isFirst:r,isLeaf:(d=e.isLeaf)!=null?d:!(g!=null&&g.length||o),isLast:c,parentKey:i,expanded:!1,level:h,rawNode:e,checkDisabled:D.check,dragDisabled:D.drag,dropDisabled:D.drop,selectDisabled:D.select}}function nn(e,n){const t=e.disabled||{};if(t===!0)return{check:!0,drag:!0,drop:!0,select:!0};let{check:l,drag:a,drop:o,select:r}=t;if(n){const c=n(e)||{};if(c===!0)return{check:!0,drag:!0,drop:!0,select:!0};l=l||c.check,a=a||c.drag,o=o||c.drop,r=r||c.select}return{check:l,drag:a,drop:o,select:r}}function tn(e,n,t,l){const a=o=>e[o]||l&&(n.some(r=>!!r[o])||!!t.length&&t.every(r=>!!r[o]));return{check:a("check"),drag:a("drag"),drop:a("drop"),select:a("select")}}function ge(e,n){e.forEach(t=>{const{key:l,children:a}=t;n.set(l,t),a&&ge(a,n)})}function Fe(e=[],n){const t=[],l=e.length;return e.forEach((a,o)=>{a.isFirst=o===0,a.isLast=o===l-1,n.has(a.key)||n.size==0?(a.hidden=!1,t.push(a)):a.hidden=!0,Fe(a.children,n).length>0&&(a.hidden=!1,t.push(a))}),t.length&&(t[0].isFirst=!0,t[t.length-1].isLast=!0),t}function an(e,n,t){const l=[],a=[];return Fe(e,t),e.forEach(o=>{for(a.push(o);a.length;){const r=a.pop();if(r){const{children:c,key:h,hidden:s}=r,f=n.has(h);if(r.expanded=f,!s&&l.push(r),c&&f)for(let i=c.length;i>0;i--)!c[i-1].hidden&&a.push(c[i-1])}}}),l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function on(e,n,{expandedKeys:t,setExpandedKeys:l}){const a=x(()=>{var v;return(v=e.draggableIcon)!=null?v:n.draggableIcon}),o=H(),r=H(),c=H(),h=H(),s=H();let f;const i=()=>{f&&(clearTimeout(f),f=void 0)};Ue(()=>i());const u=()=>{q(o.value)||(o.value=void 0,r.value=void 0)},b=()=>{q(c.value)||(c.value=void 0,h.value=void 0,s.value=void 0)},g=(v,k)=>{var L,A;return{evt:v,node:k.rawNode,dragNode:(L=o.value)==null?void 0:L.rawNode,dropNode:(A=c.value)==null?void 0:A.rawNode,dropType:s.value}},w=v=>{D(v,void 0),window.removeEventListener("dragend",w)},F=(v,k)=>{o.value=k,r.value=te(k),rn(k.key,t.value,l),window.addEventListener("dragend",w),B(e.onDragstart,g(v,k))},D=(v,k)=>{k&&B(e.onDragend,g(v,k)),u(),b()},S=async(v,k)=>{const L=o.value;if(L){i(),L.key!==k.key&&(f=setTimeout(()=>{var P;o.value&&((P=k.children)!=null&&P.length)&&ln(k.key,t.value,l),f=void 0},1e3));const A=await Ce(k,L,r.value,v,e.droppable);A?(c.value=k,h.value=A!=="inside"?k.parentKey:void 0,s.value=A):b()}B(e.onDragenter,g(v,k))},d=async(v,k)=>{const L=o.value;if(L){const A=await Ce(k,L,r.value,v,e.droppable);A?(c.value=k,h.value=A!=="inside"?k.parentKey:void 0,s.value=A):b()}B(e.onDragover,g(v,k))},y=(v,k)=>{const L=c.value;(L==null?void 0:L.key)===k.key&&!v.currentTarget.contains(v.relatedTarget)&&b(),B(e.onDragleave,g(v,k))},C=(v,k)=>{s.value||b(),B(e.onDrop,g(v,k)),u(),b()};return{draggableIcon:a,dragKey:x(()=>{var v;return(v=o.value)==null?void 0:v.key}),dropKey:x(()=>{var v;return(v=c.value)==null?void 0:v.key}),dropParentKey:h,dropType:s,handleDragstart:F,handleDragend:D,handleDragenter:S,handleDragover:d,handleDragleave:y,handleDrop:C}}function ln(e,n,t){n.indexOf(e)===-1&&t([...n,e])}function rn(e,n,t){const l=n.indexOf(e);if(l!==-1){const a=[...n];a.splice(l,1),t(a)}}async function Ce(e,n,t,l,a){const{key:o,children:r=[]}=e;if(n.key===o||t&&t.includes(o))return!1;const{clientY:c}=l,{top:h,height:s}=l.target.getBoundingClientRect(),f=c<h+s/2;let i;if(a){const u={evt:l,isTopHalf:f,dragNode:n.rawNode,dropNode:e.rawNode};i=await a(u)}return(i===void 0||i===!0)&&(r.length>0?i="inside":f?i="before":i="after"),i}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function cn(e,n,t,{expandedKeys:l,handleExpand:a},{activeKey:o,handleSelect:r}){const c=H(!1);return{focused:c,handleFocus:u=>{c.value=!0,B(e.onFocus,u)},handleBlur:u=>{c.value=!0,B(e.onBlur,u)},handleKeydown:u=>{switch(u.code){case"ArrowUp":case"ArrowDown":u.preventDefault()}B(e.onKeydown,u)},handleKeyup:u=>{const b=u.code,g=o.value,w=t.value,F=w.length;if(g===void 0)["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(b)&&fe(o,w,0,F);else{const D=t.value,S=D.findIndex(d=>d.key===g);if(S===-1)return;switch(b){case"Enter":case"NumpadEnter":r(g);break;case"ArrowDown":fe(o,D,S+1,F);break;case"ArrowUp":fe(o,D,S-1,0,!0);break;case"ArrowLeft":{const{rawNode:d,key:y,parentKey:C}=D[S];if(d.isLeaf||!l.value.includes(y)){const v=C?n.value.get(C):void 0;v&&(o.value=v.key)}else a(y,d)}break;case"ArrowRight":{const{rawNode:d,key:y}=D[S];if(!l.value.includes(y))a(y,d);else for(let C=S+1;C<F;C++){const v=D[C];o.value=v.key;break}}break}}B(e.onKeyup,u)}}}function fe(e,n,t,l,a=!1){let o=t;for(;a?o>=l:o<l;){const r=n[o];if(r.selectDisabled)a?o--:o++;else{e.value=r.key;return}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function sn(e,n,t,l,a,o,r){const c=x(()=>{var d;return(d=e.expandIcon)!=null?d:n.expandIcon}),[h,s]=ee(e,"expandedKeys",()=>[]),[f,i]=ee(e,"loadedKeys",()=>[]),u=H([]),b=({key:d,expanded:y,node:C})=>{if(ze(c.value))return xe(z,{name:c.value,rotate:y?90:0});if(Re(c.value))return c.value({key:d,expanded:y,node:C});if(_e(c.value))return xe(z,{name:y?c.value[0]:c.value[1]})},g=d=>{if(!d||d.length<=0)return;const{onExpandedChange:y}=e,C=o.value,v=new Set(h.value);d.forEach(L=>{ae(C,C.get(L)).forEach(A=>v.add(A))});const k=[...v];s(k),ne(o,k,y)};je(r,g);const w=async(d,y)=>{var P;const{loadChildren:C}=e;if(u.value.includes(d))return;const v=t.value;if(!((P=y==null?void 0:y[v])!=null&&P.length)){if(!C||u.value.includes(d)||f.value.includes(d))return;u.value.push(d);const N=await C(y);u.value.splice(u.value.indexOf(d),1);const M=o.value,E=M.get(d);if(N!=null&&N.length){const X=E.level,R=Ae(e,N,v,l.value,a.value,d,X,{check:!!E.checkDisabled,drag:!!E.dragDisabled,drop:!!E.dropDisabled,select:!!E.selectDisabled});ge(R,M),E.rawNode[v]=N,E.children=R;const _=[...f.value,d];i(_),B(e.onLoaded,_,y)}else return}const k=h.value.indexOf(d),L=k>=0,A=[...h.value];L?A.splice(k,1):A.push(d),F(L,y,A)},F=(d,y,C)=>{const{onExpand:v,onExpandedChange:k}=e;B(v,!d,y),s(C),ne(o,C,k)},D=()=>{const d=[],y=[];o.value.forEach(C=>{C.isLeaf||(d.push(C.key),y.push(C.rawNode))}),B(e.onExpandedChange,d,y),s(d)},S=()=>{B(e.onExpandedChange,[],[]),s([])};return r.value.length&&g(r.value),{expandIconRenderer:b,expandedKeys:h,setExpandedKeys:s,expandAll:D,collapseAll:S,handleExpand:w,loadingKeys:u}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dn(e,n,t){const l=un(e,t);return{searchedKeys:x(()=>{const{searchValue:o}=e;if(!o)return Pe;const r=l.value,c=[];return n.value.forEach(h=>{r(h.rawNode,o)&&c.push(h.key)}),c})}}function un(e,n){return x(()=>{var t;return(t=e.searchFn)!=null?t:fn(n.value)})}function fn(e){return(n,t)=>{const l=n[e];return l?l.toLowerCase().includes(t.toLowerCase()):!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function hn(e,n){const[t,l]=ee(e,"selectedKeys",()=>[]),a=x(()=>e.selectable==="multiple"),o=H();We(()=>{const s=t.value,f=s.length;o.value=f>0?s[f-1]:void 0});const r=x(()=>{const s=o.value;return s!==void 0?n.value.get(s):void 0}),c=s=>{const i=n.value.get(s);if(!i)return;const u=t.value.indexOf(s),b=u>-1;let g=[...t.value];a.value?b?g.splice(u,1):g.push(s):g=b?[]:[s],h(b,i.rawNode,g)},h=(s,f,i)=>{var w;const{onSelect:u,onSelectedChange:b}=e,g=i.includes((w=f.key)!=null?w:"")?!0:!s;B(u,g,f),l(i),ne(n,i,b)};return{activeKey:o,activeNode:r,selectedKeys:t,handleSelect:c}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const G=Symbol("treeToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const gn={autoHeight:{type:Boolean,default:void 0},checkedKeys:Array,expandedKeys:Array,indeterminateKeys:Array,loadedKeys:Array,selectedKeys:Array,blocked:{type:Boolean,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},childrenKey:String,checkOnClick:{type:Boolean,default:!1},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:Function,draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:Function,empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},height:Number,labelKey:String,leafLineIcon:String,loadChildren:Function,searchFn:Function,searchValue:String,selectable:{type:[Boolean,String],default:!0},showLine:{type:Boolean,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualItemHeight:{type:Number,default:28},"onUpdate:checkedKeys":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],"onUpdate:selectedKeys":[Function,Array],onCheck:[Function,Array],onCheckedChange:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onSelect:[Function,Array],onSelectedChange:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onKeydown:[Function,Array],onKeyup:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},vn={node:{type:Object,required:!0},isLeaf:{type:Boolean,required:!0},isFirst:{type:Boolean,required:!0},isLast:{type:Boolean,required:!0},label:String,level:{type:Number,required:!0},rawNode:{type:Object,required:!0},expanded:{type:Boolean,required:!0},children:Array,parentKey:[String,Number,Symbol],checkDisabled:{type:Boolean,default:void 0},dragDisabled:{type:Boolean,default:void 0},dropDisabled:{type:Boolean,default:void 0},selectDisabled:{type:Boolean,default:void 0}},yn={node:{type:Object,required:!0},checkDisabled:{type:Boolean,default:void 0}},pn={expanded:{type:Boolean,required:!0},hasTopLine:{type:Boolean,default:void 0},hasBottomLine:{type:Boolean,default:void 0},isLeaf:{type:Boolean,default:void 0},nodeKey:{type:[String,Number,Symbol],required:!0},rawNode:{type:Object,required:!0}},bn={disabled:{type:Boolean,default:void 0},node:{type:Object,required:!0},nodeKey:{type:[String,Number,Symbol],required:!0},label:String,selected:{type:Boolean,default:void 0}},kn=V({props:yn,setup(e){const{mergedPrefixCls:n,allCheckedKeys:t,indeterminateKeys:l,handleCheck:a}=Y(G),o=x(()=>t.value.includes(e.node.key)),r=x(()=>l.value.includes(e.node.key)),c=()=>a(e.node);return()=>K(Ee,{class:`${n.value}-node-checkbox`,checked:o.value,disabled:e.checkDisabled,indeterminate:r.value,onChange:c},null)}}),xn=V({props:bn,setup(e,{slots:n}){const{props:t,mergedPrefixCls:l,mergedCheckOnClick:a,handleSelect:o,handleCheck:r,searchedKeys:c}=Y(G),h=x(()=>c.value.includes(e.nodeKey)),s=i=>{e.disabled||(o(e.nodeKey),a.value&&r(e.node)),B(t.onNodeClick,i,e.node.rawNode)},f=i=>{B(t.onNodeContextmenu,i,e.node.rawNode)};return()=>{var v,k;const{nodeKey:i,label:u,node:b,selected:g}=e,{rawNode:w}=b,{prefix:F,suffix:D}=w,S={key:i,selected:g,node:w},d=((v=n.prefix)==null?void 0:v.call(n,S))||F&&K(z,{name:F},null),y=((k=n.suffix)==null?void 0:k.call(n,S))||D&&K(z,{name:D},null),C=`${l.value}-node-content`;return K("span",{class:C,onClick:s,onContextmenu:f},[d&&K("span",{class:`${C}-prefix`},[d]),K("span",{class:`${C}-label`},[Cn(n.label,u,w,t.searchValue,h.value,C)]),y&&K("span",{class:`${C}-suffix`},[y])])}}});function Cn(e,n,t,l,a,o){if(e)return e({node:t,searchValue:l,searched:a});if(a&&n&&l){const r=n.toUpperCase().indexOf(l.toUpperCase());if(r>-1){const c=r+l.length,h=n.substring(0,r),s=n.substring(c),f=K("span",{class:`${o}-label-highlight`},[n.substring(r,c)]);return[h,f,s]}}return n}const mn=V({props:pn,setup(e,{slots:n}){const{mergedPrefixCls:t,expandIconRenderer:l,loadingKeys:a,handleExpand:o}=Y(G),r=x(()=>a.value.includes(e.nodeKey)),c=x(()=>{const s=`${t.value}-node-expand`;return Ve({[s]:!0,[`${s}-noop`]:e.isLeaf})}),h=s=>{o(e.nodeKey,e.rawNode),s.stopPropagation()};return()=>{var i,u;const s=`${t.value}-node-expand`;let f;if(r.value)f=K(z,{name:"loading"},null);else if(!e.isLeaf){const{expanded:b,nodeKey:g,rawNode:w}=e;f=(u=(i=n.expandIcon)!=null?i:l)==null?void 0:u({key:g,expanded:b,node:w})}return K("span",{class:c.value,onClick:h},[e.hasTopLine&&K("div",{class:`${s}-top-line`},null),f,e.hasBottomLine&&K("div",{class:`${s}-bottom-line`},null)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Kn=({level:e,noopIdentUnitArr:n,prefixCls:t})=>{const l=[];for(let a=0;a<e;a++)l.push(K("span",{key:a,class:n.includes(a)?`${t}-node-indent-noop-unit`:`${t}-node-indent-unit`},null));return K("span",{"aria-hidden":!0,class:`${t}-node-indent`},[l])},Dn=Kn,Sn=V({setup(e,{slots:n}){const{props:t,mergedPrefixCls:l}=Y(G);return()=>{const a=`${l.value}-node-leaf`;let o;return n.leafLineIcon?o=n.leafLineIcon():t.leafLineIcon?o=K(z,{name:t.leafLineIcon},null):o=K("span",{class:`${a}-line`},null),K("span",{class:a},[o])}}}),me=V({props:vn,setup(e,{slots:n}){const{props:t,flattedNodes:l,mergedPrefixCls:a,mergedShowLine:o,activeKey:r,selectedKeys:c,draggableIcon:h,dragKey:s,dropKey:f,dropParentKey:i,dropType:u,handleDragstart:b,handleDragend:g,handleDragenter:w,handleDragover:F,handleDragleave:D,handleDrop:S}=Y(G),d=x(()=>e.node.key),y=x(()=>r.value===d.value),C=x(()=>o.value&&e.isLast),v=x(()=>o.value&&!e.isLeaf&&(!e.isFirst||e.level!==0)),k=x(()=>o.value&&!e.isLeaf&&!e.isLast),L=x(()=>c.value.includes(d.value)),A=x(()=>e.selectDisabled||!t.selectable),P=x(()=>s.value===d.value),N=x(()=>f.value===d.value),M=x(()=>i.value===d.value),E=x(()=>N.value&&u.value==="before"),X=x(()=>N.value&&u.value==="inside"),R=x(()=>N.value&&u.value==="after"),_=x(()=>{const m=`${a.value}-node`;return{[m]:!0,[`${m}-active`]:y.value,[`${m}-last`]:C.value,[`${m}-disabled`]:A.value,[`${m}-selected`]:L.value,[`${m}-expanded`]:e.expanded,[`${m}-dragging`]:P.value,[`${m}-dropping`]:N.value,[`${m}-drop-parent`]:M.value,[`${m}-drop-before`]:E.value,[`${m}-drop-inside`]:X.value,[`${m}-drop-after`]:R.value}}),oe=m=>{var U;m.stopPropagation(),b(m,e.node),(U=m.dataTransfer)==null||U.setData("text/plain","")},le=m=>{m.stopPropagation(),g(m,e.node)},re=m=>{m.preventDefault(),m.stopPropagation(),w(m,e.node)},ce=m=>{m.preventDefault(),m.stopPropagation(),F(m,e.node)},se=m=>{m.stopPropagation(),D(m,e.node)},de=m=>{m.stopPropagation(),S(m,e.node)};return()=>{var ye,pe;const m=new Map;l.value.forEach(Z=>{m.set(Z.key,Z)});const{isLeaf:U,label:p,level:I,rawNode:T,expanded:O,checkDisabled:j,dragDisabled:W,dropDisabled:ie,node:J}=e,{checkable:ue,draggable:Q}=t,$=Q&&!W,Ie=(pe=(ye=n.draggableIcon)==null?void 0:ye.call(n))!=null?pe:K(z,{name:h.value},null),Be=m.get(d.value),ve=[];o.value&&ae(m,Be).reverse().forEach((Z,Ne)=>{var be;(be=m.get(Z))!=null&&be.isLast&&ve.push(Ne)});const $e=t.customAdditional?t.customAdditional({node:T,level:I}):void 0;return K("div",he({class:_.value,"aria-grabbed":P.value||void 0,"aria-label":p,"aria-selected":L.value,draggable:$||void 0,title:p,onDragstart:$?oe:void 0,onDragend:$?le:void 0,onDragenter:$?re:void 0,onDragover:$?ce:void 0,onDragleave:$?se:void 0,onDrop:$&&!ie?de:void 0},$e),[K(Dn,{level:I,noopIdentUnitArr:ve,prefixCls:a.value},null),$?K("span",{class:`${a.value}-node-draggable-icon`},[Ie]):Q&&K("span",{class:`${a.value}-node-draggable-icon-noop`},null),U&&o.value?K(Sn,null,n):K(mn,{expanded:O,hasTopLine:v.value,hasBottomLine:k.value,isLeaf:U,nodeKey:d.value,rawNode:T},n),ue&&K(kn,{checkDisabled:j,node:J},null),K(xn,{disabled:A.value,node:J,nodeKey:d.value,label:p,selected:L.value},n)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ke(e){const{heightMd:n,heightSm:t,marginSizeXs:l,colorPrimaryHover:a,colorPrimaryText:o,colorContainerBgHover:r,colorContainerBg:c,colorIconInfo:h}=e;return{dropLineWidth:2,dropLineColor:a,bgColor:c,nodeBgColorHover:r,nodeBgColorSelected:c,nodeColorSelected:o,nodePaddingHorizontal:l,nodePaddingVertical:"0px",nodeContentHeight:n,nodeContentLabelHighlightColor:o,nodeContentPrefixMarginRight:l,nodeCheckboxMarginRight:l,nodeIconWidth:t,expandIconColor:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const wn=(e,n)=>Ke(e),De={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},An=V({name:"IxTree",props:gn,setup(e,{attrs:n,expose:t,slots:l}){const a=ke("common"),{globalHashId:o,hashId:r,registerToken:c}=Te("tree");c(wn);const h=x(()=>`${a.prefixCls}-tree`),s=ke("tree"),f=x(()=>{var p;return(p=e.autoHeight)!=null?p:s.autoHeight}),i=x(()=>{var p;return(p=e.childrenKey)!=null?p:s.childrenKey}),u=Oe(e,s),b=x(()=>{var p;return(p=e.labelKey)!=null?p:s.labelKey}),g=x(()=>{var p;return(p=e.showLine)!=null?p:s.showLine}),w=x(()=>{var p;return(p=e.blocked)!=null?p:s.blocked}),F=x(()=>e.checkable&&e.checkOnClick),{mergedNodes:D,mergedNodeMap:S}=Ze(e,i,u,b),{searchedKeys:d}=dn(e,S,b),y=sn(e,s,i,u,b,S,d),C=en(D,y,e,d),v=Ye(e,S),k=on(e,s,y),L=hn(e,S);Ge(G,{props:e,config:s,flattedNodes:C,mergedPrefixCls:h,mergedNodeMap:S,mergedGetKey:u,mergedShowLine:g,mergedCheckOnClick:F,searchedKeys:d,...v,...y,...k,...L});const A=H(),P=H(),{activeKey:N}=L,{focused:M,handleFocus:E,handleBlur:X,handleKeydown:R,handleKeyup:_}=cn(e,S,C,y,L),oe=x(()=>{const p=h.value;return{[o.value]:!!o.value,[r.value]:!!r.value,[p]:!0,[`${p}-active`]:!q(N.value),[`${p}-blocked`]:w.value,[`${p}-virtual`]:e.virtual,[`${p}-auto-height`]:f.value,[`${p}-focused`]:M.value,[`${p}-show-line`]:g.value,[`${p}-empty`]:!C.value.length}}),le=x(()=>{var j,W;const p=N.value;if(q(p))return"";const I=S.value;let T=String(p),O=(j=I.get(p))==null?void 0:j.parentKey;for(;O;)T=`${String(O)} > ${T}`,O=(W=I.get(O))==null?void 0:W.parentKey;return T}),re=p=>{var I;(I=A==null?void 0:A.value)==null||I.focus(p)},ce=()=>{var p;(p=A==null?void 0:A.value)==null||p.blur()},se=p=>{var I;(I=P.value)==null||I.scrollTo(p)},de=p=>{var I;return(I=S.value.get(p))==null?void 0:I.rawNode},m=()=>C.value;t({focus:re,blur:ce,expandAll:y.expandAll,collapseAll:y.collapseAll,scrollTo:se,getNode:de,_getFlattedNodes:m});const U=(p,I,T)=>{B(e.onScrolledChange,p,I,T.map(O=>O.rawNode))};return()=>{var T;const p=C.value;let I;if(p.length>0){const O=({item:$})=>K(me,he({node:$},$),l),{height:j,virtual:W,virtualItemHeight:ie,virtualScrollMode:J,onScroll:ue,onScrolledBottom:Q}=e;I=W?K(He,{ref:P,class:`${h.value}-content`,dataSource:p,getKey:"key",height:f.value?"100%":j,rowHeight:ie,rowRender:O,virtual:!0,scrollMode:J,onScroll:ue,onScrolledBottom:Q,onScrolledChange:U},null):K("div",{class:`${h.value}-content`,style:Xe(f.value?void 0:{maxHeight:qe(j)})},[K("div",{class:`${h.value}-content-inner`},[p.map($=>K(me,he({node:$},$),l))])])}else I=K(Me,{empty:e.empty},l);return K("div",{class:oe.value,role:"tree"},[M.value&&K("span",{style:De,"aria-live":"assertive"},[le.value]),K("input",{ref:A,style:De,tabindex:(T=n.tabIndex)!=null?T:0,onFocus:E,onBlur:X,onKeydown:R,onKeyup:_,value:"","aria-label":"for screen reader"},null),I])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const In=An;export{In as I};
