import{m as I,ao as ee,A as j,at as Pe,j as Ee,M as xe,N as Te,aw as Oe,H as He,aL as Me,av as qe}from"./index-8abf4cd4.js";import{d as M,c as k,r as H,X as ze,w as Ue,f as je,v as ke,i as _e,a0 as Re,M as We,l as V,x as Y,p as K,n as Ve,ad as he,B as Ge,O as Xe}from"./vendor-1c4f0380.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ne(e,n,t){if(t){const l=[],a=e.value;n.forEach(o=>{const r=a.get(o);r&&l.push(r.rawNode)}),I(t,n,l)}}function te(e,n){const t=[],{children:l}=e||{};return l&&l.forEach(a=>{const{key:o}=a;n!=null&&n.includes(o)||t.push(a.key),t.push(...te(a,n))}),t}function ae(e,n,t){const l=[];for(;n&&!M(n.parentKey);){const{parentKey:a}=n;t!=null&&t.includes(n.parentKey)||l.push(a),n=e.get(a)}return l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ye(e,n){const[t,l]=ee(e,"checkedKeys",()=>[]),a=k(()=>{const s=[];return e.checkable&&n.value.forEach((f,d)=>{f.checkDisabled&&s.push(d)}),s}),o=k(()=>e.cascaderStrategy!=="off"?Qe(n.value,t.value,a.value):t.value),r=k(()=>{const s=o.value;if(s.length===0||e.cascaderStrategy==="off")return[];const f=new Set,d=n.value;return s.forEach(u=>{const{parentKey:b}=d.get(u)||{};if(!M(b)){let g=d.get(b);if(g&&!s.includes(g.key))for(f.add(b);g&&!M(g.parentKey);)f.add(g.parentKey),g=d.get(g.parentKey)}}),[...f]}),c=s=>{const f=s.key,d=n.value,u=a.value,b=e.cascaderStrategy,g=b!=="off",w=g?te(s,u):[],F=o.value.indexOf(f);let D=[...o.value];const S=F>-1||!!w.length&&w.every(i=>D.includes(i)||r.value.includes(i));if(S){const i=g?ae(d,s,u):[];D.splice(F,1),D=D.filter(y=>!i.includes(y)&&!w.includes(y))}else D.push(f),g&&Se(d,s,D,u),D.push(...w);h(S,s.rawNode,Je(b,D,d,u))},h=(s,f,d)=>{const{onCheck:u,onCheckedChange:b}=e;I(u,!s,f),l(d),ne(n,d,b)};return{checkedKeys:t,allCheckedKeys:o,checkDisabledKeys:a,indeterminateKeys:r,handleCheck:c}}function Se(e,n,t,l){let a=!0;for(;a&&n&&!M(n.parentKey);){const o=e.get(n.parentKey);o&&!l.includes(n.parentKey)&&(a=o.children.every(r=>l.includes(r.key)||t.includes(r.key)),a&&t.push(n.parentKey)),n=o}}function Je(e,n,t,l){if(e==="off")return[...new Set(n)];let a=[];n=we(t,n,l),l.length&&(a=n.filter(o=>l.includes(o)));for(const o of n){const r=t.get(o);if(r){const c=r.key,h=r.parentKey;e==="parent"?n.includes(h)||a.push(c):e==="child"?r.isLeaf&&a.push(c):a.push(c)}}return[...new Set(a)]}function Qe(e,n,t){let l=[...n],a;for(const o of n){const r=e.get(o),c=r==null?void 0:r.parentKey,h=te(r,t);l=l.concat(h),!M(c)&&a!==c&&(Se(e,r,l,t),a=c)}return l=we(e,[...new Set(l)],t),l}function we(e,n,t){let l=[...n];if(t.length){for(const a of t)if(!l.includes(a)){const o=e.get(a),r=ae(e,o,t);l=l.filter(c=>!r.includes(c))}}return l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ze(e,n,t,l){const a=k(()=>Ae(e,e.dataSource,n.value,t.value,l.value)),o=k(()=>{const r=new Map;return ge(a.value,r),r});return{mergedNodes:a,mergedNodeMap:o}}function en(e,{expandedKeys:n},t,l){return k(()=>{const{searchValue:a}=t,o=new Map(n.value.map((c,h)=>[c,h])),r=new Map(l.value.map((c,h)=>[c,h]));return a&&!r.size?[]:o.size||r.size?an(e.value,o,r):e.value.map(c=>({...c,expanded:!1,level:0}))})}function Ae(e,n,t,l,a,o,r,c){const{cascaderStrategy:h,disabled:s,loadChildren:f}=e,d=M(r)?-1:r;return n.map((u,b)=>Le(u,t,l,a,s,!!f,b===0,b===n.length-1,d,h,c?[c]:[],o))}function Le(e,n,t,l,a,o,r,c,h,s,f,d){var S,i;const u=t(e),b=nn(e,a),g=e[n],w=e[l];h++;const F=g==null?void 0:g.map((y,C)=>Le(y,n,t,l,a,o,C===0,C===g.length-1,h,s,[b,...f],u)),D=tn(b,f,(S=F==null?void 0:F.map(y=>({check:y.checkDisabled,drag:y.dragDisabled,drop:y.dropDisabled,select:y.selectDisabled})))!=null?S:[],s!=="off");return{label:w,key:u,children:F,isFirst:r,isLeaf:(i=e.isLeaf)!=null?i:!(g!=null&&g.length||o),isLast:c,parentKey:d,expanded:!1,level:h,rawNode:e,checkDisabled:D.check,dragDisabled:D.drag,dropDisabled:D.drop,selectDisabled:D.select}}function nn(e,n){const t=e.disabled||{};if(t===!0)return{check:!0,drag:!0,drop:!0,select:!0};let{check:l,drag:a,drop:o,select:r}=t;if(n){const c=n(e)||{};if(c===!0)return{check:!0,drag:!0,drop:!0,select:!0};l=l||c.check,a=a||c.drag,o=o||c.drop,r=r||c.select}return{check:l,drag:a,drop:o,select:r}}function tn(e,n,t,l){const a=o=>e[o]||l&&(n.some(r=>!!r[o])||!!t.length&&t.every(r=>!!r[o]));return{check:a("check"),drag:a("drag"),drop:a("drop"),select:a("select")}}function ge(e,n){e.forEach(t=>{const{key:l,children:a}=t;n.set(l,t),a&&ge(a,n)})}function Fe(e=[],n){const t=[],l=e.length;return e.forEach((a,o)=>{a.isFirst=o===0,a.isLast=o===l-1,n.has(a.key)||n.size==0?(a.hidden=!1,t.push(a)):a.hidden=!0,Fe(a.children,n).length>0&&(a.hidden=!1,t.push(a))}),t.length&&(t[0].isFirst=!0,t[t.length-1].isLast=!0),t}function an(e,n,t){const l=[],a=[];return Fe(e,t),e.forEach(o=>{for(a.push(o);a.length;){const r=a.pop();if(r){const{children:c,key:h,hidden:s}=r,f=n.has(h);if(r.expanded=f,!s&&l.push(r),c&&f)for(let d=c.length;d>0;d--)!c[d-1].hidden&&a.push(c[d-1])}}}),l}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function on(e,n,{expandedKeys:t,setExpandedKeys:l}){const a=k(()=>{var v;return(v=e.draggableIcon)!=null?v:n.draggableIcon}),o=H(),r=H(),c=H(),h=H(),s=H();let f;const d=()=>{f&&(clearTimeout(f),f=void 0)};ze(()=>d());const u=()=>{M(o.value)||(o.value=void 0,r.value=void 0)},b=()=>{M(c.value)||(c.value=void 0,h.value=void 0,s.value=void 0)},g=(v,x)=>{var L,A;return{evt:v,node:x.rawNode,dragNode:(L=o.value)==null?void 0:L.rawNode,dropNode:(A=c.value)==null?void 0:A.rawNode,dropType:s.value}},w=v=>{D(v,void 0),window.removeEventListener("dragend",w)},F=(v,x)=>{o.value=x,r.value=te(x),rn(x.key,t.value,l),window.addEventListener("dragend",w),I(e.onDragstart,g(v,x))},D=(v,x)=>{x&&I(e.onDragend,g(v,x)),u(),b()},S=async(v,x)=>{const L=o.value;if(L){d(),L.key!==x.key&&(f=setTimeout(()=>{var P;o.value&&((P=x.children)!=null&&P.length)&&ln(x.key,t.value,l),f=void 0},1e3));const A=await Ce(x,L,r.value,v,e.droppable);A?(c.value=x,h.value=A!=="inside"?x.parentKey:void 0,s.value=A):b()}I(e.onDragenter,g(v,x))},i=async(v,x)=>{const L=o.value;if(L){const A=await Ce(x,L,r.value,v,e.droppable);A?(c.value=x,h.value=A!=="inside"?x.parentKey:void 0,s.value=A):b()}I(e.onDragover,g(v,x))},y=(v,x)=>{const L=c.value;(L==null?void 0:L.key)===x.key&&!v.currentTarget.contains(v.relatedTarget)&&b(),I(e.onDragleave,g(v,x))},C=(v,x)=>{s.value||b(),I(e.onDrop,g(v,x)),u(),b()};return{draggableIcon:a,dragKey:k(()=>{var v;return(v=o.value)==null?void 0:v.key}),dropKey:k(()=>{var v;return(v=c.value)==null?void 0:v.key}),dropParentKey:h,dropType:s,handleDragstart:F,handleDragend:D,handleDragenter:S,handleDragover:i,handleDragleave:y,handleDrop:C}}function ln(e,n,t){n.indexOf(e)===-1&&t([...n,e])}function rn(e,n,t){const l=n.indexOf(e);if(l!==-1){const a=[...n];a.splice(l,1),t(a)}}async function Ce(e,n,t,l,a){const{key:o,children:r=[]}=e;if(n.key===o||t&&t.includes(o))return!1;const{clientY:c}=l,{top:h,height:s}=l.target.getBoundingClientRect(),f=c<h+s/2;let d;if(a){const u={evt:l,isTopHalf:f,dragNode:n.rawNode,dropNode:e.rawNode};d=await a(u)}return(d===void 0||d===!0)&&(r.length>0?d="inside":f?d="before":d="after"),d}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function cn(e,n,t,{expandedKeys:l,handleExpand:a},{activeKey:o,handleSelect:r}){const c=H(!1);return{focused:c,handleFocus:u=>{c.value=!0,I(e.onFocus,u)},handleBlur:u=>{c.value=!0,I(e.onBlur,u)},handleKeydown:u=>{switch(u.code){case"ArrowUp":case"ArrowDown":u.preventDefault()}I(e.onKeydown,u)},handleKeyup:u=>{const b=u.code,g=o.value,w=t.value,F=w.length;if(g===void 0)["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(b)&&fe(o,w,0,F);else{const D=t.value,S=D.findIndex(i=>i.key===g);if(S===-1)return;switch(b){case"Enter":case"NumpadEnter":r(g);break;case"ArrowDown":fe(o,D,S+1,F);break;case"ArrowUp":fe(o,D,S-1,0,!0);break;case"ArrowLeft":{const{rawNode:i,key:y,parentKey:C}=D[S];if(i.isLeaf||!l.value.includes(y)){const v=C?n.value.get(C):void 0;v&&(o.value=v.key)}else a(y,i)}break;case"ArrowRight":{const{rawNode:i,key:y}=D[S];if(!l.value.includes(y))a(y,i);else for(let C=S+1;C<F;C++){const v=D[C];o.value=v.key;break}}break}}I(e.onKeyup,u)}}}function fe(e,n,t,l,a=!1){let o=t;for(;a?o>=l:o<l;){const r=n[o];if(r.selectDisabled)a?o--:o++;else{e.value=r.key;return}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function sn(e,n,t,l,a,o,r){const c=k(()=>{var i;return(i=e.expandIcon)!=null?i:n.expandIcon}),[h,s]=ee(e,"expandedKeys",()=>[]),[f,d]=ee(e,"loadedKeys",()=>[]),u=H([]),b=({key:i,expanded:y,node:C})=>{if(je(c.value))return ke(j,{name:c.value,rotate:y?90:0});if(_e(c.value))return c.value({key:i,expanded:y,node:C});if(Re(c.value))return ke(j,{name:y?c.value[0]:c.value[1]})},g=i=>{if(!i||i.length<=0)return;const{onExpandedChange:y}=e,C=o.value,v=new Set(h.value);i.forEach(L=>{ae(C,C.get(L)).forEach(A=>v.add(A))});const x=[...v];s(x),ne(o,x,y)};Ue(r,g);const w=async(i,y)=>{var P;const{loadChildren:C}=e;if(u.value.includes(i))return;const v=t.value;if(!((P=y==null?void 0:y[v])!=null&&P.length)){if(!C||u.value.includes(i)||f.value.includes(i))return;u.value.push(i);const N=await C(y);u.value.splice(u.value.indexOf(i),1);const q=o.value,E=q.get(i);if(N!=null&&N.length){const X=E.level,_=Ae(e,N,v,l.value,a.value,i,X,{check:!!E.checkDisabled,drag:!!E.dragDisabled,drop:!!E.dropDisabled,select:!!E.selectDisabled});ge(_,q),E.rawNode[v]=N,E.children=_;const R=[...f.value,i];d(R),I(e.onLoaded,R,y)}else return}const x=h.value.indexOf(i),L=x>=0,A=[...h.value];L?A.splice(x,1):A.push(i),F(L,y,A)},F=(i,y,C)=>{const{onExpand:v,onExpandedChange:x}=e;I(v,!i,y),s(C),ne(o,C,x)},D=()=>{const i=[],y=[];o.value.forEach(C=>{C.isLeaf||(i.push(C.key),y.push(C.rawNode))}),I(e.onExpandedChange,i,y),s(i)},S=()=>{I(e.onExpandedChange,[],[]),s([])};return r.value.length&&g(r.value),{expandIconRenderer:b,expandedKeys:h,setExpandedKeys:s,expandAll:D,collapseAll:S,handleExpand:w,loadingKeys:u}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dn(e,n,t){const l=un(e,t);return{searchedKeys:k(()=>{const{searchValue:o}=e;if(!o)return Pe;const r=l.value,c=[];return n.value.forEach(h=>{r(h.rawNode,o)&&c.push(h.key)}),c})}}function un(e,n){return k(()=>{var t;return(t=e.searchFn)!=null?t:fn(n.value)})}function fn(e){return(n,t)=>{const l=n[e];return l?l.toLowerCase().includes(t.toLowerCase()):!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function hn(e,n){const[t,l]=ee(e,"selectedKeys",()=>[]),a=k(()=>e.selectable==="multiple"),o=H();We(()=>{const s=t.value,f=s.length;o.value=f>0?s[f-1]:void 0});const r=k(()=>{const s=o.value;return s!==void 0?n.value.get(s):void 0}),c=s=>{const d=n.value.get(s);if(!d)return;const u=t.value.indexOf(s),b=u>-1;let g=[...t.value];a.value?b?g.splice(u,1):g.push(s):g=b?[]:[s],h(b,d.rawNode,g)},h=(s,f,d)=>{var w;const{onSelect:u,onSelectedChange:b}=e,g=d.includes((w=f.key)!=null?w:"")?!0:!s;I(u,g,f),l(d),ne(n,d,b)};return{activeKey:o,activeNode:r,selectedKeys:t,handleSelect:c}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const G=Symbol("treeToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const gn={autoHeight:{type:Boolean,default:void 0},checkedKeys:Array,expandedKeys:Array,indeterminateKeys:Array,loadedKeys:Array,selectedKeys:Array,blocked:{type:Boolean,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},childrenKey:String,checkOnClick:{type:Boolean,default:!1},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:Function,draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:Function,empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Function,Array],default:void 0},getKey:{type:[String,Function],default:void 0},height:Number,labelKey:String,leafLineIcon:String,loadChildren:Function,searchFn:Function,searchValue:String,selectable:{type:[Boolean,String],default:!0},showLine:{type:Boolean,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualItemHeight:{type:Number,default:28},"onUpdate:checkedKeys":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],"onUpdate:selectedKeys":[Function,Array],onCheck:[Function,Array],onCheckedChange:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onSelect:[Function,Array],onSelectedChange:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onKeydown:[Function,Array],onKeyup:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},vn={node:{type:Object,required:!0},isLeaf:{type:Boolean,required:!0},isFirst:{type:Boolean,required:!0},isLast:{type:Boolean,required:!0},label:String,level:{type:Number,required:!0},rawNode:{type:Object,required:!0},expanded:{type:Boolean,required:!0},children:Array,parentKey:[String,Number,Symbol],checkDisabled:{type:Boolean,default:void 0},dragDisabled:{type:Boolean,default:void 0},dropDisabled:{type:Boolean,default:void 0},selectDisabled:{type:Boolean,default:void 0}},yn={node:{type:Object,required:!0},checkDisabled:{type:Boolean,default:void 0}},pn={expanded:{type:Boolean,required:!0},hasTopLine:{type:Boolean,default:void 0},hasBottomLine:{type:Boolean,default:void 0},isLeaf:{type:Boolean,default:void 0},nodeKey:{type:[String,Number,Symbol],required:!0},rawNode:{type:Object,required:!0}},bn={disabled:{type:Boolean,default:void 0},node:{type:Object,required:!0},nodeKey:{type:[String,Number,Symbol],required:!0},label:String,selected:{type:Boolean,default:void 0}},xn=V({props:yn,setup(e){const{mergedPrefixCls:n,allCheckedKeys:t,indeterminateKeys:l,handleCheck:a}=Y(G),o=k(()=>t.value.includes(e.node.key)),r=k(()=>l.value.includes(e.node.key)),c=()=>a(e.node);return()=>K(Ee,{class:`${n.value}-node-checkbox`,checked:o.value,disabled:e.checkDisabled,indeterminate:r.value,onChange:c},null)}}),kn=V({props:bn,setup(e,{slots:n}){const{props:t,mergedPrefixCls:l,mergedCheckOnClick:a,handleSelect:o,handleCheck:r,searchedKeys:c}=Y(G),h=k(()=>c.value.includes(e.nodeKey)),s=d=>{e.disabled||(o(e.nodeKey),a.value&&r(e.node)),I(t.onNodeClick,d,e.node.rawNode)},f=d=>{I(t.onNodeContextmenu,d,e.node.rawNode)};return()=>{var v,x;const{nodeKey:d,label:u,node:b,selected:g}=e,{rawNode:w}=b,{prefix:F,suffix:D}=w,S={key:d,selected:g,node:w},i=((v=n.prefix)==null?void 0:v.call(n,S))||F&&K(j,{name:F},null),y=((x=n.suffix)==null?void 0:x.call(n,S))||D&&K(j,{name:D},null),C=`${l.value}-node-content`;return K("span",{class:C,onClick:s,onContextmenu:f},[i&&K("span",{class:`${C}-prefix`},[i]),K("span",{class:`${C}-label`},[Cn(n.label,u,w,t.searchValue,h.value,C)]),y&&K("span",{class:`${C}-suffix`},[y])])}}});function Cn(e,n,t,l,a,o){if(e)return e({node:t,searchValue:l,searched:a});if(a&&n&&l){const r=n.toUpperCase().indexOf(l.toUpperCase());if(r>-1){const c=r+l.length,h=n.substring(0,r),s=n.substring(c),f=K("span",{class:`${o}-label-highlight`},[n.substring(r,c)]);return[h,f,s]}}return n}const mn=V({props:pn,setup(e,{slots:n}){const{mergedPrefixCls:t,expandIconRenderer:l,loadingKeys:a,handleExpand:o}=Y(G),r=k(()=>a.value.includes(e.nodeKey)),c=k(()=>{const s=`${t.value}-node-expand`;return Ve({[s]:!0,[`${s}-noop`]:e.isLeaf})}),h=s=>{o(e.nodeKey,e.rawNode),s.stopPropagation()};return()=>{var d,u;const s=`${t.value}-node-expand`;let f;if(r.value)f=K(j,{name:"loading"},null);else if(!e.isLeaf){const{expanded:b,nodeKey:g,rawNode:w}=e;f=(u=(d=n.expandIcon)!=null?d:l)==null?void 0:u({key:g,expanded:b,node:w})}return K("span",{class:c.value,onClick:h},[e.hasTopLine&&K("div",{class:`${s}-top-line`},null),f,e.hasBottomLine&&K("div",{class:`${s}-bottom-line`},null)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Kn=({level:e,noopIdentUnitArr:n,prefixCls:t})=>{const l=[];for(let a=0;a<e;a++)l.push(K("span",{key:a,class:n.includes(a)?`${t}-node-indent-noop-unit`:`${t}-node-indent-unit`},null));return K("span",{"aria-hidden":!0,class:`${t}-node-indent`},[l])},Dn=Kn,Sn=V({setup(e,{slots:n}){const{props:t,mergedPrefixCls:l}=Y(G);return()=>{const a=`${l.value}-node-leaf`;let o;return n.leafLineIcon?o=n.leafLineIcon():t.leafLineIcon?o=K(j,{name:t.leafLineIcon},null):o=K("span",{class:`${a}-line`},null),K("span",{class:a},[o])}}}),me=V({props:vn,setup(e,{slots:n}){const{props:t,flattedNodes:l,mergedPrefixCls:a,mergedShowLine:o,activeKey:r,selectedKeys:c,draggableIcon:h,dragKey:s,dropKey:f,dropParentKey:d,dropType:u,handleDragstart:b,handleDragend:g,handleDragenter:w,handleDragover:F,handleDragleave:D,handleDrop:S}=Y(G),i=k(()=>e.node.key),y=k(()=>r.value===i.value),C=k(()=>o.value&&e.isLast),v=k(()=>o.value&&!e.isLeaf&&(!e.isFirst||e.level!==0)),x=k(()=>o.value&&!e.isLeaf&&!e.isLast),L=k(()=>c.value.includes(i.value)),A=k(()=>e.selectDisabled||!t.selectable),P=k(()=>s.value===i.value),N=k(()=>f.value===i.value),q=k(()=>d.value===i.value),E=k(()=>N.value&&u.value==="before"),X=k(()=>N.value&&u.value==="inside"),_=k(()=>N.value&&u.value==="after"),R=k(()=>{const m=`${a.value}-node`;return{[m]:!0,[`${m}-active`]:y.value,[`${m}-last`]:C.value,[`${m}-disabled`]:A.value,[`${m}-selected`]:L.value,[`${m}-expanded`]:e.expanded,[`${m}-dragging`]:P.value,[`${m}-dropping`]:N.value,[`${m}-drop-parent`]:q.value,[`${m}-drop-before`]:E.value,[`${m}-drop-inside`]:X.value,[`${m}-drop-after`]:_.value}}),oe=m=>{var z;m.stopPropagation(),b(m,e.node),(z=m.dataTransfer)==null||z.setData("text/plain","")},le=m=>{m.stopPropagation(),g(m,e.node)},re=m=>{m.preventDefault(),m.stopPropagation(),w(m,e.node)},ce=m=>{m.preventDefault(),m.stopPropagation(),F(m,e.node)},se=m=>{m.stopPropagation(),D(m,e.node)},de=m=>{m.stopPropagation(),S(m,e.node)};return()=>{var ye,pe;const m=new Map;l.value.forEach(Z=>{m.set(Z.key,Z)});const{isLeaf:z,label:p,level:$,rawNode:T,expanded:O,checkDisabled:U,dragDisabled:W,dropDisabled:ie,node:J}=e,{checkable:ue,draggable:Q}=t,B=Q&&!W,$e=(pe=(ye=n.draggableIcon)==null?void 0:ye.call(n))!=null?pe:K(j,{name:h.value},null),Ie=m.get(i.value),ve=[];o.value&&ae(m,Ie).reverse().forEach((Z,Ne)=>{var be;(be=m.get(Z))!=null&&be.isLast&&ve.push(Ne)});const Be=t.customAdditional?t.customAdditional({node:T,level:$}):void 0;return K("div",he({class:R.value,"aria-grabbed":P.value||void 0,"aria-label":p,"aria-selected":L.value,draggable:B||void 0,title:p,onDragstart:B?oe:void 0,onDragend:B?le:void 0,onDragenter:B?re:void 0,onDragover:B?ce:void 0,onDragleave:B?se:void 0,onDrop:B&&!ie?de:void 0},Be),[K(Dn,{level:$,noopIdentUnitArr:ve,prefixCls:a.value},null),B?K("span",{class:`${a.value}-node-draggable-icon`},[$e]):Q&&K("span",{class:`${a.value}-node-draggable-icon-noop`},null),z&&o.value?K(Sn,null,n):K(mn,{expanded:O,hasTopLine:v.value,hasBottomLine:x.value,isLeaf:z,nodeKey:i.value,rawNode:T},n),ue&&K(xn,{checkDisabled:U,node:J},null),K(kn,{disabled:A.value,node:J,nodeKey:i.value,label:p,selected:L.value},n)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ke(e){const{heightMd:n,heightSm:t,fontSizeIcon:l,marginSizeXs:a,paddingSizeXs:o,paddingSizeSm:r,colorPrimaryHover:c,colorPrimaryText:h,colorContainerBgHover:s,colorContainerBg:f,colorIconInfo:d}=e,u=t;return{dropLineWidth:2,dropLineColor:c,bgColor:f,nodeBgColorHover:s,nodeBgColorSelected:f,nodeColorSelected:h,nodePaddingVertical:"0px",nodeContentHeight:n,nodeContentPadding:`0 ${r}px 0 ${o}px`,nodeContentLabelPadding:`0 ${o}px`,nodeContentLabelHighlightColor:h,nodeCheckboxMargin:`0 ${a}px 0 ${Math.max((l-u)/2+1,1)}px`,nodeIconWidth:u,expandIconColor:d}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const wn=(e,n)=>Ke(e),De={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},An=V({name:"IxTree",props:gn,setup(e,{attrs:n,expose:t,slots:l}){const a=xe("common"),{globalHashId:o,hashId:r,registerToken:c}=Te("tree");c(wn);const h=k(()=>`${a.prefixCls}-tree`),s=xe("tree"),f=k(()=>{var p;return(p=e.autoHeight)!=null?p:s.autoHeight}),d=k(()=>{var p;return(p=e.childrenKey)!=null?p:s.childrenKey}),u=Oe(e,s),b=k(()=>{var p;return(p=e.labelKey)!=null?p:s.labelKey}),g=k(()=>{var p;return(p=e.showLine)!=null?p:s.showLine}),w=k(()=>{var p;return(p=e.blocked)!=null?p:s.blocked}),F=k(()=>e.checkable&&e.checkOnClick),{mergedNodes:D,mergedNodeMap:S}=Ze(e,d,u,b),{searchedKeys:i}=dn(e,S,b),y=sn(e,s,d,u,b,S,i),C=en(D,y,e,i),v=Ye(e,S),x=on(e,s,y),L=hn(e,S);Ge(G,{props:e,config:s,flattedNodes:C,mergedPrefixCls:h,mergedNodeMap:S,mergedGetKey:u,mergedShowLine:g,mergedCheckOnClick:F,searchedKeys:i,...v,...y,...x,...L});const A=H(),P=H(),{activeKey:N}=L,{focused:q,handleFocus:E,handleBlur:X,handleKeydown:_,handleKeyup:R}=cn(e,S,C,y,L),oe=k(()=>{const p=h.value;return{[o.value]:!!o.value,[r.value]:!!r.value,[p]:!0,[`${p}-active`]:!M(N.value),[`${p}-blocked`]:w.value,[`${p}-virtual`]:e.virtual,[`${p}-auto-height`]:f.value,[`${p}-focused`]:q.value,[`${p}-show-line`]:g.value,[`${p}-empty`]:!C.value.length}}),le=k(()=>{var U,W;const p=N.value;if(M(p))return"";const $=S.value;let T=String(p),O=(U=$.get(p))==null?void 0:U.parentKey;for(;O;)T=`${String(O)} > ${T}`,O=(W=$.get(O))==null?void 0:W.parentKey;return T}),re=p=>{var $;($=A==null?void 0:A.value)==null||$.focus(p)},ce=()=>{var p;(p=A==null?void 0:A.value)==null||p.blur()},se=p=>{var $;($=P.value)==null||$.scrollTo(p)},de=p=>{var $;return($=S.value.get(p))==null?void 0:$.rawNode},m=()=>C.value;t({focus:re,blur:ce,expandAll:y.expandAll,collapseAll:y.collapseAll,scrollTo:se,getNode:de,_getFlattedNodes:m});const z=(p,$,T)=>{I(e.onScrolledChange,p,$,T.map(O=>O.rawNode))};return()=>{var T;const p=C.value;let $;if(p.length>0){const O=({item:B})=>K(me,he({node:B},B),l),{height:U,virtual:W,virtualItemHeight:ie,virtualScrollMode:J,onScroll:ue,onScrolledBottom:Q}=e;$=W?K(He,{ref:P,class:`${h.value}-content`,dataSource:p,getKey:"key",height:f.value?"100%":U,rowHeight:ie,rowRender:O,virtual:!0,scrollMode:J,onScroll:ue,onScrolledBottom:Q,onScrolledChange:z},null):K("div",{class:`${h.value}-content`,style:Xe(f.value?void 0:{maxHeight:Me(U)})},[K("div",{class:`${h.value}-content-inner`},[p.map(B=>K(me,he({node:B},B),l))])])}else $=K(qe,{empty:e.empty},l);return K("div",{class:oe.value,role:"tree"},[q.value&&K("span",{style:De,"aria-live":"assertive"},[le.value]),K("input",{ref:A,style:De,tabindex:(T=n.tabIndex)!=null?T:0,onFocus:E,onBlur:X,onKeydown:_,onKeyup:R,value:"","aria-label":"for screen reader"},null),$])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const $n=An;export{$n as I};
