import{a6 as re,A as k,am as ie,ac as ce,j as ue,c as de,m as L,k as he,K as te,R as j,L as fe,Y as me,I as ge}from"./index-20a6d8b7.js";import{t as Ce,g as be,I as pe}from"./index-f4358f06.js";import{u as G}from"./globalConfig-6a16b64f.js";import{I as ve}from"./index-0a648417.js";import{I as ye}from"./index-77cab74e.js";import{x as V,l as Y,c as x,A as u,z as _,w as W,f as $,r as X,m as xe,q as Te,a4 as ke,b as ze}from"./vendor-63a43443.js";import{u as Pe,a as Ie}from"./index-278a5a66.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const K=Symbol("proTableToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function S(e,t){!e||e.length===0||e.forEach(n=>{t(n),"children"in n&&S(n.children,t)})}function Se(e,t){const{title:n,type:l}=e;return n||(l?t.layout[l]:"")}const H=V({props:{columns:{type:Array,required:!0},searchValue:{type:String,default:void 0},title:{type:String,default:void 0},onDrop:{type:Function,required:!0},onFixedChange:{type:Function,required:!0},onVisibleChange:{type:Function,required:!0}},setup(e){const t=re(),{locale:n,mergedPrefixCls:l}=Y(K),i=x(()=>Re(e.columns)),d=(a,s)=>{s.children?S(s.children,o=>{!o.children&&o.changeVisible!==!1&&(o.visible=a)}):s.visible=a,e.onVisibleChange()},h=a=>{const{dragNode:s,dropNode:o,dropType:b}=a,C=s==null?void 0:s.key,p=o==null?void 0:o.key;if(!C||!p)return;const v=we(e.columns,C,p,b);e.onDrop(t,v)},f=(a,s,o)=>{o.preventDefault(),s.fixed=a,S(s.children,b=>{b.fixed=a}),e.onFixedChange()};return()=>{const a=e.columns.filter(c=>c.layoutable!==!1);if(a.length===0)return;const{searchValue:s,title:o}=e,{startPin:b,endPin:C,noPin:p}=n.table.layout,v={blocked:!0,cascaderStrategy:"all",checkable:!0,checkedKeys:i.value,checkOnClick:!0,draggable:!0,dataSource:a,disabled:Ve,empty:"",childrenKey:"children",getKey:"key",labelKey:"title",searchValue:s,onCheck:d,onDrop:h},y={label:({node:c})=>Se(c,n.table),suffix:({node:c})=>{if(c.changeFixed===!1||c.parentKey!=null)return null;const{fixed:r}=c;return r==="start"?[u(k,{name:"vertical-align-center",title:p,onClick:g=>f(void 0,c,g)},null),u(k,{name:"vertical-align-top",rotate:180,title:C,onClick:g=>f("end",c,g)},null)]:r==="end"?[u(k,{name:"vertical-align-top",title:b,onClick:g=>f("start",c,g)},null),u(k,{name:"vertical-align-center",title:p,onClick:g=>f(void 0,c,g)},null)]:[u(k,{name:"vertical-align-top",title:b,onClick:g=>f("start",c,g)},null),u(k,{name:"vertical-align-top",rotate:180,title:C,onClick:g=>f("end",c,g)},null)]}},m=`${l.value}-layout-tool-tree`;return u("div",{class:m},[o&&u("div",{class:`${m}-title`},[o]),u(ye,v,y)])}}});function Ve(e){const{changeIndex:t,changeVisible:n}=e;return t!==!1&&n!==!1?!1:{check:n===!1,drag:t===!1}}function Re(e){const t=[];return ne(e,t),t}function ne(e,t){for(let n=0;n<e.length;n++){const l=e[n];l.visible!==!1&&("children"in l&&l.children?ne(l.children,t):t.push(l.key))}}function we(e,t,n,l){const i=[...e];let d;if(A(i,t,(h,f,a)=>{d=h,a.splice(f,1)}),l==="inside")A(i,n,h=>{h.children.unshift(d)});else{let h,f=[];A(i,n,(a,s,o)=>{h=s,f=o}),l==="before"?f.splice(h,0,d):f.splice(h+1,0,d)}return i}function A(e,t,n){for(let l=0;l<e.length;l++){const i=e[l];if(i.key===t)return n(i,l,e);"children"in i&&i.children&&A(i.children,t,n)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Fe={...Ce,columns:{type:Array,default:()=>[]},layoutTool:{type:[Boolean,Object],default:!0},toolbar:{type:Array,default:void 0},onColumnsChange:[Function,Array]},$e={changeSize:{type:Boolean,default:void 0},className:{type:String,default:void 0},placeholder:{type:String,default:void 0},resetable:{type:Boolean,default:void 0},searchable:{type:Boolean,default:void 0},searchValue:{type:String,default:void 0},visible:{type:Boolean,default:void 0},"onUpdate:searchValue":[Function,Array],"onUpdate:visible":[Function,Array],onReset:[Function,Array]},Ae={placeholder:{type:String,default:void 0},resetable:{type:Boolean,required:!0},searchable:{type:Boolean,required:!0},searchValue:{type:String,default:void 0},"onUpdate:searchValue":[Function,Array],onReset:[Function,Array]},Ee=V({props:Ae,setup(e){const{locale:t,mergedPrefixCls:n,mergedColumns:l,setMergedColumns:i,mergedColumnMap:d,resetColumns:h}=Y(K),f=x(()=>l.value.length!==d.value.size),a=x(()=>l.value.filter(m=>m.visible===!1)),[s,o]=ie(e,"searchValue"),b=m=>{const c=m.target.value;o(c)},C=m=>{L(e.onReset,m)!==!1&&h()},p=m=>{S(l.value,c=>{!c.children&&c.changeVisible!==!1&&(c.visible=m)}),v()},v=()=>{const{startColumns:m,centerColumns:c,endColumns:r}=ee(l.value);i([...m,...c,...r])},y=()=>{i([...l.value])};return()=>{var Q;const{startColumns:m,centerColumns:c,endColumns:r}=ee(l.value),g=m.length>0,z=r.length>0,P=g||z,T=`${n.value}-layout-tool`,D=_({[`${T}-content`]:!0,[`${T}-with-fixed`]:P,[`${T}-with-children`]:f.value}),{placeholder:I,all:M,reset:B,startPinTitle:N,noPinTitle:R,endPinTitle:w}=t.table.layout,q=(Z,O)=>{i(Z==="start"?[...O,...c,...r]:Z==="center"?[...m,...O,...r]:[...m,...c,...O])},J=l.value.length,U=a.value.length,oe=U===0&&J!==0,se=U>0&&U!==J,F=s.value;return u("div",{class:D},[e.searchable&&u("div",{class:`${T}-search-wrapper`},[u(ce,{placeholder:(Q=e.placeholder)!=null?Q:I,size:"sm",suffix:"search",value:F,onInput:b},null)]),u("div",{class:`${T}-select-wrapper`},[u(ue,{checked:oe,indeterminate:se,label:M,onChange:p},null),e.resetable&&u(de,{size:"sm",mode:"link",onClick:C},{default:()=>[B]})]),u("div",{class:`${T}-tree-wrapper`},[g&&u(H,{key:"start",columns:m,searchValue:F,title:N,onDrop:q,onFixedChange:v,onVisibleChange:y},null),(!P||c.length>0)&&u(H,{key:"center",columns:c,searchValue:F,title:P?R:void 0,onDrop:q,onFixedChange:v,onVisibleChange:y},null),z&&u(H,{key:"end",columns:r,searchValue:F,title:w,onDrop:q,onFixedChange:v,onVisibleChange:y},null)])])}}});function ee(e){const t=[],n=[],l=[];return e.forEach(i=>{const{fixed:d}=i;d==="start"?t.push(i):d==="end"?n.push(i):l.push(i)}),{startColumns:t,endColumns:n,centerColumns:l}}const Le=[0,4],We={sm:"grid-compact",md:"grid-medium",lg:"grid-loose"},le=V({name:"IxProTableLayoutTool",props:$e,setup(e,{slots:t}){const{config:n,locale:l,mergedPrefixCls:i,mergedSize:d,setMergedSize:h}=Y(K),f=x(()=>{var o;return(o=e.changeSize)!=null?o:n.layoutTool.changeSize}),a=x(()=>{var o;return(o=e.resetable)!=null?o:n.layoutTool.resetable}),s=x(()=>{var o;return(o=e.searchable)!=null?o:n.layoutTool.searchable});return()=>{var m;const o=`${i.value}-layout-tool`,b=l.table.layout,C=c=>{const r=We[c],g=b[c];return u(k,{key:r,class:_([`${o}-header-icon`,d.value===c?`${o}-header-icon-active`:""]),name:r,title:g,onClick:()=>h(c)},null)},p=f.value?u(he,null,{default:()=>[C("sm"),C("md"),C("lg")]}):void 0,v={placeholder:e.placeholder,resetable:a.value,searchable:s.value,searchValue:e.searchValue,"onUpdate:searchValue":e["onUpdate:searchValue"],onReset:e.onReset},y={class:_([o,e.className]),header:{title:b.title,suffix:p},offset:Le,placement:"bottomEnd",showArrow:!1,trigger:"click",visible:e.visible,"onUpdate:visible":e["onUpdate:visible"]};return u(ve,y,{default:(m=t.default)!=null?m:()=>u("span",{class:`${o}-trigger`},[u(k,{name:"ellipsis"},null)]),content:()=>u(Ee,v,null)})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ke(e,t){const n=x(()=>e.columns),[l,i]=te(E(n.value,t)),d=x(()=>{const a=new Map;return S(l.value,s=>a.set(s.key,s)),a}),h=x(()=>ae(l.value));return W(n,a=>i(E(a,t))),W(l,a=>L(e.onColumnsChange,a)),{mergedColumns:l,setMergedColumns:i,mergedColumnMap:d,displayColumns:h,resetColumns:()=>i(E(n.value,t))}}function E(e,t,n){return e.map(l=>De(l,t,n))}function De(e,t,n){var h;const l=be(e),d={...e.type==="indexable"?t.columnIndexable:void 0,...e,key:l,parentKey:n};return(h=e.children)!=null&&h.length&&(d.children=E(e.children,t,l)),d}function ae(e){const t=[];return e.forEach(n=>{if(n.visible!==!1)if("children"in n&&n.children){const l=ae(n.children);if(l.length===0)return;t.push({...n,children:l})}else t.push(n)}),t}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Me({mergedColumns:e,setMergedColumns:t,mergedColumnMap:n}){return{hasResizable:x(()=>e.value.some(d=>d.resizable)),onResizeEnd:(d,h,f)=>{const a=n.value.get(d);if(!a)return;const s=a.width,o=$(s)?j(s.replace("px","")):s;if(!o)a.width=h;else{const b=h-f,C=Math.floor(o*h/b*1e3)/1e3,{minWidth:p,maxWidth:v}=a,y=$(p)?j(p.replace("px","")):p,m=$(v)?j(v.replace("px",""),Number.MAX_SAFE_INTEGER):v;y&&C<y?a.width=y:m&&C>m?a.width=m:a.width=C}t([...e.value])}}}const Be=V({props:["column","onClick","onResizeEnd"],setup(e,{slots:t}){const n=X(),l=s=>{L(e.onResizeEnd,e.column.key,s.width,s.offsetWidth)},i=xe({maxWidth:e.column.maxWidth,minWidth:e.column.minWidth,onResizeEnd:l}),{resizing:d,position:h}=Pe(n,i),f=X(!d.value);W(d,s=>{s?f.value=!1:setTimeout(()=>f.value=!0)});const a=s=>{f.value&&L(e.onClick,s)};return()=>{var o,b;if(!e.column.resizable)return u("th",{onClick:a},[(o=t.default)==null?void 0:o.call(t)]);const s=[u(Ie,{placement:"end"},null)];if(d.value){const{width:C,height:p}=h.value;s.push(u("div",{class:"cdk-resizable-preview",style:`width:${C}px;height:${p}px`},null))}return u("th",{ref:n,onClick:a},[(b=t.default)==null?void 0:b.call(t),s])}}}),Ne=V({name:"IxProTable",props:Fe,setup(e,{slots:t,expose:n}){const l=G("common"),i=G("table"),d=fe("table"),h=G("locale"),f=x(()=>`${l.prefixCls}-table`),a=Ke(e,i),{hasResizable:s,onResizeEnd:o}=Me(a),b=x(()=>{var r;return(r=e.size)!=null?r:d.size}),[C,p]=te(b.value);W(b,p),Te(K,{props:e,config:i,locale:h,mergedPrefixCls:f,mergedSize:C,setMergedSize:p,...a});const v=X();n({scrollTo:r=>{var g;return(g=v.value)==null?void 0:g.scrollTo(r)}});const y=()=>{const{layoutTool:r}=e;if(!r)return null;const g=ze(r)?r:void 0;return u(le,g,null)},m=()=>{const{toolbar:r}=e;if(r)return r.length<=1?r:u(ge,{align:"center",gap:8},{default:()=>[r]})},c=()=>{var z;if(t.header)return t.header();const{header:r,toolbar:g}=e;if(r||g||t.toolbar){const P={suffix:(z=t.toolbar)!=null?z:m},T=$(r)?{title:r}:r;return u(me,T,P)}};return()=>{const{customAdditional:r,customTag:g,layoutTool:z,toolbar:P,tableLayout:T,...D}=e,I=s.value,M=T||(I?"fixed":void 0),B={...r,headCell:({column:R})=>{const w=r!=null&&r.headCell?r.headCell({column:R}):void 0;return I?{...w,column:R,onResizeEnd:o}:w}},N={headCell:I?Be:void 0,...g};return u(pe,ke({ref:v},D,{class:f.value,columns:a.displayColumns.value,customAdditional:B,customTag:N,size:C.value,tableLayout:M}),{...t,header:c,default:y})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Xe=Ne,Ye=le;export{Xe as I,Ye as a};
