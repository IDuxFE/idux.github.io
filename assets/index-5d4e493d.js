import{A as R,ao as ce,a9 as de,j as he,c as fe,aP as me,m as U,k as ge,ak as oe,O as _,M as Ce,aq as be,I as ye}from"./index-c8d09f7e.js";import{t as ve,g as pe,I as xe}from"./index-f3910f64.js";import{u as X}from"./globalConfig-41efd36e.js";import{I as ke}from"./index-0acad939.js";import{I as Te,f as se,m as J}from"./index-239b668a.js";import{l as L,y as te,q as u,c as S,p as Z,w as N,f as M,r as ee,z as ze,D as Pe,a8 as Se,b as we}from"./vendor-754a3ca4.js";import{u as Ie,a as Ve}from"./index-7f1383b6.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const O=Symbol("proTableToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Fe(e,t){const{title:l,type:n}=e;return l||(n?t.layout[n]:"")}const Q=L({props:{columns:{type:Array,required:!0},checkedKeys:{type:Array,required:!0},searchValue:{type:String,default:void 0},title:{type:String,default:void 0},onDrop:{type:Function,required:!0},onFixedChange:{type:Function,required:!0},onVisibleChange:{type:Function,required:!0}},setup(e){const{locale:t,mergedPrefixCls:l}=te(O),n=r=>{const c=new Set(r),s=new Set(e.checkedKeys);r.forEach(d=>{s.has(d)&&(c.delete(d),s.delete(d))}),e.onVisibleChange(c,s)},i=r=>{const{dragNode:c,dropNode:s}=r,d=c==null?void 0:c.key,o=s==null?void 0:s.key;!d||!o||e.onDrop(r)},a=(r,c,s)=>{s.preventDefault(),s.stopImmediatePropagation(),e.onFixedChange(c,r)};return()=>{if(e.columns.length===0)return;const r=`${l.value}-layout-tool-tree`,{columns:c,searchValue:s,title:d}=e,{startPin:o,endPin:y,noPin:v}=t.table.layout,b={blocked:!0,cascaderStrategy:"child",checkable:!0,checkedKeys:e.checkedKeys,checkOnClick:!0,draggable:!0,dataSource:c,disabled:Re,empty:"",childrenKey:"children",getKey:"key",labelKey:"title",searchValue:s,searchFn:()=>!0,onCheckedChange:n,onDrop:i},k={label:({node:f})=>Fe(f,t.table),suffix:({node:f})=>{if(f.changeFixed===!1||f.parentKey!=null)return null;const{fixed:z}=f;return z==="start"?[u(R,{name:"vertical-align-center",title:v,onClick:m=>a(void 0,f,m)},null),u(R,{name:"vertical-align-top",rotate:180,title:y,onClick:m=>a("end",f,m)},null)]:z==="end"?[u(R,{name:"vertical-align-top",title:o,onClick:m=>a("start",f,m)},null),u(R,{name:"vertical-align-center",title:v,onClick:m=>a(void 0,f,m)},null)]:[u(R,{name:"vertical-align-top",title:o,onClick:m=>a("start",f,m)},null),u(R,{name:"vertical-align-top",rotate:180,title:y,onClick:m=>a("end",f,m)},null)]}};return u("div",{class:r},[d&&u("div",{class:`${r}-title`},[d]),u(Te,b,k)])}}});function Re(e){const{changeIndex:t,changeVisible:l}=e;return t!==!1&&l!==!1?!1:{check:l===!1,select:l===!1,drag:t===!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const $e={...ve,columns:{type:Array,default:()=>[]},layoutTool:{type:[Boolean,Object],default:!0},toolbar:{type:Array,default:void 0},onColumnsChange:[Function,Array]},Ae={changeSize:{type:Boolean,default:void 0},className:{type:String,default:void 0},placeholder:{type:String,default:void 0},resetable:{type:Boolean,default:void 0},searchable:{type:Boolean,default:void 0},searchValue:{type:String,default:void 0},visible:{type:Boolean,default:void 0},"onUpdate:searchValue":[Function,Array],"onUpdate:visible":[Function,Array],onReset:[Function,Array]},Le={placeholder:{type:String,default:void 0},resetable:{type:Boolean,required:!0},searchable:{type:Boolean,required:!0},searchValue:{type:String,default:void 0},"onUpdate:searchValue":[Function,Array],onReset:[Function,Array]};var D=function(e){return e[e.start=0]="start",e[e.center=1]="center",e[e.end=2]="end",e}(D||{});const Ee=L({props:Le,setup(e){const{locale:t,mergedPrefixCls:l,mergedColumns:n,checkedColumnKeys:i,setMergedColumns:a,mergedColumnMap:r,resetColumns:c}=te(O),s=S(()=>n.value.length!==r.value.size),d=S(()=>n.value.filter(g=>g.visible===!1)),[o,y]=ce(e,"searchValue"),v=S(()=>{var p;const g=(p=o.value)==null?void 0:p.toLowerCase();return se(n.value,"children",C=>{if(C.layoutable===!1)return!1;if(!g)return!0;const{title:x}=C;return x?x.toLowerCase().includes(g):!1})}),b=S(()=>Y(v.value)),k=g=>{const p=g.target.value;y(p)},f=g=>{U(e.onReset,g)!==!1&&c()},z=g=>{const p=J(n.value,"children",(C,x)=>{var I;const T={...C};return!((I=C.children)!=null&&I.length)&&C.changeVisible!==!1&&C.layoutable!==!1&&x.every(P=>P.layoutable!==!1)&&(T.visible=g),T});a(p)},m=(g,p)=>{const C=J(n.value,"children",(P,$)=>{const V={...P};return(P.key===g.key||$.some(F=>F.key===g.key))&&(V.fixed=p),V}),{startColumns:x,centerColumns:T,endColumns:I}=Y(C);a([...x,...T,...I])},h=(g,p)=>{const C=J(n.value,"children",x=>{const T={...x};return g.has(x.key)&&(T.visible=!0),p.has(x.key)&&(T.visible=!1),T});a(C)},w=(g,p)=>{const{dragNode:C,dropNode:x,dropType:T}=p,I=C==null?void 0:C.key,P=x==null?void 0:x.key;if(!I||!P)return;const{startColumns:$,centerColumns:V,endColumns:F}=Y(n.value),j=[$,V,F].reduce((E,K,G)=>G===g?E.concat(Ke(K,I,P,T)):E.concat(K),[]);a(j)};return()=>{var le;const{startColumns:g,centerColumns:p,endColumns:C}=b.value,x=g.length>0,T=C.length>0,I=x||T,P=`${l.value}-layout-tool`,$=Z({[`${P}-content`]:!0,[`${P}-with-fixed`]:I,[`${P}-with-children`]:s.value}),{placeholder:V,all:F,reset:j,startPinTitle:E,noPinTitle:K,endPinTitle:G}=t.table.layout,ne=n.value.length,H=d.value.length,ie=H===0&&ne!==0,ue=H>0&&H!==ne,W=o.value;return u("div",{class:$},[e.searchable&&u("div",{class:`${P}-search-wrapper`},[u(de,{placeholder:(le=e.placeholder)!=null?le:V,size:"sm",suffix:"search",value:W,onInput:k},null)]),u("div",{class:`${P}-select-wrapper`},[u(he,{checked:ie,indeterminate:ue,label:F,onChange:z},null),e.resetable&&u(fe,{size:"sm",mode:"link",onClick:f},{default:()=>[j]})]),v.value.length?u("div",{class:`${P}-tree-wrapper`},[x&&u(Q,{key:"start",columns:g,checkedKeys:i.value.start,searchValue:W,title:E,onDrop:A=>w(D.start,A),onFixedChange:m,onVisibleChange:h},null),(!I||p.length>0)&&u(Q,{key:"center",columns:p,checkedKeys:i.value.center,searchValue:W,title:I?K:void 0,onDrop:A=>w(D.center,A),onFixedChange:m,onVisibleChange:h},null),T&&u(Q,{key:"end",columns:C,checkedKeys:i.value.end,searchValue:W,title:G,onDrop:A=>w(D.end,A),onFixedChange:m,onVisibleChange:h},null)]):u(me,{simple:!0},null)])}}});function Y(e){const t=[],l=[],n=[];return e.forEach(i=>{const{fixed:a}=i;a==="start"?t.push(i):a==="end"?l.push(i):n.push(i)}),{startColumns:t,endColumns:l,centerColumns:n}}function Ke(e,t,l,n){const i=[...e];let a;if(q(i,t,(r,c,s)=>{a=r,s.splice(c,1)}),n==="inside")q(i,l,r=>{r.children.unshift(a)});else{let r,c=[];q(i,l,(s,d,o)=>{r=d,c=o}),n==="before"?c.splice(r,0,a):c.splice(r+1,0,a)}return i}function q(e,t,l){for(let n=0;n<e.length;n++){const i=e[n];if(i.key===t)return l(i,n,e);"children"in i&&i.children&&q(i.children,t,l)}}const We=[0,4],Me={sm:"grid-compact",md:"grid-medium",lg:"grid-loose"},re=L({name:"IxProTableLayoutTool",props:Ae,setup(e,{slots:t}){const{config:l,locale:n,mergedPrefixCls:i,mergedSize:a,setMergedSize:r}=te(O),c=S(()=>{var o;return(o=e.changeSize)!=null?o:l.layoutTool.changeSize}),s=S(()=>{var o;return(o=e.resetable)!=null?o:l.layoutTool.resetable}),d=S(()=>{var o;return(o=e.searchable)!=null?o:l.layoutTool.searchable});return()=>{var z;const o=`${i.value}-layout-tool`,y=n.table.layout,v=m=>{const h=Me[m],w=y[m];return u(R,{key:h,class:Z([`${o}-header-icon`,a.value===m?`${o}-header-icon-active`:""]),name:h,title:w,onClick:()=>r(m)},null)},b=c.value?u(ge,null,{default:()=>[v("sm"),v("md"),v("lg")]}):void 0,k={placeholder:e.placeholder,resetable:s.value,searchable:d.value,searchValue:e.searchValue,"onUpdate:searchValue":e["onUpdate:searchValue"],onReset:e.onReset},f={class:Z([o,e.className]),header:{title:y.title,suffix:b},offset:We,placement:"bottomEnd",showArrow:!1,trigger:"click",visible:e.visible,"onUpdate:visible":e["onUpdate:visible"]};return u(ke,f,{default:(z=t.default)!=null?z:()=>u("span",{class:`${o}-trigger`},[u(R,{name:"ellipsis"},null)]),content:()=>u(Ee,k,null)})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function De(e,t){const l=S(()=>e.columns),[n,i]=oe(B(l.value,t)),a=S(()=>{const o=new Map,y={start:[],center:[],end:[]},v=se(n.value,"children",(b,k)=>{var z;const f=b.key;return o.set(f,b),b.visible===!1||k.some(m=>m.visible===!1)?!1:(!((z=b.children)!=null&&z.length)&&b.layoutable!==!1&&k.every(m=>m.layoutable!==!1)&&(ae("start",b,k)?y.start.push(f):ae("end",b,k)?y.end.push(f):y.center.push(f)),!0)},"and");return{map:o,checkedKeys:y,displayColumns:v}}),r=S(()=>a.value.map),c=S(()=>a.value.checkedKeys),s=S(()=>a.value.displayColumns);return N(l,o=>i(B(o,t))),N(n,o=>U(e.onColumnsChange,o)),{checkedColumnKeys:c,mergedColumns:n,setMergedColumns:i,mergedColumnMap:r,displayColumns:s,resetColumns:()=>i(B(l.value,t))}}function B(e,t,l){return e.map(n=>qe(n,t,l))}function qe(e,t,l){var r;const n=pe(e),a={...e.type==="indexable"?t.columnIndexable:void 0,...e,key:n,parentKey:l};return(r=e.children)!=null&&r.length&&(a.children=B(e.children,t,n)),a}function ae(e,t,l){return t.fixed===e||l.some(n=>n.fixed===e)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Be({mergedColumns:e,setMergedColumns:t,mergedColumnMap:l}){return{hasResizable:S(()=>e.value.some(a=>a.resizable)),onResizeEnd:(a,r,c)=>{const s=l.value.get(a);if(!s)return;const d=s.width,o=M(d)?_(d.replace("px","")):d;if(!o)s.width=r;else{const y=r-c,v=Math.floor(o*r/y*1e3)/1e3,{minWidth:b,maxWidth:k}=s,f=M(b)?_(b.replace("px","")):b,z=M(k)?_(k.replace("px",""),Number.MAX_SAFE_INTEGER):k;f&&v<f?s.width=f:z&&v>z?s.width=z:s.width=v}t([...e.value])}}}const Ue=L({props:["column","onClick","onResizeEnd"],setup(e,{slots:t}){const l=ee(),n=d=>{U(e.onResizeEnd,e.column.key,d.width,d.offsetWidth)},i=ze({maxWidth:e.column.maxWidth,minWidth:e.column.minWidth,onResizeEnd:n}),{resizing:a,position:r}=Ie(l,i),c=ee(!a.value);N(a,d=>{d?c.value=!1:setTimeout(()=>c.value=!0)});const s=d=>{c.value&&U(e.onClick,d)};return()=>{var o,y;if(!e.column.resizable)return u("th",{onClick:s},[(o=t.default)==null?void 0:o.call(t)]);const d=[u(Ve,{placement:"end"},null)];if(a.value){const{width:v,height:b}=r.value;d.push(u("div",{class:"cdk-resizable-preview",style:`width:${v}px;height:${b}px`},null))}return u("th",{ref:l,onClick:s},[(y=t.default)==null?void 0:y.call(t),d])}}}),Ne=L({name:"IxProTable",props:$e,setup(e,{slots:t,expose:l}){const n=X("common"),i=X("table"),a=Ce("table"),r=X("locale"),c=S(()=>`${n.prefixCls}-table`),s=De(e,i),{hasResizable:d,onResizeEnd:o}=Be(s),y=S(()=>{var h;return(h=e.size)!=null?h:a.size}),[v,b]=oe(y.value);N(y,b),Pe(O,{props:e,config:i,locale:r,mergedPrefixCls:c,mergedSize:v,setMergedSize:b,...s});const k=ee();l({scrollTo:h=>{var w;return(w=k.value)==null?void 0:w.scrollTo(h)}});const f=()=>{const{layoutTool:h}=e;if(!h)return null;const w=we(h)?h:void 0;return u(re,w,null)},z=()=>{const{toolbar:h}=e;if(h)return h.length<=1?h:u(ye,{align:"center",gap:8},{default:()=>[h]})},m=()=>{var g;if(t.header)return t.header();const{header:h,toolbar:w}=e;if(h||w||t.toolbar){const p={suffix:(g=t.toolbar)!=null?g:z},C=M(h)?{title:h}:h;return u(be,C,p)}};return()=>{const{customAdditional:h,customTag:w,layoutTool:g,toolbar:p,tableLayout:C,...x}=e,T=d.value,I=C||(T?"fixed":void 0),P={...h,headCell:({column:V})=>{const F=h!=null&&h.headCell?h.headCell({column:V}):void 0;return T?{...F,column:V,onResizeEnd:o}:F}},$={headCell:T?Ue:void 0,...w};return u(xe,Se({ref:k},x,{class:c.value,columns:s.displayColumns.value,customAdditional:P,customTag:$,size:v.value,tableLayout:I}),{...t,header:m,default:f})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Qe=Ne,Ye=re;export{Qe as I,Ye as a};
