import{ag as N,l as q,w as C,u as h,aT as G,aU as H,a2 as Q,aV as J,j as P}from"./index.fa1c17ad.js";import{e as i,b as k,Q as X,a7 as S,z as x,y as c,v as R,a0 as O,x as Y,A as _,w as U,I as ee,a1 as ae}from"./vendor.71a61ad2.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const E=10,I=1,T=0,te=.2,oe=90;function ne(e,t,a,n,o,s,l){const r=()=>e("next"),f=()=>e("previous"),g=()=>t("left"),m=()=>t("right"),v=()=>a("out"),d=()=>a("in"),w=()=>n(!1);return i(()=>[{key:"goPrevious",icon:"left",opr:f,disabled:s.value.previous,visible:l.value},{key:"goNext",icon:"right",opr:r,disabled:s.value.next,visible:l.value},{key:"rotateLeft",icon:"rotate-left",opr:g,visible:!0},{key:"rotateRight",icon:"rotate-right",opr:m,visible:!0},{key:"zoomOut",icon:"zoom-out",opr:v,disabled:o.value.out,visible:!0},{key:"zoomIn",icon:"zoom-in",opr:d,disabled:o.value.in,visible:!0},{key:"close",icon:"close",opr:w,visible:!0}])}function se(e){const t=k(I),a=k(T),n={left:-1,right:1},o={in:1,out:-1},s=i(()=>{const[v,d]=e.value;return v>I?v:d<I?d:I});X(()=>t.value=s.value);const l=i(()=>{const[v,d]=e.value;return{in:t.value>=d,out:t.value<=v}}),r=i(()=>({transform:`scale(${t.value}) rotate(${a.value}deg)`})),f=S((v="left",d=oe)=>{a.value=a.value+d*n[v]},E),g=S((v,d=te)=>{l.value[v]||(t.value=t.value+d*o[v])},E);return{transformStyle:r,scaleDisabled:l,rotateHandle:f,scaleHandle:g,resetTransform:()=>{t.value=s.value,a.value=T}}}function le(e,t){const[a,n]=N(e,"activeIndex",0),o=i(()=>({previous:!t.value&&a.value===0,next:!t.value&&a.value===e.images.length-1})),s=i(()=>e.images.length>1),l=S((r="next")=>{if(r==="next"){if(o.value.next||o.value.previous)return;n(a.value>=e.images.length-1?0:a.value+1);return}n(a.value<=0?e.images.length-1:a.value-1)},E);return{activeIndex:a,switchDisabled:o,switchVisible:s,goHandle:l}}const re=e=>{const{disabled:t,icon:a,prefixCls:n,opr:o}=e,s=q(),l=i(()=>x({[`${n}-opr-item`]:!0,[`${n}-opr-item-disabled`]:t}));return c(C,{class:l.value,name:a,onClick:o,key:s},null)};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ie={visible:{type:Boolean,default:void 0},activeIndex:Number,container:{type:[String,HTMLElement,Function],default:void 0},images:{type:Array,default:()=>[]},zoom:{type:Array,validator:e=>e.length===2},loop:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},zIndex:Number,"onUpdate:visible":[Function,Array],"onUpdate:activeIndex":[Function,Array]},ue={src:{type:String,required:!0},preview:{type:Boolean,default:void 0},imageViewer:Object,onLoad:[Function,Array],onError:[Function,Array]},D=J?"DOMMouseScroll":"mousewheel",B=R({name:"IxImageViewer",props:ie,setup(e){const t=h("common"),a=h("imageViewer"),n=i(()=>`${t.prefixCls}-image-viewer`),o=G(e,a,t,n),[s,l]=N(e,"visible",!1),{currentZIndex:r}=H(O(e,"zIndex"),O(t,"overlayZIndex"),s),f=i(()=>{var u;return(u=e.zoom)!=null?u:a.zoom}),g=i(()=>{var u;return(u=e.loop)!=null?u:a.loop}),m=i(()=>{var u;return(u=e.maskClosable)!=null?u:a.maskClosable}),{transformStyle:v,scaleDisabled:d,rotateHandle:w,scaleHandle:p,resetTransform:$}=se(f),{activeIndex:y,switchDisabled:z,switchVisible:V,goHandle:b}=le(e,g),K=()=>m.value&&l(!1),M=ne(b,w,p,l,d,z,V),{onWheelScroll:A,onKeydown:F}=ce(s,l,p,b);Y(()=>{window.addEventListener(D,A,{passive:!1,capture:!1}),window.addEventListener("keydown",F,!1)}),_(()=>{window.removeEventListener(D,A),window.removeEventListener("keydown",F)}),U([s,y],([u])=>{u&&$()});const Z=i(()=>`z-index: ${r.value}`);return()=>{const u=n.value,j=e.images[y.value];return c(Q,{target:o.value,load:s.value},{default:()=>[c(ee,{name:`${t.prefixCls}-zoom-big-fast`,appear:!0},{default:()=>[s.value&&c("div",{class:u,style:Z.value},[c("div",{class:`${u}-opr`},[M.value.filter(L=>L.visible).map(L=>{const W={...L,prefixCls:u};return c(re,W,null)})]),c("div",{class:`${u}-preview`,onClick:K},[c("img",{class:`${u}-preview-img`,src:j,style:v.value},null)])])]})]})}}});function ce(e,t,a,n){const o=r=>{var m;if(!e.value)return;const f=r;f.preventDefault(),((m=f.wheelDelta)!=null?m:-f.detail)>0?a("in",.2):a("out",.2)},s={ArrowUp:()=>a("in",.2),ArrowDown:()=>a("out",.2),ArrowLeft:()=>n("previous"),ArrowRight:()=>n("next"),Escape:()=>t(!1)};return{onWheelScroll:o,onKeydown:r=>{!e.value||(r.preventDefault(),r.code in s&&s[r.code]())}}}const ve=R({name:"IxImage",inheritAttrs:!1,props:ue,setup(e,{attrs:t,slots:a}){const{class:n,style:o,...s}=t,l=h("common"),r=i(()=>`${l.prefixCls}-image`),f=h("image"),g=pe(e,f),{status:m,setFailed:v,setLoaded:d}=be(e),[w,p]=ge(),{outerClasses:$,overLayerClasses:y,imageClasses:z}=we(r,n,m,g);return()=>{var b;const V={visible:w.value,"onUpdate:visible":p,images:[e.src],...(b=e.imageViewer)!=null?b:{}};return c("div",{class:$.value,style:o},[c("div",{class:y.value},[de(e,a,r,m,g,p),me(a,r,m),fe(a,r,m),c(B,V,null)]),c("img",ae(s,{src:e.src,class:z.value,onLoad:d,onError:v}),null)])}}});function de(e,t,a,n,o,s){var l,r;return n.value==="loaded"&&o.value&&c("span",{class:`${a.value}-preview-wrapper`,onClick:()=>s(!0)},[(r=(l=t.previewIcon)==null?void 0:l.call(t))!=null?r:c(C,{class:`${a.value}-preview-icon`,name:"zoom-in"},null)])}function me(e,t,a){var n,o;return a.value==="loading"&&((o=(n=e.placeholder)==null?void 0:n.call(e))!=null?o:c(C,{class:`${t.value}-placeholder`,name:"loading"},null))}function fe(e,t,a){var n,o;return a.value==="failed"&&((o=(n=e.fallback)==null?void 0:n.call(e))!=null?o:c(C,{class:`${t.value}-fallback`,name:"file-image"},null))}function ge(){const e=k(!1);return[e,a=>{e.value=a}]}function we(e,t,a,n){const o=i(()=>x([e.value,t,`${e.value}-${a.value}`,{[`${e.value}-preview`]:n.value}])),s=i(()=>x(`${e.value}-layer`)),l=i(()=>x([`${e.value}-inner`,{[`${e.value}-inner-hidden`]:a.value!=="loaded"}]));return{outerClasses:o,overLayerClasses:s,imageClasses:l}}function pe(e,t){return i(()=>{var a;return(a=e.preview)!=null?a:t.preview})}function be(e){const t=k("loading"),a=o=>{t.value="loaded",P(e.onLoad,o)},n=o=>{t.value="failed",P(e.onError,o)};return U(()=>e.src,()=>{t.value="loading"},{immediate:!0}),{status:t,setLoaded:a,setFailed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const xe=ve,he=B;export{xe as I,he as a};
