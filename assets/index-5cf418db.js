import{m as U,aR as D,aa as le,a7 as ue,r as ie,a9 as oe,S as W,a1 as P,b7 as se,$ as O,L as re}from"./index-20a6d8b7.js";import{x as L,l as K,c as k,A as w,M as Y,S as ce,f as de,j as ve,i as p,D as me,r as R,ax as fe,a4 as he,w as Z,t as be,I as _,q as ge,bn as ye}from"./vendor-63a43443.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const A={ltr:"left",rtl:"right",btt:"bottom",ttb:"top"},X=Symbol("sliderToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const xe={control:{type:[String,Number,Object,Array],default:void 0},value:{type:[Number,Array],default:void 0},disabled:{type:Boolean,default:!1},dots:{type:Boolean,default:!1},keyboard:{type:Boolean,default:!0},marks:{type:Object,default:void 0},max:{type:Number,default:100},min:{type:Number,default:0},range:{type:Boolean,default:!1},reverse:{type:Boolean,default:!1},step:{type:Number,default:1},tooltipFormatter:{type:Function,default:void 0},tooltipPlacement:{type:String,default:void 0},tooltipVisible:{type:Boolean,default:void 0},vertical:{type:Boolean,default:!1},"onUpdate:value":[Function,Array],onChange:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array]},Me={value:{type:Number,default:void 0},onFocus:[Function,Array],onBlur:[Function,Array]},we={onClickMark:[Function,Array]},ke=L({name:"IxSliderMarks",props:we,setup(e){const{values:c,marks:b,max:v,min:l,prefixCls:d,range:u,reverse:i,vertical:o}=K(X),h=k(()=>`${d.value}-mark`);return()=>w("div",{class:h.value},[Se(e,c.value,b.value,v.value,l.value,h.value,u.value,i.value,o.value)])}});function Se(e,c,b,v,l,d,u,i,o){if(Y(b))return;const h=v-l;return Object.keys(b).map(parseFloat).sort((s,r)=>s-r).map(s=>{const r=b[s],y=ce(r);let x;if(de(r)||ve(r)?x=r:p(r)?x=r():y&&(x=r.label),Y(x))return null;const F=u?!(s<c[0]||s>c[1]):s<=c[0],$={[`${d}-label`]:!0,[`${d}-label-active`]:F},S=o?{marginBottom:"-50%",[i?A.ttb:A.btt]:`${(s-l)/h*100}%`}:{transform:`translateX(${i?"50%":"-50%"})`,[i?A.rtl:A.ltr]:`${(s-l)/h*100}%`},B=y?me([S,r==null?void 0:r.style]):S,C=V=>U(e.onClickMark,V,s);return w("span",{key:s,class:$,style:B,onMousedown:C,onTouchstart:C},[x])})}const Ae=L({name:"IxSliderSteps",setup(){const{values:e,dots:c,marks:b,max:v,min:l,prefixCls:d,range:u,reverse:i,step:o,vertical:h}=K(X);return()=>w("div",{class:`${d.value}-step`},[Fe(e.value,c.value,b.value,v.value,l.value,d.value,u.value,i.value,o.value,h.value)])}});function Fe(e,c,b,v,l,d,u,i,o,h){const s=v-l;return $e(c,b,v,l,o).map(r=>{const y=`${Math.abs(r-l)/s*100}%`,x=u?!(r<e[0]||r>e[1]):r<=e[0],F=h?{[i?A.ttb:A.btt]:y}:{[i?A.rtl:A.ltr]:y},$={[`${d}-dot`]:!0,[`${d}-dot-active`]:x,[`${d}-dot-reverse`]:i};return w("span",{key:r,class:$,style:F},null)})}function $e(e,c,b,v,l){const d=Object.keys(c!=null?c:{}).map(parseFloat).sort((u,i)=>u-i);if(e&&l)for(let u=v;u<=b;u+=l)d.indexOf(u)===-1&&d.push(u);return d}const Re=L({name:"IxSliderThumb",inheritAttrs:!1,props:Me,setup(e,{attrs:c,expose:b}){var g;const{disabled:v,dragging:l,prefixCls:d,tooltipVisible:u,tooltipPlacement:i,tooltipFormatter:o}=K(X),h=R((g=u.value)!=null?g:!1),s=R(!1),r=R(null),y=R(null),x=k(()=>`${d.value}-thumb`),F=()=>u.value!==!1&&(h.value=!0),$=()=>u.value!==!0&&(h.value=!1);fe(()=>{var M;return h.value&&((M=r.value)==null?void 0:M.updatePopper())});function S(){s.value=!0,F()}function B(){s.value=!1,l.value||$()}function C(M){F(),l.value||U(e.onFocus,M)}function V(M){$(),l.value||U(e.onBlur,M)}return b({tooltipRef:r,thumbRef:y,isHovering:s,showTooltip:F,hideTooltip:$}),()=>w(le,{ref:r,visible:h.value,placement:i.value,trigger:"manual",onMouseenter:S,onMouseleave:B},{default:()=>[w("div",he(c,{ref:y,class:x.value,onMouseenter:S,onMouseleave:B,onFocus:v.value?D:C,onBlur:v.value?D:V}),null)],title:()=>p(o.value)?o.value(e.value):w("span",null,[e.value])})}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Be(e){const{elementRef:c,focus:b,blur:v}=ue(),{accessor:l,control:d}=ie();oe(d);const u=R([e.min,e.min]),i=R([]),o=R(-1),h=R(null),s=R(!1),r=k(()=>l.disabled),y=k(()=>{const t=[e.min,e.max,e.step].map(n=>{const a=`${n}`.split(".")[1];return a?a.length:0});return Math.max(...t)}),x=k(()=>{const t=`${e.step}`.split(".")[1];return t?t.length:0}),F=k(()=>e.vertical?e.reverse?A.ttb:A.btt:e.reverse?A.rtl:A.ltr);function $(t){return n=>{t===0&&(c.value=n==null?void 0:n.thumbRef),i.value[t]=n}}function S(t){var a,m;const n=i.value.findIndex(f=>(f==null?void 0:f.thumbRef)===t.target);if(n!==-1)t.preventDefault(),o.value=n,(m=(a=i.value[n])==null?void 0:a.thumbRef)==null||m.focus(),V();else{const f=q(t);z(f),N(f)}}function B(t){if(e.keyboard){const n=i.value.findIndex(a=>(a==null?void 0:a.thumbRef)===t.target);if(n!==-1){let a=null;t.code==="ArrowUp"||t.code==="ArrowRight"?(o.value=n,a=J(1)):(t.code==="ArrowDown"||t.code==="ArrowLeft")&&(o.value=n,a=J(-1)),a!==null&&(t.preventDefault(),N(a),H(a))}}}function C(t,n){t.stopPropagation(),z(n),N(n)}function V(){s.value||(s.value=!0,P(window,"mousemove",M),P(window,"touchmove",M),P(window,"mouseup",I),P(window,"touchend",I),P(window,"contextmenu",I))}function g(){if(s.value){const t=i.value[o.value];s.value=!1,o.value=-1,t!=null&&t.isHovering||_(()=>t==null?void 0:t.hideTooltip()),O(window,"mousemove",M),O(window,"touchmove",M),O(window,"mouseup",I),O(window,"touchend",I),O(window,"contextmenu",I)}}function M(t){if(!s.value){g();return}const n=q(t);N(n),H(n)}function I(){g()}function ee(){var n,a;const{value:t}=o;t!==-1&&((a=(n=i.value[t])==null?void 0:n.thumbRef)==null||a.focus())}function N(t){const{value:n}=o;if(u.value[n]!==t){const a=u.value.slice();a[n]=t;const m=be(l.value),f=e.range?a:a[0];l.setValue(f),U(e.onChange,f,m),_(()=>E())}}function z(t){const{value:n}=u;o.value=e.range?Math.abs(n[0]-t)<Math.abs(n[1]-t)?0:1:0}function H(t){var n,a;if(e.range){const{value:m}=u;let f=o.value;t>m[1]?f=1:t<m[0]&&(f=0),f!==o.value&&(o.value=f,(a=(n=i.value[o.value])==null?void 0:n.thumbRef)==null||a.focus())}}function q(t){const n=se(t),a=h.value.getBoundingClientRect();let m;return e.vertical?m=(a.bottom-n.clientY)/a.height:m=(n.clientX-a.left)/a.width,e.reverse&&(m=1-m),G(m*(e.max-e.min)+e.min)}function G(t){var j,Q;t=Math.max(e.min,Math.min(e.max,t));const n=(j=e.marks)!=null?j:{},a=Object.keys(n).map(parseFloat);if(e.step!==null){const T=Math.pow(10,y.value),te=Math.floor((e.max*T-e.min*T)/(e.step*T)),ne=Math.min((t-e.min)/e.step,te),ae=Math.round(ne)*e.step+e.min;a.push(parseFloat(ae.toFixed(y.value)))}const m=a.map(T=>Math.abs(t-T)),f=m.indexOf(Math.min(...m));return(Q=a[f])!=null?Q:e.min}function J(t){if(e.step!==null){const n=t<0?-e.step:+e.step,a=u.value[o.value];return Math.max(e.min,Math.min(e.max,parseFloat((a+n).toFixed(x.value))))}return e.min}Z(()=>l.value,(t,n)=>{s.value||Array.isArray(t)&&Array.isArray(n)&&t.every((a,m)=>a===n[m])||E()},{immediate:!0}),Z(()=>[e.max,e.min,e.range,e.step],()=>{E()});function E(){var a,m;if(e.min>e.max)return;const{value:t=0}=l;let n;if(e.range){if(!Array.isArray(t))return;n=[(a=t[0])!=null?a:e.min,(m=t[1])!=null?m:e.min]}else{if(!W(t))return;n=[t]}u.value=n.map(f=>W(f)?G(f):e.min).sort((f,j)=>f-j)}return{valuesRef:u,thumbListRef:i,railRef:h,direction:F,isDisabled:r,isDragging:s,focus:b,blur:v,setThumbRefs:$,handleMouseDown:S,handleMouseUp:ee,handleKeyDown:B,handleMarkClick:C}}const Ce=L({name:"IxSlider",props:xe,setup(e,{expose:c}){const b=re("common"),{direction:v,isDisabled:l,isDragging:d,valuesRef:u,railRef:i,setThumbRefs:o,handleMouseDown:h,handleMouseUp:s,handleKeyDown:r,handleMarkClick:y,focus:x,blur:F}=Be(e),{trackStyle:$}=Ie(e,u,v),S=k(()=>`${b.prefixCls}-slider`),B=k(()=>u.value.slice(0,e.range?2:1)),C=k(()=>e.vertical?e.reverse?"translateY(-50%)":"translateY(50%)":e.reverse?"translateX(50%)":"translateX(-50%)"),V=k(()=>{const g=S.value;return{[g]:!0,[`${g}-disabled`]:l.value,[`${g}-vertical`]:e.vertical,[`${g}-with-marks`]:!Y(e.marks)}});return ge(X,{...ye(e),direction:v,dragging:d,values:u,disabled:l,prefixCls:S}),c({focus:x,blur:F}),()=>w("div",{class:V.value,onMousedown:l.value?D:h,onTouchstart:l.value?D:h,onMouseup:l.value?D:s,onKeydown:l.value?D:r},[w("div",{ref:i,class:`${S.value}-rail`},null),w("div",{class:`${S.value}-track`,style:$.value},null),w(Ae,null,null),B.value.map((g,M)=>{const I=(g-e.min)/(e.max-e.min)*100;return w(Re,{ref:o(M),value:g,role:"slider",tabindex:l.value?-1:0,"aria-label":"Slider","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":g,"aria-readonly":l.value,"aria-orientation":e.vertical?"vertical":"horizontal",onFocus:e.onFocus,onBlur:e.onBlur,style:{transform:C.value,[v.value]:`${I}%`}},null)}),w(ke,{onClickMark:l.value?D:y},null)])}});function Ie(e,c,b){const v=k(()=>Math.max(...c.value)),l=k(()=>Math.min(...c.value));return{trackStyle:k(()=>({[b.value]:e.range?`${(l.value-e.min)/(e.max-e.min)*100}%`:"0%",[e.vertical?"height":"width"]:e.range?`${(v.value-l.value)/(e.max-e.min)*100}%`:`${(+c.value[0]-e.min)/(e.max-e.min)*100}%`}))}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Te=Ce;export{Te as I};
