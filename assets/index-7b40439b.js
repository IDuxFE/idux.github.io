import{u as C,f as I,o as B,g as T,h as p,i as b,s as N,j as O}from"./index-cbb19196.js";import{v as y,e as h,y as d,b as g,p as w,x as L,Q as R,w as A,N as $,i as H}from"./vendor-5869a5c0.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const S=Symbol("anchorToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const F={affix:{type:Boolean,default:!0},bounds:Number,hideLinkBall:{type:Boolean,default:void 0},offsetTop:Number,target:[String,HTMLElement,Function],targetOffset:Number,onChange:[Function,Array],onClick:[Function,Array]},P={href:{type:String,required:!0},title:String},j=y({name:"IxAnchor",props:F,setup(e,{slots:l}){const o=C("common"),r=h(()=>`${o.prefixCls}-anchor`),f=C("anchor"),n=h(()=>e.hideLinkBall??f.hideLinkBall),a=h(()=>{const{offsetTop:u}=e;return{maxHeight:u?`calc(100vh - ${u}px)`:"100vh"}}),{activeLink:i}=q(e,f),{anchorRef:v,inkBallElRef:t,inkBallClasses:s,inkBallTop:c}=M(i,r);return()=>{var m;const u=r.value,x=n.value?null:d("span",{class:s.value,style:{top:c.value},ref:t},null),k=d("div",{class:`${u}-wrapper`,style:a.value},[d("div",{class:u,ref:v},[d("div",{class:`${u}-ink`},[x]),(m=l.default)==null?void 0:m.call(l)])]);return e.affix?d(I,{target:e.target,offset:e.offsetTop},{default:()=>[k]}):k}}}),q=(e,l)=>{const o=g([]),r=t=>{o.value.includes(t)||o.value.push(t)},f=t=>{const s=o.value.indexOf(t);s!==-1&&o.value.splice(s,1)},n=g(),a=t=>{n.value!==t&&(n.value=t,b(e.onChange,t))},{scrollTo:i}=Q(e,l,o,a);return w(S,{registerLink:r,unregisterLink:f,activeLink:n,handleLinkClick:(t,s)=>{b(e.onClick,t,s),i(s.href)}}),{activeLink:n}},M=(e,l)=>{const o=g(),r=g(),f=h(()=>{const a=l.value;return{[`${a}-ink-ball`]:!0,[`${a}-ink-ball-visible`]:!!e.value}}),n=g();return L(()=>{R(()=>{var s,c;const a=(s=o.value)==null?void 0:s.querySelector(`a[data-href="${e.value}"]`);if(!a)return;const i=((c=r.value)==null?void 0:c.getBoundingClientRect().height)??9,{offsetTop:v,clientHeight:t}=a;n.value=`${v+t/2-i/2}px`},{flush:"post"})}),{anchorRef:o,inkBallElRef:r,inkBallClasses:f,inkBallTop:n}},E=(e,l)=>{const o=document.getElementById(e.split("#")[1]);if(o){const{top:r}=O(o,l);return r}return null},G=(e,l,o,r)=>e.length?e.map(n=>{const a=E(n,l);return{link:n,top:a}}).reduce((n,a)=>{const{top:i}=a;return i!==null&&i<o+r&&n.top<i?a:n}).link:"",Q=(e,l,o,r)=>{const f=h(()=>e.bounds??l.bounds),n=g(),a="scroll";let i=!1;const v=h(()=>e.targetOffset??e.offsetTop??0),t=()=>{if(i)return;const c=G(o.value,n.value,v.value,f.value);r(c)},s=c=>{r(c);const u=E(c,n.value);u!==null&&(i=!0,N({amountOfChange:u-v.value,target:n.value,callback:()=>{i=!1}}))};return A(()=>e.target,()=>{B(n.value,a,t),n.value=T(e.target),p(n.value,a,t),t()}),L(()=>{n.value=T(e.target),p(n.value,a,t),t()}),$(()=>{B(n.value,a,t)}),{scrollTo:s}},U=y({name:"IxAnchorLink",props:P,setup(e,{slots:l}){const o=C("common"),r=h(()=>`${o.prefixCls}-anchor-link`),{registerLink:f,unregisterLink:n,activeLink:a,handleLinkClick:i}=H(S);A(()=>e.href,(c,u)=>{n(u),f(c)}),L(()=>f(e.href)),$(()=>n(e.href));const v=h(()=>a.value===e.href),t=h(()=>{const c=r.value;return{[`${c}-title`]:!0,[`${c}-title-active`]:v.value}}),s=c=>i(c,e);return()=>{var k,m;const{href:c,title:u}=e,x=r.value;return d("div",{class:x},[d("a",{class:t.value,href:c,"data-href":c,title:u,onClick:s},[((k=l.title)==null?void 0:k.call(l))??u]),(m=l.default)==null?void 0:m.call(l)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const D=j,J=U;export{D as I,J as a};
