import{am as N,a6 as q,A as C,L as h,aT as G,aU as H,C as J,aV as Q,m as O}from"./index-d7673542.js";import{c as i,r as k,Q as X,a9 as S,A as x,z as c,x as R,a2 as P,y as Y,O as _,w as U,J as ee,a3 as te}from"./vendor-ead7b4e4.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const A=10,I=1,T=0,ae=.2,oe=90;function ne(e,a,t,n,o,s,l){const r=()=>e("next"),f=()=>e("previous"),g=()=>a("left"),m=()=>a("right"),v=()=>t("out"),d=()=>t("in"),w=()=>n(!1);return i(()=>[{key:"goPrevious",icon:"left",opr:f,disabled:s.value.previous,visible:l.value},{key:"goNext",icon:"right",opr:r,disabled:s.value.next,visible:l.value},{key:"rotateLeft",icon:"rotate-left",opr:g,visible:!0},{key:"rotateRight",icon:"rotate-right",opr:m,visible:!0},{key:"zoomOut",icon:"zoom-out",opr:v,disabled:o.value.out,visible:!0},{key:"zoomIn",icon:"zoom-in",opr:d,disabled:o.value.in,visible:!0},{key:"close",icon:"close",opr:w,visible:!0}])}function se(e){const a=k(I),t=k(T),n={left:-1,right:1},o={in:1,out:-1},s=i(()=>{const[v,d]=e.value;return v>I?v:d<I?d:I});X(()=>a.value=s.value);const l=i(()=>{const[v,d]=e.value;return{in:a.value>=d,out:a.value<=v}}),r=i(()=>({transform:`scale(${a.value}) rotate(${t.value}deg)`})),f=S((v="left",d=oe)=>{t.value=t.value+d*n[v]},A),g=S((v,d=ae)=>{l.value[v]||(a.value=a.value+d*o[v])},A);return{transformStyle:r,scaleDisabled:l,rotateHandle:f,scaleHandle:g,resetTransform:()=>{a.value=s.value,t.value=T}}}function le(e,a){const[t,n]=N(e,"activeIndex",0),o=i(()=>({previous:!a.value&&t.value===0,next:!a.value&&t.value===e.images.length-1})),s=i(()=>e.images.length>1),l=S((r="next")=>{if(r==="next"){if(o.value.next||o.value.previous)return;n(t.value>=e.images.length-1?0:t.value+1);return}n(t.value<=0?e.images.length-1:t.value-1)},A);return{activeIndex:t,switchDisabled:o,switchVisible:s,goHandle:l}}const re=e=>{const{disabled:a,icon:t,prefixCls:n,opr:o}=e,s=q(),l=i(()=>x({[`${n}-opr-item`]:!0,[`${n}-opr-item-disabled`]:a}));return c(C,{class:l.value,name:t,onClick:o,key:s},null)},ie=re;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ue={visible:{type:Boolean,default:void 0},activeIndex:Number,container:{type:[String,HTMLElement,Function],default:void 0},images:{type:Array,default:()=>[]},zoom:{type:Array,validator:e=>e.length===2},loop:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},zIndex:Number,"onUpdate:visible":[Function,Array],"onUpdate:activeIndex":[Function,Array]},ce={src:{type:String,required:!0},preview:{type:Boolean,default:void 0},imageViewer:Object,onLoad:[Function,Array],onError:[Function,Array]},D=Q?"DOMMouseScroll":"mousewheel",B=R({name:"IxImageViewer",props:ue,setup(e){const a=h("common"),t=h("imageViewer"),n=i(()=>`${a.prefixCls}-image-viewer`),o=G(e,t,a,n),[s,l]=N(e,"visible",!1),r=H(P(e,"zIndex"),P(a,"overlayZIndex"),s),f=i(()=>{var u;return(u=e.zoom)!=null?u:t.zoom}),g=i(()=>{var u;return(u=e.loop)!=null?u:t.loop}),m=i(()=>{var u;return(u=e.maskClosable)!=null?u:t.maskClosable}),{transformStyle:v,scaleDisabled:d,rotateHandle:w,scaleHandle:p,resetTransform:$}=se(f),{activeIndex:b,switchDisabled:z,switchVisible:L,goHandle:y}=le(e,g),K=()=>m.value&&l(!1),M=ne(y,w,p,l,d,z,L),{onWheelScroll:E,onKeydown:F}=ve(s,l,p,y);Y(()=>{window.addEventListener(D,E,{passive:!1,capture:!1}),window.addEventListener("keydown",F,!1)}),_(()=>{window.removeEventListener(D,E),window.removeEventListener("keydown",F)}),U([s,b],([u])=>{u&&$()});const Z=i(()=>`z-index: ${r.value}`);return()=>{const u=n.value,W=e.images[b.value];return c(J,{target:o.value,load:s.value},{default:()=>[c(ee,{name:`${a.prefixCls}-zoom`,appear:!0},{default:()=>[s.value&&c("div",{class:u,style:Z.value},[c("div",{class:`${u}-opr`},[M.value.filter(V=>V.visible).map(V=>{const j={...V,prefixCls:u};return c(ie,j,null)})]),c("div",{class:`${u}-preview`,onClick:K},[c("img",{class:`${u}-preview-img`,src:W,style:v.value},null)])])]})]})}}});function ve(e,a,t,n){const o=r=>{var m;if(!e.value)return;const f=r;f.preventDefault(),((m=f.wheelDelta)!=null?m:-f.detail)>0?t("in",.2):t("out",.2)},s={ArrowUp:()=>t("in",.2),ArrowDown:()=>t("out",.2),ArrowLeft:()=>n("previous"),ArrowRight:()=>n("next"),Escape:()=>a(!1)};return{onWheelScroll:o,onKeydown:r=>{e.value&&(r.preventDefault(),r.code in s&&s[r.code]())}}}const de=R({name:"IxImage",inheritAttrs:!1,props:ce,setup(e,{attrs:a,slots:t}){const{class:n,style:o,...s}=a,l=h("common"),r=i(()=>`${l.prefixCls}-image`),f=h("image"),g=ye(e,f),{status:m,setFailed:v,setLoaded:d}=be(e),[w,p]=we(),{outerClasses:$,overLayerClasses:b,imageClasses:z}=pe(r,n,m,g);return()=>{var y;const L={visible:w.value,"onUpdate:visible":p,images:[e.src],...(y=e.imageViewer)!=null?y:{}};return c("div",{class:$.value,style:o},[c("div",{class:b.value},[me(e,t,r,m,g,p),fe(t,r,m),ge(t,r,m),c(B,L,null)]),c("img",te(s,{src:e.src,class:z.value,onLoad:d,onError:v}),null)])}}});function me(e,a,t,n,o,s){var l,r;return n.value==="loaded"&&o.value&&c("span",{class:`${t.value}-preview-wrapper`,onClick:()=>s(!0)},[(r=(l=a.previewIcon)==null?void 0:l.call(a))!=null?r:c(C,{class:`${t.value}-preview-icon`,name:"zoom-in"},null)])}function fe(e,a,t){var n,o;return t.value==="loading"&&((o=(n=e.placeholder)==null?void 0:n.call(e))!=null?o:c(C,{class:`${a.value}-placeholder`,name:"loading"},null))}function ge(e,a,t){var n,o;return t.value==="failed"&&((o=(n=e.fallback)==null?void 0:n.call(e))!=null?o:c(C,{class:`${a.value}-fallback`,name:"file-image"},null))}function we(){const e=k(!1);return[e,t=>{e.value=t}]}function pe(e,a,t,n){const o=i(()=>x([e.value,a,`${e.value}-${t.value}`,{[`${e.value}-preview`]:n.value}])),s=i(()=>x(`${e.value}-layer`)),l=i(()=>x([`${e.value}-inner`,{[`${e.value}-inner-hidden`]:t.value!=="loaded"}]));return{outerClasses:o,overLayerClasses:s,imageClasses:l}}function ye(e,a){return i(()=>{var t;return(t=e.preview)!=null?t:a.preview})}function be(e){const a=k("loading"),t=o=>{a.value="loaded",O(e.onLoad,o)},n=o=>{a.value="failed",O(e.onError,o)};return U(()=>e.src,()=>{a.value="loading"},{immediate:!0}),{status:a,setLoaded:t,setFailed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const he=de,ke=B;export{he as I,ke as a};
