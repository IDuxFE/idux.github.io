import{z as q,ad as G,ah as O,ai as H,m as E,T as R,aj as J,t as j,ag as L}from"./index-b2ce1350.js";import{r as I,c as u,w as T,t as Q,V as W,m as X,q as K,n as Y,v as x}from"./vendor-489a52b6.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Z={value:[Number,null],control:{type:[String,Number,Object,Array],default:void 0},disabled:{type:Boolean,default:!1},formatter:Function,keyboard:{type:Boolean,default:void 0},max:{type:Number,default:1/0},min:{type:Number,default:-1/0},placeholder:String,precision:Number,readonly:{type:Boolean,default:!1},size:String,status:String,step:{type:Number,default:1},"onUpdate:value":[Function,Array],onChange:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array]};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _(a,r){const{accessor:l,control:F}=q();G(F);const C=O(a,r),k=H(a,F),V=I(""),s=I(""),b=I(!0),c=u(()=>{var e;return(e=l.value)!=null?e:void 0}),v=u(()=>{var e;return(e=a.keyboard)!=null?e:r.keyboard}),y=u(()=>l.disabled),p=u(()=>a.readonly||!!c.value&&c.value<=a.min),M=u(()=>a.readonly||!!c.value&&c.value>=a.max),m=u(()=>{const e=U(a.step);return a.precision!==void 0?a.precision:Math.max(U(l.value),e)}),B=u(()=>f(-a.step)<a.min),z=u(()=>f(a.step)>a.max),d=e=>{if(V.value=e,!e){s.value=e;return}a.formatter?s.value=a.formatter(Number(e)):s.value=e};function f(e){const{value:n}=l;let o=e;return typeof n=="number"&&!Number.isNaN(n)&&(o=parseFloat((n+e).toFixed(m.value))),Math.max(a.min,Math.min(a.max,o))}function N(){const{value:e}=l;if(!e&&e!==0||!String(e).trim())d("");else if(Number.isNaN(Number(e))||typeof e!="number"&&typeof e!="string")d("");else{const n=Number(e);(s.value===""||n!==Number(s.value))&&d(n.toFixed(m.value))}}function D(){const{value:e}=s,n=parseFloat(Number(e).toFixed(m.value));if(e==="")i(null);else if(Number.isNaN(n))N();else{const o=Math.max(a.min,Math.min(a.max,n));d(o.toFixed(m.value)),i(o)}}function i(e){const n=Q(l.value);e!==n&&(l.setValue(e),E(a.onChange,e,n),W(()=>{e!==l.value&&N()}))}function P(e){const{value:n}=e.target,o=n.trim().replace(/ã€‚/g,".");if(d(o),o===""){i(null);return}const A=Number(o);Number.isNaN(A)||A>=a.min&&A<=a.max&&i(A)}function g(){if(a.readonly||y.value||B.value)return;const e=f(-a.step);i(e)}function w(){if(a.readonly||y.value||z.value)return;const e=f(a.step);i(e)}function S(e){v.value&&(e.code==="Enter"||e.code==="NumpadEnter"?D():e.code==="ArrowUp"?(e.preventDefault(),w()):e.code==="ArrowDown"&&(e.preventDefault(),g()))}const h=I(!1);function $(e){h.value=!0,E(a.onFocus,e)}function t(e){h.value=!1,D(),l.markAsBlurred(),E(a.onBlur,e)}return T(V,e=>{if(e!==""){const n=Number(e);b.value=Number.isNaN(n)||n<a.min||n>a.max}else b.value=!1},{immediate:!0}),T(()=>l.value,()=>N(),{immediate:!0}),{mergedSize:C,mergedStatus:k,displayValue:s,isIllegal:b,isDisabled:y,isDisabledDec:p,isDisabledInc:M,isFocused:h,nowValue:c,handleKeyDown:S,handleDec:g,handleInc:w,handleInput:P,handleFocus:$,handleBlur:t}}function U(a){if(a==null)return 0;const r=String(a).split(".")[1];return r?r.length:0}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ee=X({name:"IxInputNumber",props:Z,setup(a,{expose:r,slots:l}){const F=R("common"),C=R("inputNumber"),{mergedSize:k,mergedStatus:V,displayValue:s,nowValue:b,isIllegal:c,isDisabled:v,isDisabledDec:y,isDisabledInc:p,isFocused:M,handleInput:m,handleFocus:B,handleBlur:z,handleKeyDown:d,handleDec:f,handleInc:N}=_(a,C),{elementRef:D,focus:i,blur:P}=J({handleBlur:z,handleFocus:B});r({focus:i,blur:P});const g=u(()=>`${F.prefixCls}-input-number`),w=u(()=>{const t=g.value;return K({[t]:!0,[`${t}-illegal`]:c.value})}),S=I();Y(()=>{D.value=S.value.getInputElement()});const h=t=>{t.stopPropagation(),N()},$=t=>{t.stopPropagation(),f()};return()=>{const t=g.value,e={...l,suffix:()=>[x("span",{key:"increase",class:K({[`${t}-increase`]:!0,[`${t}-increase-disabled`]:v.value||p.value}),role:"button",onClick:h},[x(j,{name:"up"},null)]),x("span",{key:"decrease",class:K({[`${t}-decrease`]:!0,[`${t}-decrease-disabled`]:v.value||y.value}),role:"button",onClick:$},[x(j,{name:"down"},null)])]};return x(L,{class:w.value,ref:S,type:"text",autocomplete:"off","aria-valuemin":a.min,"aria-valuemax":a.max,"aria-valuenow":b.value,disabled:v.value,focused:M.value,readonly:a.readonly,placeholder:a.placeholder,size:k.value,status:V.value,value:s.value,onInput:m,onKeydown:d},e)}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const te=ee;export{te as I};
