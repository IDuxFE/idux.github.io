import{ad as Ae,j as x,af as oe,aS as Ie,c as Fe,\u0275 as ke,u as Y,au as Ne,av as Ke,ab as Be,p as De,q as Le,G as Ee,H as Me,aw as Re,ax as Ve,ay as Oe}from"./index.f300137b.js";import{e as b,a4 as le,t as Te,v as re,b as Z,y as F,a as Pe,i as ze,w as we,a1 as te,p as Ge,z as Ue}from"./vendor.6b73f509.js";import{I as je}from"./index.6de76d88.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function He(e,a,l,c){return{mergedNodeMap:b(()=>{const s=new Map,o=ce(e,e.dataSource,a.value,l.value,c.value);return ee(o,s),s})}}function ce(e,a,l,c,u,s){const{treeDisabled:o,loadChildren:i}=e;return a.map(A=>de(A,l,c,u,o,!!i,s))}function de(e,a,l,c,u,s,o){var S;const i=l(e),{check:A,drag:y,drop:f,select:p}=$e(e,u),h=e[a],M=e[c],g=h==null?void 0:h.map(K=>de(K,a,l,c,u,s,i));return{children:g,label:M,key:i,isLeaf:(S=e.isLeaf)!=null?S:!((g==null?void 0:g.length)||s),parentKey:o,rawData:e,checkDisabled:A,dragDisabled:y,dropDisabled:f,selectDisabled:p}}function $e(e,a){const l=e.disabled;if(le(l))return{check:l,drag:l,drop:l,select:l};{let{drag:c,drop:u,select:s}=l!=null?l:{},o;if(a){const i=a(e);le(i)?(o!=null||(o=i),c!=null||(c=i),u!=null||(u=i),s!=null||(s=i)):(c!=null||(c=i.drag),u!=null||(u=i.drop),s!=null||(s=i.select),o!=null||(o=i.select))}return{check:o,drag:c,drop:u,select:s}}}function ee(e,a){e.forEach(l=>{const{key:c,children:u}=l;a.set(c,l),u&&ee(u,a)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _e(e,a,l){const c=b(()=>Ae(a.value)),u=b(()=>{const y=l.value;return c.value.map(f=>y.get(f)).filter(Boolean)}),s=y=>{const f=e.multiple?y:y[0],p=Te(a.value);f!==p&&(a.setValue(f),x(e.onChange,f,p))};return{selectedValue:c,selectedNodes:u,changeSelected:y=>{!e.multiple&&!y.length||s(y)},handleRemove:y=>{s(c.value.filter(f=>y!==f))},handleClear:y=>{y.stopPropagation(),s([]),x(e.onClear,y)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const se=Symbol("treeSelectToken"),qe=re({setup(){const{config:e,props:a,slots:l,locale:c,mergedPrefixCls:u,mergedChildrenKey:s,mergedGetKey:o,mergedLabelKey:i,mergedNodeMap:A,inputValue:y,setInputValue:f,treeRef:p,expandedKeys:h,setExpandedKeys:M,selectedValue:g,changeSelected:S,handleNodeClick:K}=ze(se),[V,P]=oe(a,"loadedKeys",()=>[]),B=Z(!1),C=b(()=>a.multiple&&a.checkable),O=b(()=>C.value?a.cascaderStrategy:"off"),z=(t,r,d)=>{const{onScrolledChange:v}=a;x(v,t,r,d.map(I=>I.rawData))},w=t=>{t.stopPropagation()},R=(t,r)=>{const{onCheck:d}=a;x(d,t,r),K()},T=(t,r)=>{var v;const{onSelect:d}=a;!a.multiple&&((v=g.value)==null?void 0:v[0])!==r.key&&x(d,t,r),K()},G=(t,r)=>{const{onExpand:d}=a;x(d,t,r)},U=(t,r)=>{const{onExpandedChange:d}=a;x(d,t,r),M(t)},j=t=>{var d,v;const r=B.value;r?(d=p.value)==null||d.expandAll():(v=p.value)==null||v.collapseAll(),B.value=!r,t.stopPropagation()},H=async(t,r)=>{var D;const d=(D=r.children)!=null?D:[],v=r.key,I=A.value,k=I.get(v);if(d.length&&k){const L=s.value,E=ce(a,d,L,o.value,i.value,v);ee(E,I),k.rawData[L]=d,k.children=E,P(t),x(a.onLoaded,t,r)}},$=b(()=>{var t;return(t=a.clearIcon)!=null?t:e.clearIcon}),_=t=>{const{value:r}=t.target;f(r),a.searchable&&x(a.onSearch,r)},q=()=>f("");return()=>{const{customAdditional:t,dataSource:r,draggable:d,draggableIcon:v,empty:I,expandIcon:k,multiple:D,leafLineIcon:L,virtual:E,searchable:W,showLine:X,onDragstart:n,onDragend:m,onDragenter:N,onDragleave:ue,onDragover:ie,onDrop:ye,onNodeClick:fe,onNodeContextmenu:ve,onScroll:ge,onScrolledBottom:pe,droppable:he,treeDisabled:me,loadChildren:Se,searchFn:J,overlayRender:ae,overlayHeight:be}=a,Ce=u.value,xe={label:l.treeLabel,prefix:l.treePrefix,suffix:l.treeSuffix,leafLineIcon:l.leafLineIcon,empty:l.empty,expandIcon:l.expandIcon,draggableIcon:l.draggableIcon},Q=[F(je,{ref:p,blocked:!0,checkOnClick:!0,checkedKeys:g.value,customAdditional:t,expandedKeys:h.value,loadedKeys:V.value,labelKey:i.value,checkable:C.value,cascaderStrategy:O.value,childrenKey:s.value,dataSource:r,draggable:d,draggableIcon:v,droppable:he,disabled:me,empty:I,expandIcon:k,getKey:o.value,height:be,loadChildren:Se,leafLineIcon:L,virtual:E,selectable:D?"multiple":!0,selectedKeys:g.value,searchValue:J!==!1?y.value:void 0,searchFn:Pe(J)?J:void 0,showLine:X,onClick:w,onCheck:R,onDragstart:n,onDragend:m,onDragenter:N,onDragleave:ue,onDragover:ie,onDrop:ye,onNodeClick:fe,onNodeContextmenu:ve,onExpand:G,onSelect:T,onLoaded:H,onCheckedChange:S,onSelectedChange:C.value?Ie:S,onExpandedChange:U,onScroll:ge,onScrolledBottom:pe,onScrolledChange:z},xe)];if(W==="overlay"){const ne=y.value;Q.unshift(F("div",{class:`${Ce}-overlay-search-wrapper`},[F(Fe,{size:"md",title:B.value?c.treeSelect.expandAll:c.treeSelect.collapseAll,icon:B.value?"tree-expand":"tree-unexpand",onClick:j},null),F(ke,{clearable:!0,clearIcon:$.value,clearVisible:!!ne,size:"sm",suffix:"search",value:ne,onClear:q,onInput:_},null)]))}return F("div",null,[ae?ae(Q):Q])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const We={control:{type:[String,Number,Object],default:void 0},value:{type:null,default:void 0},open:{type:Boolean,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:{type:Function,default:void 0},empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Array],default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},leafLineIcon:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},offset:Array,overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},size:{type:String,default:void 0},showLine:{type:Boolean,default:void 0},status:String,suffix:{type:String,default:void 0},treeDisabled:{type:Function,default:void 0},virtual:{type:Boolean,default:!1},"onUpdate:value":[Function,Array],"onUpdate:open":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],onCheck:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onSearch:[Function,Array],onSelect:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array],overlayHeight:{type:Number,default:256}},Xe=re({name:"IxTreeSelect",inheritAttrs:!1,props:We,setup(e,{attrs:a,expose:l,slots:c}){const u=Y("common"),s=Y("locale"),o=Y("treeSelect"),i=b(()=>`${u.prefixCls}-tree-select`),A=Ne(e,o,u,i),y=b(()=>{var n;return(n=e.childrenKey)!=null?n:o.childrenKey}),f=Ke(e,o),p=b(()=>{var n;return(n=e.labelKey)!=null?n:o.labelKey}),h=Z(),[M,g]=Be(""),S=()=>{var n;return(n=h.value)==null?void 0:n.focus()},K=()=>{var n;return(n=h.value)==null?void 0:n.blur()},V=()=>{var n;e.searchable==="overlay"?g(""):(n=h.value)==null||n.clearInput()},[P,B]=oe(e,"expandedKeys",()=>[]),{accessor:C,control:O}=De();Le(O);const z=Ee(e,o),w=Me(e,O),{mergedNodeMap:R}=He(e,y,f,p),{selectedValue:T,selectedNodes:G,changeSelected:U,handleRemove:j,handleClear:H}=_e(e,C,R),{overlayRef:$,overlayStyle:_,updateOverlay:q,overlayOpened:t,setOverlayOpened:r}=Re(e,o,h),d=Z();l({focus:S,blur:K,collapseAll:()=>{var n;return(n=d.value)==null?void 0:n.collapseAll()},expandAll:()=>{var n;return(n=d.value)==null?void 0:n.expandAll()},scrollTo:n=>{var m;(m=d.value)==null||m.scrollTo(n)},getNode:n=>{var m;return d.value?d.value.getNode(n):(m=R.value.get(n))==null?void 0:m.rawData}}),we(t,n=>{n&&S(),V()});const I=()=>{e.searchable!=="overlay"&&S()},k=()=>{e.multiple?V():r(!1)},D=()=>C.markAsBlurred(),L=n=>{S(),j(n)};Ge(se,{props:e,slots:c,config:o,locale:s,mergedPrefixCls:i,mergedChildrenKey:y,mergedGetKey:f,mergedLabelKey:p,expandedKeys:P,mergedNodeMap:R,inputValue:M,setInputValue:g,treeRef:d,accessor:C,setExpandedKeys:B,overlayOpened:t,setOverlayOpened:r,handleNodeClick:k,selectedValue:T,changeSelected:U});const E=b(()=>{const{overlayClassName:n,multiple:m}=e,N=i.value;return Ue({[`${N}-overlay`]:!0,[`${N}-overlay-multiple`]:m,[n||""]:!!n})}),W=()=>F(Oe,te({ref:h,className:i.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:o,dataSource:G.value,disabled:C.disabled,maxLabel:e.maxLabel,multiple:e.multiple,opened:t.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:z.value,status:w.value,suffix:e.suffix,value:T.value,onBlur:D,onClear:H,onInputValueChange:g,onItemRemove:L,onOpenedChange:r,onResize:q,onSearch:e.onSearch},a),c),X=()=>F(qe,{onClick:I},null);return()=>{var N;const n={class:E.value,style:_.value,clickOutside:!0,container:A.value,disabled:C.disabled||e.readonly,offset:(N=e.offset)!=null?N:o.offset,placement:"bottomStart",trigger:"manual",triggerId:a.id,visible:t.value,"onUpdate:visible":r},m={default:W,content:X};return F(Ve,te({ref:$},n),m)}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ze=Xe;export{Ze as I};
