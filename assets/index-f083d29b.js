import{O as Ue,P as Re,aR as kt,ao as qe,m as N,M as Ce,aL as X,aS as Ke,o as ee,D as Ee,a2 as Kt,K as we,Z as Xe,A as ge,Y as Ge,c as Me,j as Pe,ab as Et,at as Tt,H as Ye,a1 as he,$ as se,a3 as Ae,aT as $t,E as It,G as Rt,aU as Pt,av as Ot,L as Le,N as Ht,aw as zt,ar as Wt,aG as Ft}from"./index-e0064ebe.js";import{b as Ze,f as j,X as Mt,T as At,c as b,r as P,w as _,N as Je,M as Qe,d as ce,y as et,_ as ue,m as pe,bq as Lt,a1 as Nt,l as F,x as W,n as le,p as m,i as ie,ad as de,an as _t,B as Oe,K as Dt,au as Vt}from"./vendor-74fd07a1.js";import{b as tt}from"./GlobalCodeBox-051c3046.js";import{I as jt}from"./index-2f3eb2fa.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const nt=Symbol("IxTableColumn"),He=()=>{};He.displayName="IxTableColumn";He[nt]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function lt(e,t,n){if(!e||Ze(e)&&e.title===!1)return;if(j(t)||Mt(t))return t;const o=Ue(t).find(r=>r.type===At);return o?o.children:n}function Ut(e){return"key"in e?e.key:"dataKey"in e?Re(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:kt("__IDUX_table_column_key_")}function ot(e,t,n,o,r,l,s=!1){const a=v=>v.filter(g=>g.type!=="scroll-bar"),u=s?r:a(r),i=s?l:a(l);if(!u.length&&!i.length)return;const d=o.findIndex(v=>v.rowKey===e.rowKey),f=v=>{if(t.findIndex(y=>y.key===v.key)>-1)return;const g=n.findIndex(y=>y.key===v.key);return{data:v,index:g,poolKey:`fix-${d}-${g}`}};return{start:u.map(f).filter(Boolean),end:i.map(f).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function qt(e,t,n,o){const r=b(()=>{var h;const{columns:c}=e;return rt(c&&c.length>0?c:at((h=t.default)==null?void 0:h.call(t)),n)}),{flattedColumns:l,scrollBarColumn:s,flattedColumnsWithScrollBar:a}=Gt(r,o),{fixedColumns:u,fixedColumnKeys:i}=Yt(a),d=b(()=>!!e.ellipsis||l.value.some(c=>c.ellipsis)),f=b(()=>l.value.some(c=>c.fixed)),v=b(()=>a.value.length),{columnWidthMap:g,columnWidths:y,changeColumnWidth:p}=Zt(l),{columnOffsets:C,columnOffsetsWithScrollBar:k}=Jt(u,g,v),E=b(()=>Qt(r.value,s.value));return{flattedColumns:l,scrollBarColumn:s,flattedColumnsWithScrollBar:a,fixedColumns:u,fixedColumnKeys:i,hasEllipsis:d,hasFixed:f,columnWidthMap:g,columnWidths:y,changeColumnWidth:p,columnOffsets:C,columnOffsetsWithScrollBar:k,mergedRows:E}}function rt(e,t){return e.map(n=>Xt(n,t))}function at(e){const t=[];return Ue(e,{key:nt}).forEach((n,o)=>{const{props:r,children:l}=n,{key:s=o,editable:a,ellipsis:u,...i}=r||{};i.key=s,i.editable=a||a==="",i.ellipsis=u||u==="";const{default:d,cell:f,title:v,expand:g,icon:y}=l||{};d&&(i.children=at(d())),f&&(i.customCell=f),v&&(i.customTitle=v),g&&(i.customExpand=g),y&&(i.customIcon=y),t.push(i)}),t}function ve(e){return j(e)?{title:e,cell:e}:e}function Xt(e,t){var u,i;const{columnBase:n,columnExpandable:o,columnSelectable:r,columnIndexable:l}=t,{align:s=n.align}=e,a=Ut(e);if("type"in e){const{type:d}=e;if(d==="expandable"){const{showLine:f=o.showLine,icon:v=o.icon}=e;return{...e,key:a,align:ve(s),icon:v,showLine:f}}if(d==="selectable"){const{multiple:f=!0,showIndex:v=r.showIndex}=e;return{...e,key:a,align:ve(s),multiple:f,showIndex:v}}if(d==="indexable"){const f=(i=(u=e.align)!=null?u:l.align)!=null?i:n.align;return{...l,...e,align:ve(f),key:a}}return{...e,key:a,align:ve(s)}}else{const{sortable:d,filterable:f,children:v}=e,g={...e,key:a,align:ve(s)};return d&&(g.sortable={...n.sortable,...d}),f&&(g.filterable={...n.filterable,...f}),v!=null&&v.length&&(g.children=rt(v,t)),g}}function Gt(e,t){const n=b(()=>ze(e.value)),o=b(()=>{const l=t.value,s=n.value;if(l===0||s.length===0)return;const a=s[s.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:a&&a.fixed,width:l}}),r=b(()=>{const l=n.value,s=o.value;return s?[...l,s]:l});return{flattedColumns:n,scrollBarColumn:o,flattedColumnsWithScrollBar:r}}function ze(e){const t=[];return e.forEach(n=>{const{fixed:o,children:r}=n;if(r!=null&&r.length){let l=ze(r);o&&(l=l.map(s=>({fixed:o,...s}))),t.push(...l)}else t.push(n)}),t}function Yt(e){const t=b(()=>{const o=[],r=[];return e.value.forEach(l=>{const{fixed:s}=l;s==="start"?o.push(l):s==="end"&&r.push(l)}),{fixedStartColumns:o,fixedEndColumns:r}}),n=b(()=>{var l,s;const{fixedStartColumns:o,fixedEndColumns:r}=t.value;return{lastStartKey:(l=o[o.length-1])==null?void 0:l.key,firstEndKey:(s=r[0])==null?void 0:s.key}});return{fixedColumns:t,fixedColumnKeys:n}}function Zt(e){const t=P({}),n=P(),o=P([]);return _(n,Je(l=>{o.value=l?l.split("-").filter(Boolean).map(Number):[]},16)),Qe(()=>{const l=e.value;n.value=l.map(s=>t.value[s.key]).join("-")}),{columnWidthMap:t,columnWidths:o,changeColumnWidth:(l,s)=>{s===!1?delete t.value[l]:t.value[l]=s}}}function Jt(e,t,n){const o=b(()=>Ne(e.value.fixedStartColumns,e.value.fixedEndColumns.filter(l=>l.type!=="scroll-bar"),t.value,n.value-1)),r=b(()=>Ne(e.value.fixedStartColumns,e.value.fixedEndColumns,t.value,n.value));return{columnOffsets:o,columnOffsetsWithScrollBar:r}}function Ne(e,t,n,o){var u,i,d,f;const r={},l={};let s=0,a=0;for(let v=0;v<e.length;v++){const g=e[v],y=(i=(u=n[g.key])!=null?u:g.width)!=null?i:0;r[g.key]={index:v,offset:s},s+=y}for(let v=0;v<t.length;v++){const g=t[t.length-v-1],y=(f=(d=n[g.key])!=null?d:g.width)!=null?f:0;l[g.key]={index:o-v-1,offset:a},a+=y}return{starts:r,ends:l}}function Qt(e,t){const n=[],o={};function r(a,u,i){var v;(v=n[i])!=null||(n[i]=[]);let d=u;return a.map(g=>{var E;let y=(E=g.titleColSpan)!=null?E:1,p=!1;const C=g.children;if(C!=null&&C.length){p=!0;const c=r(C,d,i+1);ce(g.titleColSpan)&&(y=c.reduce((h,S)=>h+S))}const k=d+y-1;return n[i].push({...g,titleColSpan:y,colStart:d,colEnd:k,hasChildren:p}),o[g.key]={colStart:d,colEnd:k},d+=y,y})}const l=t?[...e,t]:e;r(l,0,0);const s=n.length;return n.forEach((a,u)=>{a.forEach(i=>{i.hasChildren||(i.titleRowSpan=s-u)})}),{rows:n,offsetIndexMap:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function en(e,t,n,o,r,l,s){const a=b(()=>{const p=t.value,C=n.value;return e.dataSource.map((k,E)=>st(k,C,p,E,e.dataSource.length))}),u=b(()=>{const p=new Map;return Te(a.value,p),p}),i=b(()=>it(a.value,r.value,l.value)),d=b(()=>ct(i.value,o.value,l.value)),f=b(()=>{const p=s.value,C=d.value;if(p===null||!p.pageSize)return C;{const{total:k}=p;if(k&&C.length<k)return C;const E=p.pageSize,c=(p.pageIndex-1)*E;return C.slice(c,c+E)}}),v=b(()=>{const p=new Map;return Te(f.value,p),p}),g=b(()=>{const p=l.value;return p.length>0?ut(f.value,p,0):f.value});return{isTreeData:b(()=>a.value.some(p=>{var C;return(C=p.children)==null?void 0:C.length})),filteredData:i,flattedData:g,mergedMap:u,paginatedMap:v}}function st(e,t,n,o,r,l){var i;const s=t(e),a={record:e,rowKey:s,parentKey:l==null?void 0:l[0].rowKey,showLineIndentIndexList:(i=[...l!=null?l:[]].reverse())==null?void 0:i.reduce((d,f,v)=>(f.hasNextSibling&&d.push(v),d),[]),hasPrevSibling:o>0,hasNextSibling:o<r-1},u=e[n];return u&&(a.children=u.map((d,f)=>st(d,t,n,f,u.length,[a,...l!=null?l:[]]))),a}function Te(e,t){e.forEach(n=>{const{rowKey:o,children:r}=n;t.set(o,n),r&&Te(r,t)})}function ct(e,t,n){const o=t.filter(s=>s.sorter),r=o.length;if(r===0)return e;const l=e.slice();return l.forEach(s=>{n.includes(s.rowKey)&&s.children&&s.children.length>0&&(s.children=ct(s.children,t,n))}),l.sort((s,a)=>{for(let u=0;u<r;u++){const{orderBy:i,sorter:d}=o[u],f=d(s.record,a.record);if(f!==0)return i==="ascend"?f:-f}return 0})}function it(e,t,n){const o=t.filter(r=>r.filter);return o.length===0?e:e.map(r=>{const l=o.every(({filter:d,filterBy:f})=>d(f,r.record)),{rowKey:s,children:a}=r,u=n.includes(s);let i=r;if(u&&a&&a.length){const d=it(a,t,n);d.length!==a.length&&(i={...r,children:d})}return l||u&&i.children&&i.children.length?i:null}).filter(r=>r!==null)}function ut(e,t,n){return e.reduce((o,r)=>{const{children:l,parentKey:s,record:a,rowKey:u,hasPrevSibling:i,hasNextSibling:d,showLineIndentIndexList:f}=r,v=t.includes(u);if(o.push({children:l,parentKey:s,record:a,rowKey:u,level:n,expanded:v,hasPrevSibling:i,hasNextSibling:d,showLineIndentIndexList:f}),v&&r.children){const g=ut(r.children,t,n+1);o.push(...g)}return o},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tn(e,t){const n=b(()=>t.value.find(a=>"type"in a&&a.type==="expandable")),[o,r]=qe(e,"expandedRowKeys",()=>[]);return{expandable:n,expandedRowKeys:o,setExpandedRowKeys:r,checkExpandDisabled:a=>{if(!n.value)return!0;const{disabled:u,customExpand:i}=n.value,{record:d}=a;return u!=null&&u(d)?!0:!(i||a.children&&a.children.length>0)},handleExpandChange:(a,u)=>{const{onChange:i,onExpand:d}=n.value||{},f=[...o.value],v=f.indexOf(a),g=v>=0;g?f.splice(v,1):f.push(a),N(d,!g,u),r(f),N(i,f)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nn(e){const t=b(()=>e.value.filter(l=>l.filterable)),n=et({}),o=P([]);return _(t,(l,s)=>{l.forEach(a=>{const{key:u,filterable:i}=a,d=i.filterBy;if(d||n[u]===void 0){n[u]=d||[];return}const f=s?s.find(g=>g.key===u):void 0;(f==null?void 0:f.filterable.filterBy)&&(n[u]=[])}),o.value=_e(l,n)},{immediate:!0}),{activeFilters:o,activeFilterByMap:n,handleFilter:(l,s,a)=>{const{onChange:u}=s;n[l]=a,o.value=_e(t.value,n),N(u,a,o.value)}}}function _e(e,t){return e.map(n=>{const{key:o,filterable:r}=n,{filter:l,filterBy:s=t[o]}=r;return{key:o,filter:l,filterBy:s}}).filter(n=>n.filter&&n.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ln(e,t,n){var i,d,f,v,g;const o=Ce("pagination"),r=b(()=>{const{pagination:y}=e;return y===!1?null:y===!0?{}:y}),l=P((d=(i=r.value)==null?void 0:i.pageIndex)!=null?d:1),s=P((g=(v=(f=r.value)==null?void 0:f.pageSize)!=null?v:t.pagination.pageSize)!=null?g:o.pageSize),a=(y,p)=>{var C;l.value=y,s.value=p,N((C=r.value)==null?void 0:C.onChange,y,p)};return{mergedPagination:b(()=>{var p,C;const y=r.value;return y===null?null:{...t.pagination,size:n.value,...y,pageIndex:(p=y.pageIndex)!=null?p:l.value,pageSize:(C=y.pageSize)!=null?C:s.value,onChange:a}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function on(e,{setStickyScrollLeft:t}){const n=P(),o=P(),r=P(),l=P(),s=P();_(n,c=>{c&&(r.value=c.getHolderElement())});const{handleScroll:a,pingedStart:u,pingedEnd:i}=rn(e,o,r,s,t),{scrollHorizontalOverflowed:d,scrollVerticalOverflowed:f}=an(r,l),v=b(()=>{var c;return X((c=e.scroll)==null?void 0:c.width)}),g=b(()=>{var c;return X((c=e.scroll)==null?void 0:c.height)}),y=b(()=>Ke(ee(r))),p=b(()=>f.value?y.value:0),C=b(()=>u.value&&d.value),k=b(()=>i.value&&d.value);return{virtualScrollRef:n,scrollHeadRef:o,scrollBodyRef:r,scrollContentRef:l,scrollFootRef:s,handleScroll:a,scrollTo:c=>{var h;e.virtual?(h=n.value)==null||h.scrollTo(c):typeof c=="number"&&Kt({target:ee(r),top:c,duration:200})},pingedStart:C,pingedEnd:k,scrollWidth:v,scrollHeight:g,scrollBarSize:y,scrollBarSizeOnFixedHolder:p,scrollHorizontalOverflowed:d,scrollVerticalOverflowed:f}}function rn(e,t,n,o,r){const l=P(!1),s=P(!1);let a;const u=()=>{a&&(clearTimeout(a),a=void 0)};ue(()=>u());const i=P(),d=y=>{i.value=y,u(),a=setTimeout(()=>{i.value=void 0,a=void 0},100)},f=(y,p)=>{p&&p.scrollLeft!==y&&(p.scrollLeft=y)},v=y=>{const p=ee(n);if(!p)return;const{clientWidth:C,scrollWidth:k}=p;r(y/k*C||0)};return{handleScroll:(y,p)=>{const C=y==null?void 0:y.currentTarget,k=p!=null?p:C.scrollLeft,E=i.value;if((!E||E===C)&&(d(C),f(k,t.value),f(k,ee(n)),f(k,o.value),v(k)),C){const{scrollWidth:c,clientWidth:h}=C;l.value=k>1,s.value=c-h-k>1}(y==null?void 0:y.type)==="scroll"&&N(e.onScroll,y)},pingedStart:l,pingedEnd:s}}function an(e,t){const n=P(!1),o=P(!1),r=()=>{const a=ee(e.value);a?(n.value=a.scrollWidth>a.clientWidth,o.value=a.scrollHeight>a.clientHeight):(n.value=!1,o.value=!1)};let l=[];const s=()=>l.forEach(a=>a());return pe(()=>{l=[Ee(e,r),Ee(t,r)]}),ue(()=>s()),{scrollHorizontalOverflowed:n,scrollVerticalOverflowed:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function sn(e,t,n,o,r,l){const s=b(()=>{var d;return(d=e.scrollToTopOnChange)!=null?d:t.scrollToTopOnChange});let a=[];const u=()=>{a=[_([()=>{var d;return(d=n.value)==null?void 0:d.pageIndex},()=>{var d;return(d=n.value)==null?void 0:d.pageSize}],()=>l(0)),_([r,o],([d,f],[v,g])=>{(!cn(d,v)||!un(f,g))&&l(0)})]},i=()=>{a.forEach(d=>d())};_(s,d=>{i(),d&&u()},{immediate:!0})}function cn(e,t){return e.length===t.length&&e.every(n=>{const o=t.find(r=>r.key===n.key);return o?n.filter===o.filter&&n.filterBy.length===o.filterBy.length&&n.filterBy.every(r=>o.filterBy.includes(r)):!1})}function un(e,t){return e.length===t.length&&e.every(n=>{const o=t.find(r=>r.key===n.key);return o?n.sorter===o.sorter&&n.orderBy===o.orderBy&&n.multiple===o.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dn(e,t,n,{mergedMap:o,paginatedMap:r}){const l=b(()=>n.value.find(c=>"type"in c&&c.type==="selectable")),[s,a]=qe(e,"selectedRowKeys",()=>[]),u=b(()=>{const{disabled:c}=l.value||{},h=[],S=[];return r.value.forEach((B,w)=>{c!=null&&c(B.record)?S.push(w):h.push(w)}),{enabledRowKeys:h,disabledRowKeys:S}}),i=b(()=>{const c=new Set,h=s.value,{disabledRowKeys:S}=u.value,B=o.value;return h.forEach(w=>{const{parentKey:K}=B.get(w)||{};if(!ce(K)){let x=B.get(K);if(x&&!h.includes(x.rowKey))for(;x&&!ce(x==null?void 0:x.rowKey);)S.includes(x.rowKey)||c.add(x.rowKey),x=ce(x.parentKey)?void 0:B.get(x.parentKey)}}),[...c]}),d=b(()=>{const c=s.value,{disabledRowKeys:h}=u.value;let S=0;return r.value.forEach((B,w)=>{!h.includes(w)&&c.includes(w)&&S++},0),S}),f=b(()=>{const c=r.value.size,h=u.value.disabledRowKeys.length;return c===0||c===h?!1:c===h+d.value}),v=b(()=>!f.value&&d.value>0),g=new Map,y=c=>{a(c);const h=o.value,{onChange:S}=l.value||{};if(S){const B=[];g.forEach((w,K)=>{c.includes(K)||g.delete(K)}),c.forEach(w=>{let K=h.get(w);K?g.set(w,K):K=g.get(w),K&&B.push(K.record)}),N(S,c,B)}},p=(c,h)=>{const S=o.value,{disabledRowKeys:B}=u.value,{multiple:w,onSelect:K}=l.value||{};let x=[...s.value];const T=x.indexOf(c),R=T>=0;if(w){const O=S.get(c),H=dt(O,B);if(R){x.splice(T,1);const D=fn(S,O,B);x=x.filter(U=>!D.includes(U)&&!H.includes(U))}else x.push(c),x.push(...H);vn(S,O,x,B)}else x=R?[]:[c];N(K,!R,h),y(x)},C=()=>{const{enabledRowKeys:c}=u.value,h=new Set(s.value);f.value?c.forEach(S=>h.delete(S)):c.forEach(S=>h.add(S)),y([...h])},k=hn(l,t),E=yn(l,o,r,s,y);return{selectable:l,selectedRowKeys:s,indeterminateRowKeys:i,currentPageRowKeys:u,currentPageAllSelected:f,currentPageSomeSelected:v,handleSelectChange:p,handleHeadSelectChange:C,mergedSelectableMenus:k,handleSelectableMenuClick:E}}function dt(e,t){const n=[],{children:o}=e||{};return o&&o.forEach(r=>{const{rowKey:l}=r;t.includes(l)||n.push(r.rowKey),n.push(...dt(r,t))}),n}function fn(e,t,n){const o=[];for(;t!=null&&t.parentKey;){const{parentKey:r}=t;n.includes(t.parentKey)||o.push(r),t=e.get(r)}return o}function vn(e,t,n,o){let r=!0;for(;r&&t&&!ce(t.parentKey);){const l=e.get(t.parentKey);if(l&&!o.includes(t.parentKey)){r=l.children.every(a=>o.includes(a.rowKey)||n.includes(a.rowKey));const s=n.findIndex(a=>a===t.parentKey);r?s<0&&n.push(t.parentKey):s>-1&&n.splice(s,1)}t=l}}const ft=Symbol("IDUX_TABLE_KEY_selectable-all"),vt=Symbol("IDUX_TABLE_KEY_selectable-invert"),ht=Symbol("IDUX_TABLE_KEY_selectable-none"),yt=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function hn(e,t){return b(()=>{const{menus:n}=e.value||{};if(!n||n.length===0)return[];const{selectAll:o,selectInvert:r,selectNone:l,selectPageInvert:s}=t.table;return n.map(a=>j(a)?a==="all"?{type:"item",key:ft,label:o}:a==="invert"?{type:"item",key:vt,label:r}:a==="none"?{type:"item",key:ht,label:l}:a==="pageInvert"?{type:"item",key:yt,label:s}:{type:"item",key:a,label:a}:a)})}function yn(e,t,n,o,r){const l=()=>{const{disabled:d,onSelectAll:f}=e.value||{},v=[];t.value.forEach((g,y)=>{d!=null&&d(g.record)||v.push(y)}),N(f,v),r(v)},s=()=>{const{disabled:d,onSelectInvert:f}=e.value||{},v=[...o.value];t.value.forEach((g,y)=>{if(d!=null&&d(g.record))return;const p=v.indexOf(y);p>=0?v.splice(p,1):v.push(y)}),r(v),N(f,v)},a=()=>{const{onSelectNone:d}=e.value||{};N(d),r([])},u=()=>{const{disabled:d,onSelectPageInvert:f}=e.value||{},v=[],g=o.value;n.value.forEach((y,p)=>{d!=null&&d(y.record)||g.includes(p)||v.push(p)}),N(f,v),r(v)},i=new Map([[ft,l],[vt,s],[ht,a],[yt,u]]);return d=>{const f=d.key;if(Lt(f)&&i.has(f)){i.get(f)();return}const{disabled:v,onMenuClick:g}=e.value||{};if(!g)return;const y=[];n.value.forEach((p,C)=>{v!=null&&v(p.record)||y.push(C)}),N(g,d,y)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function gn(e){const t=b(()=>e.value.filter(s=>s.sortable)),n=b(()=>t.value.some(s=>s.sortable.multiple!==void 0)),o=et({}),r=P([]);return _(t,(s,a)=>{s.forEach(u=>{const{key:i,sortable:d}=u,f=d.orderBy;if(f||o[i]===void 0){o[i]=f;return}const v=a?a.find(y=>y.key===i):void 0;(v==null?void 0:v.sortable.orderBy)&&(o[i]=void 0)}),r.value=Ve(s,o)},{immediate:!0}),{activeSorters:r,activeOrderByMap:o,handleSort:(s,a)=>{const{orders:u,onChange:i}=a,d=o[s],f=d?De(u,d):De(u);n.value?o[s]=f:Object.keys(o).forEach(v=>{s===v?o[v]=f:o[v]=void 0}),r.value=Ve(t.value,o),N(i,f,r.value)}}}function De(e,t){return t?e[e.indexOf(t)+1]:e[0]}function Ve(e,t){return e.map(n=>{const{key:o,sortable:r}=n,{multiple:l=0,orderBy:s=t[o],sorter:a}=r;return{key:o,multiple:l,orderBy:s,sorter:a}}).filter(n=>n.orderBy).sort((n,o)=>o.multiple-n.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function pn(e){const t=b(()=>!!e.sticky),n=b(()=>{const{sticky:l}=e,{offsetTop:s=0,offsetBottom:a=0,offsetScroll:u=0,container:i=window}=Nt(l)?l:{};return{offsetTop:s,offsetBottom:a,offsetScroll:u,container:i}}),[o,r]=we(0);return{isSticky:t,mergedSticky:n,stickyScrollLeft:o,setStickyScrollLeft:r}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function mn(e,{hasEllipsis:t,hasFixed:n},{scrollWidth:o,scrollHeight:r},l,s,a){return b(()=>e.tableLayout?e.tableLayout:o.value&&n.value?o.value==="max-content"?"auto":"fixed":r.value||a.value||l.value||t.value||s.value.horizontal||s.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const M=Symbol("TABLE_TOKEN"),We=Symbol("tableBodyToken"),gt=Symbol("tableBodyRowToken"),ye=F({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:n,columnWidthMap:o,mergedSelectableMenus:r,mergedPrefixCls:l}=W(M),s=b(()=>{const{isFixedHolder:a,columns:u}=e;return u||(a?n.value:t.value)});return()=>{if(s.value.every(i=>!i.width&&!i.type))return;const a=l.value,u=s.value.map(i=>{var p;const{key:d,type:f}=i,v=(p=i.width)!=null?p:o.value[d],g=f?le({[`${a}-col-${f}`]:!0,[`${a}-col-with-dropdown`]:f==="selectable"&&r.value.length>0}):void 0,y={width:X(v),minWidth:X(i.minWidth),maxWidth:X(i.maxWidth)};return m("col",{key:d,class:g,style:y},null)});return m("colgroup",null,[u])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const bn={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},Sn={columns:{type:Array,required:!0}},xn={column:{type:Object,required:!0}},Cn={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},wn={column:{type:Object,required:!0},colIndex:{type:Number,required:!0},colSpan:Number,rowSpan:Number},Bn={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},kn={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},Kn={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},En=F({props:kn,setup(e){const{slots:t,config:n,locale:o,mergedPrefixCls:r}=W(M),l=b(()=>{var c;return(c=e.filterable.multiple)!=null?c:n.columnBase.filterable.multiple}),s=b(()=>{var c;return(c=e.filterable.footer)!=null?c:n.columnBase.filterable.footer}),a=e.activeFilterBy,[u,i]=we(()=>a);_(()=>e.activeFilterBy,c=>i(c));const[d,f]=we(!1),v=c=>{f(c),c||e.onUpdateFilterBy(u.value)},g=()=>{f(!1),e.onUpdateFilterBy(u.value)},y=()=>{i(a)},p=c=>{const h=`${r.value}-filterable-menu-label`,S=l.value?Pe:tt;return m("span",{class:h},[m(S,{checked:c.selected,disabled:c.disabled},null),m("span",{class:`${h}-content`},[c.label])])},C=()=>{const c=[],{customMenu:h,menus:S}=e.filterable;return ie(h)?c.push(h({selectedKeys:u.value,setSelectedKeys:i})):j(h)&&t[h]?c.push(t[h]({selectedKeys:u.value,setSelectedKeys:i})):c.push(Tn(S,l,u,i,p)),s.value&&c.push($n(o,r,g,y)),c},k=b(()=>{const c=`${r.value}-filterable-trigger`;return le({[c]:!0,[`${c}-active`]:e.activeFilterBy.length>0})}),E=()=>{const{customTrigger:c}=e.filterable;return ie(c)?c():j(c)&&t[c]?t[c]():m("span",{class:k.value,onClick:h=>h.stopPropagation()},[m(ge,{name:"filter-filled"},null)])};return()=>{const c={visible:d.value,hideOnClick:!s.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":v};return m(Xe,c,{default:E,overlay:C})}}}),Tn=(e,t,n,o,r)=>{const l={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:n.value,"onUpdate:selectedKeys":o};return m(Ge,l,{itemLabel:r})},$n=(e,t,n,o)=>{const{filterConfirm:r,filterReset:l}=e.table;return m("div",{class:`${t.value}-filterable-trigger-footer`},[m(Me,{mode:"primary",size:"xs",onClick:n},{default:()=>[r]}),m(Me,{size:"xs",onClick:o},{default:()=>[l]})])},In=F({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:n,currentPageRowKeys:o,currentPageAllSelected:r,currentPageSomeSelected:l,handleHeadSelectChange:s,mergedSelectableMenus:a,handleSelectableMenuClick:u}=W(M),i=b(()=>{const C=t.value.size;return C===0||C===o.value.disabledRowKeys.length}),[d,f]=we(!1),v={"onUpdate:visible":f,trigger:"click"},g=()=>m(Ge,{dataSource:a.value,onClick:u},null),y=()=>m(ge,{class:`${e.value}-selectable-trigger`,name:"down",rotate:d.value?180:0},null),p=()=>{if(a.value.length!==0)return m(Xe,v,{default:y,overlay:g})};return()=>{const{multiple:C}=n.value;if(C)return m("span",{class:`${e.value}-cell-triggers`},[m(Pe,{checked:r.value,indeterminate:l.value,disabled:i.value,onChange:s},null),p()])}}}),Rn=F({props:Kn,setup(e){const{locale:t,mergedPrefixCls:n}=W(M);return()=>{const{activeOrderBy:o,sortable:r}=e,{orders:l,nextTooltip:s}=r,a=s&&Pn(t.table,l,o),u=On(n,l,o);return a?m(Et,{title:a},{default:()=>[u]}):u}}});function Pn(e,t,n){const o=n?t[t.indexOf(n)+1]:t[0],{sortCancel:r,sortAsc:l,sortDesc:s}=e;return o?o==="ascend"?l:s:r}function On(e,t,n){const o=e.value,r=`${o}-sortable-trigger-active`,l=t.includes("ascend")&&m(ge,{name:"caret-up-filled",class:n==="ascend"?r:void 0},null),s=t.includes("descend")&&m(ge,{name:"caret-down-filled",class:n==="descend"?r:void 0},null);return m("span",{class:`${o}-sortable-trigger`},[l,s])}const Hn=F({props:xn,setup(e){const{props:t,slots:n,mergedPrefixCls:o,fixedColumnKeys:r,columnOffsetsWithScrollBar:l,isSticky:s,handleSort:a,activeOrderByMap:u,activeFilterByMap:i,mergedRows:d,handleFilter:f}=W(M),v=b(()=>{const{type:c,ellipsis:h}=e.column,S=c||h!=null?h:t.ellipsis;return Ze(S)&&S.head===!1?void 0:S}),g=b(()=>{const{type:c,align:h,fixed:S,hasChildren:B,key:w,sortable:K,filterable:x}=e.column,T=o.value;let R={[`${T}-cell`]:!0,[`${T}-cell-${c}`]:!!c,[`${T}-cell-filterable`]:!!x,[`${T}-cell-sortable`]:!!K,[`${T}-cell-align-center`]:B||(h==null?void 0:h.title)==="center",[`${T}-cell-align-end`]:!B&&(h==null?void 0:h.title)==="end",[`${T}-cell-ellipsis`]:!!v.value};if(S){const{lastStartKey:O,firstEndKey:H}=r.value;R={...R,[`${T}-fix-start`]:S==="start",[`${T}-fix-start-last`]:O===w,[`${T}-fix-end`]:S==="end",[`${T}-fix-end-first`]:H===w,[`${T}-fix-sticky`]:s.value}}return le(R)}),y=b(()=>{var R;const{key:c,fixed:h}=e.column,{offsetIndexMap:S}=d.value;if(!h)return;const{starts:B,ends:w}=l.value,K=Object.values(h==="start"?B:w),x=S[c][h==="start"?"colStart":"colEnd"],T=X((R=K.find(O=>O.index===x))==null?void 0:R.offset);return{position:"sticky",left:h==="start"?T:void 0,right:h==="end"?T:void 0}}),p=b(()=>u[e.column.key]),C=b(()=>i[e.column.key]||Tt),k=c=>{const{key:h,filterable:S}=e.column;f(h,S,c)},E=()=>{const{key:c,sortable:h}=e.column;h&&a(c,h)};return()=>{var H,D,U;const{column:c}=e,{type:h,titleColSpan:S,titleRowSpan:B}=c;if(h==="scroll-bar")return m("th",{class:g.value,style:y.value,colspan:S===1?void 0:S,rowspan:B===1?void 0:B,onClick:E},null);const w=o.value;let K,x;if(h==="selectable")x=m(In,null,null);else{const{title:V,customTitle:J,sortable:te,filterable:I}=c,G=v.value;x=zn(V,J,n),K=lt(G,x,V);const Y=Wn(te,p,I,C,k);Y.length>0?x=m("span",{class:`${w}-cell-triggers`},[m("span",{class:`${w}-cell-title`},[x]),Y]):G&&(x=m("span",{class:`${w}-cell-title`},[x]))}const T=(H=t.customAdditional)==null?void 0:H.headCell,R=T?T({column:c}):void 0,O=(U=(D=t.customTag)==null?void 0:D.headCell)!=null?U:"th";return m(O,de({class:g.value,style:y.value,colSpan:S===1?void 0:S,rowSpan:B===1?void 0:B,title:K},R,{onClick:E}),{default:()=>[x]})}}});function zn(e,t,n){let o=e;return ie(t)?o=t({title:e}):j(t)&&n[t]&&(o=n[t]({title:e})),o}function Wn(e,t,n,o,r){const l=[];return e&&l.push(m(Rn,{activeOrderBy:t.value,sortable:e},null)),n&&l.push(m(En,{activeFilterBy:o.value,filterable:n,onUpdateFilterBy:r},null)),l}function Fn(e){return e.map(t=>pt(t)).filter(Boolean)}function pt(e){if(e.titleColSpan!==0)return m(Hn,{key:e.key,column:e},null)}const Mn=F({props:Sn,setup(e,{slots:t}){const{props:n,mergedPrefixCls:o}=W(M);return()=>{var u,i,d;const{columns:r}=e,l=(u=n.customAdditional)==null?void 0:u.headRow,s=l?l({columns:r}):void 0,a=(d=(i=n.customTag)==null?void 0:i.headRow)!=null?d:"tr";return m(a,de({class:`${o.value}-row`},s),{default:()=>{var f;return[(f=t.default)==null?void 0:f.call(t)]}})}}});function mt(e,t,n){return m(Mn,{columns:e,key:t},{default:()=>[n]})}const $e=F({setup(e,{slots:t}){const{props:n,mergedRows:o,mergedPrefixCls:r}=W(M);return()=>{var d,f,v;let l;const{rows:s}=o.value,a=(d=n.customAdditional)==null?void 0:d.head,u=a?a({rows:s}):void 0,i=(v=(f=n.customTag)==null?void 0:f.head)!=null?v:"thead";return t.default?l=t.default():l=s.map((g,y)=>{const p=Fn(g);return mt(g,y,p)}),m(i,de({class:`${r.value}-thead`},u),{default:()=>[l]})}}}),An=F({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:n,mergedVirtual:o,mergedVirtualColWidth:r,scrollHeadRef:l,handleScroll:s,scrollWidth:a,flattedData:u,flattedColumns:i,fixedColumns:d,mergedRows:f,isSticky:v}=W(M),g=P();pe(()=>{_(g,c=>{c&&(l.value=c.getHolderElement(),l.value.style.overflow="hidden")},{immediate:!0})}),Ln(l,s);const y=b(()=>a.value==="max-content"),p=b(()=>u.value.length>0),C=b(()=>{const c=n.value;return{[`${c}-fixed-holder`]:!0,[`${c}-sticky-holder`]:v.value}}),k=b(()=>{const c=v.value,{offsetTop:h,offsetBottom:S}=e;return{overflow:"hidden",top:c?X(h):void 0,bottom:c?X(S):void 0}}),E=b(()=>o.value.horizontal?f.value.rows.map((c,h)=>({key:h,data:c})):[]);return()=>{const c=p.value||!y.value;if(o.value.horizontal){const h=(T,{renderedData:R})=>{let O=[];if(c){const H=[];R.forEach(D=>{H.push(...D.data)}),O=ze(H)}return m("table",{style:{tableLayout:"fixed"}},[c&&m(ye,{columns:O,isFixedHolder:!0},null),m($e,null,{default:()=>[T]})])},S=({item:T,index:R,children:O})=>mt(T.data,R,O),B=({item:T})=>pt(T),w=(T,R)=>{const{fixedStartColumns:O,fixedEndColumns:H}=d.value;return ot(T,R,i.value,u.value,O,H,!0)},{virtualBufferSize:K,virtualBufferOffset:x}=t;return m("div",{class:C.value,style:k.value},[m(Ye,{ref:g,dataSource:E.value,colModifier:w,getKey:"key",height:0,width:"100%",colWidth:r.value,rowRender:S,colRender:B,contentRender:h,virtual:{horizontal:!0,vertical:!1},bufferSize:K,bufferOffset:x},null)])}return m("div",{class:C.value,style:k.value,ref:l},[m("table",{style:{tableLayout:"fixed"}},[c&&m(ye,{isFixedHolder:!0},null),m($e,null,null)])])}}});function Ln(e,t){const n=l=>{if(!l.shiftKey)return;const s=l.deltaY,a=l.currentTarget;if(s){const u=a.scrollLeft+s;t(l,u)}},o=l=>{he(l,"wheel",n,{passive:!0})},r=l=>{se(l,"wheel",n)};pe(()=>{_(e,(l,s)=>{r(s),o(l)},{immediate:!0})}),ue(()=>r(e.value))}const Nn=F({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:n,mergedSticky:o,stickyScrollLeft:r,setStickyScrollLeft:l}=W(M),s=P(!1),a=P(!1),u=P(0),i=P(0),d=P(0),f=b(()=>{const c=i.value,h=d.value;return h&&c*(c/h)});Qe(()=>{const c=ee(t);if(c&&s.value){const{clientWidth:h,scrollWidth:S,scrollLeft:B}=c;l(B/S*h),i.value=h,d.value=S}});const v=b(()=>({height:Ke(),width:i.value,bottom:o.value.offsetScroll})),g=b(()=>{const c=e.value;return{[`${c}-sticky-scrollbar-thumb`]:!0,[`${c}-sticky-scrollbar-thumb-active`]:a.value}}),y=b(()=>({width:`${f.value}px`,transform:`translate3d(${r.value}px, 0, 0)`})),p=()=>a.value=!1,C=c=>{u.value=c.pageX-r.value,a.value=!0,c.preventDefault()},k=c=>{if(!a.value)return;const{buttons:h}=c||window.event;if(h===0){a.value=!1;return}let S=c.pageX-u.value;S<=0&&(S=0);const B=i.value,w=d.value,K=f.value;S+K>=B&&(S=B-K);const x=S/B*(w+2);n(c,x)},E=()=>{const c=ee(t),h=Ae(c).top,S=h+c.offsetHeight,{container:B,offsetScroll:w}=o.value,K=B===window?document.documentElement.scrollTop+window.innerHeight:Ae(B).top+B.clientHeight;S-Ke()<=K||h>=K-w?s.value=!1:s.value=!0};return pe(()=>{he(document.body,"mouseup",p),he(document.body,"mousemove",k),he(window,"resize",E),_(()=>o.value.container,(c,h)=>{se(h,"scroll",E),he(c,"scroll",E)},{immediate:!0}),E()}),ue(()=>{se(document.body,"mouseup",p),se(document.body,"mousemove",k),se(window,"resize",E),se(o.value.container,"scroll",E)}),()=>!t.value||!s.value||d.value<=i.value||!f.value?null:m("div",{class:`${e.value}-sticky-scrollbar`,style:v.value},[m("div",{class:g.value,style:y.value,onMousedown:C},null)])}}),_n=F({setup(e,{slots:t}){const{mergedPrefixCls:n}=W(M);return()=>{var o;return m("tbody",{class:`${n.value}-tbody`},[(o=t.default)==null?void 0:o.call(t)])}}}),Ie=F({props:{columns:Array,isEmpty:Boolean},setup(e,{slots:t}){const{mergedPrefixCls:n,hasFixed:o,scrollHorizontalOverflowed:r,scrollBarColumn:l}=W(M),{mainTableWidth:s}=W(We),a=b(()=>{var u,i;return(i=(u=e.columns)==null?void 0:u.length)!=null?i:1});return()=>{let u=t.default();if(e.isEmpty?r.value:o.value){const i=l.value;u=m("div",{class:`${n.value}-fixed-row`,style:{width:X(s.value-(i?i.width:0)),position:"sticky",left:0,overflow:"hidden"}},[u])}return m("tr",null,[m("td",{colspan:a.value},[u])])}}}),Dn=F({props:Bn,setup(e){const t=P();return Ee(t,o=>{const{contentRect:{width:r}}=o;e.changeColumnWidth(e.cellKey,r)}),ue(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>m("td",{ref:t,style:{padding:0,border:0,height:0}},[m("div",{style:{height:0,overflow:"hidden"}},[_t("Â ")])])}}),Vn=F({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=W(M),{changeColumnWidth:n}=W(We);return()=>{var r;const o=(r=e.columns)==null?void 0:r.map(l=>{const{key:s}=l;return m(Dn,{key:s,cellKey:s,changeColumnWidth:n},null)});return m("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[o])}}}),jn=F({props:wn,setup(e){const{props:t,slots:n,config:o,mergedPrefixCls:r,mergedEmptyCell:l,activeOrderByMap:s,fixedColumnKeys:a,columnOffsets:u,isSticky:i,isTreeData:d,expandable:f,selectable:v,mergedPagination:g}=W(M),y=W(gt),p=y.props,C=b(()=>s[e.column.key]),k=Un(y,e),E=b(()=>a.value.lastStartKey===e.column.key),c=b(()=>a.value.firstEndKey===e.column.key),h=b(()=>{const{type:w,ellipsis:K}=e.column;return w||K!=null?K:t.ellipsis}),S=b(()=>{const{fixed:w,align:K}=e.column,x=r.value;let T={[`${x}-cell`]:!0,[`${x}-cell-sorted`]:!!C.value,[`${x}-cell-align-${K.cell}`]:!!K&&K.cell!="start",[`${x}-cell-ellipsis`]:!!h.value};return w&&(T={...T,[`${x}-fix-start`]:w==="start",[`${x}-fix-start-last`]:E.value,[`${x}-fix-end`]:w==="end",[`${x}-fix-end-first`]:c.value,[`${x}-fix-sticky`]:i.value}),le(T)}),B=b(()=>{const{fixed:w}=e.column;if(!w)return;const{starts:K,ends:x}=u.value,R=X((w==="start"?K:x)[e.column.key].offset);return{position:"sticky",left:w==="start"?R:void 0,right:w==="end"?R:void 0}});return()=>{var U,V,J;const{column:w}=e,{type:K}=w;let x,T;if(K==="selectable")x=Gn(y,n,v,o,g);else if(K==="indexable")x=bt(y,n,w,g);else{const te=k.value;if(x=qn(y,e,n,te),T=lt(h.value,x,te),!K&&(ce(x)||x==="")){const I=n.emptyCell||l.value;x=ie(I)?I({column:w,record:p.record,rowIndex:p.rowIndex}):I}}e.column.fixed&&h.value&&(E.value||c.value)&&(x=m("span",{class:`${r.value}-cell-content`},[x]));const R=(U=t.customAdditional)==null?void 0:U.bodyCell,O=R?R({column:w,record:p.record,rowIndex:p.rowIndex}):void 0,H=(J=(V=t.customTag)==null?void 0:V.bodyCell)!=null?J:"td",D=K==="expandable"?m("div",{class:`${r.value}-expandable-wrapper`},[Xn(y,n,f,d,r.value),!$t(x)&&m("span",{class:`${r.value}-expandable-trigger-gap`},null),x]):x;return m(H,de({class:S.value,style:B.value,title:T,colSpan:e.colSpan,rowSpan:e.rowSpan},O),{default:()=>[D]})}}});function Un(e,t){return b(()=>{const{props:{record:n}}=e,{column:o}=t,r=Re(o.dataKey);if(r.length<=0)return;let l=n;for(let s=0;s<r.length&&l;s++){const a=r[s];l=l[a]}return l})}function qn(e,t,n,o){const{props:{record:r,rowIndex:l}}=e,{column:s}=t,{customCell:a}=s,u=j(a)?n[a]:a;return u?u({value:o,record:r,rowIndex:l}):o}function Xn(e,t,n,o,r){var K;const{icon:l,customIcon:s,indent:a,showLine:u}=n.value,{props:{record:i,expanded:d,level:f=0,hasPrevSibling:v,hasNextSibling:g,showLineIndentIndexList:y},expandDisabled:p,handleExpend:C}=e,k=f>0,E=o.value&&u&&a;let c;const h=(K=j(s)?t[s]:s)!=null?K:l;ie(h)?c=h({expanded:!!d,record:i}):c=j(h)?m(ge,{name:h,rotate:d?90:0},null):h;const S=a?`width: ${X(a)}`:void 0,B={[`${r}-expandable-trigger`]:!0,[`${r}-expandable-trigger-show-line`]:E,[`${r}-expandable-trigger-disabled`]:p.value},w=[];if(a)for(let x=0;x<f;x++)w.push(m("div",{class:{[`${r}-expandable-indent`]:!0,[`${r}-expandable-indent-show-line`]:E&&y.includes(x)},style:S},null));return[...w,m("span",{class:B,style:S},[m("button",{class:`${r}-expandable-trigger-button`,type:"button",onClick:p.value?void 0:C},[c]),E&&[m("span",{class:`${r}-expandable-trigger-line-right`},null),(v||k)&&m("span",{class:`${r}-expandable-trigger-line-top`},null),g&&m("span",{class:`${r}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function Gn(e,t,n,o,r){const{props:{record:l,rowIndex:s},isSelected:a,isIndeterminate:u,selectDisabled:i,isHover:d,handleSelect:f}=e,{showIndex:v,multiple:g,customCell:y}=n.value,p=k=>{k.stopPropagation(),!g&&a.value&&!i.value&&f&&f()};if(!a.value&&!d&&v)return bt(e,t,o.columnIndexable,r);const C=j(y)?t[y]:y;if(g){const k={checked:a.value,disabled:i.value,indeterminate:u.value,onChange:f,onClick:p};return C?C({...k,record:l,rowIndex:s}):m(Pe,k,null)}else{const k={checked:a.value,disabled:i.value,onChange:f,onClick:p};return C?C({...k,record:l,rowIndex:s}):m(tt,k,null)}}function bt(e,t,n,o){const{props:{record:r,rowIndex:l},selectDisabled:s}=e,{customCell:a}=n,{pageIndex:u=1,pageSize:i=0}=o.value||{},d=j(a)?t[a]:a;if(!d)return;const f=s.value?"cursor: not-allowed":"cursor: pointer";return m("span",{style:f},[d({record:r,rowIndex:l,pageIndex:u,pageSize:i})])}function Yn(e,t,n){const o=[];return e.forEach((r,l)=>{const s=St(r,t,n,l);s&&o.push(s)}),o}function St(e,t,n,o){const{colSpan:r,rowSpan:l}=e,s=r==null?void 0:r(t,n),a=l==null?void 0:l(t,n);return s===0||a===0?void 0:m(jn,{colSpan:s===1?void 0:s,rowSpan:a===1?void 0:a,colIndex:o,column:e},null)}const Zn=F({props:Cn,setup(e,{slots:t}){const{props:n,mergedPrefixCls:o,expandable:r,handleExpandChange:l,checkExpandDisabled:s,selectable:a,selectedRowKeys:u,indeterminateRowKeys:i,handleSelectChange:d,currentPageRowKeys:f}=W(M),{expandDisabled:v,handleExpend:g,selectDisabled:y,handleSelect:p,isHover:C,attrs:k}=Jn(e,r,s,l,a,d,f),E=b(()=>u.value.includes(e.rowKey)),c=b(()=>i.value.includes(e.rowKey)),h=b(()=>{const S=`${o.value}-row`,{level:B,expanded:w}=e;return le({[`${S}`]:!0,[`${S}-level-${B}`]:!!B,[`${S}-selected`]:E.value,[`${S}-expanded`]:w})});return Oe(gt,{props:e,expandDisabled:v,handleExpend:g,isSelected:E,isIndeterminate:c,selectDisabled:y,handleSelect:p,isHover:C}),()=>{var K,x,T;const S=(K=n.customAdditional)==null?void 0:K.bodyRow,B=S?S({record:e.record,rowIndex:e.rowIndex}):void 0,w=(T=(x=n.customTag)==null?void 0:x.bodyRow)!=null?T:"tr";return m(w,de({class:h.value},k.value,B),{default:()=>{var R;return[(R=t.default)==null?void 0:R.call(t)]}})}}});function Jn(e,t,n,o,r,l,s){const a=b(()=>n(e.rowData)),u=b(()=>{var h;return(h=t.value)==null?void 0:h.trigger}),i=()=>{const{rowKey:h,record:S}=e;o(h,S)},d=b(()=>s.value.disabledRowKeys.includes(e.rowKey)),f=b(()=>{var h;return(h=r.value)==null?void 0:h.trigger}),v=b(()=>{var h;return(h=r.value)==null?void 0:h.showIndex}),g=P(!1),y=()=>{const{rowKey:h,record:S}=e;l(h,S)},p=()=>{u.value==="click"&&i(),f.value==="click"&&y()},C=()=>{u.value==="dblclick"&&i(),f.value==="dblclick"&&y()},k=()=>g.value=!0,E=()=>g.value=!1,c=b(()=>{const h=a.value,S=u.value,B=d.value,w=f.value,K=!h&&S==="click"||!B&&w==="click",x=!h&&S==="dblclick"||!B&&w==="dblclick",T=!B&&v.value;let R="";return K||x?R="pointer":(h&&S||B&&w)&&(R="not-allowed"),{style:R?`cursor: ${R}`:void 0,onClick:K?p:void 0,onDblclick:x?C:void 0,onMouseenter:T?k:void 0,onMouseleave:T?E:void 0}});return{expandDisabled:a,handleExpend:i,selectDisabled:d,handleSelect:y,isHover:g,attrs:c}}function je(e,t,n,o,r,l,s){const{children:a,expanded:u,level:i,hasPrevSibling:d,hasNextSibling:f,showLineIndentIndexList:v,record:g,rowKey:y}=e,p={key:y,expanded:u,level:i,hasPrevSibling:d,hasNextSibling:f,showLineIndentIndexList:v,hasChildren:!!(a!=null&&a.length),record:g,rowData:e,rowIndex:n,rowKey:y},C=m(Zn,p,{default:()=>[s]}),k=u&&Qn(p,o,t,r,l);return k?[C,k]:C}function Qn(e,t,n,o,r){const{customExpand:l}=o||{},{record:s,rowIndex:a}=e;let u;return ie(l)?u=l({record:s,rowIndex:a}):j(l)&&t[l]&&(u=t[l]({record:s,rowIndex:a})),u&&m(Ie,{class:`${r}-expanded-row`,columns:n},{default:()=>[u]})}const el=F({setup(){const{props:e,slots:t,expandable:n,mergedPrefixCls:o,mergedInsetShadow:r,mergedVirtual:l,mergedVirtualItemHeight:s,mergedVirtualColWidth:a,mergedAutoHeight:u,columnWidths:i,changeColumnWidth:d,flattedData:f,flattedColumns:v,fixedColumns:g,isSticky:y,mergedSticky:p,virtualScrollRef:C,scrollBodyRef:k,scrollContentRef:E,handleScroll:c,pingedStart:h,pingedEnd:S,scrollWidth:B,scrollHeight:w,scrollHorizontalOverflowed:K,scrollVerticalOverflowed:x,hasFixed:T,tableLayout:R}=W(M),O=P(),H=P(0),D=b(()=>u.value||!!B.value||y.value||l.value.horizontal);Oe(We,{mainTableWidth:H,changeColumnWidth:($,z)=>{Pt(O.value)&&d($,z)}});const V=()=>{const $=ee(k);$&&c({currentTarget:$})},J=$=>{const{offsetWidth:z}=$.target;z!==H.value&&(H.value=z)};pe(()=>{V(),_([()=>e.dataSource,B],([,z])=>{z&&V()}),_(i,Je(()=>{var A;((A=ee(k))==null?void 0:A.scrollLeft)===0&&V()},16)),It(O.value,J)}),ue(()=>Rt(O.value,J));const te=b(()=>{const $=o.value;return le({[`${$}-container`]:!0,[`${$}-ping-start`]:h.value,[`${$}-ping-end`]:S.value,[`${$}-fixed-layout`]:R.value==="fixed",[`${$}-fixed-column`]:T.value,[`${$}-inset-shadow`]:r.value,[`${$}-scroll-horizontal`]:K.value,[`${$}-scroll-vertical`]:x.value})}),I=b(()=>{var ne;const $=w.value,z=l.value.horizontal?"hidden":"auto",A=l.value.vertical?"hidden":"auto",L=(ne=e.scroll)==null?void 0:ne.fullHeight;return{overflowX:z,overflowY:A,[L?"height":"maxHeight"]:$}}),G=b(()=>({tableLayout:R.value,width:B.value,minWidth:B.value?"100%":void 0})),Y=($,z,A)=>{N(e.onScrolledChange,$,z,A.map(L=>L.record))},fe=b(()=>!l.value.vertical&&!l.value.horizontal?[]:f.value.map($=>({...$,data:v.value}))),oe=$=>{if(!(!D.value||!$))return m(Vn,{columns:$},null)},me=$=>{if(t.alert)return m(Ie,{class:`${o.value}-alert-row`,columns:$},{default:()=>[t.alert()]})},Be=$=>{if(!(f.value.length>0))return m(Ie,{class:`${o.value}-empty-row`,columns:$,isEmpty:!0},{default:()=>[m(Ot,{empty:e.empty},t)]})},be=($,z,A)=>{let L;if(A)L=A;else if(z!=null&&z.length){const ne=[];z.forEach((Se,xe)=>{const ke=Yn($!=null?$:[],Se,xe);ne.push(...Re(je(Se,$,xe,t,n.value,o.value,ke)))}),L=ne}return m(_n,null,{default:()=>[me($),oe($),Be($),L]})},Fe=()=>be(v.value,f.value),Ct=($,z)=>be($,void 0,z);return()=>{const $=o.value,z=u.value,A=l.value,L=t.default?t.default():[];if(z||w.value||y.value||A.horizontal){const{offsetTop:ne}=p.value;if(e.headless||L.push(m(An,{offsetTop:ne},null)),A.vertical&&(e.scroll||z)||!A.vertical&&A.horizontal){const Se=({item:q,index:Z,children:Q})=>je(q,q.data,Z,t,n.value,$,Q),xe=({row:q,item:Z,index:Q,rowIndex:ae})=>St(Z,q,ae,Q),ke=(q,{renderedData:Z})=>{var ae;const Q=f.value.length?(ae=Z[0])==null?void 0:ae.data:v.value;return m("table",{ref:E,class:`${$}-table`,style:G.value},[Q?m(ye,{columns:Q},null):void 0,Ct(Q,q),!1])},wt=(q,Z)=>{const{fixedStartColumns:Q,fixedEndColumns:ae}=g.value;return ot(q,Z,v.value,f.value,Q,ae,!1)},{scroll:re,onScrolledBottom:Bt}=e;L.push(m(Ye,{ref:C,class:`${$}-body-virtual-scroll`,dataSource:fe.value,colModifier:wt,fullHeight:re==null?void 0:re.fullHeight,getKey:q=>{var Z;return(Z=q.rowKey)!=null?Z:q.key},height:u.value?"100%":re==null?void 0:re.height,width:"100%",rowHeight:s.value,colWidth:a.value,rowRender:Se,colRender:xe,contentRender:ke,virtual:l.value,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:c,onScrolledBottom:Bt,onScrolledChange:Y},null))}else L.push(m("div",{ref:k,class:`${$}-content`,style:I.value,onScroll:c},[m("table",{ref:E,class:`${$}-table`,style:G.value},[m(ye,null,null),Fe(),!1])]));y.value&&L.push(m(Nn,null,null))}else L.push(m("div",{ref:k,class:`${$}-content`,style:I.value,onScroll:c},[m("table",{ref:E,class:`${$}-table`,style:G.value},[m(ye,null,null),!e.headless&&m($e,null,null),Fe(),!1])]));return m("div",{ref:O,class:te.value},[L])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tl(e,t){return e.footer?m("div",{class:`${t}-footer`},[e.footer()]):null}function nl(e,t,n,o){var s,a;let r=null,l=null;if(t!==null){const{position:u}=t,[i,d]=Dt(u).split("-"),f=`${o}-pagination ${o}-pagination-${d}`,v=(a=(s=e.pagination)==null?void 0:s.call(e,{total:n.length,...t}))!=null?a:m(jt,de({class:f,total:n.length},t),null);r=i==="top"?v:null,l=i==="bottom"?v:null}return[r,l]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function xt(e,t){const{getGreyColors:n}=t,o=n(),{fontSizeSm:r,heightMd:l,paddingSizeSm:s,paddingSizeMd:a,paddingSizeLg:u,colorTextTitleSecondary:i,colorEmphasizedContainerBg:d,colorBorder:f,colorIconInfo:v,colorPrimary:g,colorContainerBg:y,colorContainerBgHover:p,colorInfoContainerBg:C}=e;return{fontSizeSm:r,fontSizeMd:r,fontSizeLg:r,headRowHeightSm:l,headRowHeightMd:l,headRowHeightLg:l,cellPaddingHorizontalSm:s,cellPaddingHorizontalMd:a,cellPaddingHorizontalLg:u,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:i,headBgColor:d,headSeparatorColor:f,headIconColor:v,headIconColorActive:g,headIconBgColorHover:n().l30,insetShadowStart:`inset 10px 0 8px -8px ${Le(o.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${Le(o.d50,.12)}`,bodyRowBgColorHover:p,bodyRowBgColorSelected:y,bodyRowBgColorExpanded:C,bodyRowBgColorTreeExpanded:C,bodyCellVerticalAlign:"middle",expandableIconColor:v}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ll(e,t){const{getGreyColors:n}=t,o=n();return{...xt(e,t),insetShadowStart:`inset 10px 0 8px -8px ${o.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${o.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ol=(e,t,n)=>t==="default"?xt(e,n):ll(e,n),rl={sm:32,md:40,lg:56},al=150,sl=F({name:"IxTable",props:bn,setup(e,{expose:t,slots:n}){const o=Ce("common"),{globalHashId:r,hashId:l,registerToken:s}=Ht("table");s(ol);const a=b(()=>`${o.prefixCls}-table`),u=Ce("locale"),i=Ce("table"),d=b(()=>{var I;return(I=e.autoHeight)!=null?I:i.autoHeight}),f=b(()=>{var I;return(I=e.childrenKey)!=null?I:i.childrenKey}),v=zt(e,i),g=b(()=>{var I;return(I=e.emptyCell)!=null?I:i.emptyCell}),y=b(()=>{var I;return(I=e.insetShadow)!=null?I:i.insetShadow}),p=b(()=>{var I;return(I=e.size)!=null?I:i.size}),C=b(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),k=b(()=>{var I;return(I=e.virtualItemHeight)!=null?I:rl[p.value]}),E=b(()=>{var I;return(I=e.virtualColWidth)!=null?I:al}),{mergedPagination:c}=ln(e,i,p),h=pn(e),S=on(e,h),B=qt(e,n,i,S.scrollBarSizeOnFixedHolder),w=gn(B.flattedColumns),K=nn(B.flattedColumns),x=tn(e,B.flattedColumns),T=mn(e,B,S,h.isSticky,C,d),{activeSorters:R}=w,{activeFilters:O}=K,H=en(e,f,v,R,O,x.expandedRowKeys,c),D=dn(e,u,B.flattedColumns,H);sn(e,i,c,R,O,S.scrollTo);const U={props:e,slots:n,config:i,locale:u,mergedPrefixCls:a,mergedEmptyCell:g,mergedInsetShadow:y,mergedVirtual:C,mergedVirtualItemHeight:k,mergedVirtualColWidth:E,mergedAutoHeight:d,...B,...S,...w,...K,...h,tableLayout:T,mergedPagination:c,...x,...H,...D};Oe(M,U),t({scrollTo:S.scrollTo});const{flattedData:V,filteredData:J}=H,te=b(()=>{const I=a.value,{borderless:G=i.borderless,scroll:Y}=e;return le({[r.value]:!!r.value,[l.value]:!!l.value,[I]:!0,[`${I}-auto-height`]:d.value,[`${I}-borderless`]:G,[`${I}-empty`]:V.value.length===0,[`${I}-full-height`]:Y==null?void 0:Y.fullHeight,[`${I}-${p.value}`]:!0})});return()=>{const I=a.value,G=m(Wt,{header:e.header},n),Y=tl(n,I),fe=[G];let oe=[m(el,null,null),Y].filter(Boolean);if(V.value.length>0){const[Be,be]=nl(n,c.value,J.value,I);oe=[Be,...oe,be].filter(Boolean)}const me=cl(e.spin);return me?fe.push(m(Ft,me,{default:()=>[oe]})):fe.push(...oe),m("div",{class:te.value},[fe])}}});function cl(e){return Vt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const vl=sl,hl=He;export{vl as I,hl as a,Ut as g,bn as t};
