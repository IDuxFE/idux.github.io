import{A as V,ao as ue,a9 as de,j as he,c as fe,aP as me,m as U,k as ge,ak as oe,O as _,M as Ce,aq as be,I as ye}from"./index-cd46e9ff.js";import{t as ve,g as pe,I as xe}from"./index-5a6bfa28.js";import{u as X}from"./globalConfig-13f7842d.js";import{I as ke}from"./index-a2ca5cf7.js";import{I as Te,f as se,m as J}from"./index-d67f9d78.js";import{l as L,y as ee,q as c,c as S,p as Y,w as N,f as M,r as Z,z as ze,D as Pe,a8 as Se,b as we}from"./vendor-7ed7823e.js";import{u as Ie,a as Ve}from"./index-caa22b2c.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const O=Symbol("proTableToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Fe(e,t){const{title:l,type:n}=e;return l||(n?t.layout[n]:"")}const Q=L({props:{columns:{type:Array,required:!0},checkedKeys:{type:Array,required:!0},searchValue:{type:String,default:void 0},title:{type:String,default:void 0},onDrop:{type:Function,required:!0},onFixedChange:{type:Function,required:!0},onVisibleChange:{type:Function,required:!0}},setup(e){const{locale:t,mergedPrefixCls:l}=ee(O),n=r=>{const u=new Set(r),s=new Set(e.checkedKeys);r.forEach(d=>{s.has(d)&&(u.delete(d),s.delete(d))}),e.onVisibleChange(u,s)},i=r=>{const{dragNode:u,dropNode:s}=r,d=u==null?void 0:u.key,o=s==null?void 0:s.key;!d||!o||e.onDrop(r)},a=(r,u,s)=>{s.preventDefault(),s.stopImmediatePropagation(),e.onFixedChange(u,r)};return()=>{if(e.columns.length===0)return;const r=`${l.value}-layout-tool-tree`,{columns:u,searchValue:s,title:d}=e,{startPin:o,endPin:y,noPin:v}=t.table.layout,b={blocked:!0,cascaderStrategy:"child",checkable:!0,checkedKeys:e.checkedKeys,checkOnClick:!0,draggable:!0,dataSource:u,disabled:Re,empty:"",childrenKey:"children",getKey:"key",labelKey:"title",searchValue:s,searchFn:()=>!0,onCheckedChange:n,onDrop:i},k={label:({node:f})=>Fe(f,t.table),suffix:({node:f})=>{if(f.changeFixed===!1||f.parentKey!=null)return null;const{fixed:z}=f;return z==="start"?[c(V,{name:"vertical-align-center",title:v,onClick:m=>a(void 0,f,m)},null),c(V,{name:"vertical-align-top",rotate:180,title:y,onClick:m=>a("end",f,m)},null)]:z==="end"?[c(V,{name:"vertical-align-top",title:o,onClick:m=>a("start",f,m)},null),c(V,{name:"vertical-align-center",title:v,onClick:m=>a(void 0,f,m)},null)]:[c(V,{name:"vertical-align-top",title:o,onClick:m=>a("start",f,m)},null),c(V,{name:"vertical-align-top",rotate:180,title:y,onClick:m=>a("end",f,m)},null)]}};return c("div",{class:r},[d&&c("div",{class:`${r}-title`},[d]),c(Te,b,k)])}}});function Re(e){const{changeIndex:t,changeVisible:l}=e;return t!==!1&&l!==!1?!1:{check:l===!1,select:l===!1,drag:t===!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const $e={...ve,columns:{type:Array,default:()=>[]},layoutTool:{type:[Boolean,Object],default:!0},toolbar:{type:Array,default:void 0},onColumnsChange:[Function,Array]},Ae={changeSize:{type:Boolean,default:void 0},className:{type:String,default:void 0},placeholder:{type:String,default:void 0},resetable:{type:Boolean,default:void 0},searchable:{type:Boolean,default:void 0},searchValue:{type:String,default:void 0},visible:{type:Boolean,default:void 0},"onUpdate:searchValue":[Function,Array],"onUpdate:visible":[Function,Array],onReset:[Function,Array]},Le={placeholder:{type:String,default:void 0},resetable:{type:Boolean,required:!0},searchable:{type:Boolean,required:!0},searchValue:{type:String,default:void 0},"onUpdate:searchValue":[Function,Array],onReset:[Function,Array]};var D=function(e){return e[e.start=0]="start",e[e.center=1]="center",e[e.end=2]="end",e}(D||{});const Ee=L({props:Le,setup(e){const{locale:t,mergedPrefixCls:l,mergedColumns:n,checkedColumnKeys:i,setMergedColumns:a,mergedColumnMap:r,resetColumns:u}=ee(O),s=S(()=>n.value.length!==r.value.size),d=S(()=>n.value.filter(g=>g.visible===!1)),[o,y]=ue(e,"searchValue"),v=S(()=>{var x;const g=(x=o.value)==null?void 0:x.toLowerCase();return se(n.value,"children",C=>{if(C.layoutable===!1)return!1;if(!g)return!0;const{title:p}=C;return p?p.toLowerCase().includes(g):!1})}),b=S(()=>le(v.value)),k=g=>{const x=g.target.value;y(x)},f=g=>{U(e.onReset,g)!==!1&&u()},z=g=>{const x=J(n.value,"children",(C,p)=>{var I;const T={...C};return!((I=C.children)!=null&&I.length)&&C.changeVisible!==!1&&C.layoutable!==!1&&p.every(P=>P.layoutable!==!1)&&(T.visible=g),T});a(x)},m=(g,x)=>{const C=J(n.value,"children",(p,T)=>{const I={...p};return(p.key===g.key||T.some(P=>P.key===g.key))&&(I.fixed=x),I});a(C)},h=(g,x)=>{const C=J(n.value,"children",p=>{const T={...p};return g.has(p.key)&&(T.visible=!0),x.has(p.key)&&(T.visible=!1),T});a(C)},w=(g,x)=>{const{dragNode:C,dropNode:p,dropType:T}=x,I=C==null?void 0:C.key,P=p==null?void 0:p.key;if(!I||!P)return;const{startColumns:$,centerColumns:F,endColumns:R}=le(n.value),j=[$,F,R].reduce((E,K,G)=>G===g?E.concat(Ke(K,I,P,T)):E.concat(K),[]);a(j)};return()=>{var ne;const{startColumns:g,centerColumns:x,endColumns:C}=b.value,p=g.length>0,T=C.length>0,I=p||T,P=`${l.value}-layout-tool`,$=Y({[`${P}-content`]:!0,[`${P}-with-fixed`]:I,[`${P}-with-children`]:s.value}),{placeholder:F,all:R,reset:j,startPinTitle:E,noPinTitle:K,endPinTitle:G}=t.table.layout,te=n.value.length,H=d.value.length,ie=H===0&&te!==0,ce=H>0&&H!==te,W=o.value;return c("div",{class:$},[e.searchable&&c("div",{class:`${P}-search-wrapper`},[c(de,{placeholder:(ne=e.placeholder)!=null?ne:F,size:"sm",suffix:"search",value:W,onInput:k},null)]),c("div",{class:`${P}-select-wrapper`},[c(he,{checked:ie,indeterminate:ce,label:R,onChange:z},null),e.resetable&&c(fe,{size:"sm",mode:"link",onClick:f},{default:()=>[j]})]),v.value.length?c("div",{class:`${P}-tree-wrapper`},[p&&c(Q,{key:"start",columns:g,checkedKeys:i.value.start,searchValue:W,title:E,onDrop:A=>w(D.start,A),onFixedChange:m,onVisibleChange:h},null),(!I||x.length>0)&&c(Q,{key:"center",columns:x,checkedKeys:i.value.center,searchValue:W,title:I?K:void 0,onDrop:A=>w(D.center,A),onFixedChange:m,onVisibleChange:h},null),T&&c(Q,{key:"end",columns:C,checkedKeys:i.value.end,searchValue:W,title:G,onDrop:A=>w(D.end,A),onFixedChange:m,onVisibleChange:h},null)]):c(me,{simple:!0},null)])}}});function le(e){const t=[],l=[],n=[];return e.forEach(i=>{const{fixed:a}=i;a==="start"?t.push(i):a==="end"?l.push(i):n.push(i)}),{startColumns:t,endColumns:l,centerColumns:n}}function Ke(e,t,l,n){const i=[...e];let a;if(q(i,t,(r,u,s)=>{a=r,s.splice(u,1)}),n==="inside")q(i,l,r=>{r.children.unshift(a)});else{let r,u=[];q(i,l,(s,d,o)=>{r=d,u=o}),n==="before"?u.splice(r,0,a):u.splice(r+1,0,a)}return i}function q(e,t,l){for(let n=0;n<e.length;n++){const i=e[n];if(i.key===t)return l(i,n,e);"children"in i&&i.children&&q(i.children,t,l)}}const We=[0,4],Me={sm:"grid-compact",md:"grid-medium",lg:"grid-loose"},re=L({name:"IxProTableLayoutTool",props:Ae,setup(e,{slots:t}){const{config:l,locale:n,mergedPrefixCls:i,mergedSize:a,setMergedSize:r}=ee(O),u=S(()=>{var o;return(o=e.changeSize)!=null?o:l.layoutTool.changeSize}),s=S(()=>{var o;return(o=e.resetable)!=null?o:l.layoutTool.resetable}),d=S(()=>{var o;return(o=e.searchable)!=null?o:l.layoutTool.searchable});return()=>{var z;const o=`${i.value}-layout-tool`,y=n.table.layout,v=m=>{const h=Me[m],w=y[m];return c(V,{key:h,class:Y([`${o}-header-icon`,a.value===m?`${o}-header-icon-active`:""]),name:h,title:w,onClick:()=>r(m)},null)},b=u.value?c(ge,null,{default:()=>[v("sm"),v("md"),v("lg")]}):void 0,k={placeholder:e.placeholder,resetable:s.value,searchable:d.value,searchValue:e.searchValue,"onUpdate:searchValue":e["onUpdate:searchValue"],onReset:e.onReset},f={class:Y([o,e.className]),header:{title:y.title,suffix:b},offset:We,placement:"bottomEnd",showArrow:!1,trigger:"click",visible:e.visible,"onUpdate:visible":e["onUpdate:visible"]};return c(ke,f,{default:(z=t.default)!=null?z:()=>c("span",{class:`${o}-trigger`},[c(V,{name:"ellipsis"},null)]),content:()=>c(Ee,k,null)})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function De(e,t){const l=S(()=>e.columns),[n,i]=oe(B(l.value,t)),a=S(()=>{const o=new Map,y={start:[],center:[],end:[]},v=se(n.value,"children",(b,k)=>{var z;const f=b.key;return o.set(f,b),b.visible===!1||k.some(m=>m.visible===!1)?!1:(!((z=b.children)!=null&&z.length)&&b.layoutable!==!1&&k.every(m=>m.layoutable!==!1)&&(ae("start",b,k)?y.start.push(f):ae("end",b,k)?y.end.push(f):y.center.push(f)),!0)},"and");return{map:o,checkedKeys:y,displayColumns:v}}),r=S(()=>a.value.map),u=S(()=>a.value.checkedKeys),s=S(()=>a.value.displayColumns);return N(l,o=>i(B(o,t))),N(n,o=>U(e.onColumnsChange,o)),{checkedColumnKeys:u,mergedColumns:n,setMergedColumns:i,mergedColumnMap:r,displayColumns:s,resetColumns:()=>i(B(l.value,t))}}function B(e,t,l){return e.map(n=>qe(n,t,l))}function qe(e,t,l){var r;const n=pe(e),a={...e.type==="indexable"?t.columnIndexable:void 0,...e,key:n,parentKey:l};return(r=e.children)!=null&&r.length&&(a.children=B(e.children,t,n)),a}function ae(e,t,l){return t.fixed===e||l.some(n=>n.fixed===e)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Be({mergedColumns:e,setMergedColumns:t,mergedColumnMap:l}){return{hasResizable:S(()=>e.value.some(a=>a.resizable)),onResizeEnd:(a,r,u)=>{const s=l.value.get(a);if(!s)return;const d=s.width,o=M(d)?_(d.replace("px","")):d;if(!o)s.width=r;else{const y=r-u,v=Math.floor(o*r/y*1e3)/1e3,{minWidth:b,maxWidth:k}=s,f=M(b)?_(b.replace("px","")):b,z=M(k)?_(k.replace("px",""),Number.MAX_SAFE_INTEGER):k;f&&v<f?s.width=f:z&&v>z?s.width=z:s.width=v}t([...e.value])}}}const Ue=L({props:["column","onClick","onResizeEnd"],setup(e,{slots:t}){const l=Z(),n=d=>{U(e.onResizeEnd,e.column.key,d.width,d.offsetWidth)},i=ze({maxWidth:e.column.maxWidth,minWidth:e.column.minWidth,onResizeEnd:n}),{resizing:a,position:r}=Ie(l,i),u=Z(!a.value);N(a,d=>{d?u.value=!1:setTimeout(()=>u.value=!0)});const s=d=>{u.value&&U(e.onClick,d)};return()=>{var o,y;if(!e.column.resizable)return c("th",{onClick:s},[(o=t.default)==null?void 0:o.call(t)]);const d=[c(Ve,{placement:"end"},null)];if(a.value){const{width:v,height:b}=r.value;d.push(c("div",{class:"cdk-resizable-preview",style:`width:${v}px;height:${b}px`},null))}return c("th",{ref:l,onClick:s},[(y=t.default)==null?void 0:y.call(t),d])}}}),Ne=L({name:"IxProTable",props:$e,setup(e,{slots:t,expose:l}){const n=X("common"),i=X("table"),a=Ce("table"),r=X("locale"),u=S(()=>`${n.prefixCls}-table`),s=De(e,i),{hasResizable:d,onResizeEnd:o}=Be(s),y=S(()=>{var h;return(h=e.size)!=null?h:a.size}),[v,b]=oe(y.value);N(y,b),Pe(O,{props:e,config:i,locale:r,mergedPrefixCls:u,mergedSize:v,setMergedSize:b,...s});const k=Z();l({scrollTo:h=>{var w;return(w=k.value)==null?void 0:w.scrollTo(h)}});const f=()=>{const{layoutTool:h}=e;if(!h)return null;const w=we(h)?h:void 0;return c(re,w,null)},z=()=>{const{toolbar:h}=e;if(h)return h.length<=1?h:c(ye,{align:"center",gap:8},{default:()=>[h]})},m=()=>{var g;if(t.header)return t.header();const{header:h,toolbar:w}=e;if(h||w||t.toolbar){const x={suffix:(g=t.toolbar)!=null?g:z},C=M(h)?{title:h}:h;return c(be,C,x)}};return()=>{const{customAdditional:h,customTag:w,layoutTool:g,toolbar:x,tableLayout:C,...p}=e,T=d.value,I=C||(T?"fixed":void 0),P={...h,headCell:({column:F})=>{const R=h!=null&&h.headCell?h.headCell({column:F}):void 0;return T?{...R,column:F,onResizeEnd:o}:R}},$={headCell:T?Ue:void 0,...w};return c(xe,Se({ref:k},p,{class:u.value,columns:s.displayColumns.value,customAdditional:P,customTag:$,size:v.value,tableLayout:I}),{...t,header:m,default:f})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Qe=Ne,Ye=re;export{Qe as I,Ye as a};
