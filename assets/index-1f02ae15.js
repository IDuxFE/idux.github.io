import{P as Y,K as z,aq as fe,r as Je,ab as Xe,af as Ze,ag as et,m as _,ac as tt,A as ce,M as Q,N as X,ai as at,aH as nt,aI as Ve,ae as ie,a9 as Fe,ay as Ae,az as $e}from"./index-a1eb659d.js";import{u as re,g as Oe,ɵ as Re,a as Be}from"./index-b9d1cc86.js";import{w as L,c as I,m as ue,_ as ne,t as lt,l as q,x as te,p as be,n as f,ab as K,B as Ie,R as de,S as ve,r as ee,aa as Me}from"./vendor-4aa48d2c.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ae(e,t,a){if(t)return e.convert(t,a)}function le(e,t,a,n){return Y(n).reduce((l,u)=>e.set(l,e.get(t,u),u),a)}function Te(e,t,a,n){return Y(n).every(l=>e.get(t,l)===e.get(a,l))}function ye(e,t,a,n="time"){return t?a?n==="time"?t.valueOf()-a.valueOf():e.startOf(t,n).valueOf()-e.startOf(a,n).valueOf():0:1}function oe(e,t,a="time"){return t.sort((n,o)=>ye(e,n,o,a))}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function he(e,t,a,n,o){const{formatRef:l,dateFormatRef:u,timeFormatRef:s}=t,[r,d]=z(""),[c,m]=z(""),[v,i]=z(""),[b,D]=z(void 0),[y,P]=z("datePanel"),[O,B]=z(!1),[p,V]=z(!1);function h(w,x=!1){if(!w){d("");return}const{parse:$,format:M}=e;(x||$(r.value,l.value).valueOf()!==w.valueOf())&&d(M(w,l.value))}function C(w,x=!1){if(!w){m("");return}const{parse:$,format:M}=e,E=$(c.value,u.value);(x||!Te(e,E,w,["year","month","date"]))&&m(M(w,u.value))}function A(w,x=!1){if(!w){i("");return}const{parse:$,format:M}=e,E=$(v.value,s.value);(x||!Te(e,E,w,["hour","minute","second"]))&&i(M(w,s.value))}function F(w=!1){const x=ae(e,n.value,l.value);h(x,w),a.value.enableOverlayDateInput&&C(x,w),a.value.enableOverlayTimeInput&&A(x,w),D(x)}L([n,l],()=>F(),{immediate:!0}),L(a,()=>F());function T(w,x){return w?e.parse(w,x):void 0}function g(w){return!w||e.isValid(w)}function S(w){const x=w.target.value;d(x);const $=T(x,l.value);g($)&&o($)}function k(w){const x=w.target.value;m(x);let $=T(x,u.value);if(!g($))return;const M=ae(e,n.value,l.value);$&&M&&($=le(e,M,$,["hour","minute","second"])),o($),P("datePanel")}function R(w){const x=w.target.value;i(x);let $=T(x,s.value);if(!g($))return;const M=ae(e,n.value,l.value);$&&M&&($=le(e,M,$,["year","month","date"])),o($),P("timePanel")}function H(){m("")}function U(){i("")}function N(w){o(w)}function G(){P("datePanel"),B(!0)}function W(){P("timePanel"),V(!0)}function j(){B(!1)}function J(){V(!1)}return{inputValue:r,dateInputValue:c,timeInputValue:v,dateInputFocused:O,timeInputFocused:p,panelValue:b,visiblePanel:y,setVisiblePanel:P,init:F,handleInput:S,handleDateInput:k,handleTimeInput:R,handleDateInputClear:H,handleTimeInputClear:U,handlePanelChange:N,handleDateInputFocus:G,handleTimeInputFocus:W,handleDateInputBlur:j,handleTimeInputBlur:J}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const De={date:"yyyy-MM-dd",week:"RRRR-II",month:"yyyy-MM",quarter:"yyyy-'Q'Q",year:"yyyy",datetime:"yyyy-MM-dd HH:mm:ss"};function He(e,t){const a=I(()=>{var m,v,i;const c=e.type;return(i=(v=e.format)!=null?v:(m=t.format)==null?void 0:m[c])!=null?i:De[c]}),{hourEnabled:n,hourUse12Hours:o,minuteEnabled:l,secondEnabled:u,use12Hours:s}=ot(e,a),r=I(()=>{var c;return e.type!=="datetime"?a.value:(c=e.dateFormat)!=null?c:De.date}),d=I(()=>{if(e.timeFormat)return e.timeFormat;const m=[n.value&&(o.value?"hh":"HH"),l.value&&"mm",u.value&&"ss"].filter(Boolean).join(":");return s.value?`${m} a`:m});return{formatRef:a,dateFormatRef:r,timeFormatRef:d,hourEnabled:n,minuteEnabled:l,secondEnabled:u,use12Hours:s}}function ot(e,t){const a=I(()=>{var n;return(n=e.timeFormat)!=null?n:t.value});return{hourEnabled:I(()=>/[hH]/.test(a.value)),hourUse12Hours:I(()=>/h/.test(a.value)),minuteEnabled:I(()=>/m/.test(a.value)),secondEnabled:I(()=>/s/.test(a.value)),use12Hours:I(()=>/[aA]/.test(a.value))}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ee(e,t){return I(()=>{var n;const a=(n=e.allowInput)!=null?n:t.allowInput;return{allowInput:a,enableInput:a===!0,enableOverlayDateInput:a==="overlay"||e.type==="datetime",enableOverlayTimeInput:e.type==="datetime"}})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rt(e,t){return a=>{if(a.code==="Escape"){t(!1);return}if(!e.value&&!["Backspace","Tab"].includes(a.code)){a.preventDefault(),t(!0);return}a.code==="Enter"&&t(!1)}}function ut(e,t,a,n){const{bufferUpdated:o,buffer:l}=e;return u=>{if(u.code==="Escape"){a(!1);return}if(!t.value&&!["Backspace","Tab"].includes(u.code)){u.preventDefault(),a(!0);return}u.code==="Enter"&&(o.value&&n(l.value),a(!1))}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const st=[0,4];function ze(e){const{props:t,common:a,config:n,accessor:o,mergedPrefixCls:l,overlayOpened:u,setOverlayOpened:s,onAfterLeave:r}=e;return I(()=>{var d;return{clickOutside:!1,container:(d=t.overlayContainer)!=null?d:n.overlayContainer,containerFallback:`.${l.value}-overlay-container`,disabled:o.disabled||t.readonly,offset:st,placement:"bottomStart",transitionName:`${a.prefixCls}-slide-auto`,trigger:"manual",visible:u.value,"onUpdate:visible":s,onAfterLeave:r}})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ue(e){const[t,a]=fe(e,"open",!1),[n,o]=z(!1);L(t,u=>{u&&o(!0)},{immediate:!0});const l=()=>{t.value||o(!1)};return ue(()=>{e.autofocus&&a(!0)}),{overlayOpened:t,overlayVisible:n,setOverlayOpened:a,onAfterLeave:l}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ne(e,t,a,n,o){const{accessor:l,control:u}=Je();Xe(u);const s=Ze(e,t),r=et(e,u);function d(i){const b=ne(i)?oe(a,i):i;if(Y(b).some(y=>{var P;return(P=e.disabledDate)==null?void 0:P.call(e,y)}))return;let D=lt(l.value);D=ne(D)?D.map(y=>ae(a,y,n.value)):ae(a,D,n.value),l.setValue(b),_(e.onChange,b,D)}function c(i){_(e.onClear,i),d(void 0)}function m(i){_(e.onFocus,i)}function v(i){l.markAsBlurred(),o(!1),_(e.onBlur,i)}return{accessor:l,mergedSize:s,mergedStatus:r,handleChange:d,handleClear:c,handleFocus:m,handleBlur:v}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _e(e){return I(()=>{var o,l;const{props:t,config:a,accessor:n}=e;return{borderless:!1,clearable:(o=t.clearable)!=null?o:a.clearable,clearIcon:(l=t.clearIcon)!=null?l:a.clearIcon,disabled:n.disabled,size:"sm"}})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ct(e,t,a,n,o){return I(()=>{var l;return{...ge((l=e.timePanelOptions)!=null?l:{}),hourEnabled:t.value,minuteEnabled:a.value,secondEnabled:n.value,use12Hours:o.value}})}function it(e,t,a,n,o){const l=s=>{var r;return(r=ne(e.timePanelOptions)?e.timePanelOptions[s?0:1]:e.timePanelOptions)!=null?r:{}};return I(()=>{const s={hourEnabled:t.value,minuteEnabled:a.value,secondEnabled:n.value,use12Hours:o.value};return[{...ge(l(!0)),...s},{...ge(l(!1)),...s}]})}function ge(e){const{disabledHours:t,disabledMinutes:a,disabledSeconds:n,hideDisabledOptions:o,hourStep:l,minuteStep:u,secondStep:s}=e;return{disabledHours:t,disabledMinutes:a,disabledSeconds:n,hideDisabledOptions:o,hourStep:l,minuteStep:u,secondStep:s}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dt(e,t,a){const[n,o]=fe(e,"activeDate",()=>t.now()),l=I(()=>{const u=n.value,s=a.value,{startOf:r,set:d,get:c}=t;switch(s){case"date":case"week":return r(r(u,"month"),"week");case"month":return r(r(u,"year"),"month");case"quarter":return r(r(u,"year"),"quarter");case"year":return d(u,parseInt(`${c(u,"year")/10}`,10)*10-1,"year");default:return u}});return{activeDate:n,setActiveDate:o,startActiveDate:l}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function vt(e){const[t,a]=z(e.type);return L(()=>e.type,a),L(()=>e.visible,n=>n&&a(e.type)),{activeType:t,setActiveType:a}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ft(e){const t=I(()=>{switch(e.value){case"date":case"week":return 6;case"month":return 4;case"quarter":return 1;case"year":return 4;default:return 0}}),a=I(()=>{switch(e.value){case"date":case"week":return 7;case"month":return 3;case"quarter":return 4;case"year":return 3;default:return 0}});return{maxRowIndex:t,maxCellIndex:a}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const se=Symbol("datePanelToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const pt={cellTooltip:Function,disabledDate:Function,type:{type:String,default:"date"},value:[Date,Array],activeDate:Date,visible:{type:Boolean,default:void 0},isSelecting:{type:Boolean,default:void 0},onCellClick:[Function,Array],onCellMouseenter:[Function,Array],"onUpdate:activeDate":[Function,Array]},mt={rowIndex:{type:Number,required:!0}},yt={rowIndex:{type:Number,required:!0},cellIndex:{type:Number,required:!0}};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Z(e){return e==="week"?"date":e}function ht(e,t,a,n){const o=Z(t);if(o==="date")return n(e);const l={date:void 0,month:"date",quarter:"month",year:"quarter"},u=[],s=(r,d)=>{const c=l[d];if(!c)return;const[m,v]=["startOf","endOf"].map(i=>a.get(a[i](r,d),c));for(let i=m;i<=v;i++)u.push({date:a.set(r,i,c),type:c})};for(s(e,o);u.length;){const r=u.pop();if(!n(r.date))return!1;s(r.date,r.type)}return!0}const gt={date:"d",week:"d",month:"MMM",quarter:"'Q'Q",year:"yyyy"},bt=q({props:yt,setup(e){const{props:t,slots:a,mergedPrefixCls:n,dateConfig:o,activeDate:l,setActiveDate:u,startActiveDate:s,activeType:r,setActiveType:d,maxRowIndex:c,maxCellIndex:m}=te(se),v=I(()=>e.rowIndex*m.value+e.cellIndex),i=I(()=>o.add(s.value,v.value,Z(r.value))),b=I(()=>xe(o,t.value,r.value,!0)),D=I(()=>xe(o,t.value,r.value,!1)),y=I(()=>{const g=t.disabledDate;return g?ht(i.value,r.value,o,g):!1}),P=I(()=>{var g;return(g=t.cellTooltip)==null?void 0:g.call(t,{value:i.value,disabled:!!y.value})}),O=I(()=>b.value&&o.isSame(b.value,i.value,Z(r.value))),B=I(()=>D.value&&o.isSame(D.value,i.value,Z(r.value))),p=I(()=>o.isSame(i.value,o.now(),Z(r.value))),V=I(()=>{const g=r.value;if(Z(r.value)==="date")return!o.isSame(i.value,l.value,"month");if(g==="year"){const S=v.value;return S===0||S===c.value*m.value}return!1}),h=I(()=>{if(V.value)return!1;const g=Z(r.value);return t.isSelecting?b.value&&o.isSame(b.value,i.value,g):b.value&&o.isSame(b.value,i.value,g)||D.value&&o.isSame(D.value,i.value,g)}),C=I(()=>{const g=Z(r.value),S=o.startOf(i.value,g).valueOf();return!!b.value&&!!D.value&&S>=o.startOf(b.value,g).valueOf()&&S<=o.startOf(D.value,g).valueOf()}),A=I(()=>{const g=`${n.value}-cell`;return be({[g]:!0,[`${g}-disabled`]:y.value,[`${g}-selected`]:h.value,[`${g}-in-range`]:C.value,[`${g}-current`]:p.value,[`${g}-out-view`]:V.value,[`${g}-start`]:O.value,[`${g}-end`]:B.value})}),F=g=>{g.stopPropagation();const S=i.value;t.type!==r.value?(d(t.type),u(S)):_(t.onCellClick,S)},T=()=>{_(t.onCellMouseenter,i.value)};return()=>{var R,H;const g=i.value,{format:S}=o,k=(H=(R=a.cell)==null?void 0:R.call(a,{date:g}))!=null?H:f("div",{class:`${n.value}-cell-inner`},[f("div",{class:`${n.value}-cell-trigger`},[S(g,gt[r.value])])]);return f("td",{class:A.value,role:"gridcell",onClick:y.value?void 0:F,onMouseenter:y.value?void 0:T},[P.value?f(tt,{title:P.value},{default:()=>[k]}):k])}}});function xe(e,t,a,n){var l;const o=Y(t);return a==="week"?n?e.startOf(o[0],"week"):e.endOf((l=o[1])!=null?l:o[0],"week"):o[n?0:1]}const It=q({props:mt,setup(e){const{mergedPrefixCls:t,activeType:a,maxCellIndex:n}=te(se),o=I(()=>{const{rowIndex:l}=e,u=a.value,s=[],r=n.value;for(let d=0;d<r;d++)s.push({key:`${u}-${d}`,rowIndex:l,cellIndex:d});return s});return()=>{const l=o.value.map(u=>f(bt,u,null));return f("tr",{role:"row",class:`${t.value}-row`},[l])}}}),Pt=q({setup(){const{mergedPrefixCls:e,dateConfig:t,activeType:a,maxRowIndex:n,maxCellIndex:o}=te(se),l=Ct(t,a,o);return()=>{const u=`${e.value}-body`,s=l.value.map(c=>{const{key:m,label:v}=c;return f("th",{role:"columnheader",key:m},[f("div",{class:`${u}-header-cell`},[v])])}),r=n.value,d=[];for(let c=0;c<r;c++)d.push(f(It,{key:c,rowIndex:c},null));return f("div",{class:u},[f("table",{role:"grid"},[s.length>0&&f("thead",null,[f("tr",{role:"row"},[s])]),f("tbody",null,[d])])])}}});function Ct(e,t,a){return I(()=>{const n=t.value,o=[];if(n==="date"||n==="week"){const l=a.value,u=e.getLocalizedLabels("day",l,"narrow"),s=e.weekStartsOn();for(let r=0;r<l;r++)o.push({key:r,label:u[(r+s)%l]})}return o})}const ke=["month","quarter","year"],Tt=q({setup(){const{locale:e,mergedPrefixCls:t,dateConfig:a,activeDate:n,setActiveDate:o,activeType:l,setActiveType:u}=te(se),s=Dt(l,n,e,a,u),r=()=>{const v=l.value==="year"?-10:-1;o(a.add(n.value,v,"year"))},d=()=>{o(a.add(n.value,-1,"month"))},c=()=>{const v=l.value==="year"?10:1;o(a.add(n.value,v,"year"))},m=()=>{o(a.add(n.value,1,"month"))};return()=>{const{previousDecade:v,previousYear:i,previousMonth:b,nextDecade:D,nextYear:y,nextMonth:P}=e.datePicker,O=l.value,B=!ke.includes(l.value),p=!ke.includes(l.value),V=s.value.map(C=>{const{label:A,...F}=C;return f("button",K({type:"button",tabindex:"-1"},F),[A])}),h=`${t.value}-header`;return f("div",{class:h},[f("button",{class:`${h}-super-prev visible`,type:"button",tabindex:"-1",title:O==="year"?v:i,onClick:r},[f(ce,{name:"double-left"},null)]),f("button",{class:`${h}-prev${B?" visible":""}`,type:"button",tabindex:"-1",title:b,onClick:d},[f(ce,{name:"left"},null)]),f("div",{class:`${h}-content`},[V]),f("button",{class:`${h}-super-next${p?" visible":""}`,type:"button",tabindex:"-1",title:P,onClick:m},[f(ce,{name:"right"},null)]),f("button",{class:`${h}-super-prev visible`,type:"button",tabindex:"-1",title:O==="year"?D:y,onClick:c},[f(ce,{name:"double-right"},null)])])}}});function Dt(e,t,a,n,o){const l=(u,s)=>{u.stopPropagation(),o(s)};return I(()=>{const u=e.value,s=t.value,{yearSelect:r,monthSelect:d,yearFormat:c,monthFormat:m}=a.datePicker,{format:v,get:i}=n;switch(u){case"date":case"week":return[{key:"year",title:r,onClick:b=>l(b,"year"),label:v(s,c)},{key:"month",title:d,onClick:b=>l(b,"month"),label:v(s,m)}];case"month":case"quarter":return[{key:"year",title:r,onClick:b=>l(b,"year"),label:v(s,c)}];case"year":{const b=parseInt(`${i(s,"year")/10}`,10)*10,D=b+9;return[{key:"decade",label:`${b}-${D}`}]}default:return[]}})}const xt=q({name:"ɵDatePanel",props:pt,setup(e,{slots:t}){const a=Q("common"),{globalHashId:n}=X(),o=Q("locale"),l=I(()=>`${a.prefixCls}-date-panel`),u=re(),{activeType:s,setActiveType:r}=vt(e),{activeDate:d,setActiveDate:c,startActiveDate:m}=dt(e,u,s),{maxRowIndex:v,maxCellIndex:i}=ft(s);return Ie(se,{props:e,slots:t,locale:o,mergedPrefixCls:l,dateConfig:u,activeType:s,setActiveType:r,activeDate:d,setActiveDate:c,startActiveDate:m,maxRowIndex:v,maxCellIndex:i}),()=>{const b=l.value;return f("div",{class:`${b} ${b}-${s.value} ${n.value}`},[f(Tt,null,null),f(Pt,null,null)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Le=xt;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function we(e){const{colorPrimary:t,colorPrimaryTextHover:a,colorText:n,colorTextInverse:o,colorTextDisabled:l,marginSizeLg:u,paddingSizeSm:s,paddingSizeLg:r,fontSizeSm:d,fontWeightMd:c,heightMd:m}=e,v=at(t),i=nt("graphite");return{separatorMarginHorizontal:u,overlayWidth:252,overlayPadding:r,overlayFooterPadding:`${s}px ${r}px`,overlayDateInputWidth:120,overlayTimeInputWidth:96,boardWidth:220,boardMaxHeight:260,rangeBoardBorder:"none",rangeOverlayPadding:`${r}px ${r}px 0 ${r}px`,rangeOverlayFooterPadding:`${s}px 0`,rangeOverlaySeparatorWidth:32,rangeOverlaySeparatorFontSize:d,panelFontSize:d,panelColor:n,panelCellWidth:28,panelCellHeight:28,panelCellWidthLg:52,panelCellHeightLg:24,panelCellColorActive:o,panelCellColorHover:a,panelCellColorDisabled:l,panelCellBgColorHover:i.l50,panelCellBgColorActive:t,panelCellBgColorInRange:v.l50,panelCellBgColorDisabled:i.l50,panelCellTriggerWidth:20,panelCellTriggerHeight:20,panelCellTriggerWidthLg:52,panelCellTriggerHeightLg:24,panelCellCurrentColor:t,panelCellCurrentBorderColor:v.l40,panelCellCurrentBgColor:t,panelHeaerHeight:m,panelHeaderFontSize:d,panelHeaderFontWeight:c,panelHeaderSpacing:u,panelBodyHeaderBgColor:i.l50}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const pe=(e,t)=>we(e);/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function kt(e,t){var o;const[a,n]=fe(t,"activeValue",(o=t.value)!=null?o:e.now());return L(()=>t.value,l=>n(l!=null?l:e.now())),{activeValue:a,setActiveValue:n}}const Se={date:"month",datetime:"month",week:"month",month:"year",quarter:"year",year:"year"};function wt(e,t,a,n){var p,V;const{set:o,get:l}=e,u=e.now(),s=I(()=>Se[t.type]),r=I(()=>t.type==="year"?12:1),d=I(()=>{var h;return(h=a.value)==null?void 0:h[0]}),c=I(()=>{var h;return(h=a.value)==null?void 0:h[1]}),m=(h,C)=>{if(!h||!C)return!1;const A=l(h,s.value),F=l(C,s.value);return t.type==="year"?A<F-r.value:(()=>{const T=l(h,"year"),g=l(C,"year");return T>g?!1:T<g||A<F})()},v=(h,C,A)=>{const F=g=>o(g,l(g,s.value)+(A==="from"?-r.value:r.value),s.value);if(!h)return A==="from"?u:F(u);if(!C)return A==="from"?h:F(h);const T=m(h,C);return A==="from"?T?h:F(C):T?C:F(h)},i=()=>{var F,T,g;if(n.value)return;const h=(T=(F=a.value)==null?void 0:F[0])!=null?T:u,C=(g=a.value)==null?void 0:g[1];[h,C].every(S=>{if(!S)return!0;const k=l(S,"year");if(Se[t.type]==="year")return[y,P].map(H=>l(H.value,"year")).includes(k);const R=l(S,"month");return[y,P].some(H=>k===l(H.value,"year")&&R===l(H.value,"month"))})&&m(y.value,P.value)||D([h,v(h,C,"to")])},[b,D]=fe(t,"activeValue",[(p=d.value)!=null?p:u,v((V=d.value)!=null?V:u,c.value,"to")]),y=I(()=>b.value[0]),P=I(()=>b.value[1]);return L([a,()=>t.visible,()=>t.type],i),{fromActiveValue:y,toActiveValue:P,setFromActiveValue:h=>{D([h,v(h,P.value,"to")])},setToActiveValue:h=>{D([v(y.value,h,"from"),h])}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const qe={control:{type:[String,Number,Object,Array],default:void 0},cellTooltip:Function,open:{type:Boolean,default:void 0},allowInput:{type:[Boolean,String],default:void 0},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},clearable:{type:Boolean,default:void 0},clearIcon:String,disabled:{type:Boolean,default:!1},disabledDate:Function,format:String,dateFormat:String,timeFormat:String,overlayClassName:String,overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayRender:Function,readonly:{type:Boolean,default:!1},size:String,status:String,suffix:String,type:{type:String,default:"date"},"onUpdate:open":[Function,Array],onClear:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array]},St={...qe,value:[String,Date,Number],footer:{type:[Boolean,Array,Object],default:!1},placeholder:String,timePanelOptions:Object,onChange:[Function,Array],onInput:[Function,Array],"onUpdate:value":[Function,Array]},Vt={...qe,value:Array,footer:{type:[Boolean,Array,Object],default:!0},placeholder:Array,separator:[String,Object],timePanelOptions:[Object,Array],onChange:[Function,Array],onInput:[Function,Array],onSelect:[Function,Array],"onUpdate:value":[Function,Array]},Ft={activeValue:Date,cellTooltip:Function,disabledDate:Function,value:Date,type:{type:String,default:"date"},timePanelOptions:{type:Object,default:()=>({})},visible:[String,Boolean],onChange:[Function,Array],"onUpdate:activeValue":[Function,Array]},At={activeValue:Array,cellTooltip:Function,disabledDate:Function,value:Array,type:{type:String,default:"date"},timePanelOptions:{type:Array,default:()=>[]},visible:[String,Boolean],onChange:[Function,Array],onSelect:[Function,Array],"onUpdate:activeValue":[Function,Array]},Ke=q({name:"IxDatePanel",props:Ft,setup(e,{slots:t}){const a=Q("common"),{globalHashId:n,hashId:o,registerToken:l}=X("datePicker"),{registerToken:u}=X("timePicker");l(pe),u(Oe);const s=I(()=>`${a.prefixCls}-date-picker-panel`),r=re(),{activeValue:d,setActiveValue:c}=kt(r,e);function m(y){_(e.onChange,y)}function v(y){m(e.value?le(r,e.value,y,["hour","minute","second"]):y)}function i(y){m(e.value?le(r,e.value,y,["year","month","date"]):y)}const b=y=>{v(y)},D=y=>{y.target instanceof HTMLInputElement||y.preventDefault()};return()=>{const y=e.type==="datetime"?"date":e.type,P={cellTooltip:e.cellTooltip,disabledDate:e.disabledDate,type:y,value:e.value,visible:e.type==="datetime"?e.visible==="datePanel":!!e.visible,activeDate:d.value,onCellClick:b,"onUpdate:activeDate":c},O={...e.timePanelOptions,activeValue:d.value,value:e.value,visible:e.type==="datetime"?e.visible==="timePanel":!1,onChange:i,"onUpdate:activeValue":c};return f("div",{class:[s.value,n.value,o.value],tabindex:-1,onMousedown:D},[de(f(Le,P,t),[[ve,e.visible!=="timePanel"]]),e.type==="datetime"&&de(f(Re,O,null),[[ve,e.visible==="timePanel"]])])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Pe=Symbol("datePickerToken"),Ce=Symbol("dateRangePickerToken"),$t=q({setup(){const e=te(Pe),{props:t,mergedPrefixCls:a,dateFormatRef:n,timeFormatRef:o,hourEnabled:l,minuteEnabled:u,secondEnabled:s,use12Hours:r,slots:d,inputEnableStatus:c,inputRef:m,controlContext:{dateInputValue:v,timeInputValue:i,visiblePanel:b,panelValue:D,dateInputFocused:y,timeInputFocused:P,handleDateInput:O,handleTimeInput:B,handleDateInputClear:p,handleTimeInputClear:V,handleDateInputFocus:h,handleTimeInputFocus:C,handleDateInputBlur:A,handleTimeInputBlur:F,handlePanelChange:T},overlayVisible:g,setOverlayOpened:S,handleKeyDown:k,handleClear:R}=e,H=ee();ue(()=>{var x;c.value.allowInput==="overlay"&&(m.value=(x=H.value)==null?void 0:x.getInputElement())});const U=x=>{h(),c.value.allowInput==="overlay"&&(m.value=x.target)},N=x=>{C(),c.value.allowInput==="overlay"&&(m.value=x.target)},G=x=>{T(x),c.value.enableOverlayTimeInput||S(!1)},W=x=>{c.value.enableOverlayTimeInput||R(x),p()},j=_e(e),J=ct(t,l,u,s,r),w=x=>{if(c.value.enableOverlayDateInput)return f("div",{class:x},[f(ie,K({ref:H},j.value,{class:`${x}-date-input`,value:v.value,clearVisible:!!v.value&&!!c.value.allowInput,focused:y.value,placeholder:n.value,readonly:!c.value.allowInput,onInput:O,onFocus:U,onBlur:A,onKeydown:k,onClear:W}),d),c.value.enableOverlayTimeInput&&f(ie,K(j.value,{class:`${x}-time-input`,value:i.value,clearVisible:!!i.value&&!!c.value.allowInput,focused:P.value,placeholder:o.value,readonly:!c.value.allowInput,onInput:B,onFocus:N,onBlur:F,onKeydown:k,onClear:V}),d)])};return()=>{const x=`${a.value}-overlay`,$=`${x}-inputs`,M={cellTooltip:t.cellTooltip,disabledDate:t.disabledDate,value:D.value,type:t.type,timePanelOptions:J.value,visible:g.value&&b.value,onChange:G},E=[f("div",{class:`${x}-body`,tabindex:-1},[w($),f(Ke,M,d)]),f(Ve,{class:`${x}-footer`,footer:t.footer},d)];return t.overlayRender?t.overlayRender(E):f("div",null,[E])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function We(e){const{props:t,config:a,accessor:n,mergedSize:o,mergedStatus:l,focused:u,handleFocus:s,handleBlur:r,handleClear:d,handleKeyDown:c,overlayOpened:m,setOverlayOpened:v}=e,i=()=>{const b=m.value;n.disabled||v(!b)};return I(()=>{var b,D,y;return{borderless:t.borderless,clearable:!t.readonly&&!n.disabled&&((b=t.clearable)!=null?b:a.clearable)&&(ne(n.value)?!!n.value.length:!!n.value),clearIcon:(D=t.clearIcon)!=null?D:a.clearIcon,disabled:n.disabled,focused:u.value,readonly:t.readonly,size:o.value,status:l.value,suffix:(y=t.suffix)!=null?y:a.suffix,onClick:i,onClear:d,onFocus:s,onBlur:r,onKeyDown:c}})}const Ot=q({inheritAttrs:!1,setup(e,{attrs:t,expose:a}){const n=te(Pe),{globalHashId:o,hashId:l}=X("datePicker"),{accessor:u,props:s,slots:r,locale:d,controlContext:{inputValue:c,handleInput:m},mergedPrefixCls:v,formatRef:i,inputEnableStatus:b,inputRef:D}=n,y=ee(),P=I(()=>{var C;return(C=s.placeholder)!=null?C:d.datePicker[`${s.type}Placeholder`]}),O=I(()=>Math.max(10,i.value.length)+2),B=We(n);a({focus:()=>{var C;(C=(b.value.allowInput==="overlay"?y:D).value)==null||C.focus()}});const V=C=>{m(C),_(s.onInput,C)},h=C=>f("div",{class:`${C}-input`},[f("input",{ref:b.value.allowInput==="overlay"?y:D,class:`${C}-input-inner`,autocomplete:"off",disabled:u.disabled,placeholder:P.value,readonly:s.readonly||b.value.enableInput===!1,size:O.value,value:c.value,onInput:V},null)]);return()=>{const C=v.value,A={default:()=>h(C),suffix:r.suffix,clearIcon:r.clearIcon};return f(Be,K({className:`${C} ${o.value} ${l.value}`},B.value,t),A)}}}),Rt=q({name:"IxDatePicker",inheritAttrs:!1,props:St,setup(e,{attrs:t,expose:a,slots:n}){const o=Q("common"),l=Q("locale"),{globalHashId:u,hashId:s,registerToken:r}=X("datePicker");r(pe);const d=I(()=>`${o.prefixCls}-date-picker`),c=Q("datePicker"),m=re(),v=ee(),i=ee(),{elementRef:b,focus:D,blur:y}=Fe();a({focus:D,blur:y});const{overlayOpened:P,overlayVisible:O,onAfterLeave:B,setOverlayOpened:p}=Ue(e),V=Ee(e,c),h=He(e,c),C=Ne(e,c,m,h.formatRef,p),{accessor:A,handleFocus:F,handleBlur:T,handleChange:g}=C,{focused:S,handleFocus:k,handleBlur:R,bindOverlayMonitor:H}=Ae(F,T);ue(()=>{H(v,P)});const U=he(m,h,V,Me(A,"value"),g),N=rt(P,p),G={props:e,slots:n,common:o,locale:l,config:c,focused:S,mergedPrefixCls:d,dateConfig:m,inputRef:b,inputEnableStatus:V,overlayOpened:P,overlayVisible:O,onAfterLeave:B,setOverlayOpened:p,handleKeyDown:N,controlContext:U,...h,...C,handleFocus:k,handleBlur:R};Ie(Pe,G),L(P,x=>{var $;x?setTimeout(()=>{var M;(M=b.value)==null||M.focus()}):(U.init(!0),S.value&&(($=i.value)==null||$.focus()))});const W=()=>f(Ot,K({ref:i},t),null),j=()=>f($t,null,null),J=ze(G),w=I(()=>be([`${d.value}-overlay`,u.value,s.value,e.overlayClassName]));return()=>f($e,K({ref:v},J.value,{class:w.value,triggerId:t.id}),{default:W,content:j})}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Bt(e,t,a,n){const{formatRef:o}=t,[l,u]=z(Y(n.value).map(p=>ae(e,p,o.value))),[s,r]=z(!1),d=p=>{u(oe(e,Mt(e,p,o.value),"date")),r(!0)},[c,m]=z("datePanel"),v=p=>{c.value!==p&&m(p),P.visiblePanel.value!==p&&P.setVisiblePanel(p),O.visiblePanel.value!==p&&O.setVisiblePanel(p)},i=I(()=>Y(l.value)),b=I(()=>i.value[0]),D=I(()=>i.value[1]);L([n,o],([p])=>{d(p)});const y=(p,V)=>{var h,C,A,F;return V?ye(e,p,(h=l.value)==null?void 0:h[1],"date")>0?[p,p]:[p,(C=l.value)==null?void 0:C[1]]:ye(e,p,(A=l.value)==null?void 0:A[0],"date")<0?[p,p]:[(F=l.value)==null?void 0:F[0],p]},P=he(e,t,a,b,p=>{u(y(p,!0)),r(!0)}),O=he(e,t,a,D,p=>{u(y(p,!1)),r(!0)});return L(P.visiblePanel,v),L(O.visiblePanel,v),{buffer:l,bufferUpdated:s,visiblePanel:c,setVisiblePanel:v,fromControl:P,toControl:O,init:(p=!1)=>{d(n.value),r(!1),P.init(p),O.init(p)},handlePanelChange:d}}function Mt(e,t,a){return Y(t).map(n=>ae(e,n,a))}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ht(e,t){const[a,n]=z(e.value),[o,l]=z(!1);L(()=>e.visible,()=>{l(!1)});const u=I(()=>o.value?oe(t,[...Y(a.value)],"date"):Y(e.value)),s=c=>{_(e.onChange,c),_(e.onSelect,c)};return{panelValue:u,isSelecting:o,handleChange:s,handleDatePanelCellClick:c=>{if(!o.value)l(!0),n([c,void 0]),_(e.onSelect,[c,void 0]);else{const m=Y(e.value);s(oe(t,[a.value[0],c],"date").map((v,i)=>m[i]?le(t,m[i],v,["hour","minute","second"]):v)),l(!1)}},handleDatePanelCellMouseenter:c=>{var m;o.value&&n([(m=a.value)==null?void 0:m[0],c])}}}const je=q({name:"IxDateRangePanel",props:At,setup(e,{slots:t}){const a=Q("common"),{globalHashId:n,hashId:o,registerToken:l}=X("datePicker"),{registerToken:u}=X("timePicker");l(pe),u(Oe);const s=I(()=>`${a.prefixCls}-date-range-picker-panel`),r=re(),{handleChange:d,handleDatePanelCellClick:c,handleDatePanelCellMouseenter:m,panelValue:v,isSelecting:i}=Ht(e,r),{fromActiveValue:b,toActiveValue:D,setFromActiveValue:y,setToActiveValue:P}=wt(r,e,v,i),O=p=>{p.target instanceof HTMLInputElement||p.preventDefault()},B=p=>{var T,g;const V=(T=v.value)==null?void 0:T[p?0:1],h=p?b.value:D.value,C=S=>{var k,R;d(oe(r,p?[S,(k=v.value)==null?void 0:k[1]]:[(R=v.value)==null?void 0:R[0],S],"date"))},A={cellTooltip:e.cellTooltip,disabledDate:e.disabledDate,type:e.type==="datetime"?"date":e.type,value:v.value,visible:e.type==="datetime"?e.visible==="datePanel":!!e.visible,activeDate:h,onCellClick:c,onCellMouseenter:m,"onUpdate:activeDate":p?y:P},F={...(g=ne(e.timePanelOptions)?e.timePanelOptions[p?0:1]:e.timePanelOptions)!=null?g:{},activeValue:V!=null?V:h,value:V,visible:e.type==="datetime"?e.visible==="timePanel":!1,onChange:C,"onUpdate:activeValue":p?y:P};return f("div",{class:`${s.value}-side`},[de(f(Le,A,t),[[ve,e.visible!=="timePanel"]]),e.type==="datetime"&&de(f(Re,F,null),[[ve,e.visible==="timePanel"]])])};return()=>{var V,h;const p=s.value;return f("div",{class:[p,n.value,o.value],tabindex:-1,onMousedown:O},[B(!0),(h=(V=t.separator)==null?void 0:V.call(t))!=null?h:f("div",{class:`${p}-separator`},null),B(!1)])}}}),Et=q({setup(){const e=te(Ce),{props:t,locale:a,slots:n,dateFormatRef:o,timeFormatRef:l,hourEnabled:u,minuteEnabled:s,secondEnabled:r,use12Hours:d,rangeControlContext:{buffer:c,visiblePanel:m,fromControl:v,toControl:i,handlePanelChange:b},mergedPrefixCls:D,inputEnableStatus:y,inputRef:P,handleChange:O,handleKeyDown:B,overlayVisible:p,renderSeparator:V,setOverlayOpened:h}=e,C=ee();ue(()=>{var k;y.value.allowInput==="overlay"&&(P.value=(k=C.value)==null?void 0:k.getInputElement())});const A=()=>{O(c.value),h(!1)},F=k=>{k.target instanceof HTMLInputElement||k.preventDefault()},T=_e(e),g=it(t,u,s,r,d),S=(k,R)=>{const{enableOverlayTimeInput:H}=y.value,{dateInputValue:U,timeInputValue:N,dateInputFocused:G,timeInputFocused:W,handleDateInput:j,handleTimeInput:J,handleDateInputClear:w,handleTimeInputClear:x,handleDateInputFocus:$,handleTimeInputFocus:M,handleDateInputBlur:E,handleTimeInputBlur:Ye}=R?v:i,Qe=me=>{$(),y.value.allowInput==="overlay"&&(P.value=me.target)},Ge=me=>{M(),y.value.allowInput==="overlay"&&(P.value=me.target)};return f("div",{class:`${k}-side`},[f(ie,K({ref:R?C:void 0},T.value,{class:`${k}-date-input`,value:U.value,clearVisible:!!U.value&&!!y.value.allowInput,focused:G.value,placeholder:o.value,readonly:!y.value.allowInput,onInput:j,onFocus:Qe,onBlur:E,onKeydown:B,onClear:w}),n),H&&f(ie,K(T.value,{class:`${k}-time-input`,value:N.value,clearVisible:!!N.value&&!!y.value.allowInput,focused:W.value,placeholder:l.value,readonly:!y.value.allowInput,onInput:J,onFocus:Ge,onBlur:Ye,onKeydown:B,onClear:x}),n)])};return()=>{const k=`${D.value}-overlay`,R=`${k}-inputs`,H={value:c.value,cellTooltip:t.cellTooltip,disabledDate:t.disabledDate,type:t.type,timePanelOptions:g.value,visible:p.value&&m.value,onChange:b,onSelect:t.onSelect},U={cell:n.cell,separator:y.value.enableOverlayDateInput?()=>f("div",{class:`${k}-separator`},null):void 0},N=[f("div",{class:`${k}-body`,tabindex:-1,onMousedown:F},[y.value.enableOverlayDateInput&&f("div",{class:R},[S(R,!0),f("div",{class:`${k}-separator`},[V()]),S(R,!1)]),f(je,H,U)]),f(Ve,{class:`${k}-footer`,footer:t.footer,okText:a.dateRangePicker.okText,okButton:{size:"xs",mode:"primary"},cancelVisible:!1,ok:A},n)];return t.overlayRender?t.overlayRender(N):f("div",{onMousedown:F},[N])}}}),zt=q({inheritAttrs:!1,setup(e,{attrs:t,expose:a}){const n=te(Ce),{globalHashId:o,hashId:l}=X("datePicker"),{accessor:u,props:s,slots:r,locale:d,rangeControlContext:{fromControl:c,toControl:m},mergedPrefixCls:v,formatRef:i,inputRef:b,inputEnableStatus:D,renderSeparator:y}=n,P=ee(),O=I(()=>{var T,g,S,k;return[(g=(T=s.placeholder)==null?void 0:T[0])!=null?g:d.dateRangePicker[`${s.type}Placeholder`][0],(k=(S=s.placeholder)==null?void 0:S[1])!=null?k:d.dateRangePicker[`${s.type}Placeholder`][1]]}),B=I(()=>Math.max(10,i.value.length)+2),p=We(n),V=T=>{c.handleInput(T),_(s.onInput,!0,T)},h=T=>{m.handleInput(T),_(s.onInput,!1,T)};a({focus:()=>{var T;(T=(D.value.allowInput==="overlay"?P:b).value)==null||T.focus()}});const A=T=>{const g=v.value,{inputValue:S}=T?c:m,k=O.value[T?0:1],R=T?V:h;return f("input",{ref:T?D.value.allowInput==="overlay"?P:b:void 0,class:`${g}-input-inner`,autocomplete:"off",disabled:u.disabled,placeholder:k,readonly:s.readonly||D.value.enableInput===!1,size:B.value,value:S.value,onInput:R},null)},F=T=>f("div",{class:`${T}-input`},[A(!0),f("span",{class:`${T}-input-separator`},[y()]),A(!1)]);return()=>{const T=v.value,g={default:()=>F(T),suffix:r.suffix,clearIcon:r.clearIcon};return f(Be,K({className:`${T} ${o.value} ${l.value}`},p.value,t),g)}}}),Ut=q({name:"IxDateRangePicker",inheritAttrs:!1,props:Vt,setup(e,{attrs:t,expose:a,slots:n}){const o=Q("common"),l=Q("locale"),{globalHashId:u,hashId:s,registerToken:r}=X("datePicker");r(pe);const d=I(()=>`${o.prefixCls}-date-range-picker`),c=Q("datePicker"),m=re(),v=ee(),i=ee(),{elementRef:b,focus:D,blur:y}=Fe();a({focus:D,blur:y});const{overlayOpened:P,overlayVisible:O,onAfterLeave:B,setOverlayOpened:p}=Ue(e),V=Ee(e,c),h=He(e,c),C=Ne(e,c,m,h.formatRef,p),{accessor:A,handleFocus:F,handleBlur:T,handleChange:g}=C,S=Bt(m,h,V,Me(A,"value")),k=ut(S,P,p,g),{focused:R,handleFocus:H,handleBlur:U,bindOverlayMonitor:N}=Ae(F,T);ue(()=>{N(v,P)});const W={props:e,slots:n,common:o,locale:l,config:c,focused:R,mergedPrefixCls:d,dateConfig:m,inputRef:b,inputEnableStatus:V,overlayOpened:P,overlayVisible:O,onAfterLeave:B,setOverlayOpened:p,rangeControlContext:S,renderSeparator:()=>{var $,M,E;return(E=(M=($=n.separator)==null?void 0:$.call(n))!=null?M:e.separator)!=null?E:l.dateRangePicker.separator},handleKeyDown:k,...h,...C,handleFocus:H,handleBlur:U};Ie(Ce,W),L(P,$=>{var M;$?setTimeout(()=>{var E;(E=b.value)==null||E.focus()}):(S.init(!0),R.value&&((M=i.value)==null||M.focus()))});const j=()=>f(zt,K({ref:i},t),null),J=()=>f(Et,null,null),w=ze(W),x=I(()=>be([`${d.value}-overlay`,u.value,s.value,e.overlayClassName]));return()=>f($e,K({ref:v},w.value,{class:x.value,triggerId:t.id}),{default:j,content:J})}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const qt=Rt,Kt=Ke,Wt=Ut,jt=je;export{qt as I,Wt as a,Kt as b,jt as c};
