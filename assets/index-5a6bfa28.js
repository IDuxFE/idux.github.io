import{am as Xe,an as We,aQ as $t,ao as Ge,m as _,M as we,aK as G,aR as Te,o as le,D as Ie,Y as Kt,ak as ke,T as Ye,A as be,S as Qe,c as Le,j as He,a7 as Et,at as Tt,H as Ze,X as pe,U as de,Z as Ne,aS as It,E as Rt,G as Pt,aT as Ot,av as Wt,al as De,N as Ht,aw as zt,ar as Mt,aF as Ft}from"./index-cd46e9ff.js";import{b as Je,f as j,V as At,T as Lt,c as b,r as P,w as V,O as et,N as tt,d as fe,z as lt,n as he,m as Be,by as Nt,X as Dt,l as F,y as M,p as ce,q as m,i as ve,a8 as ye,an as _t,D as ze,L as Vt,au as jt}from"./vendor-7ed7823e.js";import{b as nt}from"./GlobalCodeBox-20c96fe5.js";import{I as Ut}from"./index-4475b9fa.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ot=Symbol("IxTableColumn"),Me=()=>{};Me.displayName="IxTableColumn";Me[ot]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rt(e,t,l){if(!e||Je(e)&&e.title===!1)return;if(j(t)||At(t))return t;const n=Xe(t).find(r=>r.type===Lt);return n?n.children:l}function qt(e){return"key"in e?e.key:"dataKey"in e?We(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:$t("__IDUX_table_column_key_")}function at(e,t,l,n,r,o,a=!1){const s=h=>h.filter(g=>g.type!=="scroll-bar"),c=a?r:s(r),i=a?o:s(o);if(!c.length&&!i.length)return;const d=n.findIndex(h=>h.rowKey===e.rowKey),v=h=>{if(t.findIndex(y=>y.key===h.key)>-1)return;const g=l.findIndex(y=>y.key===h.key);let p;return j(h.key)?p=`fix-${d}-${h.key}`:p=`fix-${d}-${g}`,{data:h,index:g,poolKey:p}};return{start:c.map(v).filter(Boolean),end:i.map(v).filter(Boolean)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Xt(e,t,l,n){const r=b(()=>{var u;const{columns:f}=e;return st(f&&f.length>0?f:ct((u=t.default)==null?void 0:u.call(t)),l)}),{flattedColumns:o,scrollBarColumn:a,flattedColumnsWithScrollBar:s}=Yt(r,n),{fixedColumns:c,fixedColumnKeys:i}=Qt(s),d=b(()=>!!e.ellipsis||o.value.some(f=>f.ellipsis)),v=b(()=>o.value.some(f=>f.fixed)),h=b(()=>s.value.length),{columnWidthMap:g,columnWidths:p,changeColumnWidth:y}=Zt(o),{columnOffsets:x,columnOffsetsWithScrollBar:B}=Jt(c,g,h),C=b(()=>el(r.value,a.value));return{flattedColumns:o,scrollBarColumn:a,flattedColumnsWithScrollBar:s,fixedColumns:c,fixedColumnKeys:i,hasEllipsis:d,hasFixed:v,columnWidthMap:g,columnWidths:p,changeColumnWidth:y,columnOffsets:x,columnOffsetsWithScrollBar:B,mergedRows:C}}function st(e,t){return e.map(l=>Gt(l,t))}function ct(e){const t=[];return Xe(e,{key:ot}).forEach((l,n)=>{const{props:r,children:o}=l,{key:a=n,editable:s,ellipsis:c,...i}=r||{};i.key=a,i.editable=s||s==="",i.ellipsis=c||c==="";const{default:d,cell:v,title:h,expand:g,icon:p}=o||{};d&&(i.children=ct(d())),v&&(i.customCell=v),h&&(i.customTitle=h),g&&(i.customExpand=g),p&&(i.customIcon=p),t.push(i)}),t}function ge(e){return j(e)?{title:e,cell:e}:e}function Gt(e,t){var c,i;const{columnBase:l,columnExpandable:n,columnSelectable:r,columnIndexable:o}=t,{align:a=l.align}=e,s=qt(e);if("type"in e){const{type:d}=e;if(d==="expandable"){const{showLine:v=n.showLine,icon:h=n.icon}=e;return{...e,key:s,align:ge(a),icon:h,showLine:v}}if(d==="selectable"){const{multiple:v=!0,showIndex:h=r.showIndex}=e;return{...e,key:s,align:ge(a),multiple:v,showIndex:h}}if(d==="indexable"){const v=(i=(c=e.align)!=null?c:o.align)!=null?i:l.align;return{...o,...e,align:ge(v),key:s}}return{...e,key:s,align:ge(a)}}else{const{sortable:d,filterable:v,children:h}=e,g={...e,key:s,align:ge(a)};return d&&(g.sortable={...l.sortable,...d}),v&&(g.filterable={...l.filterable,...v}),h!=null&&h.length&&(g.children=st(h,t)),g}}function Yt(e,t){const l=b(()=>Fe(e.value)),n=b(()=>{const o=t.value,a=l.value;if(o===0||a.length===0)return;const s=a[a.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:s&&s.fixed,width:o}}),r=b(()=>{const o=l.value,a=n.value;return a?[...o,a]:o});return{flattedColumns:l,scrollBarColumn:n,flattedColumnsWithScrollBar:r}}function Fe(e){const t=[];return e.forEach(l=>{const{fixed:n,children:r}=l;if(r!=null&&r.length){let o=Fe(r);n&&(o=o.map(a=>({fixed:n,...a}))),t.push(...o)}else t.push(l)}),t}function Qt(e){const t=b(()=>{const n=[],r=[],o={};return e.value.forEach((a,s)=>{const{key:c,fixed:i}=a;i==="start"?(n.push(a),o[c]=s):i==="end"&&(r.push(a),o[c]=s)}),{fixedStartColumns:n,fixedEndColumns:r,fixedColumnIndexMap:o}}),l=b(()=>{var o,a;const{fixedStartColumns:n,fixedEndColumns:r}=t.value;return{lastStartKey:(o=n[n.length-1])==null?void 0:o.key,firstEndKey:(a=r[0])==null?void 0:a.key}});return{fixedColumns:t,fixedColumnKeys:l}}function Zt(e){const t=P({}),l=P(),n=P([]);return V(l,et(o=>{n.value=o?o.split("-").filter(Boolean).map(Number):[]},16)),tt(()=>{const o=e.value;l.value=o.map(a=>t.value[a.key]).join("-")}),{columnWidthMap:t,columnWidths:n,changeColumnWidth:(o,a)=>{a===!1?delete t.value[o]:t.value[o]=a}}}function Jt(e,t,l){const n=b(()=>{const{fixedStartColumns:o,fixedEndColumns:a,fixedColumnIndexMap:s}=e.value;return _e(o,a.filter(c=>c.type!=="scroll-bar"),s,t.value,l.value-1)}),r=b(()=>{const{fixedStartColumns:o,fixedEndColumns:a,fixedColumnIndexMap:s}=e.value;return _e(o,a,s,t.value,l.value)});return{columnOffsets:n,columnOffsetsWithScrollBar:r}}function _e(e,t,l,n,r){var i,d,v,h,g,p;const o={},a={};let s=0,c=0;for(let y=0;y<e.length;y++){const x=e[y],B=(d=(i=n[x.key])!=null?i:x.width)!=null?d:0;o[x.key]={index:(v=l[x.key])!=null?v:y,offset:s},s+=B}for(let y=0;y<t.length;y++){const x=t[t.length-y-1],B=(g=(h=n[x.key])!=null?h:x.width)!=null?g:0;a[x.key]={index:(p=l[x.key])!=null?p:r-y-1,offset:c},c+=B}return{starts:o,ends:a}}function el(e,t){const l=[],n={};function r(s,c,i){var h;(h=l[i])!=null||(l[i]=[]);let d=c;return s.map(g=>{var C;let p=(C=g.titleColSpan)!=null?C:1,y=!1;const x=g.children;if(x!=null&&x.length){y=!0;const f=r(x,d,i+1);fe(g.titleColSpan)&&(p=f.reduce((u,S)=>u+S))}const B=d+p-1;return l[i].push({...g,titleColSpan:p,colStart:d,colEnd:B,hasChildren:y}),n[g.key]={colStart:d,colEnd:B},d+=p,p})}const o=t?[...e,t]:e;r(o,0,0);const a=l.length;return l.forEach((s,c)=>{s.forEach(i=>{i.hasChildren||(i.titleRowSpan=a-c)})}),{rows:l,offsetIndexMap:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tl(e,t,l,n,r,o,a){const s=b(()=>{const y=t.value,x=l.value;return e.dataSource.map((B,C)=>it(B,x,y,C,e.dataSource.length))}),c=b(()=>{const y=new Map;return Re(s.value,y),y}),i=b(()=>dt(s.value,r.value,o.value)),d=b(()=>ut(i.value,n.value,o.value)),v=b(()=>{const y=a.value,x=d.value;if(y===null||!y.pageSize)return x;{const{total:B}=y;if(B&&x.length<B)return x;const C=y.pageSize,f=(y.pageIndex-1)*C;return x.slice(f,f+C)}}),h=b(()=>{const y=new Map;return Re(v.value,y),y}),g=b(()=>{const y=o.value;return y.length>0?ft(v.value,y,0):v.value});return{isTreeData:b(()=>s.value.some(y=>{var x;return(x=y.children)==null?void 0:x.length})),filteredData:i,flattedData:g,mergedMap:c,paginatedMap:h}}function it(e,t,l,n,r,o){var i;const a=t(e),s={record:e,rowKey:a,parentKey:o==null?void 0:o[0].rowKey,showLineIndentIndexList:(i=[...o!=null?o:[]].reverse())==null?void 0:i.reduce((d,v,h)=>(v.hasNextSibling&&d.push(h),d),[]),hasPrevSibling:n>0,hasNextSibling:n<r-1},c=e[l];return c&&(s.children=c.map((d,v)=>it(d,t,l,v,c.length,[s,...o!=null?o:[]]))),s}function Re(e,t){e.forEach(l=>{const{rowKey:n,children:r}=l;t.set(n,l),r&&Re(r,t)})}function ut(e,t,l){const n=t.filter(a=>a.sorter),r=n.length;if(r===0)return e;const o=e.slice();return o.forEach(a=>{l.includes(a.rowKey)&&a.children&&a.children.length>0&&(a.children=ut(a.children,t,l))}),o.sort((a,s)=>{for(let c=0;c<r;c++){const{orderBy:i,sorter:d}=n[c],v=d(a.record,s.record);if(v!==0)return i==="ascend"?v:-v}return 0})}function dt(e,t,l){const n=t.filter(r=>r.filter);return n.length===0?e:e.map(r=>{const o=n.every(({filter:d,filterBy:v})=>d(v,r.record)),{rowKey:a,children:s}=r,c=l.includes(a);let i=r;if(c&&s&&s.length){const d=dt(s,t,l);d.length!==s.length&&(i={...r,children:d})}return o||c&&i.children&&i.children.length?i:null}).filter(r=>r!==null)}function ft(e,t,l){return e.reduce((n,r)=>{const{children:o,parentKey:a,record:s,rowKey:c,hasPrevSibling:i,hasNextSibling:d,showLineIndentIndexList:v}=r,h=t.includes(c);if(n.push({children:o,parentKey:a,record:s,rowKey:c,level:l,expanded:h,hasPrevSibling:i,hasNextSibling:d,showLineIndentIndexList:v}),h&&r.children){const g=ft(r.children,t,l+1);n.push(...g)}return n},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ll(e,t){const l=b(()=>t.value.find(s=>"type"in s&&s.type==="expandable")),[n,r]=Ge(e,"expandedRowKeys",()=>[]);return{expandable:l,expandedRowKeys:n,setExpandedRowKeys:r,checkExpandDisabled:s=>{if(!l.value)return!0;const{disabled:c,customExpand:i}=l.value,{record:d}=s;return c!=null&&c(d)?!0:!(i||s.children&&s.children.length>0)},handleExpandChange:(s,c)=>{const{onChange:i,onExpand:d}=l.value||{},v=[...n.value],h=v.indexOf(s),g=h>=0;g?v.splice(h,1):v.push(s),_(d,!g,c),r(v),_(i,v)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nl(e){const t=b(()=>e.value.filter(o=>o.filterable)),l=lt({}),n=P([]);return V(t,(o,a)=>{o.forEach(s=>{const{key:c,filterable:i}=s,d=i.filterBy;if(d||l[c]===void 0){l[c]=d||[];return}const v=a?a.find(g=>g.key===c):void 0;(v==null?void 0:v.filterable.filterBy)&&(l[c]=[])}),n.value=Ve(o,l)},{immediate:!0}),{activeFilters:n,activeFilterByMap:l,handleFilter:(o,a,s)=>{const{onChange:c}=a;l[o]=s,n.value=Ve(t.value,l),_(c,s,n.value)}}}function Ve(e,t){return e.map(l=>{const{key:n,filterable:r}=l,{filter:o,filterBy:a=t[n]}=r;return{key:n,filter:o,filterBy:a}}).filter(l=>l.filter&&l.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ol(e,t,l){var i,d,v,h,g;const n=we("pagination"),r=b(()=>{const{pagination:p}=e;return p===!1?null:p===!0?{}:p}),o=P((d=(i=r.value)==null?void 0:i.pageIndex)!=null?d:1),a=P((g=(h=(v=r.value)==null?void 0:v.pageSize)!=null?h:t.pagination.pageSize)!=null?g:n.pageSize),s=(p,y)=>{var x;o.value=p,a.value=y,_((x=r.value)==null?void 0:x.onChange,p,y)};return{mergedPagination:b(()=>{var y,x;const p=r.value;return p===null?null:{...t.pagination,size:l.value,...p,pageIndex:(y=p.pageIndex)!=null?y:o.value,pageSize:(x=p.pageSize)!=null?x:a.value,onChange:s}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function rl(e,{setStickyScrollLeft:t}){const l=P(),n=P(),r=P(),o=P(),a=P(),s=P();V(l,u=>{u&&(o.value=u.getHolderElement())},{immediate:!0}),V(n,u=>{u&&(r.value=u.getHolderElement(),r.value.style.overflow="hidden")},{immediate:!0});const{handleScroll:c,pingedStart:i,pingedEnd:d}=al(e,l,n,r,o,s,t),{scrollHorizontalOverflowed:v,scrollVerticalOverflowed:h}=sl(o,a),g=b(()=>{var u;return G((u=e.scroll)==null?void 0:u.width)}),p=b(()=>{var u;return G((u=e.scroll)==null?void 0:u.height)}),y=b(()=>Te(le(o))),x=b(()=>h.value?y.value:0),B=b(()=>i.value&&v.value),C=b(()=>d.value&&v.value);return{virtualScrollRef:l,headerVirtualScrollRef:n,scrollHeadRef:r,scrollBodyRef:o,scrollContentRef:a,scrollFootRef:s,handleScroll:c,scrollTo:u=>{var S;e.virtual?(S=l.value)==null||S.scrollTo(u):typeof u=="number"&&Kt({target:le(o),top:u,duration:200})},pingedStart:B,pingedEnd:C,scrollWidth:g,scrollHeight:p,scrollBarSize:y,scrollBarSizeOnFixedHolder:x,scrollHorizontalOverflowed:v,scrollVerticalOverflowed:h}}function al(e,t,l,n,r,o,a){const s=P(!1),c=P(!1);let i;const d=()=>{i&&(clearTimeout(i),i=void 0)};he(()=>d());const v=P(),h=B=>{v.value=B,d(),i=setTimeout(()=>{v.value=void 0,i=void 0},100)},g=(B,C)=>{C&&C.scrollLeft!==B&&(C.scrollLeft=B)},p=(B,C)=>{C&&C.scrollTo({left:B})},y=B=>{const C=le(r);if(!C)return;const{clientWidth:f,scrollWidth:u}=C;a(B/u*f||0)};return{handleScroll:(B,C)=>{const f=B==null?void 0:B.currentTarget,u=C!=null?C:f.scrollLeft,S=v.value;if((!S||S===f)&&(h(f),l.value?p(u,l.value):g(u,n.value),t.value?p(u,t.value):g(u,le(r)),g(u,o.value),y(u)),f){const{scrollWidth:$,clientWidth:w}=f;s.value=u>1,c.value=$-w-u>1}(B==null?void 0:B.type)==="scroll"&&_(e.onScroll,B)},pingedStart:s,pingedEnd:c}}function sl(e,t){const l=P(!1),n=P(!1),r=()=>{const s=le(e.value);s?(l.value=s.scrollWidth>s.clientWidth,n.value=s.scrollHeight>s.clientHeight):(l.value=!1,n.value=!1)};let o=[];const a=()=>o.forEach(s=>s());return Be(()=>{o=[Ie(e,r),Ie(t,r)]}),he(()=>a()),{scrollHorizontalOverflowed:l,scrollVerticalOverflowed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function cl(e,t,l,n,r,o){const a=b(()=>{var d;return(d=e.scrollToTopOnChange)!=null?d:t.scrollToTopOnChange});let s=[];const c=()=>{s=[V([()=>{var d;return(d=l.value)==null?void 0:d.pageIndex},()=>{var d;return(d=l.value)==null?void 0:d.pageSize}],()=>o(0)),V([r,n],([d,v],[h,g])=>{(!il(d,h)||!ul(v,g))&&o(0)})]},i=()=>{s.forEach(d=>d())};V(a,d=>{i(),d&&c()},{immediate:!0})}function il(e,t){return e.length===t.length&&e.every(l=>{const n=t.find(r=>r.key===l.key);return n?l.filter===n.filter&&l.filterBy.length===n.filterBy.length&&l.filterBy.every(r=>n.filterBy.includes(r)):!1})}function ul(e,t){return e.length===t.length&&e.every(l=>{const n=t.find(r=>r.key===l.key);return n?l.sorter===n.sorter&&l.orderBy===n.orderBy&&l.multiple===n.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function dl(e,t,l,{mergedMap:n,paginatedMap:r}){const o=b(()=>l.value.find(f=>"type"in f&&f.type==="selectable")),[a,s]=Ge(e,"selectedRowKeys",()=>[]),c=b(()=>{const{disabled:f}=o.value||{},u=[],S=[];return r.value.forEach(($,w)=>{f!=null&&f($.record)?S.push(w):u.push(w)}),{enabledRowKeys:u,disabledRowKeys:S}}),i=b(()=>{const f=new Set,u=a.value,{disabledRowKeys:S}=c.value,$=n.value;return u.forEach(w=>{const{parentKey:E}=$.get(w)||{};if(!fe(E)){let K=$.get(E);if(K&&!u.includes(K.rowKey))for(;K&&!fe(K==null?void 0:K.rowKey);)S.includes(K.rowKey)||f.add(K.rowKey),K=fe(K.parentKey)?void 0:$.get(K.parentKey)}}),[...f]}),d=b(()=>{const f=a.value,{disabledRowKeys:u}=c.value;let S=0;return r.value.forEach(($,w)=>{!u.includes(w)&&f.includes(w)&&S++},0),S}),v=b(()=>{const f=r.value.size,u=c.value.disabledRowKeys.length;return f===0||f===u?!1:f===u+d.value}),h=b(()=>!v.value&&d.value>0),g=new Map,p=f=>{s(f);const u=n.value,{onChange:S}=o.value||{};if(S){const $=[];g.forEach((w,E)=>{f.includes(E)||g.delete(E)}),f.forEach(w=>{let E=u.get(w);E?g.set(w,E):E=g.get(w),E&&$.push(E.record)}),_(S,f,$)}},y=(f,u)=>{const S=n.value,{disabledRowKeys:$}=c.value,{multiple:w,onSelect:E}=o.value||{};let K=[...a.value];const k=K.indexOf(f),I=k>=0;if(w){const O=S.get(f),W=vt(O,$);if(I){K.splice(k,1);const z=fl(S,O,$);K=K.filter(L=>!z.includes(L)&&!W.includes(L))}else K.push(f),K.push(...W);vl(S,O,K,$)}else K=I?[]:[f];_(E,!I,u),p(K)},x=()=>{const{enabledRowKeys:f}=c.value,u=new Set(a.value);v.value?f.forEach(S=>u.delete(S)):f.forEach(S=>u.add(S)),p([...u])},B=hl(o,t),C=yl(o,n,r,a,p);return{selectable:o,selectedRowKeys:a,indeterminateRowKeys:i,currentPageRowKeys:c,currentPageAllSelected:v,currentPageSomeSelected:h,handleSelectChange:y,handleHeadSelectChange:x,mergedSelectableMenus:B,handleSelectableMenuClick:C}}function vt(e,t){const l=[],{children:n}=e||{};return n&&n.forEach(r=>{const{rowKey:o}=r;t.includes(o)||l.push(r.rowKey),l.push(...vt(r,t))}),l}function fl(e,t,l){const n=[];for(;t!=null&&t.parentKey;){const{parentKey:r}=t;l.includes(t.parentKey)||n.push(r),t=e.get(r)}return n}function vl(e,t,l,n){let r=!0;for(;r&&t&&!fe(t.parentKey);){const o=e.get(t.parentKey);if(o&&!n.includes(t.parentKey)){r=o.children.every(s=>n.includes(s.rowKey)||l.includes(s.rowKey));const a=l.findIndex(s=>s===t.parentKey);r?a<0&&l.push(t.parentKey):a>-1&&l.splice(a,1)}t=o}}const ht=Symbol("IDUX_TABLE_KEY_selectable-all"),yt=Symbol("IDUX_TABLE_KEY_selectable-invert"),gt=Symbol("IDUX_TABLE_KEY_selectable-none"),pt=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function hl(e,t){return b(()=>{const{menus:l}=e.value||{};if(!l||l.length===0)return[];const{selectAll:n,selectInvert:r,selectNone:o,selectPageInvert:a}=t.table;return l.map(s=>j(s)?s==="all"?{type:"item",key:ht,label:n}:s==="invert"?{type:"item",key:yt,label:r}:s==="none"?{type:"item",key:gt,label:o}:s==="pageInvert"?{type:"item",key:pt,label:a}:{type:"item",key:s,label:s}:s)})}function yl(e,t,l,n,r){const o=()=>{const{disabled:d,onSelectAll:v}=e.value||{},h=[];t.value.forEach((g,p)=>{d!=null&&d(g.record)||h.push(p)}),_(v,h),r(h)},a=()=>{const{disabled:d,onSelectInvert:v}=e.value||{},h=[...n.value];t.value.forEach((g,p)=>{if(d!=null&&d(g.record))return;const y=h.indexOf(p);y>=0?h.splice(y,1):h.push(p)}),r(h),_(v,h)},s=()=>{const{onSelectNone:d}=e.value||{};_(d),r([])},c=()=>{const{disabled:d,onSelectPageInvert:v}=e.value||{},h=[],g=n.value;l.value.forEach((p,y)=>{d!=null&&d(p.record)||g.includes(y)||h.push(y)}),_(v,h),r(h)},i=new Map([[ht,o],[yt,a],[gt,s],[pt,c]]);return d=>{const v=d.key;if(Nt(v)&&i.has(v)){i.get(v)();return}const{disabled:h,onMenuClick:g}=e.value||{};if(!g)return;const p=[];l.value.forEach((y,x)=>{h!=null&&h(y.record)||p.push(x)}),_(g,d,p)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function gl(e){const t=b(()=>e.value.filter(a=>a.sortable)),l=b(()=>t.value.some(a=>a.sortable.multiple!==void 0)),n=lt({}),r=P([]);return V(t,(a,s)=>{a.forEach(c=>{const{key:i,sortable:d}=c,v=d.orderBy;if(v||n[i]===void 0){n[i]=v;return}const h=s?s.find(p=>p.key===i):void 0;(h==null?void 0:h.sortable.orderBy)&&(n[i]=void 0)}),r.value=Ue(a,n)},{immediate:!0}),{activeSorters:r,activeOrderByMap:n,handleSort:(a,s)=>{const{orders:c,onChange:i}=s,d=n[a],v=d?je(c,d):je(c);l.value?n[a]=v:Object.keys(n).forEach(h=>{a===h?n[h]=v:n[h]=void 0}),r.value=Ue(t.value,n),_(i,v,r.value)}}}function je(e,t){return t?e[e.indexOf(t)+1]:e[0]}function Ue(e,t){return e.map(l=>{const{key:n,sortable:r}=l,{multiple:o=0,orderBy:a=t[n],sorter:s}=r;return{key:n,multiple:o,orderBy:a,sorter:s}}).filter(l=>l.orderBy).sort((l,n)=>n.multiple-l.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function pl(e){const t=b(()=>!!e.sticky),l=b(()=>{const{sticky:o}=e,{offsetTop:a=0,offsetBottom:s=0,offsetScroll:c=0,container:i=window}=Dt(o)?o:{};return{offsetTop:a,offsetBottom:s,offsetScroll:c,container:i}}),[n,r]=ke(0);return{isSticky:t,mergedSticky:l,stickyScrollLeft:n,setStickyScrollLeft:r}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function ml(e,{hasEllipsis:t,hasFixed:l},{scrollWidth:n,scrollHeight:r},o,a,s){return b(()=>e.tableLayout?e.tableLayout:n.value&&l.value?n.value==="max-content"?"auto":"fixed":r.value||s.value||o.value||t.value||a.value.horizontal||a.value.vertical?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const A=Symbol("TABLE_TOKEN"),Ae=Symbol("tableBodyToken"),mt=Symbol("tableBodyRowToken"),me=F({props:{isFixedHolder:Boolean,columns:Array},setup(e){const{flattedColumns:t,flattedColumnsWithScrollBar:l,columnWidthMap:n,mergedSelectableMenus:r,mergedPrefixCls:o}=M(A),a=b(()=>{const{isFixedHolder:s,columns:c}=e;return c||(s?l.value:t.value)});return()=>{if(a.value.every(i=>!i.width&&!i.type))return;const s=o.value,c=a.value.map(i=>{var y;const{key:d,type:v}=i,h=(y=i.width)!=null?y:n.value[d],g=v?ce({[`${s}-col-${v}`]:!0,[`${s}-col-with-dropdown`]:v==="selectable"&&r.value.length>0}):void 0,p={width:G(h),minWidth:G(i.minWidth),maxWidth:G(i.maxWidth)};return m("col",{key:d,class:g,style:p},null)});return m("colgroup",null,[c])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const bl={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},insetShadow:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualScrollMode:{type:String,default:void 0},virtualHorizontal:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},virtualColWidth:{type:Number,default:void 0},virtualBufferSize:{type:Number,default:void 0},virtualBufferOffset:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},Sl={columns:{type:Array,required:!0}},xl={column:{type:Object,required:!0}},Cl={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},hasPrevSibling:{type:Boolean,default:void 0},hasNextSibling:{type:Boolean,default:void 0},showLineIndentIndexList:{type:Array,default:()=>[]},hasChildren:{type:Boolean,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},wl={column:{type:Object,required:!0},isLast:{type:Boolean,required:!0},colSpan:Number,rowSpan:Number},kl={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},Bl={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},$l={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},Kl=F({props:Bl,setup(e){const{slots:t,config:l,locale:n,mergedPrefixCls:r}=M(A),o=b(()=>{var f;return(f=e.filterable.multiple)!=null?f:l.columnBase.filterable.multiple}),a=b(()=>{var f;return(f=e.filterable.footer)!=null?f:l.columnBase.filterable.footer}),s=e.activeFilterBy,[c,i]=ke(()=>s);V(()=>e.activeFilterBy,f=>i(f));const[d,v]=ke(!1),h=f=>{v(f),f||e.onUpdateFilterBy(c.value)},g=()=>{v(!1),e.onUpdateFilterBy(c.value)},p=()=>{i(s)},y=f=>{const u=`${r.value}-filterable-menu-label`,S=o.value?He:nt;return m("span",{class:u},[m(S,{checked:f.selected,disabled:f.disabled},null),m("span",{class:`${u}-content`},[f.label])])},x=()=>{const f=[],{customMenu:u,menus:S}=e.filterable;return ve(u)?f.push(u({selectedKeys:c.value,setSelectedKeys:i})):j(u)&&t[u]?f.push(t[u]({selectedKeys:c.value,setSelectedKeys:i})):f.push(El(S,o,c,i,y)),a.value&&f.push(Tl(n,r,g,p)),f},B=b(()=>{const f=`${r.value}-filterable-trigger`;return ce({[f]:!0,[`${f}-active`]:e.activeFilterBy.length>0})}),C=()=>{const{customTrigger:f}=e.filterable;return ve(f)?f():j(f)&&t[f]?t[f]():m("span",{class:B.value,onClick:u=>u.stopPropagation()},[m(be,{name:"filter-filled"},null)])};return()=>{const f={visible:d.value,hideOnClick:!a.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":h};return m(Ye,f,{default:C,overlay:x})}}}),El=(e,t,l,n,r)=>{const o={dataSource:e,multiple:t.value,selectable:!0,selectedKeys:l.value,"onUpdate:selectedKeys":n};return m(Qe,o,{itemLabel:r})},Tl=(e,t,l,n)=>{const{filterConfirm:r,filterReset:o}=e.table;return m("div",{class:`${t.value}-filterable-trigger-footer`},[m(Le,{mode:"primary",size:"xs",onClick:l},{default:()=>[r]}),m(Le,{size:"xs",onClick:n},{default:()=>[o]})])},Il=F({setup(){const{mergedPrefixCls:e,paginatedMap:t,selectable:l,currentPageRowKeys:n,currentPageAllSelected:r,currentPageSomeSelected:o,handleHeadSelectChange:a,mergedSelectableMenus:s,handleSelectableMenuClick:c}=M(A),i=b(()=>{const x=t.value.size;return x===0||x===n.value.disabledRowKeys.length}),[d,v]=ke(!1),h={"onUpdate:visible":v,trigger:"click"},g=()=>m(Qe,{dataSource:s.value,onClick:c},null),p=()=>m(be,{class:`${e.value}-selectable-trigger`,name:"down",rotate:d.value?180:0},null),y=()=>{if(s.value.length!==0)return m(Ye,h,{default:p,overlay:g})};return()=>{const{multiple:x}=l.value;if(x)return m("span",{class:`${e.value}-cell-triggers`},[m(He,{checked:r.value,indeterminate:o.value,disabled:i.value,onChange:a},null),y()])}}}),Rl=F({props:$l,setup(e){const{locale:t,mergedPrefixCls:l}=M(A);return()=>{const{activeOrderBy:n,sortable:r}=e,{orders:o,nextTooltip:a}=r,s=a&&Pl(t.table,o,n),c=Ol(l,o,n);return s?m(Et,{title:s},{default:()=>[c]}):c}}});function Pl(e,t,l){const n=l?t[t.indexOf(l)+1]:t[0],{sortCancel:r,sortAsc:o,sortDesc:a}=e;return n?n==="ascend"?o:a:r}function Ol(e,t,l){const n=e.value,r=`${n}-sortable-trigger-active`,o=t.includes("ascend")&&m(be,{name:"caret-up-filled",class:l==="ascend"?r:void 0},null),a=t.includes("descend")&&m(be,{name:"caret-down-filled",class:l==="descend"?r:void 0},null);return m("span",{class:`${n}-sortable-trigger`},[o,a])}const Wl=F({props:xl,setup(e){const{props:t,slots:l,mergedPrefixCls:n,fixedColumnKeys:r,columnOffsetsWithScrollBar:o,isSticky:a,handleSort:s,activeOrderByMap:c,activeFilterByMap:i,mergedRows:d,handleFilter:v}=M(A),h=b(()=>{const{type:f,ellipsis:u}=e.column,S=f||u!=null?u:t.ellipsis;return Je(S)&&S.head===!1?void 0:S}),g=b(()=>{const{type:f,align:u,fixed:S,hasChildren:$,key:w,sortable:E,filterable:K}=e.column,k=n.value;let I={[`${k}-cell`]:!0,[`${k}-cell-${f}`]:!!f,[`${k}-cell-filterable`]:!!K,[`${k}-cell-sortable`]:!!E,[`${k}-cell-align-center`]:$||(u==null?void 0:u.title)==="center",[`${k}-cell-align-end`]:!$&&(u==null?void 0:u.title)==="end",[`${k}-cell-ellipsis`]:!!h.value};if(S){const{lastStartKey:O,firstEndKey:W}=r.value;I={...I,[`${k}-fix-start`]:S==="start",[`${k}-fix-start-last`]:O===w,[`${k}-fix-end`]:S==="end",[`${k}-fix-end-first`]:W===w,[`${k}-fix-sticky`]:a.value}}return ce(I)}),p=b(()=>{var I;const{key:f,fixed:u}=e.column,{offsetIndexMap:S}=d.value;if(!u)return;const{starts:$,ends:w}=o.value,E=Object.values(u==="start"?$:w),K=S[f][u==="start"?"colStart":"colEnd"],k=G((I=E.find(O=>O.index===K))==null?void 0:I.offset);return{position:"sticky",left:u==="start"?k:void 0,right:u==="end"?k:void 0}}),y=b(()=>c[e.column.key]),x=b(()=>i[e.column.key]||Tt),B=f=>{const{key:u,filterable:S}=e.column;v(u,S,f)},C=()=>{const{key:f,sortable:u}=e.column;u&&s(f,u)};return()=>{var W,z,L;const{column:f}=e,{type:u,titleColSpan:S,titleRowSpan:$}=f;if(u==="scroll-bar")return m("th",{class:g.value,style:p.value,colspan:S===1?void 0:S,rowspan:$===1?void 0:$,onClick:C},null);const w=n.value;let E,K;if(u==="selectable")K=m(Il,null,null);else{const{title:ne,customTitle:U,sortable:Z,filterable:re}=f,q=h.value;K=Hl(ne,U,l),E=rt(q,K,ne);const J=zl(Z,y,re,x,B);J.length>0?K=m("span",{class:`${w}-cell-triggers`},[m("span",{class:`${w}-cell-title`},[K]),J]):q&&(K=m("span",{class:`${w}-cell-title`},[K]))}const k=(W=t.customAdditional)==null?void 0:W.headCell,I=k?k({column:f}):void 0,O=(L=(z=t.customTag)==null?void 0:z.headCell)!=null?L:"th";return m(O,ye({class:g.value,style:p.value,colSpan:S===1?void 0:S,rowSpan:$===1?void 0:$,title:E},I,{onClick:C}),{default:()=>[K]})}}});function Hl(e,t,l){let n=e;return ve(t)?n=t({title:e}):j(t)&&l[t]&&(n=l[t]({title:e})),n}function zl(e,t,l,n,r){const o=[];return e&&o.push(m(Rl,{activeOrderBy:t.value,sortable:e},null)),l&&o.push(m(Kl,{activeFilterBy:n.value,filterable:l,onUpdateFilterBy:r},null)),o}function Ml(e){return e.map(t=>bt(t)).filter(Boolean)}function bt(e){if(e.titleColSpan!==0)return m(Wl,{key:e.key,column:e},null)}const Fl=F({props:Sl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:n}=M(A);return()=>{var c,i,d;const{columns:r}=e,o=(c=l.customAdditional)==null?void 0:c.headRow,a=o?o({columns:r}):void 0,s=(d=(i=l.customTag)==null?void 0:i.headRow)!=null?d:"tr";return m(s,ye({class:`${n.value}-row`},a),{default:()=>{var v;return[(v=t.default)==null?void 0:v.call(t)]}})}}});function St(e,t,l){return m(Fl,{columns:e,key:t},{default:()=>[l]})}const Pe=F({setup(e,{slots:t}){const{props:l,mergedRows:n,mergedPrefixCls:r}=M(A);return()=>{var d,v,h;let o;const{rows:a}=n.value,s=(d=l.customAdditional)==null?void 0:d.head,c=s?s({rows:a}):void 0,i=(h=(v=l.customTag)==null?void 0:v.head)!=null?h:"thead";return t.default?o=t.default():o=a.map((g,p)=>{const y=Ml(g);return St(g,p,y)}),m(i,ye({class:`${r.value}-thead`},c),{default:()=>[o]})}}}),Al=F({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e){const{props:t,mergedPrefixCls:l,mergedVirtual:n,mergedVirtualColWidth:r,getVirtualColWidth:o,headerVirtualScrollRef:a,handleScroll:s,scrollHeadRef:c,scrollWidth:i,flattedData:d,flattedColumns:v,fixedColumns:h,mergedRows:g,isSticky:p}=M(A);Ll(c,s);const y=b(()=>i.value==="max-content"),x=b(()=>d.value.length>0),B=b(()=>{const u=l.value;return{[`${u}-fixed-holder`]:!0,[`${u}-sticky-holder`]:p.value}}),C=b(()=>{const u=p.value,{offsetTop:S,offsetBottom:$}=e;return{overflow:"hidden",top:u?G(S):void 0,bottom:u?G($):void 0}}),f=b(()=>n.value.horizontal?g.value.rows.map((u,S)=>({key:S,data:u})):[]);return()=>{const u=x.value||!y.value;if(n.value.horizontal){const S=(I,{renderedData:O})=>{let W=[];if(u){const z=[];O.forEach(L=>{z.push(...L.data)}),W=Fe(z)}return m("table",{style:{tableLayout:"fixed"}},[u&&m(me,{columns:W,isFixedHolder:!0},null),m(Pe,null,{default:()=>[I]})])},$=({item:I,index:O,children:W})=>St(I.data,O,W),w=({item:I})=>bt(I),E=(I,O)=>{const{fixedStartColumns:W,fixedEndColumns:z}=h.value;return at(I,O,v.value,d.value,W,z,!0)},{virtualBufferSize:K,virtualBufferOffset:k}=t;return m("div",{class:B.value,style:C.value},[m(Ze,{ref:a,dataSource:f.value,colModifier:E,getKey:"key",height:0,width:"100%",colWidth:r.value,getColWidth:o,rowRender:$,colRender:w,contentRender:S,virtual:{horizontal:!0,vertical:!1},bufferSize:K,bufferOffset:k},null)])}return m("div",{class:B.value,style:C.value,ref:c},[m("table",{style:{tableLayout:"fixed"}},[u&&m(me,{isFixedHolder:!0},null),m(Pe,null,null)])])}}});function Ll(e,t){const l=o=>{if(!o.shiftKey)return;const a=o.deltaY,s=o.currentTarget;if(a){const c=s.scrollLeft+a;t(o,c)}},n=o=>{pe(o,"wheel",l,{passive:!0})},r=o=>{de(o,"wheel",l)};Be(()=>{V(e,(o,a)=>{r(a),n(o)},{immediate:!0})}),he(()=>r(e.value))}const Nl=F({setup(){const{mergedPrefixCls:e,scrollBodyRef:t,handleScroll:l,mergedSticky:n,stickyScrollLeft:r,setStickyScrollLeft:o}=M(A),a=P(!1),s=P(!1),c=P(0),i=P(0),d=P(0),v=b(()=>{const f=i.value,u=d.value;return u&&f*(f/u)});tt(()=>{const f=le(t);if(f&&a.value){const{clientWidth:u,scrollWidth:S,scrollLeft:$}=f;o($/S*u),i.value=u,d.value=S}});const h=b(()=>({height:Te(),width:i.value,bottom:n.value.offsetScroll})),g=b(()=>{const f=e.value;return{[`${f}-sticky-scrollbar-thumb`]:!0,[`${f}-sticky-scrollbar-thumb-active`]:s.value}}),p=b(()=>({width:`${v.value}px`,transform:`translate3d(${r.value}px, 0, 0)`})),y=()=>s.value=!1,x=f=>{c.value=f.pageX-r.value,s.value=!0,f.preventDefault()},B=f=>{if(!s.value)return;const{buttons:u}=f||window.event;if(u===0){s.value=!1;return}let S=f.pageX-c.value;S<=0&&(S=0);const $=i.value,w=d.value,E=v.value;S+E>=$&&(S=$-E);const K=S/$*(w+2);l(f,K)},C=()=>{const f=le(t),u=Ne(f).top,S=u+f.offsetHeight,{container:$,offsetScroll:w}=n.value,E=$===window?document.documentElement.scrollTop+window.innerHeight:Ne($).top+$.clientHeight;S-Te()<=E||u>=E-w?a.value=!1:a.value=!0};return Be(()=>{pe(document.body,"mouseup",y),pe(document.body,"mousemove",B),pe(window,"resize",C),V(()=>n.value.container,(f,u)=>{de(u,"scroll",C),pe(f,"scroll",C)},{immediate:!0}),C()}),he(()=>{de(document.body,"mouseup",y),de(document.body,"mousemove",B),de(window,"resize",C),de(n.value.container,"scroll",C)}),()=>!t.value||!a.value||d.value<=i.value||!v.value?null:m("div",{class:`${e.value}-sticky-scrollbar`,style:h.value},[m("div",{class:g.value,style:p.value,onMousedown:x},null)])}}),Dl=F({setup(e,{slots:t}){const{mergedPrefixCls:l}=M(A);return()=>{var n;return m("tbody",{class:`${l.value}-tbody`},[(n=t.default)==null?void 0:n.call(t)])}}}),Oe=F({props:{columns:Array,isEmpty:Boolean},setup(e,{slots:t}){const{mergedPrefixCls:l,hasFixed:n,scrollHorizontalOverflowed:r,scrollBarColumn:o}=M(A),{mainTableWidth:a}=M(Ae),s=b(()=>{var c,i;return(i=(c=e.columns)==null?void 0:c.length)!=null?i:1});return()=>{let c=t.default();if(e.isEmpty?r.value:n.value){const i=o.value;c=m("div",{class:`${l.value}-fixed-row`,style:{width:G(a.value-(i?i.width:0)),position:"sticky",left:0,overflow:"hidden"}},[c])}return m("tr",null,[m("td",{colspan:s.value},[c])])}}}),_l=F({props:kl,setup(e){const t=P();return Ie(t,n=>{const{contentRect:{width:r}}=n;e.changeColumnWidth(e.cellKey,r)}),he(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>m("td",{ref:t,style:{padding:0,border:0,height:0}},[m("div",{style:{height:0,overflow:"hidden"}},[_t(" ")])])}}),Vl=F({props:{columns:Array},setup(e){const{mergedPrefixCls:t}=M(A),{changeColumnWidth:l}=M(Ae);return()=>{var r;const n=(r=e.columns)==null?void 0:r.map(o=>{const{key:a}=o;return m(_l,{key:a,cellKey:a,changeColumnWidth:l},null)});return m("tr",{class:`${t.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[n])}}}),jl=F({props:wl,setup(e){const{props:t,slots:l,config:n,mergedPrefixCls:r,mergedEmptyCell:o,activeOrderByMap:a,fixedColumnKeys:s,columnOffsets:c,isSticky:i,isTreeData:d,expandable:v,selectable:h,mergedPagination:g}=M(A),p=M(mt),y=p.props,x=b(()=>a[e.column.key]),B=Ul(p,e),C=b(()=>s.value.lastStartKey===e.column.key),f=b(()=>s.value.firstEndKey===e.column.key),u=b(()=>{const{type:w,ellipsis:E}=e.column;return w||E!=null?E:t.ellipsis}),S=b(()=>{const{fixed:w,align:E,type:K}=e.column,k=r.value;let I={[`${k}-cell`]:!0,[`${k}-cell-sorted`]:!!x.value,[`${k}-cell-align-${E.cell}`]:!!E&&E.cell!="start",[`${k}-cell-ellipsis`]:!!u.value,[`${k}-cell-${K}`]:!!K,[`${k}-cell-last`]:!!e.isLast};return w&&(I={...I,[`${k}-fix-start`]:w==="start",[`${k}-fix-start-last`]:C.value,[`${k}-fix-end`]:w==="end",[`${k}-fix-end-first`]:f.value,[`${k}-fix-sticky`]:i.value}),ce(I)}),$=b(()=>{const{fixed:w}=e.column;if(!w)return;const{starts:E,ends:K}=c.value,I=G((w==="start"?E:K)[e.column.key].offset);return{position:"sticky",left:w==="start"?I:void 0,right:w==="end"?I:void 0}});return()=>{var ne,U,Z;const{column:w}=e,E=r.value,{type:K}=w;let k,I;if(K==="selectable")k=Gl(p,l,h,n,g,E);else if(K==="indexable")k=xt(p,l,w,g,E);else{const re=B.value;if(k=ql(p,e,l,re),I=rt(u.value,k,re),!K&&(fe(k)||k==="")){const q=l.emptyCell||o.value;k=ve(q)?q({column:w,record:y.record,rowIndex:y.rowIndex}):q}}e.column.fixed&&u.value&&(C.value||f.value)&&(k=m("span",{class:`${E}-cell-content`},[k]));const O=(ne=t.customAdditional)==null?void 0:ne.bodyCell,W=O?O({column:w,record:y.record,rowIndex:y.rowIndex}):void 0,z=(Z=(U=t.customTag)==null?void 0:U.bodyCell)!=null?Z:"td",L=K==="expandable"?m("div",{class:`${E}-expandable-wrapper`},[Xl(p,l,v,d,E),!It(k)&&m("span",{class:`${E}-expandable-trigger-gap`},null),k]):k;return m(z,ye({class:S.value,style:$.value,title:I,colSpan:e.colSpan,rowSpan:e.rowSpan},W),{default:()=>[L]})}}});function Ul(e,t){return b(()=>{const{props:{record:l}}=e,{column:n}=t,r=We(n.dataKey);if(r.length<=0)return;let o=l;for(let a=0;a<r.length&&o;a++){const s=r[a];o=o[s]}return o})}function ql(e,t,l,n){const{props:{record:r,rowIndex:o}}=e,{column:a}=t,{customCell:s}=a,c=j(s)?l[s]:s;return c?c({value:n,record:r,rowIndex:o}):n}function Xl(e,t,l,n,r){var K;const{icon:o,customIcon:a,indent:s,showLine:c}=l.value,{props:{record:i,expanded:d,level:v=0,hasPrevSibling:h,hasNextSibling:g,showLineIndentIndexList:p},expandDisabled:y,handleExpend:x}=e,B=v>0,C=n.value&&c&&s;let f;const u=(K=j(a)?t[a]:a)!=null?K:o;ve(u)?f=u({expanded:!!d,record:i}):f=j(u)?m(be,{name:u,rotate:d?90:0},null):u;const S=s?`width: ${G(s)}`:void 0,$={[`${r}-expandable-trigger`]:!0,[`${r}-expandable-trigger-show-line`]:C,[`${r}-expandable-trigger-disabled`]:y.value},w=[];if(s)for(let k=0;k<v;k++)w.push(m("div",{class:{[`${r}-expandable-indent`]:!0,[`${r}-expandable-indent-show-line`]:C&&p.includes(k)},style:S},null));const E=k=>{k.preventDefault(),k.stopImmediatePropagation(),y.value||x()};return[...w,m("span",{class:$,style:S},[m("button",{class:`${r}-expandable-trigger-button`,type:"button",onClick:E},[f]),C&&[m("span",{class:`${r}-expandable-trigger-line-right`},null),(h||B)&&m("span",{class:`${r}-expandable-trigger-line-top`},null),g&&m("span",{class:`${r}-expandable-trigger-line-bottom`},null)]])].filter(Boolean)}function Gl(e,t,l,n,r,o){const{props:{record:a,rowIndex:s},isSelected:c,isIndeterminate:i,selectDisabled:d,isHover:v,handleSelect:h}=e,{showIndex:g,multiple:p,customCell:y}=l.value,x=C=>{C.stopPropagation(),!p&&c.value&&!d.value&&h&&h()};if(!c.value&&!v.value&&g)return xt(e,t,n.columnIndexable,r,o);const B=j(y)?t[y]:y;if(p){const C={checked:c.value,disabled:d.value,indeterminate:i.value,onChange:h,onClick:x};return B?B({...C,record:a,rowIndex:s}):m(He,C,null)}else{const C={checked:c.value,disabled:d.value,onChange:h,onClick:x};return B?B({...C,record:a,rowIndex:s}):m(nt,C,null)}}function xt(e,t,l,n,r){const{props:{record:o,rowIndex:a},selectDisabled:s}=e,{customCell:c}=l,{pageIndex:i=1,pageSize:d=0}=n.value||{},v=j(c)?t[c]:c;if(!v)return;const h=[`${r}-indexable-label`,s.value&&`${r}-indexable-label-disabled`];return m("span",{class:h},[v({record:o,rowIndex:a,pageIndex:i,pageSize:d})])}function Yl(e,t,l){const n=[];return e.forEach((r,o)=>{const a=Ct(r,t,l,o===e.length-1);a&&n.push(a)}),n}function Ct(e,t,l,n){const{colSpan:r,rowSpan:o}=e,a=r==null?void 0:r(t,l),s=o==null?void 0:o(t,l);return a===0||s===0?void 0:m(jl,{colSpan:a===1?void 0:a,rowSpan:s===1?void 0:s,isLast:n,column:e},null)}const Ql=F({props:Cl,setup(e,{slots:t}){const{props:l,mergedPrefixCls:n,expandable:r,handleExpandChange:o,checkExpandDisabled:a,selectable:s,selectedRowKeys:c,indeterminateRowKeys:i,handleSelectChange:d,currentPageRowKeys:v}=M(A),{expandDisabled:h,handleExpend:g,selectDisabled:p,handleSelect:y,isHover:x,attrs:B}=Zl(e,r,a,o,s,d,v),C=b(()=>c.value.includes(e.rowKey)),f=b(()=>i.value.includes(e.rowKey)),u=b(()=>{const S=`${n.value}-row`,{level:$,expanded:w}=e;return ce({[`${S}`]:!0,[`${S}-level-${$}`]:!!$,[`${S}-selected`]:C.value,[`${S}-expanded`]:w})});return ze(mt,{props:e,expandDisabled:h,handleExpend:g,isSelected:C,isIndeterminate:f,selectDisabled:p,handleSelect:y,isHover:x}),()=>{var E,K,k;const S=(E=l.customAdditional)==null?void 0:E.bodyRow,$=S?S({record:e.record,rowIndex:e.rowIndex}):void 0,w=(k=(K=l.customTag)==null?void 0:K.bodyRow)!=null?k:"tr";return m(w,ye({class:u.value},B.value,$),{default:()=>{var I;return[(I=t.default)==null?void 0:I.call(t)]}})}}});function Zl(e,t,l,n,r,o,a){const s=b(()=>l(e.rowData)),c=b(()=>{var u;return(u=t.value)==null?void 0:u.trigger}),i=()=>{const{rowKey:u,record:S}=e;n(u,S)},d=b(()=>a.value.disabledRowKeys.includes(e.rowKey)),v=b(()=>{var u;return(u=r.value)==null?void 0:u.trigger}),h=b(()=>{var u;return(u=r.value)==null?void 0:u.showIndex}),g=P(!1),p=()=>{const{rowKey:u,record:S}=e;o(u,S)},y=()=>{c.value==="click"&&i(),v.value==="click"&&p()},x=()=>{c.value==="dblclick"&&i(),v.value==="dblclick"&&p()},B=()=>g.value=!0,C=()=>g.value=!1,f=b(()=>{const u=s.value,S=c.value,$=d.value,w=v.value,E=!u&&S==="click"||!$&&w==="click",K=!u&&S==="dblclick"||!$&&w==="dblclick",k=!$&&h.value;let I="";return E||K?I="pointer":(u&&S||$&&w)&&(I="not-allowed"),{style:I?`cursor: ${I}`:void 0,onClick:E?y:void 0,onDblclick:K?x:void 0,onMouseenter:k?B:void 0,onMouseleave:k?C:void 0}});return{expandDisabled:s,handleExpend:i,selectDisabled:d,handleSelect:p,isHover:g,attrs:f}}function qe(e,t,l,n,r,o,a){const{children:s,expanded:c,level:i,hasPrevSibling:d,hasNextSibling:v,showLineIndentIndexList:h,record:g,rowKey:p}=e,y={key:p,expanded:c,level:i,hasPrevSibling:d,hasNextSibling:v,showLineIndentIndexList:h,hasChildren:!!(s!=null&&s.length),record:g,rowData:e,rowIndex:l,rowKey:p},x=m(Ql,y,{default:()=>[a]}),B=c&&Jl(y,n,t,r,o);return B?[x,B]:x}function Jl(e,t,l,n,r){const{customExpand:o}=n||{},{record:a,rowIndex:s}=e;let c;return ve(o)?c=o({record:a,rowIndex:s}):j(o)&&t[o]&&(c=t[o]({record:a,rowIndex:s})),c&&m(Oe,{class:`${r}-expanded-row`,columns:l},{default:()=>[c]})}const en=F({setup(){const{props:e,slots:t,expandable:l,mergedPrefixCls:n,mergedInsetShadow:r,mergedVirtual:o,mergedVirtualItemHeight:a,mergedVirtualColWidth:s,mergedAutoHeight:c,columnWidths:i,changeColumnWidth:d,flattedData:v,flattedColumns:h,fixedColumns:g,getVirtualColWidth:p,isSticky:y,mergedSticky:x,virtualScrollRef:B,scrollBodyRef:C,scrollContentRef:f,handleScroll:u,pingedStart:S,pingedEnd:$,scrollWidth:w,scrollHeight:E,scrollHorizontalOverflowed:K,scrollVerticalOverflowed:k,hasFixed:I,tableLayout:O}=M(A),W=P(),z=P(0),L=b(()=>c.value||!!w.value||y.value||o.value.horizontal);ze(Ae,{mainTableWidth:z,changeColumnWidth:(T,H)=>{Ot(W.value)&&d(T,H)}});const U=()=>{const T=le(C);T&&u({currentTarget:T})},Z=T=>{const{offsetWidth:H}=T.target;H!==z.value&&(z.value=H)};Be(()=>{U(),V([()=>e.dataSource,w],([,H])=>{H&&U()}),V(i,et(()=>{var N;((N=le(C))==null?void 0:N.scrollLeft)===0&&U()},16)),Rt(W.value,Z)}),he(()=>Pt(W.value,Z));const re=b(()=>{const T=n.value;return ce({[`${T}-container`]:!0,[`${T}-ping-start`]:S.value,[`${T}-ping-end`]:$.value,[`${T}-fixed-layout`]:O.value==="fixed",[`${T}-fixed-column`]:I.value,[`${T}-inset-shadow`]:r.value,[`${T}-scroll-horizontal`]:K.value,[`${T}-scroll-vertical`]:k.value})}),q=b(()=>{var se;const T=E.value,H=o.value.horizontal?"hidden":"auto",N=o.value.vertical?"hidden":"auto",D=(se=e.scroll)==null?void 0:se.fullHeight;return{overflowX:H,overflowY:N,[D?"height":"maxHeight"]:T}}),J=b(()=>({tableLayout:O.value,width:w.value,minWidth:w.value?"100%":void 0})),$e=(T,H,N)=>{_(e.onScrolledChange,T,H,N.map(D=>D.record))},Ke=b(()=>!o.value.vertical&&!o.value.horizontal?[]:v.value.map(T=>({...T,data:h.value}))),R=T=>{if(!(!L.value||!T))return m(Vl,{columns:T},null)},oe=T=>{if(t.alert)return m(Oe,{class:`${n.value}-alert-row`,columns:T},{default:()=>[t.alert()]})},Y=T=>{if(!(v.value.length>0))return m(Oe,{class:`${n.value}-empty-row`,columns:T,isEmpty:!0},{default:()=>[m(Wt,{empty:e.empty},t)]})},ee=(T,H,N)=>{let D;if(N)D=N;else if(H!=null&&H.length){const se=[];H.forEach((xe,Ce)=>{const Ee=Yl(T!=null?T:[],xe,Ce);se.push(...We(qe(xe,T,Ce,t,l.value,n.value,Ee)))}),D=se}return m(Dl,null,{default:()=>[oe(T),R(T),Y(T),D]})},ae=()=>ee(h.value,v.value),Se=(T,H)=>ee(T,void 0,H);return()=>{const T=n.value,H=c.value,N=o.value,D=t.default?t.default():[];if(H||E.value||y.value||N.horizontal){const{offsetTop:se}=x.value;if(e.headless||D.push(m(Al,{offsetTop:se},null)),N.vertical&&(e.scroll||H)||!N.vertical&&N.horizontal){const xe=({item:X,index:Q,children:te})=>qe(X,X.data,Q,t,l.value,T,te),Ce=({row:X,item:Q,index:te,rowIndex:ue})=>Ct(Q,X,ue,te),Ee=(X,{renderedData:Q})=>{var ue;const te=v.value.length?(ue=Q[0])==null?void 0:ue.data:h.value;return m("table",{ref:f,class:`${T}-table`,style:J.value},[te?m(me,{columns:te},null):void 0,Se(te,X),!1])},kt=(X,Q)=>{const{fixedStartColumns:te,fixedEndColumns:ue}=g.value;return at(X,Q,h.value,v.value,te,ue,!1)},{scroll:ie,onScrolledBottom:Bt}=e;D.push(m(Ze,{ref:B,class:`${T}-body-virtual-scroll`,dataSource:Ke.value,colModifier:kt,fullHeight:ie==null?void 0:ie.fullHeight,getKey:X=>{var Q;return(Q=X.rowKey)!=null?Q:X.key},height:c.value?"100%":ie==null?void 0:ie.height,width:"100%",rowHeight:a.value,colWidth:s.value,getColWidth:p,rowRender:xe,colRender:Ce,contentRender:Ee,virtual:o.value,scrollMode:e.virtualScrollMode,bufferSize:e.virtualBufferSize,bufferOffset:e.virtualBufferOffset,onScroll:u,onScrolledBottom:Bt,onScrolledChange:$e},null))}else D.push(m("div",{ref:C,class:`${T}-content`,style:q.value,onScroll:u},[m("table",{ref:f,class:`${T}-table`,style:J.value},[m(me,null,null),ae(),!1])]));y.value&&D.push(m(Nl,null,null))}else D.push(m("div",{ref:C,class:`${T}-content`,style:q.value,onScroll:u},[m("table",{ref:f,class:`${T}-table`,style:J.value},[m(me,null,null),!e.headless&&m(Pe,null,null),ae(),!1])]));return m("div",{ref:W,class:re.value},[D])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function tn(e,t){return e.footer?m("div",{class:`${t}-footer`},[e.footer()]):null}function ln(e,t,l,n){var a,s;let r=null,o=null;if(t!==null){const{position:c}=t,[i,d]=Vt(c).split("-"),v=`${n}-pagination ${n}-pagination-${d}`,h=(s=(a=e.pagination)==null?void 0:a.call(e,{total:l.length,...t}))!=null?s:m(Ut,ye({class:v,total:l.length},t),null);r=i==="top"?h:null,o=i==="bottom"?h:null}return[r,o]}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function wt(e,t){const{getGreyColors:l}=t,n=l(),{fontSizeSm:r,heightMd:o,paddingSizeSm:a,paddingSizeMd:s,paddingSizeLg:c,colorTextTitleSecondary:i,colorEmphasizedContainerBg:d,colorBorder:v,colorIconInfo:h,colorPrimary:g,colorContainerBg:p,colorContainerBgHover:y,colorInfoContainerBg:x}=e;return{fontSizeSm:r,fontSizeMd:r,fontSizeLg:r,headRowHeightSm:o,headRowHeightMd:o,headRowHeightLg:o,cellPaddingHorizontalSm:a,cellPaddingHorizontalMd:s,cellPaddingHorizontalLg:c,cellPaddingVerticalSm:6,cellPaddingVerticalMd:10,cellPaddingVerticalLg:18,headColor:i,headBgColor:d,headSeparatorColor:v,headIconColor:h,headIconColorActive:g,headIconBgColorHover:l().l30,insetShadowStart:`inset 10px 0 8px -8px ${De(n.d50,.12)}`,insetShadowEnd:`inset -10px 0 8px -8px ${De(n.d50,.12)}`,bodyRowBgColorHover:y,bodyRowBgColorSelected:p,bodyRowBgColorExpanded:x,bodyRowBgColorTreeExpanded:x,bodyCellVerticalAlign:"middle",expandableIconColor:h}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function nn(e,t){const{getGreyColors:l}=t,n=l();return{...wt(e,t),insetShadowStart:`inset 10px 0 8px -8px ${n.l50}`,insetShadowEnd:`inset -10px 0 8px -8px ${n.l50}`}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const on=(e,t,l)=>t==="default"?wt(e,l):nn(e,l),rn={sm:32,md:40,lg:56},an=150,sn=F({name:"IxTable",props:bl,setup(e,{expose:t,slots:l}){const n=we("common"),{globalHashId:r,hashId:o,registerToken:a}=Ht("table");a(on);const s=b(()=>`${n.prefixCls}-table`),c=we("locale"),i=we("table"),d=b(()=>{var R;return(R=e.autoHeight)!=null?R:i.autoHeight}),v=b(()=>{var R;return(R=e.childrenKey)!=null?R:i.childrenKey}),h=zt(e,i),g=b(()=>{var R;return(R=e.emptyCell)!=null?R:i.emptyCell}),p=b(()=>{var R;return(R=e.insetShadow)!=null?R:i.insetShadow}),y=b(()=>{var R;return(R=e.size)!=null?R:i.size}),x=b(()=>({horizontal:e.virtualHorizontal,vertical:e.virtual})),B=b(()=>{var R;return(R=e.virtualItemHeight)!=null?R:rn[y.value]}),C=b(()=>{var R;return(R=e.virtualColWidth)!=null?R:an}),{mergedPagination:f}=ol(e,i,y),u=pl(e),S=rl(e,u),$=Xt(e,l,i,S.scrollBarSizeOnFixedHolder),w=gl($.flattedColumns),E=nl($.flattedColumns),K=ll(e,$.flattedColumns),k=ml(e,$,S,u.isSticky,x,d),{columnWidthMap:I,flattedColumns:O}=$,{activeSorters:W}=w,{activeFilters:z}=E,L=new Map,ne=()=>{L.clear(),O.value.forEach(R=>{L.set(R.key,R)})};V(O,()=>{ne()},{immediate:!0});const U=tl(e,v,h,W,z,K.expandedRowKeys,f),Z=dl(e,c,$.flattedColumns,U);cl(e,i,f,W,z,S.scrollTo);const q={props:e,slots:l,config:i,locale:c,mergedPrefixCls:s,mergedEmptyCell:g,mergedInsetShadow:p,mergedVirtual:x,mergedVirtualItemHeight:B,mergedVirtualColWidth:C,mergedAutoHeight:d,getVirtualColWidth:(R,oe)=>{var Y,ee;return(ee=I.value[oe])!=null?ee:(Y=L.get(oe))==null?void 0:Y.width},...$,...S,...w,...E,...u,tableLayout:k,mergedPagination:f,...K,...U,...Z};ze(A,q),t({scrollTo:S.scrollTo});const{flattedData:J,filteredData:$e}=U,Ke=b(()=>{const R=s.value,{borderless:oe=i.borderless,scroll:Y}=e;return ce({[r.value]:!!r.value,[o.value]:!!o.value,[R]:!0,[`${R}-auto-height`]:d.value,[`${R}-borderless`]:oe,[`${R}-empty`]:J.value.length===0,[`${R}-full-height`]:Y==null?void 0:Y.fullHeight,[`${R}-${y.value}`]:!0})});return()=>{const R=s.value,oe=m(Mt,{header:e.header},l),Y=tn(l,R),ee=[oe];let ae=[m(en,null,null),Y].filter(Boolean);if(J.value.length>0){const[T,H]=ln(l,f.value,$e.value,R);ae=[T,...ae,H].filter(Boolean)}const Se=cn(e.spin);return Se?ee.push(m(Ft,Se,{default:()=>[ae]})):ee.push(...ae),m("div",{class:Ke.value},[ee])}}});function cn(e){return jt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const hn=sn,yn=Me;export{hn as I,yn as a,qt as g,bl as t};
