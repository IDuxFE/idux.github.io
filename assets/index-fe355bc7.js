import{a8 as le,i as D,ac as ae,an as re,u as J,aa as ve,l as ye,C as he,ao as ge,a7 as pe,ap as me,E as xe,aq as Se,ar as Ce,p as be,q as Ke,G as Ie,H as Ee,as as Le,at as Ae}from"./index-42aa140a.js";import{e as d,k as N,b as oe,a as we,t as Fe,v as H,i as Q,z as Y,y as A,a2 as q,w as se,p as Oe}from"./vendor-6c4e542b.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function $e(e){return d(()=>{const{disableData:t}=e;return a=>a.disabled||(t?t(a):!1)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ne(e,t){const[a,l]=le(void 0),r=d(()=>{const n=a.value;return n!==void 0?t.value.get(n):void 0});return{activeKey:a,activeData:r,setActiveKey:l}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Be(e,t,a,l,r){const n=d(()=>ce(e,t.value,a.value,l.value,r.value,e.dataSource)),o=d(()=>{const u=new Map;return Z(u,n.value),u});return{mergedData:n,mergedDataMap:o}}function ce(e,t,a,l,r,n,o,u){const{loadChildren:v,separator:p}=e;return n.map(i=>ue(i,t,a,l,p,r,!!v,o,u))}function ue(e,t,a,l,r,n,o,u,v){const p=t(e),i=n&&!N(v)?`${v}${r}${e[l]}`:e[l],f=e[a],m=f==null?void 0:f.map(x=>ue(x,t,a,l,r,n,o,p,i));return{children:m,key:p,isLeaf:e.isLeaf??!(m!=null&&m.length||o),label:i,parentKey:u,rawData:e}}function Z(e,t){t.forEach(a=>{const{key:l,children:r}=a;e.set(l,a),r&&Z(e,r)})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Me(e,t,a){if(a){const l=[],r=e.value;t.forEach(n=>{const o=r.get(n);o&&l.push(o.rawData)}),D(a,t,l)}}function ee(e,t,a){if(!e||!e.children)return[];const l=[];return e.children.forEach(r=>{const{key:n,rawData:o}=r;(!t||!a(o))&&(l.push(n),l.push(...ee(r,t,a)))}),l}function V(e,t,a,l){const r=[];for(;t&&!N(t.parentKey);){const{parentKey:n,rawData:o}=t;!a||!l(o)?(r.unshift(n),t=e.get(n)):t=void 0}return r}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Pe(e,t,a,l,r,n,o,u){const v=s=>{if(N(s))return[];const c=o.value,K=c.get(s);return V(c,K,!1,a.value)},[p,i]=ae(e,"expandedKeys",()=>v(u.value[0])),[f,m]=ae(e,"loadedKeys",()=>[]),x=oe([]),S=async s=>{const{loadChildren:c}=e;if(x.value.includes(s))return;const y=o.value.get(s);if(y&&(!y.children||y.children.length===0)){if(!c||f.value.includes(s))return;x.value.push(s);const h=y.rawData,C=await c(h);x.value.splice(x.value.indexOf(s),1);const O=o.value;if(C.length){const $=l.value,w=ce(e,t.value,$,r.value,n.value,C,s,y.label);Z(O,w),y.rawData[$]=C,y.children=w;const F=[...f.value,s];m(F),D(e.onLoaded,F,h)}else return}const g=p.value.indexOf(s)>=0;if(!g){const h=o.value,C=V(h,h.get(s),!1,a.value);C.push(s),E(C,!g,y.rawData)}},E=(s,c,K)=>{i(s);const{onExpand:y,onExpandedChange:L}=e;D(y,c,K),Me(o,s,L)};return{expandedKeys:p,setExpandedKeys:i,handleExpand:S,loadingKeys:x}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function De(e,t,a,l,r,n){const o=Re(e,l),u=d(()=>e.multiple||e.strategy==="off"),v=d(()=>{const i=r.value,f=o.value;if(!i||!f)return re;const m=u.value,x=n.value,S=new Set;return t.value.forEach(E=>de(S,E,f,i,m,x)),[...S]});return{searchedData:d(()=>{const i=a.value;return v.value.map(f=>i.get(f)).filter(Boolean)})}}function Re(e,t){return d(()=>{const a=e.searchFn;return we(a)?a:a?Ve(t.value):!1})}function Ve(e){return(t,a)=>{const l=t[e];return l?l.toLowerCase().includes(a.toLowerCase()):!1}}function de(e,t,a,l,r,n){const{key:o,rawData:u}=t;e.has(o)||n(u)||(a(u,l)?((r||t.isLeaf)&&e.add(o),ie(e,t,r,n)):t.children&&t.children.forEach(v=>de(e,v,a,l,r,n)))}function ie(e,t,a,l){!t||!t.children||t.children.forEach(r=>{e.has(r.key)||l(r.rawData)||((a||r.isLeaf)&&e.add(r.key),ie(e,r,a,l))})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _e(e,t,a,l,r){const n=J("locale"),o=d(()=>{const s=ve(t.value);if(!l.value)return s;if(!e.multiple){const c=s[s.length-1];return N(c)?[]:[c]}return s.map(c=>c[c.length-1]).filter(c=>!N(c))}),u=d(()=>o.value.length>=e.multipleLimit),v=d(()=>u.value?n.select.limitMessage.replace("${0}",`${e.multipleLimit}`):""),p=d(()=>{const s=a.value;return o.value.map(c=>s.get(c)).filter(Boolean)}),i=d(()=>e.multiple&&e.strategy!=="off"),f=d(()=>i.value?ke(a.value,o.value,r.value):o.value),m=d(()=>{if(!i.value)return re;const s=new Set,c=f.value,K=a.value,y=r.value;return c.forEach(L=>{let g=K.get(L);for(;g&&!N(g.parentKey);){const h=g.parentKey,C=K.get(h);C&&!y(C.rawData)&&!c.includes(h)&&s.add(h),g=C}}),[...s]}),x=s=>{let c;if(!l.value)c=e.multiple?s:s[0];else{const y=r.value;if(e.multiple){const L=a.value;c=s.map(g=>{const h=V(L,L.get(g),!0,y);return h.push(g),h})}else{const L=s[0],g=a.value;c=V(g,g.get(L),!0,y),c.push(L)}}const K=Fe(t.value);c!==K&&(t.setValue(c),D(e.onChange,c,K))};return{selectedKeys:o,selectedLimit:u,selectedLimitTitle:v,selectedData:p,selectedWithStrategyKeys:f,indeterminateKeys:m,handleSelect:s=>{const{multiple:c}=e,K=f.value,L=K.indexOf(s)>-1;if(!c){!L&&x([s]);return}const g=a.value,h=g.get(s),C=i.value,O=r.value,$=C?ee(h,!0,O):[],w=new Set(K);L||$.length>0&&$.every(F=>w.has(F)||m.value.includes(F))?(w.delete(s),C&&(V(g,h,!0,O).forEach(F=>w.delete(F)),$.forEach(F=>w.delete(F)))):(w.add(s),C&&(fe(g,h,w,O),$.forEach(F=>w.add(F)))),x([...Te(g,w,e.strategy)])},handleClear:s=>{s.stopPropagation(),x([]),D(e.onClear,s)}}}function ke(e,t,a){const l=new Set(t);let r;return t.forEach(n=>{const o=e.get(n);if(!o)return;const{parentKey:u}=o;ee(o,!0,a).forEach(p=>l.add(p)),u&&r!==u&&(fe(e,o,l,a),r=u)}),[...l]}function fe(e,t,a,l){let r=!0;for(;r&&t&&!N(t.parentKey);){const n=t.parentKey,o=e.get(n);o&&!l(t.rawData)&&(r=o.children.every(u=>l(u.rawData)||a.has(u.key)),r&&a.add(t.parentKey)),t=o}}function Te(e,t,a){if(a==="parent"){const l=new Set;return t.forEach(r=>{const n=e.get(r);if(n){const{key:o,parentKey:u}=n;(!u||!t.has(u))&&l.add(o)}}),l}if(a==="child"){const l=new Set;return t.forEach(r=>{const n=e.get(r);n&&n.isLeaf&&l.add(n.key)}),l}return t}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const U=Symbol("cascaderToken"),ze=H({props:{children:{type:Array,default:void 0},index:{type:Number,required:!0},isLeaf:{type:Boolean,required:!0},label:{type:String,required:!0},parentKey:{type:[String,Number,Symbol],default:void 0},rawData:{type:Object,required:!0}},setup(e){const t=ye(),{props:a,slots:l,mergedPrefixCls:r,mergedExpandIcon:n,mergedGetDisabled:o,mergedLabelKey:u,inputValue:v,activeKey:p,setActiveKey:i,expandedKeys:f,setExpandedKeys:m,setOverlayOpened:x,loadingKeys:S,selectedWithStrategyKeys:E,selectedLimit:s,selectedLimitTitle:c,indeterminateKeys:K,handleSelect:y,handleExpand:L}=Q(U),g=d(()=>t===p.value),h=d(()=>o.value(e.rawData)),C=d(()=>f.value.includes(t)),O=d(()=>S.value.includes(t)),$=d(()=>E.value.includes(t)),w=d(()=>K.value.includes(t)),F=d(()=>{const b=`${r.value}-option`;return Y({[b]:!0,[`${b}-leaf`]:e.isLeaf,[`${b}-active`]:g.value,[`${b}-disabled`]:h.value,[`${b}-expanded`]:C.value,[`${b}-loading`]:O.value,[`${b}-selected`]:$.value})}),_=()=>{if(e.isLeaf){if(!$.value&&s.value)return;y(t),x(!1),N(e.parentKey)&&m([])}else a.strategy==="off"&&y(t),a.expandTrigger==="click"&&L(t)},B=b=>{b.stopPropagation(),y(t)},G=()=>{i(t),!e.isLeaf&&a.expandTrigger==="hover"&&L(t)};return()=>{const{rawData:b,label:k}=e,{multiple:j}=a,M=h.value,P=$.value,R=`${r.value}-option`,T=v.value,z=T?k:b[u.value],W=!(M||P)&&c.value||z,I=a.customAdditional?a.customAdditional({data:b,index:e.index}):void 0;return A("div",q({class:F.value,title:W,onClick:M?void 0:_,onMouseenter:M?void 0:G,"aria-label":k,"aria-selected":P},I),[j&&A(he,{checked:P,disabled:M||!P&&s.value,indeterminate:w.value,onClick:B},null),A("span",{key:"__label",class:`${R}-label`},[qe(l.optionLabel,z,b,T,R)]),!e.isLeaf&&A("span",{key:"__expand-icon",class:`${R}-expand-icon`},[ge(l.expandIcon,O.value?"loading":n.value,{key:t,expanded:C.value,data:b})])])}}});function qe(e,t,a,l,r){if(e)return e({label:t,data:a,searchValue:l});if(t&&l){const n=t.toUpperCase().indexOf(l.toUpperCase());if(n>-1){const o=n+l.length,u=t.substring(0,n),v=t.substring(o),p=A("span",{class:`${r}-label-highlight`},[t.substring(n,o)]);return[u,p,v]}}return t}const ne=H({props:{dataSource:{type:Array,required:!0}},setup(e){const{props:t,slots:a,mergedPrefixCls:l}=Q(U),r=d(()=>{const n=`${l.value}-option-group`;return Y({[n]:!0,[`${n}-empty`]:e.dataSource.length===0})});return()=>{const{dataSource:n}=e;let o;if(n.length>0){const{overlayHeight:u,overlayItemHeight:v,virtual:p}=t;o=A(pe,{dataSource:n,getKey:"key",height:u,itemHeight:v,itemRender:({item:f,index:m})=>A(ze,q({index:m},f),null),virtual:p},null)}else o=A(me,{empty:t.empty},a);return A("div",{class:r.value},[o])}}}),He=H({setup(){const{props:e,mergedPrefixCls:t,mergedClearIcon:a,mergedData:l,mergedDataMap:r,searchedData:n,expandedKeys:o,inputValue:u,setInputValue:v,updateOverlay:p}=Q(U),i=Symbol(),f=d(()=>{const S=[{key:i,dataSource:l.value}],E=r.value;return o.value.forEach(s=>{const c=E.get(s);c&&c.children&&S.push({key:s,dataSource:c.children})}),S});se([()=>f.value.length,u],()=>{p()});const m=S=>{const{value:E}=S.target;v(E),e.searchable&&D(e.onSearch,E)},x=()=>v("");return()=>{const{overlayRender:S}=e,E=u.value,s=t.value,c=[];e.searchable==="overlay"&&c.push(A("div",{key:"__search-wrapper",class:`${s}-overlay-search-wrapper`},[A(xe,{clearable:!0,clearIcon:a.value,clearVisible:!!E,size:"sm",suffix:"search",value:E,onClear:x,onInput:m},null)]));const K=E?A(ne,{dataSource:n.value},null):f.value.map(y=>A(ne,y,null));return c.push(A("div",{key:"__content",class:`${s}-overlay-content`},[K])),A("div",null,[S?S(c):c])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Ue={control:{type:[String,Number,Object],default:void 0},value:{type:null,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},open:{type:Boolean,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},disableData:{type:Function},empty:{type:[String,Object],default:"simple"},expandIcon:{type:String,default:void 0},expandTrigger:{type:String,default:"click"},fullPath:{type:Boolean,default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:Number.MAX_SAFE_INTEGER},overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},separator:{type:String,default:"/"},size:{type:String,default:void 0},status:String,strategy:{type:String,default:"all"},suffix:{type:String,default:void 0},virtual:{type:Boolean,default:!1},"onUpdate:value":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],"onUpdate:open":[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onSearch:[Function,Array],overlayHeight:{type:Number,default:256},overlayItemHeight:{type:Number,default:32}},Ge=[0,4],je=H({name:"IxCascader",inheritAttrs:!1,props:Ue,setup(e,{attrs:t,expose:a,slots:l}){const r=J("common"),n=J("cascader"),o=d(()=>`${r.prefixCls}-cascader`),u=d(()=>e.childrenKey??n.childrenKey),v=d(()=>e.clearIcon??n.clearIcon),p=d(()=>e.expandIcon??n.expandIcon),i=d(()=>e.fullPath??n.fullPath),f=Se(e,n),m=$e(e),x=d(()=>e.labelKey??n.labelKey),S=oe(),[E,s]=le(""),c=()=>{var I;return(I=S.value)==null?void 0:I.focus()},K=()=>{var I;return(I=S.value)==null?void 0:I.blur()},y=()=>{var I;e.searchable==="overlay"?s(""):(I=S.value)==null||I.clearInput()};a({focus:c,blur:K});const{overlayRef:L,updateOverlay:g,overlayOpened:h,setOverlayOpened:C}=Ce(e,n,S),{accessor:O,control:$}=be();Ke($);const w=Ie(e,n),F=Ee(e,$),{mergedData:_,mergedDataMap:B}=Be(e,f,u,x,i),G=Ne(e,B),b=_e(e,O,B,i,m),{searchedData:k}=De(e,_,B,x,E,m),j=Pe(e,f,m,u,x,i,B,b.selectedKeys);se(h,I=>{I&&c(),y()});const M=()=>{e.searchable!=="overlay"&&c()},P=()=>O.markAsBlurred(),R=I=>{c(),b.handleSelect(I)};Oe(U,{props:e,slots:l,config:n,mergedPrefixCls:o,mergedChildrenKey:u,mergedClearIcon:v,mergedExpandIcon:p,mergedFullPath:i,mergedGetKey:f,mergedGetDisabled:m,mergedLabelKey:x,accessor:O,inputValue:E,setInputValue:s,overlayOpened:h,setOverlayOpened:C,updateOverlay:g,mergedData:_,mergedDataMap:B,...G,...b,searchedData:k,...j});const T=d(()=>{const{overlayClassName:I,multiple:X}=e,te=o.value;return Y({[`${te}-overlay`]:!0,[`${te}-overlay-multiple`]:X,[I||""]:!!I})}),z=()=>A(Ae,q({ref:S,className:o.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:n,dataSource:b.selectedData.value,disabled:O.disabled,maxLabel:e.maxLabel,multiple:e.multiple,opened:h.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:w.value,status:F.value,suffix:e.suffix,value:b.selectedKeys.value,onBlur:P,onClear:b.handleClear,onInputValueChange:s,onItemRemove:R,onOpenedChange:C,onResize:g,onSearch:e.onSearch},t),l),W=()=>A(He,{onClick:M},null);return()=>{const I={class:T.value,clickOutside:!0,container:e.overlayContainer??n.overlayContainer,containerFallback:`.${o.value}-overlay-container`,disabled:O.disabled||e.readonly,offset:Ge,placement:"bottomStart",transitionName:`${r.prefixCls}-slide-auto`,trigger:"manual",triggerId:t.id,visible:h.value,"onUpdate:visible":C},X={default:z,content:W};return A(Le,q({ref:L},I),X)}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Je=je;export{Je as I};
