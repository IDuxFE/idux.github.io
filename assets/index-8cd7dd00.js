import{b0 as me,t as P,av as ge,q as ie,ag as Ce,j as ye,c as be,aV as ve,m as B,p as X,k as pe,ar as ce,v as oe,W as J,n as ke,C as xe,by as Se,o as Te,T as we,aD as Ie,ax as ze,I as De}from"./index-974a2c75.js";import{t as Re,g as Ke,T as Ve,I as Pe}from"./index-e5132b83.js";import{u as Q}from"./globalConfig-9f3f17c9.js";import{I as Fe}from"./index-fbdf5bf2.js";import{I as $e}from"./index-39ed6b87.js";import{m as E,z as A,c as k,v as h,q as ne,w as U,f as O,y as Y,r as te,A as Ae,E as Ee,a7 as Le,b as Be}from"./vendor-e200cecb.js";import{u as He,a as We}from"./index-5d3ef957.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const H=Symbol("proTableToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function _e(e,n){const{title:l,type:t}=e;return l||(t?n.layout[t]:"")}const Z=E({props:{columns:{type:Array,required:!0},checkedKeys:{type:Array,required:!0},searchValue:{type:String,default:void 0},title:{type:String,default:void 0},onDrop:{type:Function,required:!0},onFixedChange:{type:Function,required:!0},onVisibleChange:{type:Function,required:!0}},setup(e){const{locale:n,mergedPrefixCls:l}=A(H),t=k(()=>new Set(me(e.columns,"children",s=>s.key,!0))),o=s=>{const u=new Set(s),c=new Set(e.checkedKeys.filter(d=>t.value.has(d)));s.forEach(d=>{c.has(d)&&(u.delete(d),c.delete(d))}),e.onVisibleChange(u,c)},r=s=>{const{dragNode:u,dropNode:c}=s,d=u==null?void 0:u.key,x=c==null?void 0:c.key;!d||!x||e.onDrop(s)},i=(s,u,c)=>{c.preventDefault(),c.stopImmediatePropagation(),e.onFixedChange(u,s)};return()=>{if(e.columns.length===0)return;const s=`${l.value}-layout-tool-tree`,{columns:u,searchValue:c,title:d}=e,{startPin:x,endPin:S,noPin:f}=n.table.layout,v={blocked:!0,cascaderStrategy:"child",checkable:!0,checkedKeys:e.checkedKeys,checkOnClick:!0,draggable:!0,dataSource:u,disabled:Oe,empty:"",childrenKey:"children",getKey:"key",labelKey:"title",searchValue:c,searchFn:()=>!0,onCheckedChange:o,onDrop:r},z={label:({node:m})=>_e(m,n.table),suffix:({node:m})=>{if(m.changeFixed===!1||m.parentKey!=null)return null;const{fixed:T}=m;return T==="start"?[h(P,{name:"vertical-align-center",title:f,onClick:C=>i(void 0,m,C)},null),h(P,{name:"vertical-align-top",rotate:180,title:S,onClick:C=>i("end",m,C)},null)]:T==="end"?[h(P,{name:"vertical-align-top",title:x,onClick:C=>i("start",m,C)},null),h(P,{name:"vertical-align-center",title:f,onClick:C=>i(void 0,m,C)},null)]:[h(P,{name:"vertical-align-top",title:x,onClick:C=>i("start",m,C)},null),h(P,{name:"vertical-align-top",rotate:180,title:S,onClick:C=>i("end",m,C)},null)]}};return h("div",{class:s},[d&&h("div",{class:`${s}-title`},[d]),h($e,v,z)])}}});function Oe(e){const{changeIndex:n,changeVisible:l}=e;return n!==!1&&l!==!1?!1:{check:l===!1,select:l===!1,drag:n===!1}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Me={...Re,columns:{type:Array,default:()=>[]},layoutTool:{type:[Boolean,Object],default:!0},toolbar:{type:Array,default:void 0},dndSortable:{type:[Boolean,Object]},columnDndSortable:{type:[Boolean,Object]},onColumnsChange:[Function,Array],onDndSortReorder:[Function,Array],onDndSortChange:[Function,Array]},qe={changeSize:{type:Boolean,default:void 0},className:{type:String,default:void 0},placeholder:{type:String,default:void 0},resetable:{type:Boolean,default:void 0},searchable:{type:Boolean,default:void 0},searchValue:{type:String,default:void 0},visible:{type:Boolean,default:void 0},"onUpdate:searchValue":[Function,Array],"onUpdate:visible":[Function,Array],onReset:[Function,Array]},Ne={placeholder:{type:String,default:void 0},resetable:{type:Boolean,required:!0},searchable:{type:Boolean,required:!0},searchValue:{type:String,default:void 0},"onUpdate:searchValue":[Function,Array],onReset:[Function,Array]};var q=function(e){return e[e.start=0]="start",e[e.center=1]="center",e[e.end=2]="end",e}(q||{});const Ge=E({props:Ne,setup(e){const{locale:n,mergedPrefixCls:l,mergedColumns:t,checkedColumnKeys:o,setMergedColumns:r,mergedColumnMap:i,resetColumns:s}=A(H),u=k(()=>t.value.length!==i.value.size),c=k(()=>t.value.filter(a=>a.visible===!1)),[d,x]=ge(e,"searchValue"),S=k(()=>{var g;const a=(g=d.value)==null?void 0:g.toLowerCase();return ie(t.value,"children",y=>{if(y.layoutable===!1)return!1;if(!a)return!0;const{title:b}=y;return b?b.toLowerCase().includes(a):!1})}),f=k(()=>ee(S.value)),v=a=>{const g=a.target.value;x(g)},z=a=>{B(e.onReset,a)!==!1&&s()},m=a=>{const g=X(t.value,"children",(y,b)=>{var w;const p={...y};return!((w=y.children)!=null&&w.length)&&y.changeVisible!==!1&&y.layoutable!==!1&&b.every(I=>I.layoutable!==!1)&&(p.visible=a),p});r(g)},T=(a,g)=>{const y=X(t.value,"children",(I,F)=>{const R={...I};return(I.key===a.key||F.some($=>$.key===a.key))&&(R.fixed=g),R}),{startColumns:b,centerColumns:p,endColumns:w}=ee(y);r([...b,...p,...w])},C=(a,g)=>{const y=X(t.value,"children",b=>{const p={...b};return a.has(b.key)&&(p.visible=!0),g.has(b.key)&&(p.visible=!1),p});r(y)},D=(a,g)=>{const{dragNode:y,dropNode:b,dropType:p}=g,w=y==null?void 0:y.key,I=b==null?void 0:b.key;if(!w||!I)return;const{startColumns:F,centerColumns:R,endColumns:$}=ee(t.value),W=[F,R,$].reduce((L,K,V)=>V===a?L.concat(Ue(K,w,I,p)):L.concat(K),[]);r(W)};return()=>{var re;const{startColumns:a,centerColumns:g,endColumns:y}=f.value,b=a.length>0,p=y.length>0,w=b||p,I=`${l.value}-layout-tool`,F=ne({[`${I}-content`]:!0,[`${I}-with-fixed`]:w,[`${I}-with-children`]:u.value}),{placeholder:R,all:$,reset:W,startPinTitle:L,noPinTitle:K,endPinTitle:V}=n.table.layout,ae=t.value.length,j=c.value.length,fe=j===0&&ae!==0,he=j>0&&j!==ae,M=d.value;return h("div",{class:F},[e.searchable&&h("div",{class:`${I}-search-wrapper`},[h(Ce,{placeholder:(re=e.placeholder)!=null?re:R,size:"sm",suffix:"search",value:M,onInput:v},null)]),h("div",{class:`${I}-select-wrapper`},[h(ye,{checked:fe,indeterminate:he,label:$,onChange:m},null),e.resetable&&h(be,{size:"sm",mode:"link",onClick:z},{default:()=>[W]})]),S.value.length?h("div",{class:`${I}-tree-wrapper`},[b&&h(Z,{key:"start",columns:a,checkedKeys:o.value.start,searchValue:M,title:L,onDrop:_=>D(q.start,_),onFixedChange:T,onVisibleChange:C},null),(!w||g.length>0)&&h(Z,{key:"center",columns:g,checkedKeys:o.value.center,searchValue:M,title:w?K:void 0,onDrop:_=>D(q.center,_),onFixedChange:T,onVisibleChange:C},null),p&&h(Z,{key:"end",columns:y,checkedKeys:o.value.end,searchValue:M,title:V,onDrop:_=>D(q.end,_),onFixedChange:T,onVisibleChange:C},null)]):h(ve,{simple:!0},null)])}}});function ee(e){const n=[],l=[],t=[];return e.forEach(o=>{const{fixed:r}=o;r==="start"?n.push(o):r==="end"?l.push(o):t.push(o)}),{startColumns:n,endColumns:l,centerColumns:t}}function Ue(e,n,l,t){const o=[...e];let r;if(N(o,n,(i,s,u)=>{r=i,u.splice(s,1)}),t==="inside")N(o,l,i=>{i.children.unshift(r)});else{let i,s=[];N(o,l,(u,c,d)=>{i=c,s=d}),t==="before"?s.splice(i,0,r):s.splice(i+1,0,r)}return o}function N(e,n,l){for(let t=0;t<e.length;t++){const o=e[t];if(o.key===n)return l(o,t,e);"children"in o&&o.children&&N(o.children,n,l)}}const je=[0,4],Xe={sm:"grid-compact",md:"grid-medium",lg:"grid-loose"},de=E({name:"IxProTableLayoutTool",props:qe,setup(e,{slots:n}){const{config:l,locale:t,mergedPrefixCls:o,mergedSize:r,setMergedSize:i}=A(H),s=k(()=>{var d;return(d=e.changeSize)!=null?d:l.layoutTool.changeSize}),u=k(()=>{var d;return(d=e.resetable)!=null?d:l.layoutTool.resetable}),c=k(()=>{var d;return(d=e.searchable)!=null?d:l.layoutTool.searchable});return()=>{var m;const d=`${o.value}-layout-tool`,x=t.table.layout,S=T=>{const C=Xe[T],D=x[T];return h(P,{key:C,class:ne([`${d}-header-icon`,r.value===T?`${d}-header-icon-active`:""]),name:C,title:D,onClick:()=>i(T)},null)},f=s.value?h(pe,null,{default:()=>[S("sm"),S("md"),S("lg")]}):void 0,v={placeholder:e.placeholder,resetable:u.value,searchable:c.value,searchValue:e.searchValue,"onUpdate:searchValue":e["onUpdate:searchValue"],onReset:e.onReset},z={class:ne([d,e.className]),header:{title:x.title,suffix:f},offset:je,placement:"bottomEnd",showArrow:!1,trigger:"click",visible:e.visible,"onUpdate:visible":e["onUpdate:visible"]};return h(Fe,z,{default:(m=n.default)!=null?m:()=>h("span",{class:`${d}-trigger`},[h(P,{name:"ellipsis"},null)]),content:()=>h(Ge,v,null)})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Je(e,n,l,t,o){const r=k(()=>e.columns),[i,s]=ce(G(t.value,r.value,n,l,o.value)),u=k(()=>{const f=new Map,v={start:[],center:[],end:[]},z=ie(i.value,"children",(m,T)=>{var D;const C=m.key;return f.set(C,m),m.visible===!1||T.some(a=>a.visible===!1)?!1:(!((D=m.children)!=null&&D.length)&&m.layoutable!==!1&&T.every(a=>a.layoutable!==!1)&&(ue("start",m,T)?v.start.push(C):ue("end",m,T)?v.end.push(C):v.center.push(C)),!0)},"and");return{map:f,checkedKeys:v,displayColumns:z}}),c=k(()=>u.value.map),d=k(()=>u.value.checkedKeys),x=k(()=>u.value.displayColumns);return U(r,f=>s(G(t.value,f,n,l,o.value))),U(i,f=>{const v=Ye(f,r.value,o.value);B(e.onColumnsChange,v)}),{checkedColumnKeys:d,mergedColumns:i,setMergedColumns:s,mergedColumnMap:c,displayColumns:x,resetColumns:()=>s(G(t.value,r.value,n,l,o.value))}}const le="__idux-pro-table-dnd-handle__";function se(e,n,l,t){const{key:o,customCell:r,...i}=t,s=O(r)?n[r]:r;return{key:o,width:40,customCell:u=>s?Y(oe,{class:`${e}-dnd-sortable-drag-handle`},()=>s(u)):Y(oe,{class:`${e}-dnd-sortable-drag-handle`},()=>Y(P,{name:l})),...i,visible:!0,align:{cell:"center"},changeVisible:!1}}function Qe(e,n,l,t){if(!t)return l;const{dragHandleColumn:o,dragHandleIcon:r}=t;if(o===!1)return l;const i=o===!0?le:o,s=l.findIndex(c=>c.key===i);return s<0?[se(e,n,r,{key:le}),...l]:([...l].splice(s,1,se(e,n,r,l[s])),l)}function Ye(e,n,l){if(!l)return e;const{dragHandleColumn:t}=l;if(t===!1)return e;const o=t===!0?le:t,r=e.findIndex(u=>u.key===o),i=n.findIndex(u=>u.key===o),s=[...e];return s.splice(r,1,n[i]),s}function G(e,n,l,t,o,r){return Qe(e,t,n.map(i=>Ze(e,i,l,t,o,r)),o)}function Ze(e,n,l,t,o,r){var c;const i=Ke(n),u={...n.type==="indexable"?l.columnIndexable:void 0,...n,key:i,parentKey:r};return(c=n.children)!=null&&c.length&&(u.children=G(e,n.children,l,t,o,i)),u}function ue(e,n,l){return n.fixed===e||l.some(t=>t.fixed===e)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function en({mergedColumns:e,setMergedColumns:n,mergedColumnMap:l}){return{hasResizable:k(()=>e.value.some(r=>r.resizable)),onResizeEnd:(r,i,s)=>{const u=l.value.get(r);if(!u)return;const c=u.width,d=O(c)?J(c.replace("px","")):c;if(!d)u.width=i;else{const x=i-s,S=Math.floor(d*i/x*1e3)/1e3,{minWidth:f,maxWidth:v}=u,z=O(f)?J(f.replace("px","")):f,m=O(v)?J(v.replace("px",""),Number.MAX_SAFE_INTEGER):v;z&&S<z?u.width=z:m&&S>m?u.width=m:u.width=S}n([...e.value])}}}const nn=E({props:["column","onClick","onResizeEnd"],setup(e,{slots:n}){const l=te(),t=c=>{B(e.onResizeEnd,e.column.key,c.width,c.offsetWidth)},o=Ae({maxWidth:e.column.maxWidth,minWidth:e.column.minWidth,onResizeEnd:t}),{resizing:r,position:i}=He(l,o),s=te(!r.value);U(r,c=>{c?s.value=!1:setTimeout(()=>s.value=!0)});const u=c=>{s.value&&B(e.onClick,c)};return()=>{var d,x;if(!e.column.resizable)return h("th",{onClick:u},[(d=n.default)==null?void 0:d.call(n)]);const c=[h(We,{placement:"end"},null)];if(r.value){const{width:S,height:f}=i.value;c.push(h("div",{class:"cdk-resizable-preview",style:`width:${S}px;height:${f}px`},null))}return h("th",{ref:l,onClick:u},[(x=n.default)==null?void 0:x.call(n),c])}}}),tn=E({inheritAttrs:!1,setup(e,{slots:n}){const{props:l,mergedDndSortable:t,mergedGetKey:o}=A(H),{isCheckDisabled:r,scrollBodyRef:i}=A(Ve),s=k(()=>{if(!t.value)return!1;const{canDrag:f}=t.value;return f!=null?f:({sourceKey:v})=>!r(v)}),u=k(()=>{var f;return t.value?(f=t.value.canDrop)!=null?f:!0:!1}),c=k(()=>{var f;return t.value?(f=t.value.isSticky)!=null?f:!0:!1}),d=k(()=>{if(!(!t.value||!t.value.autoScroll))return i.value});ke(d,{canScroll:!0,allowedAxis:"vertical"});const x=f=>{B(l.onDndSortReorder,f)},S=(f,v)=>{B(l.onDndSortChange,f,v)};return()=>h(xe,{tag:"tbody",dataSource:l.dataSource,getKey:o.value,canDrag:s.value,canDrop:u.value,isSticky:c.value,effect:"none",onSortReorder:x,onSortChange:S},{default:()=>{var f;return[(f=n.default)==null?void 0:f.call(n)]}})}}),ln=E({props:{itemKey:{type:[String,Number,Symbol],required:!0}},setup(e,{slots:n}){const{draggingOverState:l}=A(Se),{mergedPrefixCls:t}=A(H),o=k(()=>{var s;const r=l.value,i=(s=r==null?void 0:r.instruction)==null?void 0:s.edge;if(!(!i||r.key!==e.itemKey))return`${t.value}-row-dragging-over-${i}`});return()=>h(Te,{class:o.value,itemKey:e.itemKey,tag:"tr"},{default:()=>{var r;return[(r=n.default)==null?void 0:r.call(n)]}})}}),an=E({name:"IxProTable",props:Me,setup(e,{slots:n,expose:l}){const t=Q("common"),o=Q("table"),r=we("table"),i=Q("locale"),s=k(()=>`${t.prefixCls}-table`),u=k(()=>{if(!e.dndSortable)return!1;const{autoScroll:a,canDrag:g,canDrop:y,dragHandleColumn:b,dragHandleIcon:p,isSticky:w}=e.dndSortable===!0?{}:e.dndSortable;return{autoScroll:a!=null?a:!0,dragHandleColumn:b!=null?b:!0,dragHandleIcon:p!=null?p:"holder",isSticky:w!=null?w:!0,canDrag:g,canDrop:y}}),c=Ie(e,r),d=Je(e,o,n,s,u),{hasResizable:x,onResizeEnd:S}=en(d),f=k(()=>{var a;return(a=e.size)!=null?a:r.size}),[v,z]=ce(f.value);U(f,z),Ee(H,{props:e,config:o,locale:i,mergedPrefixCls:s,mergedSize:v,mergedDndSortable:u,mergedGetKey:c,setMergedSize:z,...d});const m=te();l({scrollTo:a=>{var g;return(g=m.value)==null?void 0:g.scrollTo(a)}});const T=()=>{const{layoutTool:a}=e;if(!a)return null;const g=Be(a)?a:void 0;return h(de,g,null)},C=()=>{const{toolbar:a}=e;if(a)return a.length<=1?a:h(De,{align:"center",gap:8},{default:()=>[a]})},D=()=>{var y;if(n.header)return n.header();const{header:a,toolbar:g}=e;if(a||g||n.toolbar){const b={suffix:(y=n.toolbar)!=null?y:C},p=O(a)?{title:a}:a;return h(ze,p,b)}};return()=>{const{customAdditional:a,customTag:g,layoutTool:y,toolbar:b,tableLayout:p,dndSortable:w,columnDndSortable:I,...F}=e,R=x.value,$=p||(R?"fixed":void 0),W={...a,headCell:({column:K})=>{const V=a!=null&&a.headCell?a.headCell({column:K}):void 0;return R?{...V,column:K,onResizeEnd:S}:V},bodyRow:K=>{const V=a!=null&&a.bodyRow?a.bodyRow(K):void 0;return u.value?{...V,itemKey:c.value(K.record)}:V}},L={headCell:R?nn:void 0,body:u.value?tn:void 0,bodyRow:u.value?ln:void 0,...g};return h(Pe,Le({ref:m},F,{class:s.value,columns:d.displayColumns.value,customAdditional:W,customTag:L,size:v.value,tableLayout:$}),{...n,header:D,default:T})}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const hn=an,mn=de;export{hn as I,mn as a};
