import{ag as N,l as q,w as $,u as h,aS as G,aT as H,a2 as J,aU as Q,j as P}from"./index.3f21dce0.js";import{e as i,b as k,P as X,a6 as S,z as x,y as c,v as R,$ as O,x as Y,A as _,w as U,E as ee,a0 as te}from"./vendor.0e7da6ec.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const E=10,I=1,T=0,ae=.2,oe=90;function ne(e,a,t,n,o,s,l){const r=()=>e("next"),f=()=>e("previous"),g=()=>a("left"),m=()=>a("right"),v=()=>t("out"),d=()=>t("in"),w=()=>n(!1);return i(()=>[{key:"goPrevious",icon:"left",opr:f,disabled:s.value.previous,visible:l.value},{key:"goNext",icon:"right",opr:r,disabled:s.value.next,visible:l.value},{key:"rotateLeft",icon:"rotate-left",opr:g,visible:!0},{key:"rotateRight",icon:"rotate-right",opr:m,visible:!0},{key:"zoomOut",icon:"zoom-out",opr:v,disabled:o.value.out,visible:!0},{key:"zoomIn",icon:"zoom-in",opr:d,disabled:o.value.in,visible:!0},{key:"close",icon:"close",opr:w,visible:!0}])}function se(e){const a=k(I),t=k(T),n={left:-1,right:1},o={in:1,out:-1},s=i(()=>{const[v,d]=e.value;return v>I?v:d<I?d:I});X(()=>a.value=s.value);const l=i(()=>{const[v,d]=e.value;return{in:a.value>=d,out:a.value<=v}}),r=i(()=>({transform:`scale(${a.value}) rotate(${t.value}deg)`})),f=S((v="left",d=oe)=>{t.value=t.value+d*n[v]},E),g=S((v,d=ae)=>{l.value[v]||(a.value=a.value+d*o[v])},E);return{transformStyle:r,scaleDisabled:l,rotateHandle:f,scaleHandle:g,resetTransform:()=>{a.value=s.value,t.value=T}}}function le(e,a){const[t,n]=N(e,"activeIndex",0),o=i(()=>({previous:!a.value&&t.value===0,next:!a.value&&t.value===e.images.length-1})),s=i(()=>e.images.length>1),l=S((r="next")=>{if(r==="next"){if(o.value.next||o.value.previous)return;n(t.value>=e.images.length-1?0:t.value+1);return}n(t.value<=0?e.images.length-1:t.value-1)},E);return{activeIndex:t,switchDisabled:o,switchVisible:s,goHandle:l}}const re=e=>{const{disabled:a,icon:t,prefixCls:n,opr:o}=e,s=q(),l=i(()=>x({[`${n}-opr-item`]:!0,[`${n}-opr-item-disabled`]:a}));return c($,{class:l.value,name:t,onClick:o,key:s},null)};/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ie={visible:{type:Boolean,default:void 0},activeIndex:Number,container:{type:[String,HTMLElement,Function],default:void 0},images:{type:Array,default:()=>[]},zoom:{type:Array,validator:e=>e.length===2},loop:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},zIndex:Number,"onUpdate:visible":[Function,Array],"onUpdate:activeIndex":[Function,Array]},ue={src:{type:String,required:!0},preview:{type:Boolean,default:void 0},imageViewer:Object,onLoad:[Function,Array],onError:[Function,Array]},D=Q?"DOMMouseScroll":"mousewheel",B=R({name:"IxImageViewer",props:ie,setup(e){const a=h("common"),t=h("imageViewer"),n=i(()=>`${a.prefixCls}-image-viewer`),o=G(e,t,a,n),[s,l]=N(e,"visible",!1),{currentZIndex:r}=H(O(e,"zIndex"),O(a,"overlayZIndex"),s),f=i(()=>{var u;return(u=e.zoom)!=null?u:t.zoom}),g=i(()=>{var u;return(u=e.loop)!=null?u:t.loop}),m=i(()=>{var u;return(u=e.maskClosable)!=null?u:t.maskClosable}),{transformStyle:v,scaleDisabled:d,rotateHandle:w,scaleHandle:p,resetTransform:C}=se(f),{activeIndex:y,switchDisabled:z,switchVisible:L,goHandle:b}=le(e,g),K=()=>m.value&&l(!1),M=ne(b,w,p,l,d,z,L),{onWheelScroll:A,onKeydown:F}=ce(s,l,p,b);Y(()=>{window.addEventListener(D,A,{passive:!1,capture:!1}),window.addEventListener("keydown",F,!1)}),_(()=>{window.removeEventListener(D,A),window.removeEventListener("keydown",F)}),U([s,y],([u])=>{u&&C()});const Z=i(()=>`z-index: ${r.value}`);return()=>{const u=n.value,j=e.images[y.value];return c(J,{target:o.value,load:s.value},{default:()=>[c(ee,{name:`${a.prefixCls}-zoom-big-fast`,appear:!0},{default:()=>[s.value&&c("div",{class:u,style:Z.value},[c("div",{class:`${u}-opr`},[M.value.filter(V=>V.visible).map(V=>{const W={...V,prefixCls:u};return c(re,W,null)})]),c("div",{class:`${u}-preview`,onClick:K},[c("img",{class:`${u}-preview-img`,src:j,style:v.value},null)])])]})]})}}});function ce(e,a,t,n){const o=r=>{var m;if(!e.value)return;const f=r;f.preventDefault(),((m=f.wheelDelta)!=null?m:-f.detail)>0?t("in",.2):t("out",.2)},s={ArrowUp:()=>t("in",.2),ArrowDown:()=>t("out",.2),ArrowLeft:()=>n("previous"),ArrowRight:()=>n("next"),Escape:()=>a(!1)};return{onWheelScroll:o,onKeydown:r=>{!e.value||(r.preventDefault(),r.code in s&&s[r.code]())}}}const ve=R({name:"IxImage",inheritAttrs:!1,props:ue,setup(e,{attrs:a,slots:t}){const{class:n,style:o,...s}=a,l=h("common"),r=i(()=>`${l.prefixCls}-image`),f=h("image"),g=pe(e,f),{status:m,setFailed:v,setLoaded:d}=be(e),[w,p]=ge(),{outerClasses:C,overLayerClasses:y,imageClasses:z}=we(r,n,m,g);return()=>{var b;const L={visible:w.value,"onUpdate:visible":p,images:[e.src],...(b=e.imageViewer)!=null?b:{}};return c("div",{class:C.value,style:o},[c("div",{class:y.value},[de(e,t,r,m,g,p),me(t,r,m),fe(t,r,m),c(B,L,null)]),c("img",te(s,{src:e.src,class:z.value,onLoad:d,onError:v}),null)])}}});function de(e,a,t,n,o,s){var l,r;return n.value==="loaded"&&o.value&&c("span",{class:`${t.value}-preview-wrapper`,onClick:()=>s(!0)},[(r=(l=a.previewIcon)==null?void 0:l.call(a))!=null?r:c($,{class:`${t.value}-preview-icon`,name:"zoom-in"},null)])}function me(e,a,t){var n,o;return t.value==="loading"&&((o=(n=e.placeholder)==null?void 0:n.call(e))!=null?o:c($,{class:`${a.value}-placeholder`,name:"loading"},null))}function fe(e,a,t){var n,o;return t.value==="failed"&&((o=(n=e.fallback)==null?void 0:n.call(e))!=null?o:c($,{class:`${a.value}-fallback`,name:"file-image"},null))}function ge(){const e=k(!1);return[e,t=>{e.value=t}]}function we(e,a,t,n){const o=i(()=>x([e.value,a,`${e.value}-${t.value}`,{[`${e.value}-preview`]:n.value}])),s=i(()=>x(`${e.value}-layer`)),l=i(()=>x([`${e.value}-inner`,{[`${e.value}-inner-hidden`]:t.value!=="loaded"}]));return{outerClasses:o,overLayerClasses:s,imageClasses:l}}function pe(e,a){return i(()=>{var t;return(t=e.preview)!=null?t:a.preview})}function be(e){const a=k("loading"),t=o=>{a.value="loaded",P(e.onLoad,o)},n=o=>{a.value="failed",P(e.onError,o)};return U(()=>e.src,()=>{a.value="loading"},{immediate:!0}),{status:a,setLoaded:t,setFailed:n}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const xe=ve,he=B;export{xe as I,he as a};
