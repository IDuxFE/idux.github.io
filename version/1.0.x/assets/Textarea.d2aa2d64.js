import{a3 as Y,a9 as q,u as M,w as K}from"./index.3f21dce0.js";import{i as Q,u as Z}from"./Input.f887570c.js";import{e as m,M as W,x as O,w as S,ai as R,a3 as ee,J as te,h as ne,L as k,v as oe,y as w,a0 as ie,z as D}from"./vendor.0e7da6ec.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function G(e){const{boxSizing:t,paddingBottom:l,paddingTop:o,borderBottom:s,borderTop:u}=window.getComputedStyle(e),n=parseFloat(o),r=parseFloat(l),c=parseFloat(u),d=parseFloat(s);return{boxSizing:t,paddingSize:n+r,borderSize:c+d,paddingTop:n,paddingBottom:r,borderTop:c,borderBottom:d}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const L={height:"0","min-height":"0","max-height":"none",visibility:"hidden",overflow:"hidden",transition:"none"};function P(e,t,l=!0){let o;const s=e;s.__cdk_measure_textarea?o=s.__cdk_measure_textarea:(o=e.cloneNode(!1),l&&(s.__cdk_measure_textarea=o)),Object.keys(L).forEach(n=>{o.style.setProperty(n,L[n],"important")}),e.parentNode.appendChild(o);const u=t(o);return e.parentNode.removeChild(o),u}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function se(e){return m(()=>ae(e.value))}function ae(e){return!e||!e.parentNode?0:P(e,t=>{const l=t.rows,{paddingSize:o}=G(t);t.rows=1,t.value="x";const s=t.scrollHeight-o;return t.rows=l,s},!1)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const N=e=>ne(e)&&(k(e.minRows)||k(e.maxRows));function le(e,t){let l,o,s,u=!1,n,r;const c=m(()=>N(t.value)||ee(t.value)&&!!t.value),d=m(()=>N(t.value)?t.value.minRows:void 0),p=m(()=>N(t.value)?t.value.maxRows:void 0),v=se(e),b=m(()=>e.value?G(e.value):{paddingSize:0,borderSize:0,boxSizing:""});function T(){return P(e.value,a=>(a.value=e.value.value,j(a.scrollHeight,b.value)))}function _(){return!e.value||!e.value.placeholder?0:(r||P(e.value,i=>{i.style.height="",i.value=i.placeholder,r=j(i.scrollHeight,b.value)}),r)}function y(a=!1){if(!c.value||!v.value)return;const i=e.value,f=i.value;if(!a&&d.value===o&&f===l)return;i.style.lineHeight=`${v.value}px`;const x=Math.max(T(),_());i.style.height=`${x}px`,n=n!=null?n:i.style.overflow,i.style.overflow="hidden",te(()=>q(()=>{I(i),i.style.overflow=n!=null?n:"",n=void 0})),l=f,o=d.value}function $(){if(!e.value)return;const a=d.value&&v.value?d.value*v.value:null,i=a?`${V(a,b.value)}px`:"";e.value.style.maxHeight=i}function B(){if(!e.value)return;const a=p.value&&v.value?p.value*v.value:null,i=a?`${V(a,b.value)}px`:"";e.value.style.maxHeight=i}function I(a){const{selectionStart:i,selectionEnd:f}=a;u&&document.activeElement===a&&a.setSelectionRange(i,f)}function F(){s!==void 0&&e.value&&(e.value.style.height=s)}let z;const E=W(()=>{r=void 0,y(!0)},16);return O(()=>{const a=[S(e,()=>{e.value&&(s=e.value.style.height)},{immediate:!0}),S(t,()=>{c.value?y(!0):F()},{immediate:!0}),S(d,()=>{$()},{immediate:!0}),S(p,()=>{B()},{immediate:!0})],i=Y(e,E);z=()=>{a.forEach(f=>f()),i()},u=!0}),R(()=>{z==null||z(),u=!1}),{resizeToFitContent:y,lineHeight:v,boxSizingData:b}}function j(e,t){const{borderSize:l,paddingSize:o,boxSizing:s}=t;return s==="border-box"?e+l:e-o}function V(e,t){const{borderSize:l,paddingSize:o,boxSizing:s}=t;return s==="border-box"?e+l+o:e+o}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ue={...Q,autoRows:{type:[Boolean,Object],default:void 0},computeCount:{type:Function,default:void 0},maxCount:{type:[Number,String],default:void 0},resize:{type:String,default:void 0},showCount:{type:Boolean,default:void 0}},me=oe({name:"IxTextarea",inheritAttrs:!1,props:ue,setup(e,{slots:t,expose:l,attrs:o}){const s=M("common"),u=m(()=>`${s.prefixCls}-textarea`),n=M("textarea"),{elementRef:r,accessor:c,mergedSize:d,mergedStatus:p,clearable:v,clearIcon:b,clearVisible:T,isFocused:_,isComposing:y,focus:$,blur:B,handleInput:I,handleCompositionStart:F,handleCompositionEnd:z,handleClear:E,syncValue:a}=Z(e,n);l({focus:$,blur:B});const i=m(()=>{const{showCount:h=n.showCount}=e,C=p.value,g=u.value,H={[g]:!0,[`${g}-${d.value}`]:!0,[`${g}-${C}`]:!!C,[`${g}-clearable`]:v.value,[`${g}-disabled`]:c.disabled,[`${g}-focused`]:_.value,[`${g}-with-count`]:h};return D([H,o.class])}),f=re(e,n,c),x=m(()=>{var h;return(h=e.autoRows)!=null?h:n.autoRows}),J=m(()=>{var C;const h=(C=e.resize)!=null?C:n.resize;return x.value?h==="horizontal"?"horizontal":"none":h}),U=m(()=>({resize:J.value})),{resizeToFitContent:A}=le(r,x);O(()=>{a(),S(()=>c.value,A,{immediate:!0})});const X=h=>{I(h),y.value&&A()};return()=>{const{class:h,style:C,...g}=o,H=u.value;return w("span",{class:i.value,style:C,"data-count":f.value},[w("textarea",ie(g,{ref:r,class:`${H}-inner`,style:U.value,disabled:c.disabled,readonly:e.readonly,onInput:X,onCompositionstart:F,onCompositionend:z}),null),v.value&&w("span",{class:D([`${H}-clear`,T.value?"visible":""]),onClick:E},[t.clearIcon?t.clearIcon():w(K,{name:b.value},null)])])}}});function re(e,t,l){return m(()=>{var r,c,d,p;const o=(r=e.showCount)!=null?r:t.showCount,s=(c=e.computeCount)!=null?c:t.computeCount,u=(d=e.maxCount)!=null?d:t.maxCount;let n="";if(o){const v=(p=l.value)!=null?p:"";n=v.length,s?n=s(v):u&&(n+=" / "+u)}return n})}export{me as T,P as m,le as u};
