import{al as D,a6 as q,A as k,L as x,aQ as G,aR as H,C as J,aS as Q,m as P}from"./index-7e609792.js";import{f as i,b as h,P as X,a7 as V,z as I,y as u,v as R,a1 as O,x as Y,N as _,w as B,J as ee,a2 as te}from"./vendor-50817465.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const S=10,b=1,N=0,ae=.2,oe=90;function ne(e,a,t,o,n,s,l){const r=()=>e("next"),d=()=>e("previous"),m=()=>a("left"),f=()=>a("right"),c=()=>t("out"),v=()=>t("in"),w=()=>o(!1);return i(()=>[{key:"goPrevious",icon:"left",opr:d,disabled:s.value.previous,visible:l.value},{key:"goNext",icon:"right",opr:r,disabled:s.value.next,visible:l.value},{key:"rotateLeft",icon:"rotate-left",opr:m,visible:!0},{key:"rotateRight",icon:"rotate-right",opr:f,visible:!0},{key:"zoomOut",icon:"zoom-out",opr:c,disabled:n.value.out,visible:!0},{key:"zoomIn",icon:"zoom-in",opr:v,disabled:n.value.in,visible:!0},{key:"close",icon:"close",opr:w,visible:!0}])}function se(e){const a=h(b),t=h(N),o={left:-1,right:1},n={in:1,out:-1},s=i(()=>{const[c,v]=e.value;return c>b?c:v<b?v:b});X(()=>a.value=s.value);const l=i(()=>{const[c,v]=e.value;return{in:a.value>=v,out:a.value<=c}}),r=i(()=>({transform:`scale(${a.value}) rotate(${t.value}deg)`})),d=V((c="left",v=oe)=>{t.value=t.value+v*o[c]},S),m=V((c,v=ae)=>{l.value[c]||(a.value=a.value+v*n[c])},S);return{transformStyle:r,scaleDisabled:l,rotateHandle:d,scaleHandle:m,resetTransform:()=>{a.value=s.value,t.value=N}}}function le(e,a){const[t,o]=D(e,"activeIndex",0),n=i(()=>({previous:!a.value&&t.value===0,next:!a.value&&t.value===e.images.length-1})),s=i(()=>e.images.length>1),l=V((r="next")=>{if(r==="next"){if(n.value.next||n.value.previous)return;o(t.value>=e.images.length-1?0:t.value+1);return}o(t.value<=0?e.images.length-1:t.value-1)},S);return{activeIndex:t,switchDisabled:n,switchVisible:s,goHandle:l}}const re=e=>{const{disabled:a,icon:t,prefixCls:o,opr:n}=e,s=q(),l=i(()=>I({[`${o}-opr-item`]:!0,[`${o}-opr-item-disabled`]:a}));return u(k,{class:l.value,name:t,onClick:n,key:s},null)},ie=re;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const ue={visible:{type:Boolean,default:void 0},activeIndex:Number,container:{type:[String,HTMLElement,Function],default:void 0},images:{type:Array,default:()=>[]},zoom:{type:Array,validator:e=>e.length===2},loop:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},zIndex:Number,"onUpdate:visible":[Function,Array],"onUpdate:activeIndex":[Function,Array]},ce={src:{type:String,required:!0},preview:{type:Boolean,default:void 0},imageViewer:Object,onLoad:[Function,Array],onError:[Function,Array]},T=Q?"DOMMouseScroll":"mousewheel",U=R({name:"IxImageViewer",props:ue,setup(e){const a=x("common"),t=x("imageViewer"),o=i(()=>`${a.prefixCls}-image-viewer`),n=G(e,t,a,o),[s,l]=D(e,"visible",!1),r=H(O(e,"zIndex"),O(a,"overlayZIndex"),s),d=i(()=>e.zoom??t.zoom),m=i(()=>e.loop??t.loop),f=i(()=>e.maskClosable??t.maskClosable),{transformStyle:c,scaleDisabled:v,rotateHandle:w,scaleHandle:p,resetTransform:C}=se(d),{activeIndex:y,switchDisabled:$,switchVisible:z,goHandle:E}=le(e,m),K=()=>f.value&&l(!1),M=ne(E,w,p,l,v,$,z),{onWheelScroll:A,onKeydown:F}=ve(s,l,p,E);Y(()=>{window.addEventListener(T,A,{passive:!1,capture:!1}),window.addEventListener("keydown",F,!1)}),_(()=>{window.removeEventListener(T,A),window.removeEventListener("keydown",F)}),B([s,y],([g])=>{g&&C()});const Z=i(()=>`z-index: ${r.value}`);return()=>{const g=o.value,W=e.images[y.value];return u(J,{target:n.value,load:s.value},{default:()=>[u(ee,{name:`${a.prefixCls}-zoom`,appear:!0},{default:()=>[s.value&&u("div",{class:g,style:Z.value},[u("div",{class:`${g}-opr`},[M.value.filter(L=>L.visible).map(L=>{const j={...L,prefixCls:g};return u(ie,j,null)})]),u("div",{class:`${g}-preview`,onClick:K},[u("img",{class:`${g}-preview-img`,src:W,style:c.value},null)])])]})]})}}});function ve(e,a,t,o){const n=r=>{if(!e.value)return;const d=r;d.preventDefault(),(d.wheelDelta??-d.detail)>0?t("in",.2):t("out",.2)},s={ArrowUp:()=>t("in",.2),ArrowDown:()=>t("out",.2),ArrowLeft:()=>o("previous"),ArrowRight:()=>o("next"),Escape:()=>a(!1)};return{onWheelScroll:n,onKeydown:r=>{e.value&&(r.preventDefault(),r.code in s&&s[r.code]())}}}const de=R({name:"IxImage",inheritAttrs:!1,props:ce,setup(e,{attrs:a,slots:t}){const{class:o,style:n,...s}=a,l=x("common"),r=i(()=>`${l.prefixCls}-image`),d=x("image"),m=ye(e,d),{status:f,setFailed:c,setLoaded:v}=be(e),[w,p]=we(),{outerClasses:C,overLayerClasses:y,imageClasses:$}=pe(r,o,f,m);return()=>{const z={visible:w.value,"onUpdate:visible":p,images:[e.src],...e.imageViewer??{}};return u("div",{class:C.value,style:n},[u("div",{class:y.value},[me(e,t,r,f,m,p),fe(t,r,f),ge(t,r,f),u(U,z,null)]),u("img",te(s,{src:e.src,class:$.value,onLoad:v,onError:c}),null)])}}});function me(e,a,t,o,n,s){var l;return o.value==="loaded"&&n.value&&u("span",{class:`${t.value}-preview-wrapper`,onClick:()=>s(!0)},[((l=a.previewIcon)==null?void 0:l.call(a))??u(k,{class:`${t.value}-preview-icon`,name:"zoom-in"},null)])}function fe(e,a,t){var o;return t.value==="loading"&&(((o=e.placeholder)==null?void 0:o.call(e))??u(k,{class:`${a.value}-placeholder`,name:"loading"},null))}function ge(e,a,t){var o;return t.value==="failed"&&(((o=e.fallback)==null?void 0:o.call(e))??u(k,{class:`${a.value}-fallback`,name:"file-image"},null))}function we(){const e=h(!1);return[e,t=>{e.value=t}]}function pe(e,a,t,o){const n=i(()=>I([e.value,a,`${e.value}-${t.value}`,{[`${e.value}-preview`]:o.value}])),s=i(()=>I(`${e.value}-layer`)),l=i(()=>I([`${e.value}-inner`,{[`${e.value}-inner-hidden`]:t.value!=="loaded"}]));return{outerClasses:n,overLayerClasses:s,imageClasses:l}}function ye(e,a){return i(()=>e.preview??a.preview)}function be(e){const a=h("loading"),t=n=>{a.value="loaded",P(e.onLoad,n)},o=n=>{a.value="failed",P(e.onError,n)};return B(()=>e.src,()=>{a.value="loading"},{immediate:!0}),{status:a,setLoaded:t,setFailed:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const he=de,ke=U;export{he as I,ke as a};
