import{a9 as Ae,i as x,ab as oe,aN as Ie,c as Fe,Éµ as ke,u as Y,aq as Ne,ar as Ke,a7 as De,p as Be,q as Le,E as Ee,G as Me,as as Re,at as Ve,au as Oe}from"./index-5a6244f3.js";import{e as S,au as ne,t as Te,v as re,i as Pe,b as Z,y as F,a as ze,w as we,p as Ge,a2 as te,z as Ue}from"./vendor-8302379e.js";import{I as $e}from"./index-42c28885.js";function je(e,a,n,s){return{mergedNodeMap:S(()=>{const u=new Map,c=ce(e,e.dataSource,a.value,n.value,s.value);return ee(c,u),u})}}function ce(e,a,n,s,y,u){const{treeDisabled:c,loadChildren:d}=e;return a.map(A=>de(A,n,s,y,c,!!d,u))}function de(e,a,n,s,y,u,c){const d=n(e),{check:A,drag:i,drop:f,select:p}=qe(e,y),h=e[a],B=e[s],g=h==null?void 0:h.map(b=>de(b,a,n,s,y,u,d));return{children:g,label:B,key:d,isLeaf:e.isLeaf??!(g!=null&&g.length||u),parentKey:c,rawData:e,checkDisabled:A,dragDisabled:i,dropDisabled:f,selectDisabled:p}}function qe(e,a){const n=e.disabled;if(ne(n))return{check:n,drag:n,drop:n,select:n};{let{drag:s,drop:y,select:u}=n??{},c;if(a){const d=a(e);ne(d)?(c??(c=d),s??(s=d),y??(y=d),u??(u=d)):(s??(s=d.drag),y??(y=d.drop),u??(u=d.select),c??(c=d.select))}return{check:c,drag:s,drop:y,select:u}}}function ee(e,a){e.forEach(n=>{const{key:s,children:y}=n;a.set(s,n),y&&ee(y,a)})}function He(e,a,n){const s=S(()=>Ae(a.value)),y=S(()=>{const i=n.value;return s.value.map(f=>i.get(f)).filter(Boolean)}),u=i=>{const f=e.multiple?i:i[0],p=Te(a.value);f!==p&&(a.setValue(f),x(e.onChange,f,p))};return{selectedValue:s,selectedNodes:y,changeSelected:i=>{!e.multiple&&!i.length||u(i)},handleRemove:i=>{u(s.value.filter(f=>i!==f))},handleClear:i=>{i.stopPropagation(),u([]),x(e.onClear,i)}}}const se=Symbol("treeSelectToken"),_e=re({setup(){const{config:e,props:a,slots:n,locale:s,mergedPrefixCls:y,mergedChildrenKey:u,mergedGetKey:c,mergedLabelKey:d,mergedNodeMap:A,inputValue:i,setInputValue:f,treeRef:p,expandedKeys:h,setExpandedKeys:B,selectedValue:g,changeSelected:b,handleNodeClick:E}=Pe(se),[M,T]=oe(a,"loadedKeys",()=>[]),N=Z(!1),C=S(()=>a.multiple&&a.checkable),R=S(()=>C.value?a.cascaderStrategy:"off"),P=(o,t,r)=>{const{onScrolledChange:v}=a;x(v,o,t,r.map(I=>I.rawData))},z=o=>{o.stopPropagation()},L=(o,t)=>{const{onCheck:r}=a;x(r,o,t),E()},V=(o,t)=>{var v;const{onSelect:r}=a;!a.multiple&&((v=g.value)==null?void 0:v[0])!==t.key&&x(r,o,t),E()},w=(o,t)=>{const{onExpand:r}=a;x(r,o,t)},G=(o,t)=>{const{onExpandedChange:r}=a;x(r,o,t),B(o)},U=o=>{var r,v;const t=N.value;t?(r=p.value)==null||r.expandAll():(v=p.value)==null||v.collapseAll(),N.value=!t,o.stopPropagation()},$=async(o,t)=>{const r=t.children??[],v=t.key,I=A.value,k=I.get(v);if(r.length&&k){const K=u.value,D=ce(a,r,K,c.value,d.value,v);ee(D,I),k.rawData[K]=r,k.children=D,T(o),x(a.onLoaded,o,t)}},j=S(()=>a.clearIcon??e.clearIcon),q=o=>{const{value:t}=o.target;f(t),a.searchable&&x(a.onSearch,t)},H=()=>f("");return()=>{const{customAdditional:o,dataSource:t,draggable:r,draggableIcon:v,empty:I,expandIcon:k,multiple:K,leafLineIcon:D,virtual:_,searchable:W,showLine:X,onDragstart:l,onDragend:m,onDragenter:O,onDragleave:ue,onDragover:ie,onDrop:ye,onNodeClick:fe,onNodeContextmenu:ve,onScroll:ge,onScrolledBottom:pe,droppable:he,treeDisabled:me,loadChildren:Se,searchFn:J,overlayRender:ae,overlayHeight:be}=a,Ce=y.value,xe={label:n.treeLabel,prefix:n.treePrefix,suffix:n.treeSuffix,leafLineIcon:n.leafLineIcon,empty:n.empty,expandIcon:n.expandIcon,draggableIcon:n.draggableIcon},Q=[F($e,{ref:p,blocked:!0,checkOnClick:!0,checkedKeys:g.value,customAdditional:o,expandedKeys:h.value,loadedKeys:M.value,labelKey:d.value,checkable:C.value,cascaderStrategy:R.value,childrenKey:u.value,dataSource:t,draggable:r,draggableIcon:v,droppable:he,disabled:me,empty:I,expandIcon:k,getKey:c.value,height:be,loadChildren:Se,leafLineIcon:D,virtual:_,selectable:K?"multiple":!0,selectedKeys:g.value,searchValue:J!==!1?i.value:void 0,searchFn:ze(J)?J:void 0,showLine:X,onClick:z,onCheck:L,onDragstart:l,onDragend:m,onDragenter:O,onDragleave:ue,onDragover:ie,onDrop:ye,onNodeClick:fe,onNodeContextmenu:ve,onExpand:w,onSelect:V,onLoaded:$,onCheckedChange:b,onSelectedChange:C.value?Ie:b,onExpandedChange:G,onScroll:ge,onScrolledBottom:pe,onScrolledChange:P},xe)];if(W==="overlay"){const le=i.value;Q.unshift(F("div",{class:`${Ce}-overlay-search-wrapper`},[F(Fe,{size:"xs",shape:"square",title:N.value?s.treeSelect.expandAll:s.treeSelect.collapseAll,icon:N.value?"tree-expand":"tree-unexpand",onClick:U},null),F(ke,{clearable:!0,clearIcon:j.value,clearVisible:!!le,size:"sm",suffix:"search",value:le,onClear:H,onInput:q},null)]))}return F("div",null,[ae?ae(Q):Q])}}}),We={control:{type:[String,Number,Object],default:void 0},value:{type:null,default:void 0},open:{type:Boolean,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},cascaderStrategy:{type:String,default:"off"},checkable:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},draggableIcon:{type:String,default:void 0},droppable:{type:Function,default:void 0},empty:{type:[String,Object],default:"simple"},expandIcon:{type:[String,Array],default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},leafLineIcon:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},offset:Array,overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},size:{type:String,default:void 0},showLine:{type:Boolean,default:void 0},status:String,suffix:{type:String,default:void 0},treeDisabled:{type:Function,default:void 0},virtual:{type:Boolean,default:!1},"onUpdate:value":[Function,Array],"onUpdate:open":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],onCheck:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onDragstart:[Function,Array],onDragend:[Function,Array],onDragenter:[Function,Array],onDragleave:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onNodeClick:[Function,Array],onNodeContextmenu:[Function,Array],onSearch:[Function,Array],onSelect:[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array],overlayHeight:{type:Number,default:256}},Xe=re({name:"IxTreeSelect",inheritAttrs:!1,props:We,setup(e,{attrs:a,expose:n,slots:s}){const y=Y("common"),u=Y("locale"),c=Y("treeSelect"),d=S(()=>`${y.prefixCls}-tree-select`),A=Ne(e,c,y,d),i=S(()=>e.childrenKey??c.childrenKey),f=Ke(e,c),p=S(()=>e.labelKey??c.labelKey),h=Z(),[B,g]=De(""),b=()=>{var l;return(l=h.value)==null?void 0:l.focus()},E=()=>{var l;return(l=h.value)==null?void 0:l.blur()},M=()=>{var l;e.searchable==="overlay"?g(""):(l=h.value)==null||l.clearInput()},[T,N]=oe(e,"expandedKeys",()=>[]),{accessor:C,control:R}=Be();Le(R);const P=Ee(e,c),z=Me(e,R),{mergedNodeMap:L}=je(e,i,f,p),{selectedValue:V,selectedNodes:w,changeSelected:G,handleRemove:U,handleClear:$}=He(e,C,L),{overlayRef:j,overlayStyle:q,updateOverlay:H,overlayOpened:o,setOverlayOpened:t}=Re(e,c,h),r=Z();n({focus:b,blur:E,collapseAll:()=>{var l;return(l=r.value)==null?void 0:l.collapseAll()},expandAll:()=>{var l;return(l=r.value)==null?void 0:l.expandAll()},scrollTo:l=>{var m;(m=r.value)==null||m.scrollTo(l)},getNode:l=>{var m;return r.value?r.value.getNode(l):(m=L.value.get(l))==null?void 0:m.rawData}}),we(o,l=>{l&&b(),M()});const I=()=>{e.searchable!=="overlay"&&b()},k=()=>{e.multiple?M():t(!1)},K=()=>C.markAsBlurred(),D=l=>{b(),U(l)};Ge(se,{props:e,slots:s,config:c,locale:u,mergedPrefixCls:d,mergedChildrenKey:i,mergedGetKey:f,mergedLabelKey:p,expandedKeys:T,mergedNodeMap:L,inputValue:B,setInputValue:g,treeRef:r,accessor:C,setExpandedKeys:N,overlayOpened:o,setOverlayOpened:t,handleNodeClick:k,selectedValue:V,changeSelected:G});const _=S(()=>{const{overlayClassName:l,multiple:m}=e,O=d.value;return Ue({[`${O}-overlay`]:!0,[`${O}-overlay-multiple`]:m,[l||""]:!!l})}),W=()=>F(Oe,te({ref:h,className:d.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:c,dataSource:w.value,disabled:C.disabled,maxLabel:e.maxLabel,multiple:e.multiple,opened:o.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:P.value,status:z.value,suffix:e.suffix,value:V.value,onBlur:K,onClear:$,onInputValueChange:g,onItemRemove:D,onOpenedChange:t,onResize:H,onSearch:e.onSearch},a),s),X=()=>F(_e,{onClick:I},null);return()=>{const l={class:_.value,style:q.value,clickOutside:!0,container:A.value,disabled:C.disabled||e.readonly,offset:e.offset??c.offset,placement:"bottomStart",trigger:"manual",triggerId:a.id,visible:o.value,"onUpdate:visible":t},m={default:W,content:X};return F(Ve,te({ref:j},l),m)}}}),Ze=Xe;export{Ze as I};
