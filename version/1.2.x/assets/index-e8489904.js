import{a7 as ne,i as D,ab as te,an as le,u as X,a9 as fe,l as ve,C as ye,ao as he,a6 as ge,ap as pe,Éµ as me,aq as be,ar as xe,as as Ce,p as Se,q as Ke,E as Ie,G as Ee,at as Le,au as Ae}from"./index-5a6244f3.js";import{e as u,k as $,b as re,a as we,t as Fe,v as z,i as J,z as Q,y as L,a2 as T,w as se,p as Oe}from"./vendor-8302379e.js";function $e(e,t){const[n,l]=ne(void 0),o=u(()=>{const a=n.value;return a!==void 0?t.value.get(a):void 0});return{activeKey:n,activeData:o,setActiveKey:l}}function Be(e,t,n,l,o){const a=u(()=>oe(e,t.value,n.value,l.value,o.value,e.dataSource)),c=u(()=>{const i=new Map;return Y(i,a.value),i});return{mergedData:a,mergedDataMap:c}}function oe(e,t,n,l,o,a,c,i){const{loadChildren:d}=e;return a.map(v=>ce(v,t,n,l,o,!!d,c,i))}function ce(e,t,n,l,o,a,c,i){const d=t(e),v=o&&!$(i)?`${i}/${e[l]}`:e[l],b=e[n],y=b==null?void 0:b.map(h=>ce(h,t,n,l,o,a,d,v));return{children:y,key:d,isLeaf:e.isLeaf??!(y!=null&&y.length||a),label:v,parentKey:c,rawData:e}}function Y(e,t){t.forEach(n=>{const{key:l,children:o}=n;e.set(l,n),o&&Y(e,o)})}function Ne(e,t,n){if(n){const l=[],o=e.value;t.forEach(a=>{const c=o.get(a);c&&l.push(c.rawData)}),D(n,t,l)}}function Z(e,t){if(!e||!e.children)return[];const n=[];return e.children.forEach(l=>{const{key:o,rawData:a}=l;(!t||!a.disabled)&&(n.push(o),n.push(...Z(l,t)))}),n}function k(e,t,n){const l=[];for(;t&&!$(t.parentKey);){const{parentKey:o,rawData:a}=t;!n||!a.disabled?(l.unshift(o),t=e.get(o)):t=void 0}return l}function Pe(e,t,n,l,o,a,c){const i=r=>{if($(r))return[];const s=a.value,g=s.get(r);return k(s,g,!1)},[d,v]=te(e,"expandedKeys",()=>i(c.value[0])),[b,y]=te(e,"loadedKeys",()=>[]),h=re([]),x=async r=>{const{loadChildren:s}=e;if(h.value.includes(r))return;const f=a.value.get(r);if(f&&(!f.children||f.children.length===0)){if(!s||b.value.includes(r))return;h.value.push(r);const K=f.rawData,E=await s(K);h.value.splice(h.value.indexOf(r),1);const F=a.value;if(E.length){const I=n.value,w=oe(e,t.value,I,l.value,o.value,E,r,f.label);Y(F,w),f.rawData[I]=E,f.children=w;const B=[...b.value,r];y(B),D(e.onLoaded,B,K)}else return}const S=d.value.indexOf(r)>=0;if(!S){const K=a.value,E=k(K,K.get(r),!1);E.push(r),p(E,!S,f.rawData)}},p=(r,s,g)=>{v(r);const{onExpand:f,onExpandedChange:m}=e;D(f,s,g),Ne(a,r,m)};return{expandedKeys:d,handleExpand:x,loadingKeys:h}}function De(e,t,n,l){const o=Me(e,t),a=u(()=>e.multiple||e.strategy==="off"),c=u(()=>{const d=l.value,v=o.value;if(!d||!v)return le;const b=a.value,y=new Set;return n.value.forEach(h=>{const{key:x,rawData:p}=h;y.has(x)||v(p,d)&&((b||h.isLeaf)&&y.add(x),ue(y,h,b))}),[...y]});return{searchedData:u(()=>{const d=n.value;return c.value.map(v=>d.get(v)).filter(Boolean)})}}function Me(e,t){return u(()=>{const n=e.searchFn;return we(n)?n:n?ke(t.value):!1})}function ke(e){return(t,n)=>{const l=t[e];return l?l.toLowerCase().includes(n.toLowerCase()):!1}}function ue(e,t,n){!t||!t.children||t.children.forEach(l=>{l.rawData.disabled||e.has(l.key)||((n||l.isLeaf)&&e.add(l.key),ue(e,l,n))})}function Re(e,t,n,l){const o=X("locale"),a=u(()=>{const r=fe(t.value);if(!l.value)return r;if(!e.multiple){const s=r[r.length-1];return $(s)?[]:[s]}return r.map(s=>s[s.length-1]).filter(s=>!$(s))}),c=u(()=>a.value.length>=e.multipleLimit),i=u(()=>c.value?o.select.limitMessage.replace("${0}",`${e.multipleLimit}`):""),d=u(()=>{const r=n.value;return a.value.map(s=>r.get(s)).filter(Boolean)}),v=u(()=>e.multiple&&e.strategy!=="off"),b=u(()=>v.value?Ve(n.value,a.value):a.value),y=u(()=>{if(!v.value)return le;const r=new Set,s=b.value,g=n.value;return s.forEach(f=>{let m=g.get(f);for(;m&&!$(m.parentKey);){const S=m.parentKey,K=g.get(S);K&&!K.rawData.disabled&&!s.includes(S)&&r.add(S),m=K}}),[...r]}),h=r=>{let s;if(!l.value)s=e.multiple?r:r[0];else if(e.multiple){const f=n.value;s=r.map(m=>{const S=k(f,f.get(m),!0);return S.push(m),S})}else{const f=r[0],m=n.value;s=k(m,m.get(f),!0),s.push(f)}const g=Fe(t.value);s!==g&&(t.setValue(s),D(e.onChange,s,g))};return{selectedKeys:a,selectedLimit:c,selectedLimitTitle:i,selectedData:d,selectedWithStrategyKeys:b,indeterminateKeys:y,handleSelect:r=>{const{multiple:s}=e,g=b.value,m=g.indexOf(r)>-1;if(!s){!m&&h([r]);return}const S=n.value,K=S.get(r),E=v.value,F=E?Z(K,!0):[],I=new Set(g);m||F.length>0&&F.every(w=>I.has(w)||y.value.includes(w))?(I.delete(r),E&&(k(S,K,!0).forEach(w=>I.delete(w)),F.forEach(w=>I.delete(w)))):(I.add(r),E&&(de(S,K,I),F.forEach(w=>I.add(w)))),h([..._e(S,I,e.strategy)])},handleClear:r=>{r.stopPropagation(),h([]),D(e.onClear,r)}}}function Ve(e,t){const n=new Set(t);let l;return t.forEach(o=>{const a=e.get(o);if(!a)return;const{parentKey:c}=a;Z(a,!0).forEach(d=>n.add(d)),c&&l!==c&&(de(e,a,n),l=c)}),[...n]}function de(e,t,n){let l=!0;for(;l&&t&&!$(t.parentKey);){const o=t.parentKey,a=e.get(o);a&&!t.rawData.disabled&&(l=a.children.every(c=>c.rawData.disabled||n.has(c.key)),l&&n.add(t.parentKey)),t=a}}function _e(e,t,n){if(n==="parent"){const l=new Set;return t.forEach(o=>{const a=e.get(o);if(a){const{key:c,parentKey:i}=a;(!i||!t.has(i))&&l.add(c)}}),l}if(n==="child"){const l=new Set;return t.forEach(o=>{const a=e.get(o);a&&a.isLeaf&&l.add(a.key)}),l}return t}const q=Symbol("cascaderToken"),Te=z({props:{children:{type:Array,default:void 0},index:{type:Number,required:!0},isLeaf:{type:Boolean,required:!0},label:{type:String,required:!0},parentKey:{type:[String,Number,Symbol],default:void 0},rawData:{type:Object,required:!0}},setup(e){const t=ve(),{props:n,slots:l,mergedPrefixCls:o,mergedExpandIcon:a,mergedLabelKey:c,inputValue:i,activeKey:d,setActiveKey:v,expandedKeys:b,setOverlayOpened:y,loadingKeys:h,selectedKeys:x,selectedLimit:p,selectedLimitTitle:r,indeterminateKeys:s,handleSelect:g,handleExpand:f}=J(q),m=u(()=>t===d.value),S=u(()=>e.rawData.disabled),K=u(()=>b.value.includes(t)),E=u(()=>h.value.includes(t)),F=u(()=>x.value.includes(t)),I=u(()=>s.value.includes(t)),w=u(()=>{const C=`${o.value}-option`;return Q({[C]:!0,[`${C}-leaf`]:e.isLeaf,[`${C}-active`]:m.value,[`${C}-disabled`]:S.value,[`${C}-expanded`]:K.value,[`${C}-loading`]:E.value,[`${C}-selected`]:F.value})}),B=()=>{if(e.isLeaf){if(!F.value&&p.value)return;g(t),y(!1)}else n.strategy==="off"&&g(t),n.expandTrigger==="click"&&f(t)},G=C=>{C.stopPropagation(),g(t)},U=()=>{v(t),!e.isLeaf&&n.expandTrigger==="hover"&&f(t)};return()=>{const{rawData:C,label:R}=e,{multiple:O}=n,N=S.value,P=F.value,M=`${o.value}-option`,V=i.value,_=V?R:C[c.value],H=!(N||P)&&r.value||_,j=n.customAdditional?n.customAdditional({data:C,index:e.index}):void 0;return L("div",T({class:w.value,title:H,onClick:N?void 0:B,onMouseenter:N?void 0:U,"aria-label":R,"aria-selected":P},j),[O&&L(ye,{checked:P,disabled:N||!P&&p.value,indeterminate:I.value,onClick:G},null),L("span",{key:"__label",class:`${M}-label`},[ze(l.optionLabel,_,C,V,M)]),!e.isLeaf&&L("span",{key:"__expand-icon",class:`${M}-expand-icon`},[he(l.expandIcon,E.value?"loading":a.value,{key:t,expanded:K.value,data:C})])])}}});function ze(e,t,n,l,o){if(e)return e({label:t,data:n,searchValue:l});if(t&&l){const a=t.toUpperCase().indexOf(l.toUpperCase());if(a>-1){const c=a+l.length,i=t.substring(0,a),d=t.substring(c),v=L("span",{class:`${o}-label-highlight`},[t.substring(a,c)]);return[i,v,d]}}return t}const ae=z({props:{dataSource:{type:Array,required:!0}},setup(e){const{props:t,slots:n,mergedPrefixCls:l}=J(q),o=u(()=>{const a=`${l.value}-option-group`;return Q({[a]:!0,[`${a}-empty`]:e.dataSource.length===0})});return()=>{const{dataSource:a}=e;let c;if(a.length>0){const{overlayHeight:i,overlayItemHeight:d,virtual:v}=t;c=L(ge,{dataSource:a,getKey:"key",height:i,itemHeight:d,itemRender:({item:y,index:h})=>L(Te,T({index:h},y),null),virtual:v},null)}else c=L(pe,{empty:t.empty},n);return L("div",{class:o.value},[c])}}}),qe=z({setup(){const{props:e,mergedPrefixCls:t,mergedClearIcon:n,mergedData:l,mergedDataMap:o,searchedData:a,expandedKeys:c,inputValue:i,setInputValue:d,updateOverlay:v}=J(q),b=u(()=>{const x=[l.value],p=o.value;return c.value.forEach(r=>{const s=p.get(r);s&&s.children&&x.push(s.children)}),x});se([()=>b.value.length,i],()=>{v()});const y=x=>{const{value:p}=x.target;d(p),e.searchable&&D(e.onSearch,p)},h=()=>d("");return()=>{const{overlayRender:x}=e,p=i.value,r=t.value,s=[];e.searchable==="overlay"&&s.push(L("div",{key:"__search-wrapper",class:`${r}-overlay-search-wrapper`},[L(me,{clearable:!0,clearIcon:n.value,clearVisible:!!p,size:"sm",suffix:"search",value:p,onClear:h,onInput:y},null)]));const g=p?L(ae,{dataSource:a.value},null):b.value.map((f,m)=>L(ae,{key:m,dataSource:f},null));return s.push(L("div",{key:"__content",class:`${r}-overlay-content`},[g])),L("div",null,[x?x(s):s])}}}),Ge={control:{type:[String,Number,Object],default:void 0},value:{type:null,default:void 0},expandedKeys:{type:Array,default:void 0},loadedKeys:{type:Array,default:void 0},open:{type:Boolean,default:void 0},autocomplete:{type:String,default:"off"},autofocus:{type:Boolean,default:!1},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:void 0},customAdditional:{type:Function,default:void 0},dataSource:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},empty:{type:[String,Object],default:"simple"},expandIcon:{type:String,default:void 0},expandTrigger:{type:String,default:"click"},fullPath:{type:Boolean,default:void 0},getKey:{type:[String,Function],default:void 0},labelKey:{type:String,default:void 0},loadChildren:{type:Function,default:void 0},maxLabel:{type:[Number,String],default:Number.MAX_SAFE_INTEGER},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:Number.MAX_SAFE_INTEGER},overlayClassName:{type:String,default:void 0},overlayContainer:{type:[String,HTMLElement,Function],default:void 0},overlayMatchWidth:{type:Boolean,default:void 0},overlayRender:{type:Function,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:!1},searchable:{type:[Boolean,String],default:!1},searchFn:{type:[Boolean,Function],default:!0},size:{type:String,default:void 0},status:String,strategy:{type:String,default:"all"},suffix:{type:String,default:void 0},virtual:{type:Boolean,default:!1},"onUpdate:value":[Function,Array],"onUpdate:expandedKeys":[Function,Array],"onUpdate:loadedKeys":[Function,Array],"onUpdate:open":[Function,Array],onChange:[Function,Array],onClear:[Function,Array],onExpand:[Function,Array],onExpandedChange:[Function,Array],onLoaded:[Function,Array],onSearch:[Function,Array],overlayHeight:{type:Number,default:256},overlayItemHeight:{type:Number,default:32}},Ue=[0,4],He=z({name:"IxCascader",inheritAttrs:!1,props:Ge,setup(e,{attrs:t,expose:n,slots:l}){const o=X("common"),a=X("cascader"),c=u(()=>`${o.prefixCls}-cascader`),i=be(e,a,o,c),d=u(()=>e.childrenKey??a.childrenKey),v=u(()=>e.clearIcon??a.clearIcon),b=u(()=>e.expandIcon??a.expandIcon),y=u(()=>e.fullPath??a.fullPath),h=xe(e,a),x=u(()=>e.labelKey??a.labelKey),p=re(),[r,s]=ne(""),g=()=>{var A;return(A=p.value)==null?void 0:A.focus()},f=()=>{var A;return(A=p.value)==null?void 0:A.blur()},m=()=>{var A;e.searchable==="overlay"?s(""):(A=p.value)==null||A.clearInput()};n({focus:g,blur:f});const{overlayRef:S,updateOverlay:K,overlayOpened:E,setOverlayOpened:F}=Ce(e,a,p),{accessor:I,control:w}=Se();Ke(w);const B=Ie(e,a),G=Ee(e,w),{mergedData:U,mergedDataMap:C}=Be(e,h,d,x,y),R=$e(e,C),O=Re(e,I,C,y),{searchedData:N}=De(e,x,C,r),P=Pe(e,h,d,x,y,C,O.selectedKeys);se(E,A=>{A&&g(),m()});const M=()=>{e.searchable!=="overlay"&&g()},V=()=>I.markAsBlurred(),_=A=>{g(),O.handleSelect(A)};Oe(q,{props:e,slots:l,config:a,mergedPrefixCls:c,mergedChildrenKey:d,mergedClearIcon:v,mergedExpandIcon:b,mergedFullPath:y,mergedGetKey:h,mergedLabelKey:x,accessor:I,inputValue:r,setInputValue:s,overlayOpened:E,setOverlayOpened:F,updateOverlay:K,mergedData:U,mergedDataMap:C,...R,...O,searchedData:N,...P});const H=u(()=>{const{overlayClassName:A,multiple:W}=e,ee=c.value;return Q({[`${ee}-overlay`]:!0,[`${ee}-overlay-multiple`]:W,[A||""]:!!A})}),j=()=>L(Ae,T({ref:p,className:c.value,allowInput:!1,autocomplete:e.autocomplete,autofocus:e.autofocus,borderless:e.borderless,clearable:e.clearable,clearIcon:e.clearIcon,config:a,dataSource:O.selectedData.value,disabled:I.disabled,maxLabel:e.maxLabel,multiple:e.multiple,opened:E.value,placeholder:e.placeholder,readonly:e.readonly,searchable:e.searchable,size:B.value,status:G.value,suffix:e.suffix,value:O.selectedKeys.value,onBlur:V,onClear:O.handleClear,onInputValueChange:s,onItemRemove:_,onOpenedChange:F,onResize:K,onSearch:e.onSearch},t),l),ie=()=>L(qe,{onClick:M},null);return()=>{const A={class:H.value,clickOutside:!0,container:i.value,disabled:I.disabled||e.readonly,offset:Ue,placement:"bottomStart",trigger:"manual",triggerId:t.id,visible:E.value,"onUpdate:visible":F},W={default:j,content:ie};return L(Le,T({ref:S},A),W)}}}),Xe=He;export{Xe as I};
