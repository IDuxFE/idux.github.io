import{u as C,f as O,g as T,o as p,h as b,s as w,i as N,j as y}from"./index.2ba5520c.js";import{v as A,e as h,y as d,b as g,x as L,Q as R,w as $,A as S,p as H,i as F}from"./vendor.994f7e39.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const E=Symbol("anchorToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const P={affix:{type:Boolean,default:!0},bounds:Number,hideLinkBall:{type:Boolean,default:void 0},offsetTop:Number,target:[String,HTMLElement,Function],targetOffset:Number,onChange:[Function,Array],onClick:[Function,Array]},j={href:{type:String,required:!0},title:String},q=A({name:"IxAnchor",props:P,setup(e,{slots:c}){const r=C("common"),i=h(()=>`${r.prefixCls}-anchor`),f=C("anchor"),n=h(()=>{var l;return(l=e.hideLinkBall)!=null?l:f.hideLinkBall}),o=h(()=>{const{offsetTop:l}=e;return{maxHeight:l?`calc(100vh - ${l}px)`:"100vh"}}),{activeLink:s}=M(e,f),{anchorRef:v,inkBallElRef:a,inkBallClasses:u,inkBallTop:t}=G(s,i);return()=>{var m;const l=i.value,x=n.value?null:d("span",{class:u.value,style:{top:t.value},ref:a},null),k=d("div",{class:`${l}-wrapper`,style:o.value},[d("div",{class:l,ref:v},[d("div",{class:`${l}-ink`},[x]),(m=c.default)==null?void 0:m.call(c)])]);return e.affix?d(O,{target:e.target,offset:e.offsetTop},{default:()=>[k]}):k}}}),M=(e,c)=>{const r=g([]),i=a=>{r.value.includes(a)||r.value.push(a)},f=a=>{const u=r.value.indexOf(a);u!==-1&&r.value.splice(u,1)},n=g(),o=a=>{n.value!==a&&(n.value=a,y(e.onChange,a))},{scrollTo:s}=U(e,c,r,o);return H(E,{registerLink:i,unregisterLink:f,activeLink:n,handleLinkClick:(a,u)=>{y(e.onClick,a,u),s(u.href)}}),{activeLink:n}},G=(e,c)=>{const r=g(),i=g(),f=h(()=>{const o=c.value;return{[`${o}-ink-ball`]:!0,[`${o}-ink-ball-visible`]:!!e.value}}),n=g();return L(()=>{R(()=>{var u,t,l;const o=(u=r.value)==null?void 0:u.querySelector(`a[data-href="${e.value}"]`);if(!o)return;const s=(l=(t=i.value)==null?void 0:t.getBoundingClientRect().height)!=null?l:9,{offsetTop:v,clientHeight:a}=o;n.value=`${v+a/2-s/2}px`},{flush:"post"})}),{anchorRef:r,inkBallElRef:i,inkBallClasses:f,inkBallTop:n}},I=(e,c)=>{const r=document.getElementById(e.split("#")[1]);if(r){const{top:i}=N(r,c);return i}return null},Q=(e,c,r,i)=>e.length?e.map(n=>{const o=I(n,c);return{link:n,top:o}}).reduce((n,o)=>{const{top:s}=o;return s!==null&&s<r+i&&n.top<s?o:n}).link:"",U=(e,c,r,i)=>{const f=h(()=>{var t;return(t=e.bounds)!=null?t:c.bounds}),n=g(),o="scroll";let s=!1;const v=h(()=>{var t,l;return(l=(t=e.targetOffset)!=null?t:e.offsetTop)!=null?l:0}),a=()=>{if(s)return;const t=Q(r.value,n.value,v.value,f.value);i(t)},u=t=>{i(t);const l=I(t,n.value);l!==null&&(s=!0,w({amountOfChange:l-v.value,target:n.value,callback:()=>{s=!1}}))};return $(()=>e.target,()=>{b(n.value,o,a),n.value=T(e.target),p(n.value,o,a),a()}),L(()=>{n.value=T(e.target),p(n.value,o,a),a()}),S(()=>{b(n.value,o,a)}),{scrollTo:u}},V=A({name:"IxAnchorLink",props:j,setup(e,{slots:c}){const r=C("common"),i=h(()=>`${r.prefixCls}-anchor-link`),{registerLink:f,unregisterLink:n,activeLink:o,handleLinkClick:s}=F(E);$(()=>e.href,(t,l)=>{n(l),f(t)}),L(()=>f(e.href)),S(()=>n(e.href));const v=h(()=>o.value===e.href),a=h(()=>{const t=i.value;return{[`${t}-title`]:!0,[`${t}-title-active`]:v.value}}),u=t=>s(t,e);return()=>{var k,m,B;const{href:t,title:l}=e,x=i.value;return d("div",{class:x},[d("a",{class:a.value,href:t,"data-href":t,title:l,onClick:u},[(m=(k=c.title)==null?void 0:k.call(c))!=null?m:l]),(B=c.default)==null?void 0:B.call(c)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const J=q,K=V;export{J as I,K as a};
