import{M as ke,N as fe,aM as Qe,am as Be,m as _,L as le,aG as z,aN as ce,o as X,D as ie,a2 as Je,K as oe,a1 as ee,$ as G,a3 as ge,aO as Ze,A as te,j as ve,ar as et,X as Ke,W as Ee,c as me,aa as tt,ap as lt,E as nt,G as ot,H as st,aP as at,as as rt,ao as ct,aB as it}from"./index-22ebbaf3.js";import{b as $e,f as L,L as ut,T as dt,c as b,m as he,r as O,w as D,a9 as Te,Q as Ie,d as Y,O as J,y as se,bk as ft,R as vt,x as A,l as H,A as V,z as m,ag as ht,i as Q,a3 as Z,q as Oe,_ as yt,an as pt}from"./vendor-a14e3fe7.js";import{b as Re}from"./GlobalCodeBox-7a51f28b.js";import{I as gt}from"./index-841c4683.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const We=Symbol("IxTableColumn"),ye=()=>{};ye.displayName="IxTableColumn";ye[We]=!0;/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Pe(e,l,t){if(!e||$e(e)&&e.title===!1)return;if(L(l)||ut(l))return l;const n=ke(l).find(o=>o.type===dt);return n?n.children:t}function mt(e){return"key"in e?e.key:"dataKey"in e?fe(e.dataKey).join("-"):"type"in e?`__IDUX_table_column_key_${e.type}`:Qe("__IDUX_table_column_key_")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function bt(e,l,t,n){const o=b(()=>{var k;const{columns:C}=e;return Fe(C&&C.length>0?C:He((k=l.default)==null?void 0:k.call(l)),t)}),{flattedColumns:a,scrollBarColumn:s,flattedColumnsWithScrollBar:r}=St(o,n),c=Ct(r),u=b(()=>!!e.ellipsis||a.value.some(C=>C.ellipsis)),i=b(()=>a.value.some(C=>C.fixed)),{columnWidths:d,columnWidthsWithScrollBar:y,changeColumnWidth:p}=wt(a,s),{columnOffsets:v,columnOffsetsWithScrollBar:x}=kt(d,y),w=b(()=>Bt(o.value,s.value));return{flattedColumns:a,scrollBarColumn:s,flattedColumnsWithScrollBar:r,fixedColumnKeys:c,hasEllipsis:u,hasFixed:i,columnWidths:d,columnWidthsWithScrollBar:y,changeColumnWidth:p,columnOffsets:v,columnOffsetsWithScrollBar:x,mergedRows:w}}function Fe(e,l){return e.map(t=>xt(t,l))}function He(e){const l=[];return ke(e,{key:We}).forEach((t,n)=>{const{props:o,children:a}=t,{key:s=n,editable:r,ellipsis:c,...u}=o||{};u.key=s,u.editable=r||r==="",u.ellipsis=c||c==="";const{default:i,cell:d,title:y,expand:p,icon:v}=a||{};i&&(u.children=He(i())),d&&(u.customCell=d),y&&(u.customTitle=y),p&&(u.customExpand=p),v&&(u.customIcon=v),l.push(u)}),l}function xt(e,l){var c,u;const{columnBase:t,columnExpandable:n,columnSelectable:o,columnIndexable:a}=l,{align:s=t.align}=e,r=mt(e);if("type"in e){const{type:i}=e;if(i==="expandable"){const{icon:d=n.icon}=e;return{...e,key:r,align:s,icon:d}}if(i==="selectable"){const{multiple:d=!0,showIndex:y=o.showIndex}=e;return{...e,key:r,align:s,multiple:d,showIndex:y}}if(i==="indexable"){const d=(u=(c=e.align)!=null?c:a.align)!=null?u:t.align;return{...a,...e,align:d,key:r}}return{...e,key:r,align:s}}else{const{sortable:i,filterable:d,children:y}=e,p={...e,key:r,align:s};return i&&(p.sortable={...t.sortable,...i}),d&&(p.filterable={...t.filterable,...d}),y!=null&&y.length&&(p.children=Fe(y,l)),p}}function St(e,l){const t=b(()=>Ae(e.value)),n=b(()=>{const a=l.value;if(a===0)return;const s=t.value,r=s[s.length-1];return{key:"__IDUX_table_column_key_scroll-bar",type:"scroll-bar",fixed:r&&r.fixed,width:a}}),o=b(()=>{const a=t.value;if(a.length===0)return a;const s=n.value;return s?[...a,s]:a});return{flattedColumns:t,scrollBarColumn:n,flattedColumnsWithScrollBar:o}}function Ae(e){const l=[];return e.forEach(t=>{const{fixed:n,children:o}=t;if(o!=null&&o.length){let a=Ae(o);n&&(a=a.map(s=>({fixed:n,...s}))),l.push(...a)}else l.push(t)}),l}function Ct(e){return b(()=>{let l,t;return e.value.forEach(n=>{const{fixed:o,key:a}=n;o==="start"?l=a:o==="end"&&(t||(t=a))}),{lastStartKey:l,firstEndKey:t}})}function wt(e,l){const t=he({}),n=O(),o=O([]);D(n,Te(r=>{o.value=r?r.split("-").map(Number):[]},16)),Ie(()=>{const r=Object.keys(t),c=e.value;if(r.length!==c.length){n.value=void 0;return}n.value=c.map(u=>t[u.key]).join("-")});const a=b(()=>{const r=o.value;if(r.length===0)return r;const c=l.value;return c?[...r,c.width]:r});return{columnWidths:o,columnWidthsWithScrollBar:a,changeColumnWidth:(r,c)=>{c===!1?delete t[r]:t[r]=c}}}function kt(e,l){const t=b(()=>be(e.value)),n=b(()=>be(l.value));return{columnOffsets:t,columnOffsetsWithScrollBar:n}}function be(e){const l=e.length,t=[],n=[];let o=0,a=0;for(let s=0;s<l;s++){t[s]=o,o+=e[s]||0;const r=l-s-1;n[r]=a,a+=e[r]||0}return{starts:t,ends:n}}function Bt(e,l){const t=[];function n(s,r,c){var d;(d=t[c])!=null||(t[c]=[]);let u=r;return s.map(y=>{var C;let p=(C=y.titleColSpan)!=null?C:1,v=!1;const x=y.children;if(x!=null&&x.length){v=!0;const k=n(x,u,c+1);Y(y.titleColSpan)&&(p=k.reduce((f,h)=>f+h))}const w=u+p-1;return t[c].push({...y,titleColSpan:p,colStart:u,colEnd:w,hasChildren:v}),u+=p,p})}const o=l?[...e,l]:e;n(o,0,0);const a=t.length;return t.forEach((s,r)=>{s.forEach(c=>{c.hasChildren||(c.titleRowSpan=a-r)})}),t}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Kt(e,l,t,n,o,a,s){const r=b(()=>{const v=l.value,x=t.value;return e.dataSource.map(w=>Me(w,x,v))}),c=b(()=>{const v=new Map;return ue(r.value,v),v}),u=b(()=>Ne(r.value,o.value,a.value)),i=b(()=>_e(u.value,n.value,a.value)),d=b(()=>{const v=s.value,x=i.value;if(v===null||!v.pageSize)return x;{const{total:w}=v;if(w&&x.length<w)return x;const C=v.pageSize,k=(v.pageIndex-1)*C;return x.slice(k,k+C)}}),y=b(()=>{const v=new Map;return ue(d.value,v),v}),p=b(()=>{const v=a.value;return v.length>0?ze(d.value,v,0):d.value});return{filteredData:u,flattedData:p,mergedMap:c,paginatedMap:y}}function Me(e,l,t,n){const o=l(e),a={record:e,rowKey:o,parentKey:n},s=e[t];return s&&(a.children=s.map(r=>Me(r,l,t,o))),a}function ue(e,l){e.forEach(t=>{const{rowKey:n,children:o}=t;l.set(n,t),o&&ue(o,l)})}function _e(e,l,t){const n=l.filter(s=>s.sorter),o=n.length;if(o===0)return e;const a=e.slice();return a.forEach(s=>{t.includes(s.rowKey)&&s.children&&s.children.length>0&&(s.children=_e(s.children,l,t))}),a.sort((s,r)=>{for(let c=0;c<o;c++){const{orderBy:u,sorter:i}=n[c],d=i(s.record,r.record);if(d!==0)return u==="ascend"?d:-d}return 0})}function Ne(e,l,t){const n=l.filter(o=>o.filter);return n.length===0?e:e.map(o=>{const a=n.every(({filter:i,filterBy:d})=>i(d,o.record)),{rowKey:s,children:r}=o,c=t.includes(s);let u=o;if(c&&r&&r.length){const i=Ne(r,l,t);i.length!==r.length&&(u={...o,children:i})}return a||c&&u.children&&u.children.length?u:null}).filter(o=>o!==null)}function ze(e,l,t){return e.reduce((n,o)=>{const{children:a,parentKey:s,record:r,rowKey:c}=o,u=l.includes(c);if(n.push({children:a,parentKey:s,record:r,rowKey:c,level:t,expanded:u}),u&&o.children){const i=ze(o.children,l,t+1);n.push(...i)}return n},[])}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Et(e,l){const t=b(()=>l.value.find(r=>"type"in r&&r.type==="expandable")),[n,o]=Be(e,"expandedRowKeys",()=>[]);return{expandable:t,expandedRowKeys:n,setExpandedRowKeys:o,checkExpandDisabled:r=>{if(!t.value)return!0;const{disabled:c,customExpand:u}=t.value,{record:i}=r;return c!=null&&c(i)?!0:!(u||r.children&&r.children.length>0)},handleExpandChange:(r,c)=>{const{onChange:u,onExpand:i}=t.value||{},d=[...n.value],y=d.indexOf(r),p=y>=0;p?d.splice(y,1):d.push(r),_(i,!p,c),o(d),_(u,d)}}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function $t(e){const l=b(()=>e.value.filter(a=>a.filterable)),t=he({}),n=O([]);return D(l,(a,s)=>{a.forEach(r=>{const{key:c,filterable:u}=r,i=u.filterBy;if(i||t[c]===void 0){t[c]=i||[];return}const d=s?s.find(p=>p.key===c):void 0;(d==null?void 0:d.filterable.filterBy)&&(t[c]=[])}),n.value=xe(a,t)},{immediate:!0}),{activeFilters:n,activeFilterByMap:t,handleFilter:(a,s,r)=>{const{onChange:c}=s;t[a]=r,n.value=xe(l.value,t),_(c,r,n.value)}}}function xe(e,l){return e.map(t=>{const{key:n,filterable:o}=t,{filter:a,filterBy:s=l[n]}=o;return{key:n,filter:a,filterBy:s}}).filter(t=>t.filter&&t.filterBy.length>0)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Tt(e,l,t){var u,i,d,y,p;const n=le("pagination"),o=b(()=>{const{pagination:v}=e;return v===!1?null:v===!0?{}:v}),a=O((i=(u=o.value)==null?void 0:u.pageIndex)!=null?i:1),s=O((p=(y=(d=o.value)==null?void 0:d.pageSize)!=null?y:l.pagination.pageSize)!=null?p:n.pageSize),r=(v,x)=>{var w;a.value=v,s.value=x,_((w=o.value)==null?void 0:w.onChange,v,x)};return{mergedPagination:b(()=>{var x,w;const v=o.value;return v===null?null:{...l.pagination,size:t.value,...v,pageIndex:(x=v.pageIndex)!=null?x:a.value,pageSize:(w=v.pageSize)!=null?w:s.value,onChange:r}})}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function It(e,l,{setStickyScrollLeft:t}){const n=O(),o=O(),a=O(),s=O(),r=O();D(n,C=>{C&&(a.value=C.holderRef.value)});const{handleScroll:c,pingedStart:u,pingedEnd:i}=Ot(e,o,a,r,t),d=Rt(e,l,a,s),y=b(()=>{var C;return z((C=e.scroll)==null?void 0:C.width)}),p=b(()=>{var k;let C=z((k=e.scroll)==null?void 0:k.height);return!C&&l.value&&(e.virtual||d.value)&&(C="auto"),C}),v=b(()=>ce(X(a))),x=b(()=>p.value?v.value:0);return{virtualScrollRef:n,scrollHeadRef:o,scrollBodyRef:a,scrollContentRef:s,scrollFootRef:r,handleScroll:c,scrollTo:C=>{var k;e.virtual?(k=n.value)==null||k.scrollTo(C):typeof C=="number"&&Je({target:X(a),top:C,duration:200})},pingedStart:u,pingedEnd:i,scrollWidth:y,scrollHeight:p,scrollBarSize:v,scrollBarSizeOnFixedHolder:x}}function Ot(e,l,t,n,o){const a=O(!1),s=O(!1);let r;const c=()=>{r&&(clearTimeout(r),r=void 0)};J(()=>c());const u=O(),i=v=>{u.value=v,c(),r=setTimeout(()=>{u.value=void 0,r=void 0},100)},d=(v,x)=>{x&&x.scrollLeft!==v&&(x.scrollLeft=v)},y=v=>{const x=X(t);if(!x)return;const{clientWidth:w,scrollWidth:C}=x;o(v/C*w||0)};return{handleScroll:(v,x)=>{const w=v==null?void 0:v.currentTarget,C=x!=null?x:w.scrollLeft,k=u.value;if((!k||k===w)&&(i(w),d(C,l.value),d(C,X(t)),d(C,n.value),y(C)),w){const{scrollWidth:f,clientWidth:h}=w;a.value=C>0,s.value=C<f-h}(v==null?void 0:v.type)==="scroll"&&_(e.onScroll,v)},pingedStart:a,pingedEnd:s}}function Rt(e,l,t,n){const o=O(!0),a=()=>{const c=X(t.value);c?o.value=c.scrollHeight>c.clientHeight:o.value=!1};let s=[];const r=()=>s.forEach(c=>c());return se(()=>{D([l,()=>e.virtual],([c,u])=>{r(),c&&!u&&(s=[ie(t,a),ie(n,a)])},{immediate:!0})}),J(()=>r()),o}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Wt(e,l,t,n,o,a){const s=b(()=>{var i;return(i=e.scrollToTopOnChange)!=null?i:l.scrollToTopOnChange});let r=[];const c=()=>{r=[D([()=>{var i;return(i=t.value)==null?void 0:i.pageIndex},()=>{var i;return(i=t.value)==null?void 0:i.pageSize}],()=>a(0)),D([o,n],([i,d],[y,p])=>{(!Pt(i,y)||!Ft(d,p))&&a(0)})]},u=()=>{r.forEach(i=>i())};D(s,i=>{u(),i&&c()},{immediate:!0})}function Pt(e,l){return e.length===l.length&&e.every(t=>{const n=l.find(o=>o.key===t.key);return n?t.filter===n.filter&&t.filterBy.length===n.filterBy.length&&t.filterBy.every(o=>n.filterBy.includes(o)):!1})}function Ft(e,l){return e.length===l.length&&e.every(t=>{const n=l.find(o=>o.key===t.key);return n?t.sorter===n.sorter&&t.orderBy===n.orderBy&&t.multiple===n.multiple:!1})}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Ht(e,l,t,{mergedMap:n,paginatedMap:o}){const a=b(()=>t.value.find(f=>"type"in f&&f.type==="selectable")),[s,r]=Be(e,"selectedRowKeys",()=>[]),c=b(()=>{const{disabled:f}=a.value||{},h=[],g=[];return o.value.forEach((S,E)=>{f!=null&&f(S.record)?g.push(E):h.push(E)}),{enabledRowKeys:h,disabledRowKeys:g}}),u=b(()=>{const f=new Set,h=s.value,{disabledRowKeys:g}=c.value,S=n.value;return h.forEach(E=>{const{parentKey:K}=S.get(E)||{};if(!Y(K)){let B=S.get(K);if(B&&!h.includes(B.rowKey))for(;B&&!Y(B==null?void 0:B.rowKey);)g.includes(B.rowKey)||f.add(B.rowKey),B=Y(B.parentKey)?void 0:S.get(B.parentKey)}}),[...f]}),i=b(()=>{const f=s.value,{disabledRowKeys:h}=c.value;let g=0;return o.value.forEach((S,E)=>{!h.includes(E)&&f.includes(E)&&g++},0),g}),d=b(()=>{const f=o.value.size,h=c.value.disabledRowKeys.length;return f===0||f===h?!1:f===h+i.value}),y=b(()=>!d.value&&i.value>0),p=new Map,v=f=>{r(f);const h=n.value,{onChange:g}=a.value||{};if(g){const S=[];p.forEach((E,K)=>{f.includes(K)||p.delete(K)}),f.forEach(E=>{let K=h.get(E);K?p.set(E,K):K=p.get(E),K&&S.push(K.record)}),_(g,f,S)}},x=(f,h)=>{const g=n.value,{disabledRowKeys:S}=c.value,{multiple:E,onSelect:K}=a.value||{};let B=[...s.value];const W=B.indexOf(f),R=W>=0;if(E){const P=g.get(f),T=De(P,S);if(R){B.splice(W,1);const $=At(g,P,S);B=B.filter(I=>!$.includes(I)&&!T.includes(I))}else B.push(f),B.push(...T);Mt(g,P,B,S)}else B=R?[]:[f];_(K,!R,h),v(B)},w=()=>{const{enabledRowKeys:f}=c.value,h=new Set(s.value);d.value?f.forEach(g=>h.delete(g)):f.forEach(g=>h.add(g)),v([...h])},C=_t(a,l),k=Nt(a,n,o,s,v);return{selectable:a,selectedRowKeys:s,indeterminateRowKeys:u,currentPageRowKeys:c,currentPageAllSelected:d,currentPageSomeSelected:y,handleSelectChange:x,handleHeadSelectChange:w,mergedSelectableMenus:C,handleSelectableMenuClick:k}}function De(e,l){const t=[],{children:n}=e||{};return n&&n.forEach(o=>{const{rowKey:a}=o;l.includes(a)||t.push(o.rowKey),t.push(...De(o,l))}),t}function At(e,l,t){const n=[];for(;l!=null&&l.parentKey;){const{parentKey:o}=l;t.includes(l.parentKey)||n.push(o),l=e.get(o)}return n}function Mt(e,l,t,n){let o=!0;for(;o&&l&&!Y(l.parentKey);){const a=e.get(l.parentKey);if(a&&!n.includes(l.parentKey)){o=a.children.every(r=>n.includes(r.rowKey)||t.includes(r.rowKey));const s=t.findIndex(r=>r===l.parentKey);o?s<0&&t.push(l.parentKey):s>-1&&t.splice(s,1)}l=a}}const Le=Symbol("IDUX_TABLE_KEY_selectable-all"),je=Symbol("IDUX_TABLE_KEY_selectable-invert"),Ue=Symbol("IDUX_TABLE_KEY_selectable-none"),qe=Symbol("IDUX_TABLE_KEY_selectable-pageInvert");function _t(e,l){return b(()=>{const{menus:t}=e.value||{};if(!t||t.length===0)return[];const{selectAll:n,selectInvert:o,selectNone:a,selectPageInvert:s}=l.table;return t.map(r=>L(r)?r==="all"?{type:"item",key:Le,label:n}:r==="invert"?{type:"item",key:je,label:o}:r==="none"?{type:"item",key:Ue,label:a}:r==="pageInvert"?{type:"item",key:qe,label:s}:{type:"item",key:r,label:r}:r)})}function Nt(e,l,t,n,o){const a=()=>{const{disabled:i,onSelectAll:d}=e.value||{},y=[];l.value.forEach((p,v)=>{i!=null&&i(p.record)||y.push(v)}),_(d,y),o(y)},s=()=>{const{disabled:i,onSelectInvert:d}=e.value||{},y=[...n.value];l.value.forEach((p,v)=>{if(i!=null&&i(p.record))return;const x=y.indexOf(v);x>=0?y.splice(x,1):y.push(v)}),o(y),_(d,y)},r=()=>{const{onSelectNone:i}=e.value||{};_(i),o([])},c=()=>{const{disabled:i,onSelectPageInvert:d}=e.value||{},y=[],p=n.value;t.value.forEach((v,x)=>{i!=null&&i(v.record)||p.includes(x)||y.push(x)}),_(d,y),o(y)},u=new Map([[Le,a],[je,s],[Ue,r],[qe,c]]);return i=>{const d=i.key;if(ft(d)&&u.has(d)){u.get(d)();return}const{disabled:y,onMenuClick:p}=e.value||{};if(!p)return;const v=[];t.value.forEach((x,w)=>{y!=null&&y(x.record)||v.push(w)}),_(p,i,v)}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function zt(e){const l=b(()=>e.value.filter(s=>s.sortable)),t=b(()=>l.value.some(s=>s.sortable.multiple!==void 0)),n=he({}),o=O([]);return D(l,(s,r)=>{s.forEach(c=>{const{key:u,sortable:i}=c,d=i.orderBy;if(d||n[u]===void 0){n[u]=d;return}const y=r?r.find(v=>v.key===u):void 0;(y==null?void 0:y.sortable.orderBy)&&(n[u]=void 0)}),o.value=Ce(s,n)},{immediate:!0}),{activeSorters:o,activeOrderByMap:n,handleSort:(s,r)=>{const{orders:c,onChange:u}=r,i=n[s],d=i?Se(c,i):Se(c);t.value?n[s]=d:Object.keys(n).forEach(y=>{s===y?n[y]=d:n[y]=void 0}),o.value=Ce(l.value,n),_(u,d,o.value)}}}function Se(e,l){return l?e[e.indexOf(l)+1]:e[0]}function Ce(e,l){return e.map(t=>{const{key:n,sortable:o}=t,{multiple:a=0,orderBy:s=l[n],sorter:r}=o;return{key:n,multiple:a,orderBy:s,sorter:r}}).filter(t=>t.orderBy).sort((t,n)=>n.multiple-t.multiple)}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Dt(e){const l=b(()=>!!e.sticky),t=b(()=>{const{sticky:a}=e,{offsetTop:s=0,offsetBottom:r=0,offsetScroll:c=0,container:u=window}=vt(a)?a:{};return{offsetTop:s,offsetBottom:r,offsetScroll:c,container:u}}),[n,o]=oe(0);return{isSticky:l,mergedSticky:t,stickyScrollLeft:n,setStickyScrollLeft:o}}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function Lt(e,{hasEllipsis:l,hasFixed:t},{scrollWidth:n,scrollHeight:o},a,s){return b(()=>e.tableLayout?e.tableLayout:n.value&&t.value?n.value==="max-content"?"auto":"fixed":o.value||s.value||a.value||l.value||e.virtual?"fixed":"auto")}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const M=Symbol("TABLE_TOKEN"),pe=Symbol("tableBodyToken"),ne=A({props:{isFixedHolder:Boolean},setup(e){const{flattedColumns:l,flattedColumnsWithScrollBar:t,columnWidthsWithScrollBar:n,mergedSelectableMenus:o,mergedPrefixCls:a}=H(M);return()=>{const{isFixedHolder:s}=e,r=s?t.value:l.value;if(r.every(i=>!i.width&&!i.type))return;const c=a.value,u=r.map((i,d)=>{const{key:y,type:p}=i,v=s?n.value[d]:i.width,x=p?V({[`${c}-col-${p}`]:!0,[`${c}-col-with-dropdown`]:p==="selectable"&&o.value.length>0}):void 0;let w;return s?w=v?`width: ${z(v)}`:void 0:w={width:z(v),minWidth:z(i.minWidth),maxWidth:z(i.maxWidth)},m("col",{key:y,class:x,style:w},null)});return m("colgroup",null,[u])}}}),jt=A({props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0}},setup(e,{slots:l}){const{mergedPrefixCls:t,scrollHeadRef:n,handleScroll:o,scrollWidth:a,flattedData:s,isSticky:r,columnWidths:c}=H(M);Ut(n,o);const u=b(()=>a.value==="max-content"),i=b(()=>s.value.length>0),d=b(()=>{const v=t.value;return{[`${v}-fixed-holder`]:!0,[`${v}-sticky-holder`]:r.value}}),y=b(()=>{const v=r.value,{offsetTop:x,offsetBottom:w}=e;return{overflow:"hidden",top:v?z(x):void 0,bottom:v?z(w):void 0}}),p=b(()=>({tableLayout:"fixed",visibility:i.value&&!c.value.length?"hidden":void 0}));return()=>m("div",{class:d.value,style:y.value,ref:n},[m("table",{style:p.value},[(i.value||!u.value)&&m(ne,{isFixedHolder:!0},null),l.default&&l.default()])])}});function Ut(e,l){const t=n=>{const o=n.deltaX,a=n.currentTarget;if(o){const s=a.scrollLeft+o;l(n,s),n.preventDefault()}};se(()=>ee(e.value,"wheel",t,{passive:!0})),J(()=>G(e.value,"wheel",t))}const qt=A({setup(){const{mergedPrefixCls:e,scrollBodyRef:l,handleScroll:t,mergedSticky:n,stickyScrollLeft:o,setStickyScrollLeft:a}=H(M),s=O(!1),r=O(!1),c=O(0),u=O(0),i=O(0),d=b(()=>{const f=u.value,h=i.value;return h&&f*(f/h)});Ie(()=>{const f=X(l);if(f&&s.value){const{clientWidth:h,scrollWidth:g,scrollLeft:S}=f;a(S/g*h),u.value=h,i.value=g}});const y=b(()=>({height:ce(),width:u.value,bottom:n.value.offsetScroll})),p=b(()=>{const f=e.value;return{[`${f}-sticky-scrollbar-thumb`]:!0,[`${f}-sticky-scrollbar-thumb-active`]:r.value}}),v=b(()=>({width:`${d.value}px`,transform:`translate3d(${o.value}px, 0, 0)`})),x=()=>r.value=!1,w=f=>{c.value=f.pageX-o.value,r.value=!0,f.preventDefault()},C=f=>{if(!r.value)return;const{buttons:h}=f||window.event;if(h===0){r.value=!1;return}let g=f.pageX-c.value;g<=0&&(g=0);const S=u.value,E=i.value,K=d.value;g+K>=S&&(g=S-K);const B=g/S*(E+2);t(f,B)},k=()=>{const f=X(l),h=ge(f).top,g=h+f.offsetHeight,{container:S,offsetScroll:E}=n.value,K=S===window?document.documentElement.scrollTop+window.innerHeight:ge(S).top+S.clientHeight;g-ce()<=K||h>=K-E?s.value=!1:s.value=!0};return se(()=>{ee(document.body,"mouseup",x),ee(document.body,"mousemove",C),ee(window,"resize",k),D(()=>n.value.container,(f,h)=>{G(h,"scroll",k),ee(f,"scroll",k)},{immediate:!0}),k()}),J(()=>{G(document.body,"mouseup",x),G(document.body,"mousemove",C),G(window,"resize",k),G(n.value.container,"scroll",k)}),()=>!l.value||!s.value||i.value<=u.value||!d.value?null:m("div",{class:`${e.value}-sticky-scrollbar`,style:y.value},[m("div",{class:p.value,style:v.value,onMousedown:w},null)])}}),de=A({props:{isEmpty:Boolean},setup(e,{slots:l}){const{mergedPrefixCls:t,flattedColumns:n,hasFixed:o,scrollWidth:a,scrollBarColumn:s}=H(M),{mainTableWidth:r}=H(pe),c=b(()=>n.value.length);return()=>{let u=l.default();if(e.isEmpty?a.value:o.value){const i=s.value;u=m("div",{class:`${t.value}-fixed-row`,style:{width:z(r.value-(i?i.width:0)),position:"sticky",left:0,overflow:"hidden"}},[u])}return m("tr",null,[m("td",{colSpan:c.value},[u])])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Xt={expandedRowKeys:{type:Array,default:void 0},selectedRowKeys:{type:Array,default:void 0},autoHeight:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},childrenKey:{type:String,default:void 0},columns:{type:Array,default:()=>[]},customAdditional:{type:Object,default:void 0},customTag:{type:Object,default:void 0},dataSource:{type:Array,default:()=>[]},ellipsis:{type:[Boolean,Object],default:!1},empty:{type:[String,Object],default:"default"},emptyCell:{type:[String,Function],default:void 0},getKey:{type:[String,Function],default:void 0},header:{type:[String,Object],default:void 0},headless:{type:Boolean,default:void 0},pagination:{type:[Boolean,Object],default:!0},scroll:{type:Object,default:void 0},size:{type:String,default:void 0},spin:{type:[Boolean,Object],default:void 0},sticky:{type:[Boolean,Object],default:void 0},scrollToTopOnChange:{type:Boolean,default:void 0},tableLayout:{type:String,default:void 0},virtual:{type:Boolean,default:!1},virtualItemHeight:{type:Number,default:void 0},"onUpdate:expandedRowKeys":[Function,Array],"onUpdate:selectedRowKeys":[Function,Array],onScroll:[Function,Array],onScrolledChange:[Function,Array],onScrolledBottom:[Function,Array]},Vt={columns:{type:Array,required:!0}},Gt={column:{type:Object,required:!0}},Yt={expanded:{type:Boolean,default:void 0},rowIndex:{type:Number,required:!0},level:{type:Number,default:void 0},record:{type:Object,required:!0},rowData:{type:Object,required:!0},rowKey:{type:[String,Number,Symbol],required:!0}},Qt={column:{type:Object,required:!0},colIndex:{type:Number,required:!0},level:{type:Number,default:void 0},record:{type:Object,required:!0},rowIndex:{type:Number,required:!0},disabled:{type:Boolean,default:void 0},expanded:{type:Boolean,default:void 0},handleExpend:{type:Function,default:void 0},isHover:{type:Boolean,default:void 0},selected:{type:Boolean,default:void 0},indeterminate:{type:Boolean,default:void 0},handleSelect:{type:Function,default:void 0}},Jt={cellKey:{type:[String,Number,Symbol],required:!0},changeColumnWidth:{type:Function,required:!0}},Zt={activeFilterBy:{type:Array,required:!0},filterable:{type:Object,required:!0},onUpdateFilterBy:{type:Function,required:!0}},el={activeOrderBy:{type:String,default:void 0},sortable:{type:Object,required:!0}},tl=A({props:Jt,setup(e){const l=O();return ie(l,n=>{const{offsetWidth:o}=n.target;e.changeColumnWidth(e.cellKey,o)}),J(()=>{e.changeColumnWidth(e.cellKey,!1)}),()=>m("td",{ref:l,style:{padding:0,border:0,height:0}},[m("div",{style:{height:0,overflow:"hidden"}},[ht(" ")])])}}),ll=A({setup(){const{mergedPrefixCls:e,flattedColumns:l}=H(M),{changeColumnWidth:t}=H(pe);return()=>{const n=l.value.map(o=>{const{key:a}=o;return m(tl,{key:a,cellKey:a,changeColumnWidth:t},null)});return m("tr",{class:`${e.value}-measure-row`,style:{fontSize:0,height:0},"aria-hidden":!0},[n])}}}),nl=A({props:Qt,setup(e){const{props:l,slots:t,config:n,mergedPrefixCls:o,mergedEmptyCell:a,activeOrderByMap:s,fixedColumnKeys:r,columnOffsets:c,isSticky:u,expandable:i,selectable:d,mergedPagination:y}=H(M),p=b(()=>s[e.column.key]),v=ol(e),x=b(()=>r.value.lastStartKey===e.column.key),w=b(()=>r.value.firstEndKey===e.column.key),C=b(()=>{const{type:h,ellipsis:g}=e.column;return h||g!=null?g:l.ellipsis}),k=b(()=>{const{fixed:h,align:g}=e.column,S=o.value;let E={[`${S}-cell`]:!0,[`${S}-cell-sorted`]:!!p.value,[`${S}-cell-align-${g}`]:!!g&&g!="start",[`${S}-cell-ellipsis`]:!!C.value};return h&&(E={...E,[`${S}-fix-start`]:h==="start",[`${S}-fix-start-last`]:x.value,[`${S}-fix-end`]:h==="end",[`${S}-fix-end-first`]:w.value,[`${S}-fix-sticky`]:u.value}),V(E)}),f=b(()=>{const{fixed:h}=e.column;if(!h)return;const{starts:g,ends:S}=c.value,K=z((h==="start"?g:S)[e.colIndex]);return{position:"sticky",left:h==="start"?K:void 0,right:h==="end"?K:void 0}});return()=>{var R,P,T;const{column:h}=e,{type:g}=h;let S,E;if(g==="selectable")S=rl(e,t,d,n,y);else if(g==="indexable")S=Xe(e,t,h,y);else{const $=v.value;if(S=sl(e,t,$),E=Pe(C.value,S,$),!g&&(Y(S)||S==="")){const I=t.emptyCell||a.value;S=Q(I)?I({column:h,record:e.record,rowIndex:e.rowIndex}):I}}e.column.fixed&&C.value&&(x.value||w.value)&&(S=m("span",{class:`${o.value}-cell-content`},[S]));const K=(R=l.customAdditional)==null?void 0:R.bodyCell,B=K?K({column:h,record:e.record,rowIndex:e.rowIndex}):void 0,W=(T=(P=l.customTag)==null?void 0:P.bodyCell)!=null?T:"td";return m(W,Z({class:k.value,style:f.value,title:E},B),{default:()=>[g==="expandable"&&al(e,t,i,o.value),g==="expandable"&&!Ze(S)&&m("span",{class:`${o.value}-expandable-trigger-gap`},null),S]})}}});function ol(e){return b(()=>{const{column:l,record:t}=e,n=fe(l.dataKey);if(n.length<=0)return;let o=t;for(let a=0;a<n.length&&o;a++){const s=n[a];o=o[s]}return o})}function sl(e,l,t){const{record:n,rowIndex:o,column:a}=e,{customCell:s}=a,r=L(s)?l[s]:s;return r?r({value:t,record:n,rowIndex:o}):t}function al(e,l,t,n){var y;const{icon:o,customIcon:a,indent:s}=t.value,{record:r,expanded:c,level:u=0}=e,i=s?`margin-left: ${z(u*s)}`:void 0;let d;if(!e.disabled){const p=(y=L(a)?l[a]:a)!=null?y:o;Q(p)?d=p({expanded:!!c,record:r}):d=L(p)?m(te,{name:p,rotate:c?90:0},null):p}return m("button",{class:`${n}-expandable-trigger`,style:i,type:"button",onClick:e.handleExpend},[d])}function rl(e,l,t,n,o){const{selected:a,indeterminate:s,disabled:r,isHover:c,handleSelect:u}=e,{showIndex:i,multiple:d,customCell:y}=t.value,p=x=>{x.stopPropagation(),!d&&a&&!r&&u&&u()};if(!a&&!c&&i)return Xe(e,l,n.columnIndexable,o);const v=L(y)?l[y]:y;if(d){const x={checked:a,disabled:r,indeterminate:s,onChange:u,onClick:p};return v?v(x):m(ve,x,null)}else{const x={checked:a,disabled:r,onChange:u,onClick:p};return v?v(x):m(Re,x,null)}}function Xe(e,l,t,n){const{record:o,rowIndex:a,disabled:s}=e,{customCell:r}=t,{pageIndex:c=1,pageSize:u=0}=n.value||{},i=L(r)?l[r]:r;return i?m("span",{style:s?"cursor: not-allowed":"cursor: pointer"},[i({record:o,rowIndex:a,pageIndex:c,pageSize:u})]):void 0}const cl=A({props:Yt,setup(e){const{props:l,mergedPrefixCls:t,flattedColumns:n,expandable:o,handleExpandChange:a,checkExpandDisabled:s,selectable:r,selectedRowKeys:c,indeterminateRowKeys:u,handleSelectChange:i,currentPageRowKeys:d}=H(M),{expandDisabled:y,handleExpend:p,selectDisabled:v,handleSelect:x,isHover:w,attrs:C}=il(e,o,s,a,r,i,d),k=b(()=>c.value.includes(e.rowKey)),f=b(()=>u.value.includes(e.rowKey)),h=b(()=>{const g=`${t.value}-row`,{level:S,expanded:E}=e;return V({[`${g}`]:!0,[`${g}-level-${S}`]:!!S,[`${g}-selected`]:k.value,[`${g}-expanded`]:E})});return()=>{var K,B,W;const g=(K=l.customAdditional)==null?void 0:K.bodyRow,S=g?g({record:e.record,rowIndex:e.rowIndex}):void 0,E=(W=(B=l.customTag)==null?void 0:B.bodyRow)!=null?W:"tr";return m(E,Z({class:h.value},C.value,S),{default:()=>[ul(e,n,y,p,k,f,v,x,w)]})}}});function il(e,l,t,n,o,a,s){const r=b(()=>t(e.rowData)),c=b(()=>{var h;return(h=l.value)==null?void 0:h.trigger}),u=()=>{const{rowKey:h,record:g}=e;n(h,g)},i=b(()=>s.value.disabledRowKeys.includes(e.rowKey)),d=b(()=>{var h;return(h=o.value)==null?void 0:h.trigger}),y=b(()=>{var h;return(h=o.value)==null?void 0:h.showIndex}),p=O(!1),v=()=>{const{rowKey:h,record:g}=e;a(h,g)},x=()=>{c.value==="click"&&u(),d.value==="click"&&v()},w=()=>{c.value==="dblclick"&&u(),d.value==="dblclick"&&v()},C=()=>p.value=!0,k=()=>p.value=!1,f=b(()=>{const h=r.value,g=c.value,S=i.value,E=d.value,K=!h&&g==="click"||!S&&E==="click",B=!h&&g==="dblclick"||!S&&E==="dblclick",W=!S&&y.value;let R="";return K||B?R="pointer":(h&&g||S&&E)&&(R="not-allowed"),{style:R?`cursor: ${R}`:void 0,onClick:K?x:void 0,onDblclick:B?w:void 0,onMouseenter:W?C:void 0,onMouseleave:W?k:void 0}});return{expandDisabled:r,handleExpend:u,selectDisabled:i,handleSelect:v,isHover:p,attrs:f}}function ul(e,l,t,n,o,a,s,r,c){const u=[],{rowIndex:i,record:d,level:y}=e;return l.value.forEach((p,v)=>{const{type:x,colSpan:w,rowSpan:C,key:k}=p,f=w==null?void 0:w(d,i),h=C==null?void 0:C(d,i);if(f===0||h===0)return;const g={colSpan:f===1?void 0:f,rowSpan:h===1?void 0:h,rowIndex:i,colIndex:v,record:d,column:p,level:y,key:k};x==="expandable"?(g.expanded=e.expanded,g.disabled=t.value,g.handleExpend=n):x==="selectable"&&(g.selected=o.value,g.indeterminate=a.value,g.disabled=s.value,g.handleSelect=r,g.isHover=c.value),u.push(m(nl,g,null))}),u}function Ve(e,l,t,n,o){const{expanded:a,level:s,record:r,rowKey:c}=e,u={key:c,expanded:a,level:s,record:r,rowData:e,rowIndex:l,rowKey:c},i=m(cl,u,null),d=a&&dl(u,t,n,o);return d?[i,d]:i}function dl(e,l,t,n){const{customExpand:o}=t||{},{record:a,rowIndex:s}=e;let r;return Q(o)?r=o({record:a,rowIndex:s}):L(o)&&l[o]&&(r=l[o]({record:a,rowIndex:s})),r&&m(de,{class:`${n}-expanded-row`},{default:()=>[r]})}const re=A({setup(e,{slots:l}){const{props:t,slots:n,mergedPrefixCls:o,mergedAutoHeight:a,flattedData:s,expandable:r,scrollWidth:c,scrollHeight:u,isSticky:i}=H(M),d=b(()=>a.value||c.value||u.value||i.value);return()=>{const y=o.value,p=[];n.alert&&p.push(m(de,{class:`${y}-alert-row`},{default:()=>[n.alert()]}));const v=s.value;return v.length>0?l.default?p.push(...l.default()):v.forEach((x,w)=>{p.push(...fe(Ve(x,w,n,r.value,y)))}):p.push(m(de,{class:`${y}-empty-row`,isEmpty:!0},{default:()=>[m(et,{empty:t.empty},n)]})),m("tbody",{class:`${o.value}-tbody`},[d.value&&m(ll,null,null),p])}}}),fl=A({props:Zt,setup(e){const{slots:l,config:t,locale:n,mergedPrefixCls:o}=H(M),a=b(()=>{var f;return(f=e.filterable.multiple)!=null?f:t.columnBase.filterable.multiple}),s=b(()=>{var f;return(f=e.filterable.footer)!=null?f:t.columnBase.filterable.footer}),r=e.activeFilterBy,[c,u]=oe(()=>r);D(()=>e.activeFilterBy,f=>u(f));const[i,d]=oe(!1),y=f=>{d(f),f||e.onUpdateFilterBy(c.value)},p=()=>{d(!1),e.onUpdateFilterBy(c.value)},v=()=>{u(r)},x=f=>{const h=`${o.value}-filterable-menu-label`,g=a.value?ve:Re;return m("span",{class:h},[m(g,{checked:f.selected,disabled:f.disabled},null),m("span",{class:`${h}-content`},[f.label])])},w=()=>{const f=[],{customMenu:h,menus:g}=e.filterable;return Q(h)?f.push(h({selectedKeys:c.value,setSelectedKeys:u})):L(h)&&l[h]?f.push(l[h]({selectedKeys:c.value,setSelectedKeys:u})):f.push(vl(g,a,c,u,x)),s.value&&f.push(hl(n,o,p,v)),f},C=b(()=>{const f=`${o.value}-filterable-trigger`;return V({[f]:!0,[`${f}-active`]:e.activeFilterBy.length>0})}),k=()=>{const{customTrigger:f}=e.filterable;return Q(f)?f():L(f)&&l[f]?l[f]():m("span",{class:C.value,onClick:h=>h.stopPropagation()},[m(te,{name:"filter-filled"},null)])};return()=>{const f={visible:i.value,hideOnClick:!s.value,placement:"bottomEnd",trigger:"click","onUpdate:visible":y};return m(Ke,f,{default:k,overlay:w})}}}),vl=(e,l,t,n,o)=>{const a={dataSource:e,multiple:l.value,selectable:!0,selectedKeys:t.value,"onUpdate:selectedKeys":n};return m(Ee,a,{itemLabel:o})},hl=(e,l,t,n)=>{const{filterConfirm:o,filterReset:a}=e.table;return m("div",{class:`${l.value}-filterable-trigger-footer`},[m(me,{mode:"primary",size:"xs",onClick:t},{default:()=>[o]}),m(me,{size:"xs",onClick:n},{default:()=>[a]})])},yl=A({setup(){const{mergedPrefixCls:e,paginatedMap:l,selectable:t,currentPageRowKeys:n,currentPageAllSelected:o,currentPageSomeSelected:a,handleHeadSelectChange:s,mergedSelectableMenus:r,handleSelectableMenuClick:c}=H(M),u=b(()=>{const w=l.value.size;return w===0||w===n.value.disabledRowKeys.length}),[i,d]=oe(!1),y={"onUpdate:visible":d,trigger:"click"},p=()=>m(Ee,{dataSource:r.value,onClick:c},null),v=()=>m(te,{class:`${e.value}-selectable-trigger`,name:"down",rotate:i.value?180:0},null),x=()=>{if(r.value.length!==0)return m(Ke,y,{default:v,overlay:p})};return()=>{const{multiple:w}=t.value;if(w)return m("span",{class:`${e.value}-cell-triggers`},[m(ve,{checked:o.value,indeterminate:a.value,disabled:u.value,onChange:s},null),x()])}}}),pl=A({props:el,setup(e){const{locale:l,mergedPrefixCls:t}=H(M);return()=>{const{activeOrderBy:n,sortable:o}=e,{orders:a,nextTooltip:s}=o,r=s&&gl(l.table,a,n),c=ml(t,a,n);return r?m(tt,{title:r},{default:()=>[c]}):c}}});function gl(e,l,t){const n=t?l[l.indexOf(t)+1]:l[0],{sortCancel:o,sortAsc:a,sortDesc:s}=e;return n?n==="ascend"?a:s:o}function ml(e,l,t){const n=e.value,o=`${n}-sortable-trigger-active`,a=l.includes("ascend")&&m(te,{name:"caret-up-filled",class:t==="ascend"?o:void 0},null),s=l.includes("descend")&&m(te,{name:"caret-down-filled",class:t==="descend"?o:void 0},null);return m("span",{class:`${n}-sortable-trigger`},[a,s])}const bl=A({props:Gt,setup(e){const{props:l,slots:t,mergedPrefixCls:n,fixedColumnKeys:o,columnOffsetsWithScrollBar:a,isSticky:s,handleSort:r,activeOrderByMap:c,activeFilterByMap:u,handleFilter:i}=H(M),d=b(()=>{const{type:k,ellipsis:f}=e.column,h=k||f!=null?f:l.ellipsis;return $e(h)&&h.head===!1?void 0:h}),y=b(()=>{const{type:k,align:f,fixed:h,hasChildren:g,key:S,sortable:E,filterable:K}=e.column,B=n.value;let W={[`${B}-cell`]:!0,[`${B}-cell-${k}`]:!!k,[`${B}-cell-filterable`]:!!K,[`${B}-cell-sortable`]:!!E,[`${B}-cell-align-center`]:g||f==="center",[`${B}-cell-align-end`]:!g&&f==="end",[`${B}-cell-ellipsis`]:!!d.value};if(h){const{lastStartKey:R,firstEndKey:P}=o.value;W={...W,[`${B}-fix-start`]:h==="start",[`${B}-fix-start-last`]:R===S,[`${B}-fix-end`]:h==="end",[`${B}-fix-end-first`]:P===S,[`${B}-fix-sticky`]:s.value}}return V(W)}),p=b(()=>{const{fixed:k,colStart:f,colEnd:h}=e.column;if(!k)return;const{starts:g,ends:S}=a.value,B=z((k==="start"?g:S)[k==="start"?f:h]);return{position:"sticky",left:k==="start"?B:void 0,right:k==="end"?B:void 0}}),v=b(()=>c[e.column.key]),x=b(()=>u[e.column.key]||lt),w=k=>{const{key:f,filterable:h}=e.column;i(f,h,k)},C=()=>{const{key:k,sortable:f}=e.column;f&&r(k,f)};return()=>{var P,T,$;const{column:k}=e,{type:f,titleColSpan:h,titleRowSpan:g}=k;if(f==="scroll-bar")return m("th",{class:y.value,style:p.value,colspan:h===1?void 0:h,rowspan:g===1?void 0:g,onClick:C},null);const S=n.value;let E,K;if(f==="selectable")K=m(yl,null,null);else{const{title:I,customTitle:F,sortable:U,filterable:q}=k,j=d.value;K=xl(I,F,t),E=Pe(j,K,I);const N=Sl(U,v,q,x,w);N.length>0?K=m("span",{class:`${S}-cell-triggers`},[m("span",{class:`${S}-cell-title`},[K]),N]):j&&(K=m("span",{class:`${S}-cell-title`},[K]))}const B=(P=l.customAdditional)==null?void 0:P.headCell,W=B?B({column:k}):void 0,R=($=(T=l.customTag)==null?void 0:T.headCell)!=null?$:"th";return m(R,Z({class:y.value,style:p.value,colSpan:h===1?void 0:h,rowSpan:g===1?void 0:g,title:E},W,{onClick:C}),{default:()=>[K]})}}});function xl(e,l,t){let n=e;return Q(l)?n=l({title:e}):L(l)&&t[l]&&(n=t[l]({title:e})),n}function Sl(e,l,t,n,o){const a=[];return e&&a.push(m(pl,{activeOrderBy:l.value,sortable:e},null)),t&&a.push(m(fl,{activeFilterBy:n.value,filterable:t,onUpdateFilterBy:o},null)),a}const Cl=A({props:Vt,setup(e){const{props:l,mergedPrefixCls:t}=H(M);return()=>{var r,c,u;const{columns:n}=e,o=(r=l.customAdditional)==null?void 0:r.headRow,a=o?o({columns:n}):void 0,s=(u=(c=l.customTag)==null?void 0:c.headRow)!=null?u:"tr";return m(s,Z({class:`${t.value}-row`},a),{default:()=>[n.filter(i=>i.titleColSpan!==0).map(i=>m(bl,{key:i.key,column:i},null))]})}}}),we=A({setup(){const{props:e,mergedRows:l,mergedPrefixCls:t}=H(M);return()=>{var r,c,u;const n=l.value,o=(r=e.customAdditional)==null?void 0:r.head,a=o?o({rows:n}):void 0,s=(u=(c=e.customTag)==null?void 0:c.head)!=null?u:"thead";return m(s,Z({class:`${t.value}-thead`},a),{default:()=>[n.map((i,d)=>m(Cl,{key:d,columns:i},null))]})}}}),wl=A({setup(){const{props:e,slots:l,expandable:t,mergedPrefixCls:n,mergedVirtualItemHeight:o,mergedAutoHeight:a,columnWidths:s,changeColumnWidth:r,flattedData:c,isSticky:u,mergedSticky:i,virtualScrollRef:d,scrollBodyRef:y,scrollContentRef:p,handleScroll:v,pingedStart:x,pingedEnd:w,scrollWidth:C,scrollHeight:k,hasFixed:f,tableLayout:h}=H(M),g=O(),S=O(0);Oe(pe,{mainTableWidth:S,changeColumnWidth:($,I)=>{at(g.value)&&r($,I)}});const K=()=>{const $=X(y);$&&v({currentTarget:$})},B=$=>{const{offsetWidth:I}=$.target;I!==S.value&&(S.value=I)};se(()=>{K(),D([()=>e.dataSource,C],([,I])=>{I&&K()}),D(s,Te(()=>{var F;((F=X(y))==null?void 0:F.scrollLeft)===0&&K()},16)),nt(g.value,B)}),J(()=>ot(g.value,B));const W=b(()=>{const $=n.value;return V({[`${$}-container`]:!0,[`${$}-ping-start`]:x.value,[`${$}-ping-end`]:w.value,[`${$}-fixed-layout`]:h.value==="fixed",[`${$}-fixed-column`]:f.value,[`${$}-scroll-horizontal`]:C.value,[`${$}-scroll-vertical`]:k.value})}),R=b(()=>{var j;const $=C.value,I=k.value,F=$?"auto":void 0,U=e.virtual?"hidden":I?"scroll":$?"hidden":void 0,q=(j=e.scroll)==null?void 0:j.fullHeight;return{overflowX:F,overflowY:U,[q?"height":"maxHeight"]:I}}),P=b(()=>({tableLayout:h.value,width:C.value,minWidth:C.value?"100%":void 0})),T=($,I,F)=>{_(e.onScrolledChange,$,I,F.map(U=>U.record))};return()=>{const $=n.value,I=a.value,F=l.default?l.default():[];if(I||k.value||u.value){const{offsetTop:U}=i.value;if(e.headless||F.push(m(jt,{offsetTop:U},{default:()=>[m(we,null,null)]})),e.virtual&&(e.scroll||I)){const q=({item:ae,index:Ye})=>Ve(ae,Ye,l,t.value,$),j=ae=>m("table",{ref:p,class:`${$}-table`,style:P.value},[m(ne,null,null),m(re,null,{default:()=>[ae]}),!1]),{scroll:N,onScrolledBottom:Ge}=e;F.push(m(st,{ref:d,style:R.value,dataSource:c.value,fullHeight:N==null?void 0:N.fullHeight,getKey:"rowKey",height:a.value?"100%":N==null?void 0:N.height,itemHeight:o.value,itemRender:q,contentRender:j,virtual:!0,onScroll:v,onScrolledBottom:Ge,onScrolledChange:T},null))}else F.push(m("div",{ref:y,class:`${$}-content`,style:R.value,onScroll:v},[m("table",{ref:p,class:`${$}-table`,style:P.value},[m(ne,null,null),m(re,null,null),!1])]));u.value&&F.push(m(qt,null,null))}else F.push(m("div",{ref:y,class:`${$}-content`,style:R.value,onScroll:v},[m("table",{ref:p,class:`${$}-table`,style:P.value},[m(ne,null,null),!e.headless&&m(we,null,null),m(re,null,null),!1])]));return m("div",{ref:g,class:W.value},[F])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */function kl(e,l){return e.footer?m("div",{class:`${l}-footer`},[e.footer()]):null}function Bl(e,l,t){let n=null,o=null;if(e!==null){const{position:a}=e,[s,r]=yt(a).split("-"),c=`${t}-pagination ${t}-pagination-${r}`,u=m(gt,Z({class:c,total:l.length},e),null);n=s==="top"?u:null,o=s==="bottom"?u:null}return[n,o]}const Kl={sm:32,md:40,lg:56},El={sm:40,md:48,lg:56},$l=A({name:"IxTable",props:Xt,setup(e,{expose:l,slots:t}){const n=le("common"),o=b(()=>`${n.prefixCls}-table`),a=le("locale"),s=le("table"),r=b(()=>{var T;return(T=e.autoHeight)!=null?T:s.autoHeight}),c=b(()=>{var T;return(T=e.childrenKey)!=null?T:s.childrenKey}),u=rt(e,s),i=b(()=>{var T;return(T=e.emptyCell)!=null?T:s.emptyCell}),d=b(()=>{var T;return(T=e.size)!=null?T:s.size}),y=b(()=>{var T;return(T=e.virtualItemHeight)!=null?T:n.theme==="seer"?Kl[d.value]:El[d.value]}),{mergedPagination:p}=Tt(e,s,d),v=Dt(e),x=It(e,r,v),w=bt(e,t,s,x.scrollBarSizeOnFixedHolder),C=zt(w.flattedColumns),k=$t(w.flattedColumns),f=Et(e,w.flattedColumns),h=Lt(e,w,x,v.isSticky,r),{activeSorters:g}=C,{activeFilters:S}=k,E=Kt(e,c,u,g,S,f.expandedRowKeys,p),K=Ht(e,a,w.flattedColumns,E);Wt(e,s,p,g,S,x.scrollTo);const B={props:e,slots:t,config:s,locale:a,mergedPrefixCls:o,mergedEmptyCell:i,mergedVirtualItemHeight:y,mergedAutoHeight:r,...w,...x,...C,...k,...v,tableLayout:h,mergedPagination:p,...f,...E,...K};Oe(M,B),l({scrollTo:x.scrollTo});const{flattedData:W,filteredData:R}=E,P=b(()=>{const T=o.value,{borderless:$=s.borderless,scroll:I}=e;return V({[T]:!0,[`${T}-auto-height`]:r.value,[`${T}-borderless`]:$,[`${T}-empty`]:W.value.length===0,[`${T}-full-height`]:I==null?void 0:I.fullHeight,[`${T}-${d.value}`]:!0})});return()=>{const T=o.value,$=m(ct,{header:e.header},t),I=kl(t,T),[F,U]=Bl(p.value,R.value,T),q=[$],j=[F,m(wl,null,null),I,U].filter(Boolean),N=Tl(e.spin);return N?q.push(m(it,N,{default:()=>[j]})):q.push(...j),m("div",{class:P.value},[q])}}});function Tl(e){return pt(e)?{spinning:e}:e}/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const Pl=$l,Fl=ye;export{Pl as I,Fl as a,mt as g,Xt as t};
